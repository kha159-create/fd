import{r as V,a as Ti,c as zt,g as Ni,R as Dn}from"./vendor-DJ1oPbzn.js";import{g as mo,i as po,a as ho,b as go,c as Ci,d as Ei,e as wi,s as xo,f as yo}from"./firebase-B0X-WtUt.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const d of l.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&s(d)}).observe(document,{childList:!0,subtree:!0});function n(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(r){if(r.ep)return;r.ep=!0;const l=n(r);fetch(r.href,l)}})();var vo={exports:{}},an={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _i=V,Ai=Symbol.for("react.element"),Si=Symbol.for("react.fragment"),Ii=Object.prototype.hasOwnProperty,Ri=_i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Pi={key:!0,ref:!0,__self:!0,__source:!0};function bo(t,e,n){var s,r={},l=null,d=null;n!==void 0&&(l=""+n),e.key!==void 0&&(l=""+e.key),e.ref!==void 0&&(d=e.ref);for(s in e)Ii.call(e,s)&&!Pi.hasOwnProperty(s)&&(r[s]=e[s]);if(t&&t.defaultProps)for(s in e=t.defaultProps,e)r[s]===void 0&&(r[s]=e[s]);return{$$typeof:Ai,type:t,key:l,ref:d,props:r,_owner:Ri.current}}an.Fragment=Si;an.jsx=bo;an.jsxs=bo;vo.exports=an;var o=vo.exports,Tn={},Hn=Ti;Tn.createRoot=Hn.createRoot,Tn.hydrateRoot=Hn.hydrateRoot;const Kt=()=>({transactions:[],categories:[{id:"cat-1",name:"بقالة",icon:"🛒"},{id:"cat-2",name:"مطاعم",icon:"🍔"},{id:"cat-3",name:"وقود",icon:"⛽"},{id:"cat-4",name:"فواتير",icon:"🧾"},{id:"cat-9",name:"سداد فواتير",icon:"💳"},{id:"cat-5",name:"تسوق",icon:"🛍️"},{id:"cat-6",name:"إيجار",icon:"🏠"},{id:"cat-8",name:"صيدلية",icon:"💊"},{id:"cat-7",name:"أخرى",icon:"💸"}],installments:[],investments:{currentValue:0},cards:{"snb-card":{id:"snb-card",name:"SNB الأهلي",limit:26e3,dueDay:15,statementDay:25,smsSamples:["SNB","الأهلي","إئتمانية"]},"enbd-card":{id:"enbd-card",name:"ENBD الإمارات",limit:1e4,dueDay:18,statementDay:28,smsSamples:["ENBD","الإمارات","Visa card"]}},bankAccounts:{"bank-default":{id:"bank-default",name:"حساب البنك",balance:0,currency:"SAR",smsSamples:["مدى","mada","Alrajhi","الراجحي","Inma","الإنماء","بنك"]}},loans:{},debtsToMe:{},debtsFromMe:{},settings:{darkMode:!1,language:"ar",notifications:!0}});/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let Mi,ki;function Di(){return{geminiUrl:Mi,vertexUrl:ki}}function Li(t,e,n,s){var r,l;if(!(t!=null&&t.baseUrl)){const d=Di();return e?(r=d.vertexUrl)!==null&&r!==void 0?r:n:(l=d.geminiUrl)!==null&&l!==void 0?l:s}return t.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class We{}function Q(t,e){const n=/\{([^}]+)\}/g;return t.replace(n,(s,r)=>{if(Object.prototype.hasOwnProperty.call(e,r)){const l=e[r];return l!=null?String(l):""}else throw new Error(`Key '${r}' not found in valueMap.`)})}function a(t,e,n){for(let l=0;l<e.length-1;l++){const d=e[l];if(d.endsWith("[]")){const c=d.slice(0,-2);if(!(c in t))if(Array.isArray(n))t[c]=Array.from({length:n.length},()=>({}));else throw new Error(`Value must be a list given an array path ${d}`);if(Array.isArray(t[c])){const f=t[c];if(Array.isArray(n))for(let u=0;u<f.length;u++){const m=f[u];a(m,e.slice(l+1),n[u])}else for(const u of f)a(u,e.slice(l+1),n)}return}else if(d.endsWith("[0]")){const c=d.slice(0,-3);c in t||(t[c]=[{}]);const f=t[c];a(f[0],e.slice(l+1),n);return}(!t[d]||typeof t[d]!="object")&&(t[d]={}),t=t[d]}const s=e[e.length-1],r=t[s];if(r!==void 0){if(!n||typeof n=="object"&&Object.keys(n).length===0||n===r)return;if(typeof r=="object"&&typeof n=="object"&&r!==null&&n!==null)Object.assign(r,n);else throw new Error(`Cannot set value for an existing key. Key: ${s}`)}else s==="_self"&&typeof n=="object"&&n!==null&&!Array.isArray(n)?Object.assign(t,n):t[s]=n}function i(t,e,n=void 0){try{if(e.length===1&&e[0]==="_self")return t;for(let s=0;s<e.length;s++){if(typeof t!="object"||t===null)return n;const r=e[s];if(r.endsWith("[]")){const l=r.slice(0,-2);if(l in t){const d=t[l];return Array.isArray(d)?d.map(c=>i(c,e.slice(s+1),n)):n}else return n}else t=t[r]}return t}catch(s){if(s instanceof TypeError)return n;throw s}}function Fi(t,e){for(const[n,s]of Object.entries(e)){const r=n.split("."),l=s.split("."),d=new Set;let c=-1;for(let f=0;f<r.length;f++)if(r[f]==="*"){c=f;break}if(c!==-1&&l.length>c)for(let f=c;f<l.length;f++){const u=l[f];u!=="*"&&!u.endsWith("[]")&&!u.endsWith("[0]")&&d.add(u)}Nn(t,r,l,0,d)}}function Nn(t,e,n,s,r){if(s>=e.length||typeof t!="object"||t===null)return;const l=e[s];if(l.endsWith("[]")){const d=l.slice(0,-2),c=t;if(d in c&&Array.isArray(c[d]))for(const f of c[d])Nn(f,e,n,s+1,r)}else if(l==="*"){if(typeof t=="object"&&t!==null&&!Array.isArray(t)){const d=t,c=Object.keys(d).filter(u=>!u.startsWith("_")&&!r.has(u)),f={};for(const u of c)f[u]=d[u];for(const[u,m]of Object.entries(f)){const p=[];for(const h of n.slice(s))h==="*"?p.push(u):p.push(h);a(d,p,m)}for(const u of c)delete d[u]}}else{const d=t;l in d&&Nn(d[l],e,n,s+1,r)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Ln(t){if(typeof t!="string")throw new Error("fromImageBytes must be a string");return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Ui(t){const e={},n=i(t,["operationName"]);n!=null&&a(e,["operationName"],n);const s=i(t,["resourceName"]);return s!=null&&a(e,["_url","resourceName"],s),e}function ji(t){const e={},n=i(t,["name"]);n!=null&&a(e,["name"],n);const s=i(t,["metadata"]);s!=null&&a(e,["metadata"],s);const r=i(t,["done"]);r!=null&&a(e,["done"],r);const l=i(t,["error"]);l!=null&&a(e,["error"],l);const d=i(t,["response","generateVideoResponse"]);return d!=null&&a(e,["response"],Bi(d)),e}function Vi(t){const e={},n=i(t,["name"]);n!=null&&a(e,["name"],n);const s=i(t,["metadata"]);s!=null&&a(e,["metadata"],s);const r=i(t,["done"]);r!=null&&a(e,["done"],r);const l=i(t,["error"]);l!=null&&a(e,["error"],l);const d=i(t,["response"]);return d!=null&&a(e,["response"],qi(d)),e}function Bi(t){const e={},n=i(t,["generatedSamples"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(d=>$i(d))),a(e,["generatedVideos"],l)}const s=i(t,["raiMediaFilteredCount"]);s!=null&&a(e,["raiMediaFilteredCount"],s);const r=i(t,["raiMediaFilteredReasons"]);return r!=null&&a(e,["raiMediaFilteredReasons"],r),e}function qi(t){const e={},n=i(t,["videos"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(d=>Gi(d))),a(e,["generatedVideos"],l)}const s=i(t,["raiMediaFilteredCount"]);s!=null&&a(e,["raiMediaFilteredCount"],s);const r=i(t,["raiMediaFilteredReasons"]);return r!=null&&a(e,["raiMediaFilteredReasons"],r),e}function $i(t){const e={},n=i(t,["video"]);return n!=null&&a(e,["video"],Oi(n)),e}function Gi(t){const e={},n=i(t,["_self"]);return n!=null&&a(e,["video"],Yi(n)),e}function Hi(t){const e={},n=i(t,["operationName"]);return n!=null&&a(e,["_url","operationName"],n),e}function Ji(t){const e={},n=i(t,["operationName"]);return n!=null&&a(e,["_url","operationName"],n),e}function Oi(t){const e={},n=i(t,["uri"]);n!=null&&a(e,["uri"],n);const s=i(t,["encodedVideo"]);s!=null&&a(e,["videoBytes"],Ln(s));const r=i(t,["encoding"]);return r!=null&&a(e,["mimeType"],r),e}function Yi(t){const e={},n=i(t,["gcsUri"]);n!=null&&a(e,["uri"],n);const s=i(t,["bytesBase64Encoded"]);s!=null&&a(e,["videoBytes"],Ln(s));const r=i(t,["mimeType"]);return r!=null&&a(e,["mimeType"],r),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Jn;(function(t){t.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",t.OUTCOME_OK="OUTCOME_OK",t.OUTCOME_FAILED="OUTCOME_FAILED",t.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(Jn||(Jn={}));var On;(function(t){t.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",t.PYTHON="PYTHON"})(On||(On={}));var Ve;(function(t){t.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",t.STRING="STRING",t.NUMBER="NUMBER",t.INTEGER="INTEGER",t.BOOLEAN="BOOLEAN",t.ARRAY="ARRAY",t.OBJECT="OBJECT",t.NULL="NULL"})(Ve||(Ve={}));var Yn;(function(t){t.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",t.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",t.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",t.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",t.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",t.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",t.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",t.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",t.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT"})(Yn||(Yn={}));var Wn;(function(t){t.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",t.SEVERITY="SEVERITY",t.PROBABILITY="PROBABILITY"})(Wn||(Wn={}));var zn;(function(t){t.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE",t.OFF="OFF"})(zn||(zn={}));var Kn;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(Kn||(Kn={}));var Xn;(function(t){t.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",t.NO_AUTH="NO_AUTH",t.API_KEY_AUTH="API_KEY_AUTH",t.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",t.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",t.OAUTH="OAUTH",t.OIDC_AUTH="OIDC_AUTH"})(Xn||(Xn={}));var Qn;(function(t){t.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",t.SIMPLE_SEARCH="SIMPLE_SEARCH",t.ELASTIC_SEARCH="ELASTIC_SEARCH"})(Qn||(Qn={}));var Zn;(function(t){t.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",t.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",t.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",t.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",t.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(Zn||(Zn={}));var es;(function(t){t.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",t.STOP="STOP",t.MAX_TOKENS="MAX_TOKENS",t.SAFETY="SAFETY",t.RECITATION="RECITATION",t.LANGUAGE="LANGUAGE",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.SPII="SPII",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.IMAGE_SAFETY="IMAGE_SAFETY",t.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",t.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",t.NO_IMAGE="NO_IMAGE"})(es||(es={}));var ts;(function(t){t.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",t.NEGLIGIBLE="NEGLIGIBLE",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH"})(ts||(ts={}));var ns;(function(t){t.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",t.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",t.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",t.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",t.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(ns||(ns={}));var ss;(function(t){t.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",t.SAFETY="SAFETY",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.IMAGE_SAFETY="IMAGE_SAFETY"})(ss||(ss={}));var os;(function(t){t.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",t.ON_DEMAND="ON_DEMAND",t.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(os||(os={}));var nn;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.AUDIO="AUDIO"})(nn||(nn={}));var is;(function(t){t.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",t.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",t.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",t.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(is||(is={}));var Cn;(function(t){t.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",t.JOB_STATE_QUEUED="JOB_STATE_QUEUED",t.JOB_STATE_PENDING="JOB_STATE_PENDING",t.JOB_STATE_RUNNING="JOB_STATE_RUNNING",t.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",t.JOB_STATE_FAILED="JOB_STATE_FAILED",t.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",t.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",t.JOB_STATE_PAUSED="JOB_STATE_PAUSED",t.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",t.JOB_STATE_UPDATING="JOB_STATE_UPDATING",t.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(Cn||(Cn={}));var rs;(function(t){t.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",t.TUNING_MODE_FULL="TUNING_MODE_FULL",t.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(rs||(rs={}));var as;(function(t){t.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",t.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",t.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",t.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",t.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",t.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",t.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(as||(as={}));var ls;(function(t){t.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",t.TUNING_TASK_I2V="TUNING_TASK_I2V",t.TUNING_TASK_T2V="TUNING_TASK_T2V"})(ls||(ls={}));var ds;(function(t){t.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",t.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",t.BALANCED="BALANCED",t.PRIORITIZE_COST="PRIORITIZE_COST"})(ds||(ds={}));var cs;(function(t){t.UNSPECIFIED="UNSPECIFIED",t.BLOCKING="BLOCKING",t.NON_BLOCKING="NON_BLOCKING"})(cs||(cs={}));var us;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(us||(us={}));var fs;(function(t){t.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",t.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(fs||(fs={}));var ms;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.AUTO="AUTO",t.ANY="ANY",t.NONE="NONE",t.VALIDATED="VALIDATED"})(ms||(ms={}));var ps;(function(t){t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE"})(ps||(ps={}));var hs;(function(t){t.DONT_ALLOW="DONT_ALLOW",t.ALLOW_ADULT="ALLOW_ADULT",t.ALLOW_ALL="ALLOW_ALL"})(hs||(hs={}));var gs;(function(t){t.auto="auto",t.en="en",t.ja="ja",t.ko="ko",t.hi="hi",t.zh="zh",t.pt="pt",t.es="es"})(gs||(gs={}));var xs;(function(t){t.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",t.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",t.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",t.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",t.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(xs||(xs={}));var ys;(function(t){t.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",t.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",t.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",t.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(ys||(ys={}));var vs;(function(t){t.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",t.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",t.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",t.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(vs||(vs={}));var bs;(function(t){t.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",t.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",t.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",t.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",t.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",t.EDIT_MODE_STYLE="EDIT_MODE_STYLE",t.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",t.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(bs||(bs={}));var Ts;(function(t){t.FOREGROUND="FOREGROUND",t.BACKGROUND="BACKGROUND",t.PROMPT="PROMPT",t.SEMANTIC="SEMANTIC",t.INTERACTIVE="INTERACTIVE"})(Ts||(Ts={}));var Ns;(function(t){t.ASSET="ASSET",t.STYLE="STYLE"})(Ns||(Ns={}));var Cs;(function(t){t.INSERT="INSERT",t.REMOVE="REMOVE",t.REMOVE_STATIC="REMOVE_STATIC",t.OUTPAINT="OUTPAINT"})(Cs||(Cs={}));var Es;(function(t){t.OPTIMIZED="OPTIMIZED",t.LOSSLESS="LOSSLESS"})(Es||(Es={}));var ws;(function(t){t.STATE_UNSPECIFIED="STATE_UNSPECIFIED",t.PROCESSING="PROCESSING",t.ACTIVE="ACTIVE",t.FAILED="FAILED"})(ws||(ws={}));var _s;(function(t){t.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",t.UPLOADED="UPLOADED",t.GENERATED="GENERATED"})(_s||(_s={}));var As;(function(t){t.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.RESPONSE_REJECTED="RESPONSE_REJECTED",t.NEED_MORE_INPUT="NEED_MORE_INPUT"})(As||(As={}));var Ss;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.VIDEO="VIDEO",t.AUDIO="AUDIO",t.DOCUMENT="DOCUMENT"})(Ss||(Ss={}));var Is;(function(t){t.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",t.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",t.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(Is||(Is={}));var Rs;(function(t){t.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",t.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",t.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(Rs||(Rs={}));var Ps;(function(t){t.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",t.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",t.NO_INTERRUPTION="NO_INTERRUPTION"})(Ps||(Ps={}));var Ms;(function(t){t.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",t.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",t.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(Ms||(Ms={}));var ks;(function(t){t.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",t.SILENT="SILENT",t.WHEN_IDLE="WHEN_IDLE",t.INTERRUPT="INTERRUPT"})(ks||(ks={}));var Ds;(function(t){t.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",t.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",t.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",t.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",t.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",t.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",t.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",t.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",t.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",t.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",t.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",t.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",t.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(Ds||(Ds={}));var Ls;(function(t){t.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",t.QUALITY="QUALITY",t.DIVERSITY="DIVERSITY",t.VOCALIZATION="VOCALIZATION"})(Ls||(Ls={}));var nt;(function(t){t.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",t.PLAY="PLAY",t.PAUSE="PAUSE",t.STOP="STOP",t.RESET_CONTEXT="RESET_CONTEXT"})(nt||(nt={}));class En{constructor(e){const n={};for(const s of e.headers.entries())n[s[0]]=s[1];this.headers=n,this.responseInternal=e}json(){return this.responseInternal.json()}}class Ct{get text(){var e,n,s,r,l,d,c,f;if(((r=(s=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||s===void 0?void 0:s.parts)===null||r===void 0?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let u="",m=!1;const p=[];for(const h of(f=(c=(d=(l=this.candidates)===null||l===void 0?void 0:l[0])===null||d===void 0?void 0:d.content)===null||c===void 0?void 0:c.parts)!==null&&f!==void 0?f:[]){for(const[v,E]of Object.entries(h))v!=="text"&&v!=="thought"&&(E!==null||E!==void 0)&&p.push(v);if(typeof h.text=="string"){if(typeof h.thought=="boolean"&&h.thought)continue;m=!0,u+=h.text}}return p.length>0&&console.warn(`there are non-text parts ${p} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),m?u:void 0}get data(){var e,n,s,r,l,d,c,f;if(((r=(s=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||s===void 0?void 0:s.parts)===null||r===void 0?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let u="";const m=[];for(const p of(f=(c=(d=(l=this.candidates)===null||l===void 0?void 0:l[0])===null||d===void 0?void 0:d.content)===null||c===void 0?void 0:c.parts)!==null&&f!==void 0?f:[]){for(const[h,v]of Object.entries(p))h!=="inlineData"&&(v!==null||v!==void 0)&&m.push(h);p.inlineData&&typeof p.inlineData.data=="string"&&(u+=atob(p.inlineData.data))}return m.length>0&&console.warn(`there are non-data parts ${m} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),u.length>0?btoa(u):void 0}get functionCalls(){var e,n,s,r,l,d,c,f;if(((r=(s=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||s===void 0?void 0:s.parts)===null||r===void 0?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const u=(f=(c=(d=(l=this.candidates)===null||l===void 0?void 0:l[0])===null||d===void 0?void 0:d.content)===null||c===void 0?void 0:c.parts)===null||f===void 0?void 0:f.filter(m=>m.functionCall).map(m=>m.functionCall).filter(m=>m!==void 0);if((u==null?void 0:u.length)!==0)return u}get executableCode(){var e,n,s,r,l,d,c,f,u;if(((r=(s=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||s===void 0?void 0:s.parts)===null||r===void 0?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const m=(f=(c=(d=(l=this.candidates)===null||l===void 0?void 0:l[0])===null||d===void 0?void 0:d.content)===null||c===void 0?void 0:c.parts)===null||f===void 0?void 0:f.filter(p=>p.executableCode).map(p=>p.executableCode).filter(p=>p!==void 0);if((m==null?void 0:m.length)!==0)return(u=m==null?void 0:m[0])===null||u===void 0?void 0:u.code}get codeExecutionResult(){var e,n,s,r,l,d,c,f,u;if(((r=(s=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||s===void 0?void 0:s.parts)===null||r===void 0?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const m=(f=(c=(d=(l=this.candidates)===null||l===void 0?void 0:l[0])===null||d===void 0?void 0:d.content)===null||c===void 0?void 0:c.parts)===null||f===void 0?void 0:f.filter(p=>p.codeExecutionResult).map(p=>p.codeExecutionResult).filter(p=>p!==void 0);if((m==null?void 0:m.length)!==0)return(u=m==null?void 0:m[0])===null||u===void 0?void 0:u.output}}class Fs{}class Us{}class Wi{}class zi{}class Ki{}class Xi{}class js{}class Vs{}class Bs{}class Qi{}class sn{_fromAPIResponse({apiResponse:e,isVertexAI:n}){const s=new sn;let r;const l=e;return n?r=Vi(l):r=ji(l),Object.assign(s,r),s}}class qs{}class $s{}class Gs{}class Zi{}class er{}class tr{}class Hs{}class nr{get text(){var e,n,s;let r="",l=!1;const d=[];for(const c of(s=(n=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&s!==void 0?s:[]){for(const[f,u]of Object.entries(c))f!=="text"&&f!=="thought"&&u!==null&&d.push(f);if(typeof c.text=="string"){if(typeof c.thought=="boolean"&&c.thought)continue;l=!0,r+=c.text}}return d.length>0&&console.warn(`there are non-text parts ${d} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),l?r:void 0}get data(){var e,n,s;let r="";const l=[];for(const d of(s=(n=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&s!==void 0?s:[]){for(const[c,f]of Object.entries(d))c!=="inlineData"&&f!==null&&l.push(c);d.inlineData&&typeof d.inlineData.data=="string"&&(r+=atob(d.inlineData.data))}return l.length>0&&console.warn(`there are non-data parts ${l} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),r.length>0?btoa(r):void 0}}class sr{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function de(t,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(t.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){const n=e.split("/",2);return`publishers/${n[0]}/models/${n[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function To(t,e){const n=de(t,e);return n?n.startsWith("publishers/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/${n}`:n.startsWith("models/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/publishers/google/${n}`:n:""}function No(t){return Array.isArray(t)?t.map(e=>on(e)):[on(t)]}function on(t){if(typeof t=="object"&&t!==null)return t;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof t}`)}function Co(t){const e=on(t);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function Eo(t){const e=on(t);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function Js(t){if(t==null)throw new Error("PartUnion is required");if(typeof t=="object")return t;if(typeof t=="string")return{text:t};throw new Error(`Unsupported part type: ${typeof t}`)}function wo(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("PartListUnion is required");return Array.isArray(t)?t.map(e=>Js(e)):[Js(t)]}function wn(t){return t!=null&&typeof t=="object"&&"parts"in t&&Array.isArray(t.parts)}function Os(t){return t!=null&&typeof t=="object"&&"functionCall"in t}function Ys(t){return t!=null&&typeof t=="object"&&"functionResponse"in t}function Ee(t){if(t==null)throw new Error("ContentUnion is required");return wn(t)?t:{role:"user",parts:wo(t)}}function Fn(t,e){if(!e)return[];if(t.isVertexAI()&&Array.isArray(e))return e.flatMap(n=>{const s=Ee(n);return s.parts&&s.parts.length>0&&s.parts[0].text!==void 0?[s.parts[0].text]:[]});if(t.isVertexAI()){const n=Ee(e);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]}return Array.isArray(e)?e.map(n=>Ee(n)):[Ee(e)]}function Ae(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("contents are required");if(!Array.isArray(t)){if(Os(t)||Ys(t))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[Ee(t)]}const e=[],n=[],s=wn(t[0]);for(const r of t){const l=wn(r);if(l!=s)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(l)e.push(r);else{if(Os(r)||Ys(r))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");n.push(r)}}return s||e.push({role:"user",parts:wo(n)}),e}function or(t,e){t.includes("null")&&(e.nullable=!0);const n=t.filter(s=>s!=="null");if(n.length===1)e.type=Object.values(Ve).includes(n[0].toUpperCase())?n[0].toUpperCase():Ve.TYPE_UNSPECIFIED;else{e.anyOf=[];for(const s of n)e.anyOf.push({type:Object.values(Ve).includes(s.toUpperCase())?s.toUpperCase():Ve.TYPE_UNSPECIFIED})}}function st(t){const e={},n=["items"],s=["anyOf"],r=["properties"];if(t.type&&t.anyOf)throw new Error("type and anyOf cannot be both populated.");const l=t.anyOf;l!=null&&l.length==2&&(l[0].type==="null"?(e.nullable=!0,t=l[1]):l[1].type==="null"&&(e.nullable=!0,t=l[0])),t.type instanceof Array&&or(t.type,e);for(const[d,c]of Object.entries(t))if(c!=null)if(d=="type"){if(c==="null")throw new Error("type: null can not be the only possible type for the field.");if(c instanceof Array)continue;e.type=Object.values(Ve).includes(c.toUpperCase())?c.toUpperCase():Ve.TYPE_UNSPECIFIED}else if(n.includes(d))e[d]=st(c);else if(s.includes(d)){const f=[];for(const u of c){if(u.type=="null"){e.nullable=!0;continue}f.push(st(u))}e[d]=f}else if(r.includes(d)){const f={};for(const[u,m]of Object.entries(c))f[u]=st(m);e[d]=f}else{if(d==="additionalProperties")continue;e[d]=c}return e}function Un(t){return st(t)}function jn(t){if(typeof t=="object")return t;if(typeof t=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:t}}};throw new Error(`Unsupported speechConfig type: ${typeof t}`)}function Vn(t){if("multiSpeakerVoiceConfig"in t)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return t}function lt(t){if(t.functionDeclarations)for(const e of t.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=st(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=st(e.response));return t}function dt(t){if(t==null)throw new Error("tools is required");if(!Array.isArray(t))throw new Error("tools is required and must be an array of Tools");const e=[];for(const n of t)e.push(n);return e}function ir(t,e,n,s=1){const r=!e.startsWith(`${n}/`)&&e.split("/").length===s;return t.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${t.getProject()}/${e}`:e.startsWith(`${n}/`)?`projects/${t.getProject()}/locations/${t.getLocation()}/${e}`:r?`projects/${t.getProject()}/locations/${t.getLocation()}/${n}/${e}`:e:r?`${n}/${e}`:e}function Fe(t,e){if(typeof e!="string")throw new Error("name must be a string");return ir(t,e,"cachedContents")}function _o(t){switch(t){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return t}}function Be(t){return Ln(t)}function rr(t){return t!=null&&typeof t=="object"&&"name"in t}function ar(t){return t!=null&&typeof t=="object"&&"video"in t}function lr(t){return t!=null&&typeof t=="object"&&"uri"in t}function Ao(t){var e;let n;if(rr(t)&&(n=t.name),!(lr(t)&&(n=t.uri,n===void 0))&&!(ar(t)&&(n=(e=t.video)===null||e===void 0?void 0:e.uri,n===void 0))){if(typeof t=="string"&&(n=t),n===void 0)throw new Error("Could not extract file name from the provided input.");if(n.startsWith("https://")){const r=n.split("files/")[1].match(/[a-z0-9]+/);if(r===null)throw new Error(`Could not extract file name from URI ${n}`);n=r[0]}else n.startsWith("files/")&&(n=n.split("files/")[1]);return n}}function So(t,e){let n;return t.isVertexAI()?n=e?"publishers/google/models":"models":n=e?"models":"tunedModels",n}function Io(t){for(const e of["models","tunedModels","publisherModels"])if(dr(t,e))return t[e];return[]}function dr(t,e){return t!==null&&typeof t=="object"&&e in t}function cr(t,e={}){const n=t,s={name:n.name,description:n.description,parametersJsonSchema:n.inputSchema};return n.outputSchema&&(s.responseJsonSchema=n.outputSchema),e.behavior&&(s.behavior=e.behavior),{functionDeclarations:[s]}}function ur(t,e={}){const n=[],s=new Set;for(const r of t){const l=r.name;if(s.has(l))throw new Error(`Duplicate function name ${l} found in MCP tools. Please ensure function names are unique.`);s.add(l);const d=cr(r,e);d.functionDeclarations&&n.push(...d.functionDeclarations)}return{functionDeclarations:n}}function Ro(t,e){let n;if(typeof e=="string")if(t.isVertexAI())if(e.startsWith("gs://"))n={format:"jsonl",gcsUri:[e]};else if(e.startsWith("bq://"))n={format:"bigquery",bigqueryUri:e};else throw new Error(`Unsupported string source for Vertex AI: ${e}`);else if(e.startsWith("files/"))n={fileName:e};else throw new Error(`Unsupported string source for Gemini API: ${e}`);else if(Array.isArray(e)){if(t.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");n={inlinedRequests:e}}else n=e;const s=[n.gcsUri,n.bigqueryUri].filter(Boolean).length,r=[n.inlinedRequests,n.fileName].filter(Boolean).length;if(t.isVertexAI()){if(r>0||s!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(s>0||r!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return n}function fr(t){if(typeof t!="string")return t;const e=t;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function Po(t){if(typeof t!="object"||t===null)return{};const e=t,n=e.inlinedResponses;if(typeof n!="object"||n===null)return t;const r=n.inlinedResponses;if(!Array.isArray(r)||r.length===0)return t;let l=!1;for(const d of r){if(typeof d!="object"||d===null)continue;const f=d.response;if(typeof f!="object"||f===null)continue;if(f.embedding!==void 0){l=!0;break}}return l&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),t}function ct(t,e){const n=e;if(!t.isVertexAI()){if(/batches\/[^/]+$/.test(n))return n.split("/").pop();throw new Error(`Invalid batch job name: ${n}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(n))return n.split("/").pop();if(/^\d+$/.test(n))return n;throw new Error(`Invalid batch job name: ${n}.`)}function Mo(t){const e=t;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function mr(t){const e={},n=i(t,["responsesFile"]);n!=null&&a(e,["fileName"],n);const s=i(t,["inlinedResponses","inlinedResponses"]);if(s!=null){let l=s;Array.isArray(l)&&(l=l.map(d=>Hr(d))),a(e,["inlinedResponses"],l)}const r=i(t,["inlinedEmbedContentResponses","inlinedResponses"]);if(r!=null){let l=r;Array.isArray(l)&&(l=l.map(d=>d)),a(e,["inlinedEmbedContentResponses"],l)}return e}function pr(t){const e={},n=i(t,["predictionsFormat"]);n!=null&&a(e,["format"],n);const s=i(t,["gcsDestination","outputUriPrefix"]);s!=null&&a(e,["gcsUri"],s);const r=i(t,["bigqueryDestination","outputUri"]);return r!=null&&a(e,["bigqueryUri"],r),e}function hr(t){const e={},n=i(t,["format"]);n!=null&&a(e,["predictionsFormat"],n);const s=i(t,["gcsUri"]);s!=null&&a(e,["gcsDestination","outputUriPrefix"],s);const r=i(t,["bigqueryUri"]);if(r!=null&&a(e,["bigqueryDestination","outputUri"],r),i(t,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(i(t,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(i(t,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}function en(t){const e={},n=i(t,["name"]);n!=null&&a(e,["name"],n);const s=i(t,["metadata","displayName"]);s!=null&&a(e,["displayName"],s);const r=i(t,["metadata","state"]);r!=null&&a(e,["state"],Mo(r));const l=i(t,["metadata","createTime"]);l!=null&&a(e,["createTime"],l);const d=i(t,["metadata","endTime"]);d!=null&&a(e,["endTime"],d);const c=i(t,["metadata","updateTime"]);c!=null&&a(e,["updateTime"],c);const f=i(t,["metadata","model"]);f!=null&&a(e,["model"],f);const u=i(t,["metadata","output"]);return u!=null&&a(e,["dest"],mr(Po(u))),e}function _n(t){const e={},n=i(t,["name"]);n!=null&&a(e,["name"],n);const s=i(t,["displayName"]);s!=null&&a(e,["displayName"],s);const r=i(t,["state"]);r!=null&&a(e,["state"],Mo(r));const l=i(t,["error"]);l!=null&&a(e,["error"],l);const d=i(t,["createTime"]);d!=null&&a(e,["createTime"],d);const c=i(t,["startTime"]);c!=null&&a(e,["startTime"],c);const f=i(t,["endTime"]);f!=null&&a(e,["endTime"],f);const u=i(t,["updateTime"]);u!=null&&a(e,["updateTime"],u);const m=i(t,["model"]);m!=null&&a(e,["model"],m);const p=i(t,["inputConfig"]);p!=null&&a(e,["src"],gr(p));const h=i(t,["outputConfig"]);return h!=null&&a(e,["dest"],pr(Po(h))),e}function gr(t){const e={},n=i(t,["instancesFormat"]);n!=null&&a(e,["format"],n);const s=i(t,["gcsSource","uris"]);s!=null&&a(e,["gcsUri"],s);const r=i(t,["bigquerySource","inputUri"]);return r!=null&&a(e,["bigqueryUri"],r),e}function xr(t,e){const n={};if(i(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(i(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(i(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");const s=i(e,["fileName"]);s!=null&&a(n,["fileName"],s);const r=i(e,["inlinedRequests"]);if(r!=null){let l=r;Array.isArray(l)&&(l=l.map(d=>Gr(t,d))),a(n,["requests","requests"],l)}return n}function yr(t){const e={},n=i(t,["format"]);n!=null&&a(e,["instancesFormat"],n);const s=i(t,["gcsUri"]);s!=null&&a(e,["gcsSource","uris"],s);const r=i(t,["bigqueryUri"]);if(r!=null&&a(e,["bigquerySource","inputUri"],r),i(t,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(i(t,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function vr(t){const e={};if(i(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=i(t,["data"]);n!=null&&a(e,["data"],n);const s=i(t,["mimeType"]);return s!=null&&a(e,["mimeType"],s),e}function br(t,e){const n={},s=i(e,["name"]);return s!=null&&a(n,["_url","name"],ct(t,s)),n}function Tr(t,e){const n={},s=i(e,["name"]);return s!=null&&a(n,["_url","name"],ct(t,s)),n}function Nr(t){const e={},n=i(t,["content"]);n!=null&&a(e,["content"],n);const s=i(t,["citationMetadata"]);s!=null&&a(e,["citationMetadata"],Cr(s));const r=i(t,["tokenCount"]);r!=null&&a(e,["tokenCount"],r);const l=i(t,["finishReason"]);l!=null&&a(e,["finishReason"],l);const d=i(t,["urlContextMetadata"]);d!=null&&a(e,["urlContextMetadata"],d);const c=i(t,["avgLogprobs"]);c!=null&&a(e,["avgLogprobs"],c);const f=i(t,["groundingMetadata"]);f!=null&&a(e,["groundingMetadata"],f);const u=i(t,["index"]);u!=null&&a(e,["index"],u);const m=i(t,["logprobsResult"]);m!=null&&a(e,["logprobsResult"],m);const p=i(t,["safetyRatings"]);if(p!=null){let h=p;Array.isArray(h)&&(h=h.map(v=>v)),a(e,["safetyRatings"],h)}return e}function Cr(t){const e={},n=i(t,["citationSources"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(r=>r)),a(e,["citations"],s)}return e}function ko(t){const e={},n=i(t,["parts"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(l=>Xr(l))),a(e,["parts"],r)}const s=i(t,["role"]);return s!=null&&a(e,["role"],s),e}function Er(t,e){const n={},s=i(t,["displayName"]);if(e!==void 0&&s!=null&&a(e,["batch","displayName"],s),i(t,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return n}function wr(t,e){const n={},s=i(t,["displayName"]);e!==void 0&&s!=null&&a(e,["displayName"],s);const r=i(t,["dest"]);return e!==void 0&&r!=null&&a(e,["outputConfig"],hr(fr(r))),n}function Ws(t,e){const n={},s=i(e,["model"]);s!=null&&a(n,["_url","model"],de(t,s));const r=i(e,["src"]);r!=null&&a(n,["batch","inputConfig"],xr(t,Ro(t,r)));const l=i(e,["config"]);return l!=null&&Er(l,n),n}function _r(t,e){const n={},s=i(e,["model"]);s!=null&&a(n,["model"],de(t,s));const r=i(e,["src"]);r!=null&&a(n,["inputConfig"],yr(Ro(t,r)));const l=i(e,["config"]);return l!=null&&wr(l,n),n}function Ar(t,e){const n={},s=i(t,["displayName"]);return e!==void 0&&s!=null&&a(e,["batch","displayName"],s),n}function Sr(t,e){const n={},s=i(e,["model"]);s!=null&&a(n,["_url","model"],de(t,s));const r=i(e,["src"]);r!=null&&a(n,["batch","inputConfig"],Lr(t,r));const l=i(e,["config"]);return l!=null&&Ar(l,n),n}function Ir(t,e){const n={},s=i(e,["name"]);return s!=null&&a(n,["_url","name"],ct(t,s)),n}function Rr(t,e){const n={},s=i(e,["name"]);return s!=null&&a(n,["_url","name"],ct(t,s)),n}function Pr(t){const e={},n=i(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const s=i(t,["name"]);s!=null&&a(e,["name"],s);const r=i(t,["done"]);r!=null&&a(e,["done"],r);const l=i(t,["error"]);return l!=null&&a(e,["error"],l),e}function Mr(t){const e={},n=i(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const s=i(t,["name"]);s!=null&&a(e,["name"],s);const r=i(t,["done"]);r!=null&&a(e,["done"],r);const l=i(t,["error"]);return l!=null&&a(e,["error"],l),e}function kr(t,e){const n={},s=i(e,["contents"]);if(s!=null){let l=Fn(t,s);Array.isArray(l)&&(l=l.map(d=>d)),a(n,["requests[]","request","content"],l)}const r=i(e,["config"]);return r!=null&&(a(n,["_self"],Dr(r,n)),Fi(n,{"requests[].*":"requests[].request.*"})),n}function Dr(t,e){const n={},s=i(t,["taskType"]);e!==void 0&&s!=null&&a(e,["requests[]","taskType"],s);const r=i(t,["title"]);e!==void 0&&r!=null&&a(e,["requests[]","title"],r);const l=i(t,["outputDimensionality"]);if(e!==void 0&&l!=null&&a(e,["requests[]","outputDimensionality"],l),i(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(i(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function Lr(t,e){const n={},s=i(e,["fileName"]);s!=null&&a(n,["file_name"],s);const r=i(e,["inlinedRequests"]);return r!=null&&a(n,["requests"],kr(t,r)),n}function Fr(t){const e={};if(i(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=i(t,["fileUri"]);n!=null&&a(e,["fileUri"],n);const s=i(t,["mimeType"]);return s!=null&&a(e,["mimeType"],s),e}function Ur(t,e,n){const s={},r=i(e,["systemInstruction"]);n!==void 0&&r!=null&&a(n,["systemInstruction"],ko(Ee(r)));const l=i(e,["temperature"]);l!=null&&a(s,["temperature"],l);const d=i(e,["topP"]);d!=null&&a(s,["topP"],d);const c=i(e,["topK"]);c!=null&&a(s,["topK"],c);const f=i(e,["candidateCount"]);f!=null&&a(s,["candidateCount"],f);const u=i(e,["maxOutputTokens"]);u!=null&&a(s,["maxOutputTokens"],u);const m=i(e,["stopSequences"]);m!=null&&a(s,["stopSequences"],m);const p=i(e,["responseLogprobs"]);p!=null&&a(s,["responseLogprobs"],p);const h=i(e,["logprobs"]);h!=null&&a(s,["logprobs"],h);const v=i(e,["presencePenalty"]);v!=null&&a(s,["presencePenalty"],v);const E=i(e,["frequencyPenalty"]);E!=null&&a(s,["frequencyPenalty"],E);const A=i(e,["seed"]);A!=null&&a(s,["seed"],A);const I=i(e,["responseMimeType"]);I!=null&&a(s,["responseMimeType"],I);const R=i(e,["responseSchema"]);R!=null&&a(s,["responseSchema"],Un(R));const k=i(e,["responseJsonSchema"]);if(k!=null&&a(s,["responseJsonSchema"],k),i(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(i(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const P=i(e,["safetySettings"]);if(n!==void 0&&P!=null){let B=P;Array.isArray(B)&&(B=B.map(ne=>Qr(ne))),a(n,["safetySettings"],B)}const N=i(e,["tools"]);if(n!==void 0&&N!=null){let B=dt(N);Array.isArray(B)&&(B=B.map(ne=>Zr(lt(ne)))),a(n,["tools"],B)}const T=i(e,["toolConfig"]);if(n!==void 0&&T!=null&&a(n,["toolConfig"],T),i(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const M=i(e,["cachedContent"]);n!==void 0&&M!=null&&a(n,["cachedContent"],Fe(t,M));const F=i(e,["responseModalities"]);F!=null&&a(s,["responseModalities"],F);const j=i(e,["mediaResolution"]);j!=null&&a(s,["mediaResolution"],j);const L=i(e,["speechConfig"]);if(L!=null&&a(s,["speechConfig"],jn(L)),i(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const x=i(e,["thinkingConfig"]);x!=null&&a(s,["thinkingConfig"],x);const D=i(e,["imageConfig"]);return D!=null&&a(s,["imageConfig"],D),s}function jr(t){const e={},n=i(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const s=i(t,["candidates"]);if(s!=null){let f=s;Array.isArray(f)&&(f=f.map(u=>Nr(u))),a(e,["candidates"],f)}const r=i(t,["modelVersion"]);r!=null&&a(e,["modelVersion"],r);const l=i(t,["promptFeedback"]);l!=null&&a(e,["promptFeedback"],l);const d=i(t,["responseId"]);d!=null&&a(e,["responseId"],d);const c=i(t,["usageMetadata"]);return c!=null&&a(e,["usageMetadata"],c),e}function Vr(t,e){const n={},s=i(e,["name"]);return s!=null&&a(n,["_url","name"],ct(t,s)),n}function Br(t,e){const n={},s=i(e,["name"]);return s!=null&&a(n,["_url","name"],ct(t,s)),n}function qr(t){const e={};if(i(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=i(t,["enableWidget"]);return n!=null&&a(e,["enableWidget"],n),e}function $r(t){const e={},n=i(t,["timeRangeFilter"]);if(n!=null&&a(e,["timeRangeFilter"],n),i(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");return e}function Gr(t,e){const n={},s=i(e,["model"]);s!=null&&a(n,["request","model"],de(t,s));const r=i(e,["contents"]);if(r!=null){let c=Ae(r);Array.isArray(c)&&(c=c.map(f=>ko(f))),a(n,["request","contents"],c)}const l=i(e,["metadata"]);l!=null&&a(n,["metadata"],l);const d=i(e,["config"]);return d!=null&&a(n,["request","generationConfig"],Ur(t,d,i(n,["request"],{}))),n}function Hr(t){const e={},n=i(t,["response"]);n!=null&&a(e,["response"],jr(n));const s=i(t,["error"]);return s!=null&&a(e,["error"],s),e}function Jr(t,e){const n={},s=i(t,["pageSize"]);e!==void 0&&s!=null&&a(e,["_query","pageSize"],s);const r=i(t,["pageToken"]);if(e!==void 0&&r!=null&&a(e,["_query","pageToken"],r),i(t,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return n}function Or(t,e){const n={},s=i(t,["pageSize"]);e!==void 0&&s!=null&&a(e,["_query","pageSize"],s);const r=i(t,["pageToken"]);e!==void 0&&r!=null&&a(e,["_query","pageToken"],r);const l=i(t,["filter"]);return e!==void 0&&l!=null&&a(e,["_query","filter"],l),n}function Yr(t){const e={},n=i(t,["config"]);return n!=null&&Jr(n,e),e}function Wr(t){const e={},n=i(t,["config"]);return n!=null&&Or(n,e),e}function zr(t){const e={},n=i(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const s=i(t,["nextPageToken"]);s!=null&&a(e,["nextPageToken"],s);const r=i(t,["operations"]);if(r!=null){let l=r;Array.isArray(l)&&(l=l.map(d=>en(d))),a(e,["batchJobs"],l)}return e}function Kr(t){const e={},n=i(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const s=i(t,["nextPageToken"]);s!=null&&a(e,["nextPageToken"],s);const r=i(t,["batchPredictionJobs"]);if(r!=null){let l=r;Array.isArray(l)&&(l=l.map(d=>_n(d))),a(e,["batchJobs"],l)}return e}function Xr(t){const e={},n=i(t,["videoMetadata"]);n!=null&&a(e,["videoMetadata"],n);const s=i(t,["thought"]);s!=null&&a(e,["thought"],s);const r=i(t,["inlineData"]);r!=null&&a(e,["inlineData"],vr(r));const l=i(t,["fileData"]);l!=null&&a(e,["fileData"],Fr(l));const d=i(t,["thoughtSignature"]);d!=null&&a(e,["thoughtSignature"],d);const c=i(t,["functionCall"]);c!=null&&a(e,["functionCall"],c);const f=i(t,["codeExecutionResult"]);f!=null&&a(e,["codeExecutionResult"],f);const u=i(t,["executableCode"]);u!=null&&a(e,["executableCode"],u);const m=i(t,["functionResponse"]);m!=null&&a(e,["functionResponse"],m);const p=i(t,["text"]);return p!=null&&a(e,["text"],p),e}function Qr(t){const e={};if(i(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const n=i(t,["category"]);n!=null&&a(e,["category"],n);const s=i(t,["threshold"]);return s!=null&&a(e,["threshold"],s),e}function Zr(t){const e={},n=i(t,["functionDeclarations"]);if(n!=null){let u=n;Array.isArray(u)&&(u=u.map(m=>m)),a(e,["functionDeclarations"],u)}if(i(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=i(t,["googleSearch"]);s!=null&&a(e,["googleSearch"],$r(s));const r=i(t,["googleSearchRetrieval"]);if(r!=null&&a(e,["googleSearchRetrieval"],r),i(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const l=i(t,["googleMaps"]);l!=null&&a(e,["googleMaps"],qr(l));const d=i(t,["urlContext"]);d!=null&&a(e,["urlContext"],d);const c=i(t,["computerUse"]);c!=null&&a(e,["computerUse"],c);const f=i(t,["codeExecution"]);return f!=null&&a(e,["codeExecution"],f),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Ye;(function(t){t.PAGED_ITEM_BATCH_JOBS="batchJobs",t.PAGED_ITEM_MODELS="models",t.PAGED_ITEM_TUNING_JOBS="tuningJobs",t.PAGED_ITEM_FILES="files",t.PAGED_ITEM_CACHED_CONTENTS="cachedContents"})(Ye||(Ye={}));class At{constructor(e,n,s,r){this.pageInternal=[],this.paramsInternal={},this.requestInternal=n,this.init(e,s,r)}init(e,n,s){var r,l;this.nameInternal=e,this.pageInternal=n[this.nameInternal]||[],this.sdkHttpResponseInternal=n==null?void 0:n.sdkHttpResponse,this.idxInternal=0;let d={config:{}};!s||Object.keys(s).length===0?d={config:{}}:typeof s=="object"?d=Object.assign({},s):d=s,d.config&&(d.config.pageToken=n.nextPageToken),this.paramsInternal=d,this.pageInternalSize=(l=(r=d.config)===null||r===void 0?void 0:r.pageSize)!==null&&l!==void 0?l:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class ea extends We{constructor(e){super(),this.apiClient=e,this.create=async n=>(this.apiClient.isVertexAI()&&(n.config=this.formatDestination(n.src,n.config)),this.createInternal(n)),this.createEmbeddings=async n=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(n)},this.list=async(n={})=>new At(Ye.PAGED_ITEM_BATCH_JOBS,s=>this.listInternal(s),await this.listInternal(n),n)}createInlinedGenerateContentRequest(e){const n=Ws(this.apiClient,e),s=n._url,r=Q("{model}:batchGenerateContent",s),c=n.batch.inputConfig.requests,f=c.requests,u=[];for(const m of f){const p=Object.assign({},m);if(p.systemInstruction){const h=p.systemInstruction;delete p.systemInstruction;const v=p.request;v.systemInstruction=h,p.request=v}u.push(p)}return c.requests=u,delete n.config,delete n._url,delete n._query,{path:r,body:n}}getGcsUri(e){if(typeof e=="string")return e.startsWith("gs://")?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e=="string")return e.startsWith("bq://")?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,n){const s=n?Object.assign({},n):{},r=Date.now().toString();if(s.displayName||(s.displayName=`genaiBatchJob_${r}`),s.dest===void 0){const l=this.getGcsUri(e),d=this.getBigqueryUri(e);if(l)l.endsWith(".jsonl")?s.dest=`${l.slice(0,-6)}/dest`:s.dest=`${l}_dest_${r}`;else if(d)s.dest=`${d}_dest_${r}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return s}async createInternal(e){var n,s,r,l;let d,c="",f={};if(this.apiClient.isVertexAI()){const u=_r(this.apiClient,e);return c=Q("batchPredictionJobs",u._url),f=u._query,delete u._url,delete u._query,d=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(m=>m.json()),d.then(m=>_n(m))}else{const u=Ws(this.apiClient,e);return c=Q("{model}:batchGenerateContent",u._url),f=u._query,delete u._url,delete u._query,d=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json()),d.then(m=>en(m))}}async createEmbeddingsInternal(e){var n,s;let r,l="",d={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=Sr(this.apiClient,e);return l=Q("{model}:asyncBatchEmbedContent",c._url),d=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),r.then(f=>en(f))}}async get(e){var n,s,r,l;let d,c="",f={};if(this.apiClient.isVertexAI()){const u=Br(this.apiClient,e);return c=Q("batchPredictionJobs/{name}",u._url),f=u._query,delete u._url,delete u._query,d=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(m=>m.json()),d.then(m=>_n(m))}else{const u=Vr(this.apiClient,e);return c=Q("batches/{name}",u._url),f=u._query,delete u._url,delete u._query,d=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json()),d.then(m=>en(m))}}async cancel(e){var n,s,r,l;let d="",c={};if(this.apiClient.isVertexAI()){const f=Tr(this.apiClient,e);d=Q("batchPredictionJobs/{name}:cancel",f._url),c=f._query,delete f._url,delete f._query,await this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal})}else{const f=br(this.apiClient,e);d=Q("batches/{name}:cancel",f._url),c=f._query,delete f._url,delete f._query,await this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal})}}async listInternal(e){var n,s,r,l;let d,c="",f={};if(this.apiClient.isVertexAI()){const u=Wr(e);return c=Q("batchPredictionJobs",u._url),f=u._query,delete u._url,delete u._query,d=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(m=>m.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:m.headers},h})),d.then(m=>{const p=Kr(m),h=new Hs;return Object.assign(h,p),h})}else{const u=Yr(e);return c=Q("batches",u._url),f=u._query,delete u._url,delete u._query,d=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:m.headers},h})),d.then(m=>{const p=zr(m),h=new Hs;return Object.assign(h,p),h})}}async delete(e){var n,s,r,l;let d,c="",f={};if(this.apiClient.isVertexAI()){const u=Rr(this.apiClient,e);return c=Q("batchPredictionJobs/{name}",u._url),f=u._query,delete u._url,delete u._query,d=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(m=>m.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:m.headers},h})),d.then(m=>Mr(m))}else{const u=Ir(this.apiClient,e);return c=Q("batches/{name}",u._url),f=u._query,delete u._url,delete u._query,d=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:m.headers},h})),d.then(m=>Pr(m))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function ta(t){const e={};if(i(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=i(t,["data"]);n!=null&&a(e,["data"],n);const s=i(t,["mimeType"]);return s!=null&&a(e,["mimeType"],s),e}function zs(t){const e={},n=i(t,["parts"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(l=>Na(l))),a(e,["parts"],r)}const s=i(t,["role"]);return s!=null&&a(e,["role"],s),e}function na(t,e){const n={},s=i(t,["ttl"]);e!==void 0&&s!=null&&a(e,["ttl"],s);const r=i(t,["expireTime"]);e!==void 0&&r!=null&&a(e,["expireTime"],r);const l=i(t,["displayName"]);e!==void 0&&l!=null&&a(e,["displayName"],l);const d=i(t,["contents"]);if(e!==void 0&&d!=null){let m=Ae(d);Array.isArray(m)&&(m=m.map(p=>zs(p))),a(e,["contents"],m)}const c=i(t,["systemInstruction"]);e!==void 0&&c!=null&&a(e,["systemInstruction"],zs(Ee(c)));const f=i(t,["tools"]);if(e!==void 0&&f!=null){let m=f;Array.isArray(m)&&(m=m.map(p=>Ca(p))),a(e,["tools"],m)}const u=i(t,["toolConfig"]);if(e!==void 0&&u!=null&&a(e,["toolConfig"],u),i(t,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return n}function sa(t,e){const n={},s=i(t,["ttl"]);e!==void 0&&s!=null&&a(e,["ttl"],s);const r=i(t,["expireTime"]);e!==void 0&&r!=null&&a(e,["expireTime"],r);const l=i(t,["displayName"]);e!==void 0&&l!=null&&a(e,["displayName"],l);const d=i(t,["contents"]);if(e!==void 0&&d!=null){let p=Ae(d);Array.isArray(p)&&(p=p.map(h=>h)),a(e,["contents"],p)}const c=i(t,["systemInstruction"]);e!==void 0&&c!=null&&a(e,["systemInstruction"],Ee(c));const f=i(t,["tools"]);if(e!==void 0&&f!=null){let p=f;Array.isArray(p)&&(p=p.map(h=>Ea(h))),a(e,["tools"],p)}const u=i(t,["toolConfig"]);e!==void 0&&u!=null&&a(e,["toolConfig"],u);const m=i(t,["kmsKeyName"]);return e!==void 0&&m!=null&&a(e,["encryption_spec","kmsKeyName"],m),n}function oa(t,e){const n={},s=i(e,["model"]);s!=null&&a(n,["model"],To(t,s));const r=i(e,["config"]);return r!=null&&na(r,n),n}function ia(t,e){const n={},s=i(e,["model"]);s!=null&&a(n,["model"],To(t,s));const r=i(e,["config"]);return r!=null&&sa(r,n),n}function ra(t,e){const n={},s=i(e,["name"]);return s!=null&&a(n,["_url","name"],Fe(t,s)),n}function aa(t,e){const n={},s=i(e,["name"]);return s!=null&&a(n,["_url","name"],Fe(t,s)),n}function la(t){const e={},n=i(t,["sdkHttpResponse"]);return n!=null&&a(e,["sdkHttpResponse"],n),e}function da(t){const e={},n=i(t,["sdkHttpResponse"]);return n!=null&&a(e,["sdkHttpResponse"],n),e}function ca(t){const e={};if(i(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=i(t,["fileUri"]);n!=null&&a(e,["fileUri"],n);const s=i(t,["mimeType"]);return s!=null&&a(e,["mimeType"],s),e}function ua(t){const e={};if(i(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=i(t,["description"]);n!=null&&a(e,["description"],n);const s=i(t,["name"]);s!=null&&a(e,["name"],s);const r=i(t,["parameters"]);r!=null&&a(e,["parameters"],r);const l=i(t,["parametersJsonSchema"]);l!=null&&a(e,["parametersJsonSchema"],l);const d=i(t,["response"]);d!=null&&a(e,["response"],d);const c=i(t,["responseJsonSchema"]);return c!=null&&a(e,["responseJsonSchema"],c),e}function fa(t,e){const n={},s=i(e,["name"]);return s!=null&&a(n,["_url","name"],Fe(t,s)),n}function ma(t,e){const n={},s=i(e,["name"]);return s!=null&&a(n,["_url","name"],Fe(t,s)),n}function pa(t){const e={};if(i(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=i(t,["enableWidget"]);return n!=null&&a(e,["enableWidget"],n),e}function ha(t){const e={},n=i(t,["timeRangeFilter"]);if(n!=null&&a(e,["timeRangeFilter"],n),i(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");return e}function ga(t,e){const n={},s=i(t,["pageSize"]);e!==void 0&&s!=null&&a(e,["_query","pageSize"],s);const r=i(t,["pageToken"]);return e!==void 0&&r!=null&&a(e,["_query","pageToken"],r),n}function xa(t,e){const n={},s=i(t,["pageSize"]);e!==void 0&&s!=null&&a(e,["_query","pageSize"],s);const r=i(t,["pageToken"]);return e!==void 0&&r!=null&&a(e,["_query","pageToken"],r),n}function ya(t){const e={},n=i(t,["config"]);return n!=null&&ga(n,e),e}function va(t){const e={},n=i(t,["config"]);return n!=null&&xa(n,e),e}function ba(t){const e={},n=i(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const s=i(t,["nextPageToken"]);s!=null&&a(e,["nextPageToken"],s);const r=i(t,["cachedContents"]);if(r!=null){let l=r;Array.isArray(l)&&(l=l.map(d=>d)),a(e,["cachedContents"],l)}return e}function Ta(t){const e={},n=i(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const s=i(t,["nextPageToken"]);s!=null&&a(e,["nextPageToken"],s);const r=i(t,["cachedContents"]);if(r!=null){let l=r;Array.isArray(l)&&(l=l.map(d=>d)),a(e,["cachedContents"],l)}return e}function Na(t){const e={},n=i(t,["videoMetadata"]);n!=null&&a(e,["videoMetadata"],n);const s=i(t,["thought"]);s!=null&&a(e,["thought"],s);const r=i(t,["inlineData"]);r!=null&&a(e,["inlineData"],ta(r));const l=i(t,["fileData"]);l!=null&&a(e,["fileData"],ca(l));const d=i(t,["thoughtSignature"]);d!=null&&a(e,["thoughtSignature"],d);const c=i(t,["functionCall"]);c!=null&&a(e,["functionCall"],c);const f=i(t,["codeExecutionResult"]);f!=null&&a(e,["codeExecutionResult"],f);const u=i(t,["executableCode"]);u!=null&&a(e,["executableCode"],u);const m=i(t,["functionResponse"]);m!=null&&a(e,["functionResponse"],m);const p=i(t,["text"]);return p!=null&&a(e,["text"],p),e}function Ca(t){const e={},n=i(t,["functionDeclarations"]);if(n!=null){let u=n;Array.isArray(u)&&(u=u.map(m=>m)),a(e,["functionDeclarations"],u)}if(i(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=i(t,["googleSearch"]);s!=null&&a(e,["googleSearch"],ha(s));const r=i(t,["googleSearchRetrieval"]);if(r!=null&&a(e,["googleSearchRetrieval"],r),i(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const l=i(t,["googleMaps"]);l!=null&&a(e,["googleMaps"],pa(l));const d=i(t,["urlContext"]);d!=null&&a(e,["urlContext"],d);const c=i(t,["computerUse"]);c!=null&&a(e,["computerUse"],c);const f=i(t,["codeExecution"]);return f!=null&&a(e,["codeExecution"],f),e}function Ea(t){const e={},n=i(t,["functionDeclarations"]);if(n!=null){let p=n;Array.isArray(p)&&(p=p.map(h=>ua(h))),a(e,["functionDeclarations"],p)}const s=i(t,["retrieval"]);s!=null&&a(e,["retrieval"],s);const r=i(t,["googleSearch"]);r!=null&&a(e,["googleSearch"],r);const l=i(t,["googleSearchRetrieval"]);l!=null&&a(e,["googleSearchRetrieval"],l);const d=i(t,["enterpriseWebSearch"]);d!=null&&a(e,["enterpriseWebSearch"],d);const c=i(t,["googleMaps"]);c!=null&&a(e,["googleMaps"],c);const f=i(t,["urlContext"]);f!=null&&a(e,["urlContext"],f);const u=i(t,["computerUse"]);u!=null&&a(e,["computerUse"],u);const m=i(t,["codeExecution"]);return m!=null&&a(e,["codeExecution"],m),e}function wa(t,e){const n={},s=i(t,["ttl"]);e!==void 0&&s!=null&&a(e,["ttl"],s);const r=i(t,["expireTime"]);return e!==void 0&&r!=null&&a(e,["expireTime"],r),n}function _a(t,e){const n={},s=i(t,["ttl"]);e!==void 0&&s!=null&&a(e,["ttl"],s);const r=i(t,["expireTime"]);return e!==void 0&&r!=null&&a(e,["expireTime"],r),n}function Aa(t,e){const n={},s=i(e,["name"]);s!=null&&a(n,["_url","name"],Fe(t,s));const r=i(e,["config"]);return r!=null&&wa(r,n),n}function Sa(t,e){const n={},s=i(e,["name"]);s!=null&&a(n,["_url","name"],Fe(t,s));const r=i(e,["config"]);return r!=null&&_a(r,n),n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Ia extends We{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new At(Ye.PAGED_ITEM_CACHED_CONTENTS,s=>this.listInternal(s),await this.listInternal(n),n)}async create(e){var n,s,r,l;let d,c="",f={};if(this.apiClient.isVertexAI()){const u=ia(this.apiClient,e);return c=Q("cachedContents",u._url),f=u._query,delete u._url,delete u._query,d=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(m=>m.json()),d.then(m=>m)}else{const u=oa(this.apiClient,e);return c=Q("cachedContents",u._url),f=u._query,delete u._url,delete u._query,d=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json()),d.then(m=>m)}}async get(e){var n,s,r,l;let d,c="",f={};if(this.apiClient.isVertexAI()){const u=ma(this.apiClient,e);return c=Q("{name}",u._url),f=u._query,delete u._url,delete u._query,d=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(m=>m.json()),d.then(m=>m)}else{const u=fa(this.apiClient,e);return c=Q("{name}",u._url),f=u._query,delete u._url,delete u._query,d=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json()),d.then(m=>m)}}async delete(e){var n,s,r,l;let d,c="",f={};if(this.apiClient.isVertexAI()){const u=aa(this.apiClient,e);return c=Q("{name}",u._url),f=u._query,delete u._url,delete u._query,d=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(m=>m.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:m.headers},h})),d.then(m=>{const p=da(m),h=new $s;return Object.assign(h,p),h})}else{const u=ra(this.apiClient,e);return c=Q("{name}",u._url),f=u._query,delete u._url,delete u._query,d=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:m.headers},h})),d.then(m=>{const p=la(m),h=new $s;return Object.assign(h,p),h})}}async update(e){var n,s,r,l;let d,c="",f={};if(this.apiClient.isVertexAI()){const u=Sa(this.apiClient,e);return c=Q("{name}",u._url),f=u._query,delete u._url,delete u._query,d=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(m=>m.json()),d.then(m=>m)}else{const u=Aa(this.apiClient,e);return c=Q("{name}",u._url),f=u._query,delete u._url,delete u._query,d=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json()),d.then(m=>m)}}async listInternal(e){var n,s,r,l;let d,c="",f={};if(this.apiClient.isVertexAI()){const u=va(e);return c=Q("cachedContents",u._url),f=u._query,delete u._url,delete u._query,d=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(m=>m.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:m.headers},h})),d.then(m=>{const p=Ta(m),h=new Gs;return Object.assign(h,p),h})}else{const u=ya(e);return c=Q("cachedContents",u._url),f=u._query,delete u._url,delete u._query,d=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:m.headers},h})),d.then(m=>{const p=ba(m),h=new Gs;return Object.assign(h,p),h})}}}function Ks(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],s=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&s>=t.length&&(t=void 0),{value:t&&t[s++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ge(t){return this instanceof ge?(this.v=t,this):new ge(t)}function ot(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=n.apply(t,e||[]),r,l=[];return r=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),c("next"),c("throw"),c("return",d),r[Symbol.asyncIterator]=function(){return this},r;function d(v){return function(E){return Promise.resolve(E).then(v,p)}}function c(v,E){s[v]&&(r[v]=function(A){return new Promise(function(I,R){l.push([v,A,I,R])>1||f(v,A)})},E&&(r[v]=E(r[v])))}function f(v,E){try{u(s[v](E))}catch(A){h(l[0][3],A)}}function u(v){v.value instanceof ge?Promise.resolve(v.value.v).then(m,p):h(l[0][2],v)}function m(v){f("next",v)}function p(v){f("throw",v)}function h(v,E){v(E),l.shift(),l.length&&f(l[0][0],l[0][1])}}function wt(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof Ks=="function"?Ks(t):t[Symbol.iterator](),n={},s("next"),s("throw"),s("return"),n[Symbol.asyncIterator]=function(){return this},n);function s(l){n[l]=t[l]&&function(d){return new Promise(function(c,f){d=t[l](d),r(c,f,d.done,d.value)})}}function r(l,d,c,f){Promise.resolve(f).then(function(u){l({value:u,done:c})},d)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Ra(t){var e;if(t.candidates==null||t.candidates.length===0)return!1;const n=(e=t.candidates[0])===null||e===void 0?void 0:e.content;return n===void 0?!1:Do(n)}function Do(t){if(t.parts===void 0||t.parts.length===0)return!1;for(const e of t.parts)if(e===void 0||Object.keys(e).length===0)return!1;return!0}function Pa(t){if(t.length!==0){for(const e of t)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function Xs(t){if(t===void 0||t.length===0)return[];const e=[],n=t.length;let s=0;for(;s<n;)if(t[s].role==="user")e.push(t[s]),s++;else{const r=[];let l=!0;for(;s<n&&t[s].role==="model";)r.push(t[s]),l&&!Do(t[s])&&(l=!1),s++;l?e.push(...r):e.pop()}return e}class Ma{constructor(e,n){this.modelsModule=e,this.apiClient=n}create(e){return new ka(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class ka{constructor(e,n,s,r={},l=[]){this.apiClient=e,this.modelsModule=n,this.model=s,this.config=r,this.history=l,this.sendPromise=Promise.resolve(),Pa(l)}async sendMessage(e){var n;await this.sendPromise;const s=Ee(e.message),r=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(s),config:(n=e.config)!==null&&n!==void 0?n:this.config});return this.sendPromise=(async()=>{var l,d,c;const f=await r,u=(d=(l=f.candidates)===null||l===void 0?void 0:l[0])===null||d===void 0?void 0:d.content,m=f.automaticFunctionCallingHistory,p=this.getHistory(!0).length;let h=[];m!=null&&(h=(c=m.slice(p))!==null&&c!==void 0?c:[]);const v=u?[u]:[];this.recordHistory(s,v,h)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),r}async sendMessageStream(e){var n;await this.sendPromise;const s=Ee(e.message),r=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(s),config:(n=e.config)!==null&&n!==void 0?n:this.config});this.sendPromise=r.then(()=>{}).catch(()=>{});const l=await r;return this.processStreamResponse(l,s)}getHistory(e=!1){const n=e?Xs(this.history):this.history;return structuredClone(n)}processStreamResponse(e,n){var s,r;return ot(this,arguments,function*(){var d,c,f,u;const m=[];try{for(var p=!0,h=wt(e),v;v=yield ge(h.next()),d=v.done,!d;p=!0){u=v.value,p=!1;const E=u;if(Ra(E)){const A=(r=(s=E.candidates)===null||s===void 0?void 0:s[0])===null||r===void 0?void 0:r.content;A!==void 0&&m.push(A)}yield yield ge(E)}}catch(E){c={error:E}}finally{try{!p&&!d&&(f=h.return)&&(yield ge(f.call(h)))}finally{if(c)throw c.error}}this.recordHistory(n,m)})}recordHistory(e,n,s){let r=[];n.length>0&&n.every(l=>l.role!==void 0)?r=n:r.push({role:"model",parts:[]}),s&&s.length>0?this.history.push(...Xs(s)):this.history.push(e),this.history.push(...r)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class ln extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,ln.prototype)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Da(t){const e={},n=i(t,["file"]);return n!=null&&a(e,["file"],n),e}function La(t){const e={},n=i(t,["sdkHttpResponse"]);return n!=null&&a(e,["sdkHttpResponse"],n),e}function Fa(t){const e={},n=i(t,["name"]);return n!=null&&a(e,["_url","file"],Ao(n)),e}function Ua(t){const e={},n=i(t,["sdkHttpResponse"]);return n!=null&&a(e,["sdkHttpResponse"],n),e}function ja(t){const e={},n=i(t,["name"]);return n!=null&&a(e,["_url","file"],Ao(n)),e}function Va(t,e){const n={},s=i(t,["pageSize"]);e!==void 0&&s!=null&&a(e,["_query","pageSize"],s);const r=i(t,["pageToken"]);return e!==void 0&&r!=null&&a(e,["_query","pageToken"],r),n}function Ba(t){const e={},n=i(t,["config"]);return n!=null&&Va(n,e),e}function qa(t){const e={},n=i(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const s=i(t,["nextPageToken"]);s!=null&&a(e,["nextPageToken"],s);const r=i(t,["files"]);if(r!=null){let l=r;Array.isArray(l)&&(l=l.map(d=>d)),a(e,["files"],l)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class $a extends We{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new At(Ye.PAGED_ITEM_FILES,s=>this.listInternal(s),await this.listInternal(n),n)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(n=>n)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var n,s;let r,l="",d={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=Ba(e);return l=Q("files",c._url),d=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(u=>{const m=u;return m.sdkHttpResponse={headers:f.headers},m})),r.then(f=>{const u=qa(f),m=new Zi;return Object.assign(m,u),m})}}async createInternal(e){var n,s;let r,l="",d={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=Da(e);return l=Q("upload/v1beta/files",c._url),d=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),r.then(f=>{const u=La(f),m=new er;return Object.assign(m,u),m})}}async get(e){var n,s;let r,l="",d={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=ja(e);return l=Q("files/{file}",c._url),d=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),r.then(f=>f)}}async delete(e){var n,s;let r,l="",d={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=Fa(e);return l=Q("files/{file}",c._url),d=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(u=>{const m=u;return m.sdkHttpResponse={headers:f.headers},m})),r.then(f=>{const u=Ua(f),m=new tr;return Object.assign(m,u),m})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function tn(t){const e={};if(i(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=i(t,["data"]);n!=null&&a(e,["data"],n);const s=i(t,["mimeType"]);return s!=null&&a(e,["mimeType"],s),e}function Ga(t){const e={},n=i(t,["parts"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(l=>ol(l))),a(e,["parts"],r)}const s=i(t,["role"]);return s!=null&&a(e,["role"],s),e}function Ha(t){const e={};if(i(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=i(t,["fileUri"]);n!=null&&a(e,["fileUri"],n);const s=i(t,["mimeType"]);return s!=null&&a(e,["mimeType"],s),e}function Ja(t){const e={};if(i(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=i(t,["description"]);n!=null&&a(e,["description"],n);const s=i(t,["name"]);s!=null&&a(e,["name"],s);const r=i(t,["parameters"]);r!=null&&a(e,["parameters"],r);const l=i(t,["parametersJsonSchema"]);l!=null&&a(e,["parametersJsonSchema"],l);const d=i(t,["response"]);d!=null&&a(e,["response"],d);const c=i(t,["responseJsonSchema"]);return c!=null&&a(e,["responseJsonSchema"],c),e}function Oa(t){const e={},n=i(t,["modelSelectionConfig"]);n!=null&&a(e,["modelConfig"],n);const s=i(t,["audioTimestamp"]);s!=null&&a(e,["audioTimestamp"],s);const r=i(t,["candidateCount"]);r!=null&&a(e,["candidateCount"],r);const l=i(t,["enableAffectiveDialog"]);l!=null&&a(e,["enableAffectiveDialog"],l);const d=i(t,["frequencyPenalty"]);d!=null&&a(e,["frequencyPenalty"],d);const c=i(t,["logprobs"]);c!=null&&a(e,["logprobs"],c);const f=i(t,["maxOutputTokens"]);f!=null&&a(e,["maxOutputTokens"],f);const u=i(t,["mediaResolution"]);u!=null&&a(e,["mediaResolution"],u);const m=i(t,["presencePenalty"]);m!=null&&a(e,["presencePenalty"],m);const p=i(t,["responseJsonSchema"]);p!=null&&a(e,["responseJsonSchema"],p);const h=i(t,["responseLogprobs"]);h!=null&&a(e,["responseLogprobs"],h);const v=i(t,["responseMimeType"]);v!=null&&a(e,["responseMimeType"],v);const E=i(t,["responseModalities"]);E!=null&&a(e,["responseModalities"],E);const A=i(t,["responseSchema"]);A!=null&&a(e,["responseSchema"],A);const I=i(t,["routingConfig"]);I!=null&&a(e,["routingConfig"],I);const R=i(t,["seed"]);R!=null&&a(e,["seed"],R);const k=i(t,["speechConfig"]);k!=null&&a(e,["speechConfig"],Lo(k));const P=i(t,["stopSequences"]);P!=null&&a(e,["stopSequences"],P);const N=i(t,["temperature"]);N!=null&&a(e,["temperature"],N);const T=i(t,["thinkingConfig"]);T!=null&&a(e,["thinkingConfig"],T);const M=i(t,["topK"]);M!=null&&a(e,["topK"],M);const F=i(t,["topP"]);return F!=null&&a(e,["topP"],F),e}function Ya(t){const e={};if(i(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=i(t,["enableWidget"]);return n!=null&&a(e,["enableWidget"],n),e}function Wa(t){const e={},n=i(t,["timeRangeFilter"]);if(n!=null&&a(e,["timeRangeFilter"],n),i(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");return e}function za(t,e){const n={},s=i(t,["generationConfig"]);e!==void 0&&s!=null&&a(e,["setup","generationConfig"],s);const r=i(t,["responseModalities"]);e!==void 0&&r!=null&&a(e,["setup","generationConfig","responseModalities"],r);const l=i(t,["temperature"]);e!==void 0&&l!=null&&a(e,["setup","generationConfig","temperature"],l);const d=i(t,["topP"]);e!==void 0&&d!=null&&a(e,["setup","generationConfig","topP"],d);const c=i(t,["topK"]);e!==void 0&&c!=null&&a(e,["setup","generationConfig","topK"],c);const f=i(t,["maxOutputTokens"]);e!==void 0&&f!=null&&a(e,["setup","generationConfig","maxOutputTokens"],f);const u=i(t,["mediaResolution"]);e!==void 0&&u!=null&&a(e,["setup","generationConfig","mediaResolution"],u);const m=i(t,["seed"]);e!==void 0&&m!=null&&a(e,["setup","generationConfig","seed"],m);const p=i(t,["speechConfig"]);e!==void 0&&p!=null&&a(e,["setup","generationConfig","speechConfig"],Vn(p));const h=i(t,["thinkingConfig"]);e!==void 0&&h!=null&&a(e,["setup","generationConfig","thinkingConfig"],h);const v=i(t,["enableAffectiveDialog"]);e!==void 0&&v!=null&&a(e,["setup","generationConfig","enableAffectiveDialog"],v);const E=i(t,["systemInstruction"]);e!==void 0&&E!=null&&a(e,["setup","systemInstruction"],Ga(Ee(E)));const A=i(t,["tools"]);if(e!==void 0&&A!=null){let M=dt(A);Array.isArray(M)&&(M=M.map(F=>rl(lt(F)))),a(e,["setup","tools"],M)}const I=i(t,["sessionResumption"]);e!==void 0&&I!=null&&a(e,["setup","sessionResumption"],il(I));const R=i(t,["inputAudioTranscription"]);e!==void 0&&R!=null&&a(e,["setup","inputAudioTranscription"],R);const k=i(t,["outputAudioTranscription"]);e!==void 0&&k!=null&&a(e,["setup","outputAudioTranscription"],k);const P=i(t,["realtimeInputConfig"]);e!==void 0&&P!=null&&a(e,["setup","realtimeInputConfig"],P);const N=i(t,["contextWindowCompression"]);e!==void 0&&N!=null&&a(e,["setup","contextWindowCompression"],N);const T=i(t,["proactivity"]);return e!==void 0&&T!=null&&a(e,["setup","proactivity"],T),n}function Ka(t,e){const n={},s=i(t,["generationConfig"]);e!==void 0&&s!=null&&a(e,["setup","generationConfig"],Oa(s));const r=i(t,["responseModalities"]);e!==void 0&&r!=null&&a(e,["setup","generationConfig","responseModalities"],r);const l=i(t,["temperature"]);e!==void 0&&l!=null&&a(e,["setup","generationConfig","temperature"],l);const d=i(t,["topP"]);e!==void 0&&d!=null&&a(e,["setup","generationConfig","topP"],d);const c=i(t,["topK"]);e!==void 0&&c!=null&&a(e,["setup","generationConfig","topK"],c);const f=i(t,["maxOutputTokens"]);e!==void 0&&f!=null&&a(e,["setup","generationConfig","maxOutputTokens"],f);const u=i(t,["mediaResolution"]);e!==void 0&&u!=null&&a(e,["setup","generationConfig","mediaResolution"],u);const m=i(t,["seed"]);e!==void 0&&m!=null&&a(e,["setup","generationConfig","seed"],m);const p=i(t,["speechConfig"]);e!==void 0&&p!=null&&a(e,["setup","generationConfig","speechConfig"],Lo(Vn(p)));const h=i(t,["thinkingConfig"]);e!==void 0&&h!=null&&a(e,["setup","generationConfig","thinkingConfig"],h);const v=i(t,["enableAffectiveDialog"]);e!==void 0&&v!=null&&a(e,["setup","generationConfig","enableAffectiveDialog"],v);const E=i(t,["systemInstruction"]);e!==void 0&&E!=null&&a(e,["setup","systemInstruction"],Ee(E));const A=i(t,["tools"]);if(e!==void 0&&A!=null){let M=dt(A);Array.isArray(M)&&(M=M.map(F=>al(lt(F)))),a(e,["setup","tools"],M)}const I=i(t,["sessionResumption"]);e!==void 0&&I!=null&&a(e,["setup","sessionResumption"],I);const R=i(t,["inputAudioTranscription"]);e!==void 0&&R!=null&&a(e,["setup","inputAudioTranscription"],R);const k=i(t,["outputAudioTranscription"]);e!==void 0&&k!=null&&a(e,["setup","outputAudioTranscription"],k);const P=i(t,["realtimeInputConfig"]);e!==void 0&&P!=null&&a(e,["setup","realtimeInputConfig"],P);const N=i(t,["contextWindowCompression"]);e!==void 0&&N!=null&&a(e,["setup","contextWindowCompression"],N);const T=i(t,["proactivity"]);return e!==void 0&&T!=null&&a(e,["setup","proactivity"],T),n}function Xa(t,e){const n={},s=i(e,["model"]);s!=null&&a(n,["setup","model"],de(t,s));const r=i(e,["config"]);return r!=null&&a(n,["config"],za(r,n)),n}function Qa(t,e){const n={},s=i(e,["model"]);s!=null&&a(n,["setup","model"],de(t,s));const r=i(e,["config"]);return r!=null&&a(n,["config"],Ka(r,n)),n}function Za(t){const e={},n=i(t,["musicGenerationConfig"]);return n!=null&&a(e,["musicGenerationConfig"],n),e}function el(t){const e={},n=i(t,["weightedPrompts"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(r=>r)),a(e,["weightedPrompts"],s)}return e}function tl(t){const e={},n=i(t,["media"]);if(n!=null){let u=No(n);Array.isArray(u)&&(u=u.map(m=>tn(m))),a(e,["mediaChunks"],u)}const s=i(t,["audio"]);s!=null&&a(e,["audio"],tn(Eo(s)));const r=i(t,["audioStreamEnd"]);r!=null&&a(e,["audioStreamEnd"],r);const l=i(t,["video"]);l!=null&&a(e,["video"],tn(Co(l)));const d=i(t,["text"]);d!=null&&a(e,["text"],d);const c=i(t,["activityStart"]);c!=null&&a(e,["activityStart"],c);const f=i(t,["activityEnd"]);return f!=null&&a(e,["activityEnd"],f),e}function nl(t){const e={},n=i(t,["media"]);if(n!=null){let u=No(n);Array.isArray(u)&&(u=u.map(m=>m)),a(e,["mediaChunks"],u)}const s=i(t,["audio"]);s!=null&&a(e,["audio"],Eo(s));const r=i(t,["audioStreamEnd"]);r!=null&&a(e,["audioStreamEnd"],r);const l=i(t,["video"]);l!=null&&a(e,["video"],Co(l));const d=i(t,["text"]);d!=null&&a(e,["text"],d);const c=i(t,["activityStart"]);c!=null&&a(e,["activityStart"],c);const f=i(t,["activityEnd"]);return f!=null&&a(e,["activityEnd"],f),e}function sl(t){const e={},n=i(t,["setupComplete"]);n!=null&&a(e,["setupComplete"],n);const s=i(t,["serverContent"]);s!=null&&a(e,["serverContent"],s);const r=i(t,["toolCall"]);r!=null&&a(e,["toolCall"],r);const l=i(t,["toolCallCancellation"]);l!=null&&a(e,["toolCallCancellation"],l);const d=i(t,["usageMetadata"]);d!=null&&a(e,["usageMetadata"],ll(d));const c=i(t,["goAway"]);c!=null&&a(e,["goAway"],c);const f=i(t,["sessionResumptionUpdate"]);return f!=null&&a(e,["sessionResumptionUpdate"],f),e}function ol(t){const e={},n=i(t,["videoMetadata"]);n!=null&&a(e,["videoMetadata"],n);const s=i(t,["thought"]);s!=null&&a(e,["thought"],s);const r=i(t,["inlineData"]);r!=null&&a(e,["inlineData"],tn(r));const l=i(t,["fileData"]);l!=null&&a(e,["fileData"],Ha(l));const d=i(t,["thoughtSignature"]);d!=null&&a(e,["thoughtSignature"],d);const c=i(t,["functionCall"]);c!=null&&a(e,["functionCall"],c);const f=i(t,["codeExecutionResult"]);f!=null&&a(e,["codeExecutionResult"],f);const u=i(t,["executableCode"]);u!=null&&a(e,["executableCode"],u);const m=i(t,["functionResponse"]);m!=null&&a(e,["functionResponse"],m);const p=i(t,["text"]);return p!=null&&a(e,["text"],p),e}function il(t){const e={},n=i(t,["handle"]);if(n!=null&&a(e,["handle"],n),i(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function Lo(t){const e={},n=i(t,["voiceConfig"]);if(n!=null&&a(e,["voiceConfig"],n),i(t,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");const s=i(t,["languageCode"]);return s!=null&&a(e,["languageCode"],s),e}function rl(t){const e={},n=i(t,["functionDeclarations"]);if(n!=null){let u=n;Array.isArray(u)&&(u=u.map(m=>m)),a(e,["functionDeclarations"],u)}if(i(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=i(t,["googleSearch"]);s!=null&&a(e,["googleSearch"],Wa(s));const r=i(t,["googleSearchRetrieval"]);if(r!=null&&a(e,["googleSearchRetrieval"],r),i(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const l=i(t,["googleMaps"]);l!=null&&a(e,["googleMaps"],Ya(l));const d=i(t,["urlContext"]);d!=null&&a(e,["urlContext"],d);const c=i(t,["computerUse"]);c!=null&&a(e,["computerUse"],c);const f=i(t,["codeExecution"]);return f!=null&&a(e,["codeExecution"],f),e}function al(t){const e={},n=i(t,["functionDeclarations"]);if(n!=null){let p=n;Array.isArray(p)&&(p=p.map(h=>Ja(h))),a(e,["functionDeclarations"],p)}const s=i(t,["retrieval"]);s!=null&&a(e,["retrieval"],s);const r=i(t,["googleSearch"]);r!=null&&a(e,["googleSearch"],r);const l=i(t,["googleSearchRetrieval"]);l!=null&&a(e,["googleSearchRetrieval"],l);const d=i(t,["enterpriseWebSearch"]);d!=null&&a(e,["enterpriseWebSearch"],d);const c=i(t,["googleMaps"]);c!=null&&a(e,["googleMaps"],c);const f=i(t,["urlContext"]);f!=null&&a(e,["urlContext"],f);const u=i(t,["computerUse"]);u!=null&&a(e,["computerUse"],u);const m=i(t,["codeExecution"]);return m!=null&&a(e,["codeExecution"],m),e}function ll(t){const e={},n=i(t,["promptTokenCount"]);n!=null&&a(e,["promptTokenCount"],n);const s=i(t,["cachedContentTokenCount"]);s!=null&&a(e,["cachedContentTokenCount"],s);const r=i(t,["candidatesTokenCount"]);r!=null&&a(e,["responseTokenCount"],r);const l=i(t,["toolUsePromptTokenCount"]);l!=null&&a(e,["toolUsePromptTokenCount"],l);const d=i(t,["thoughtsTokenCount"]);d!=null&&a(e,["thoughtsTokenCount"],d);const c=i(t,["totalTokenCount"]);c!=null&&a(e,["totalTokenCount"],c);const f=i(t,["promptTokensDetails"]);if(f!=null){let v=f;Array.isArray(v)&&(v=v.map(E=>E)),a(e,["promptTokensDetails"],v)}const u=i(t,["cacheTokensDetails"]);if(u!=null){let v=u;Array.isArray(v)&&(v=v.map(E=>E)),a(e,["cacheTokensDetails"],v)}const m=i(t,["candidatesTokensDetails"]);if(m!=null){let v=m;Array.isArray(v)&&(v=v.map(E=>E)),a(e,["responseTokensDetails"],v)}const p=i(t,["toolUsePromptTokensDetails"]);if(p!=null){let v=p;Array.isArray(v)&&(v=v.map(E=>E)),a(e,["toolUsePromptTokensDetails"],v)}const h=i(t,["trafficType"]);return h!=null&&a(e,["trafficType"],h),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function dl(t){const e={};if(i(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=i(t,["data"]);n!=null&&a(e,["data"],n);const s=i(t,["mimeType"]);return s!=null&&a(e,["mimeType"],s),e}function cl(t){const e={},n=i(t,["content"]);n!=null&&a(e,["content"],n);const s=i(t,["citationMetadata"]);s!=null&&a(e,["citationMetadata"],ul(s));const r=i(t,["tokenCount"]);r!=null&&a(e,["tokenCount"],r);const l=i(t,["finishReason"]);l!=null&&a(e,["finishReason"],l);const d=i(t,["urlContextMetadata"]);d!=null&&a(e,["urlContextMetadata"],d);const c=i(t,["avgLogprobs"]);c!=null&&a(e,["avgLogprobs"],c);const f=i(t,["groundingMetadata"]);f!=null&&a(e,["groundingMetadata"],f);const u=i(t,["index"]);u!=null&&a(e,["index"],u);const m=i(t,["logprobsResult"]);m!=null&&a(e,["logprobsResult"],m);const p=i(t,["safetyRatings"]);if(p!=null){let h=p;Array.isArray(h)&&(h=h.map(v=>v)),a(e,["safetyRatings"],h)}return e}function ul(t){const e={},n=i(t,["citationSources"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(r=>r)),a(e,["citations"],s)}return e}function fl(t,e){const n={},s=i(e,["model"]);s!=null&&a(n,["_url","model"],de(t,s));const r=i(e,["contents"]);if(r!=null){let l=Ae(r);Array.isArray(l)&&(l=l.map(d=>d)),a(n,["contents"],l)}return n}function ml(t){const e={},n=i(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const s=i(t,["tokensInfo"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(l=>l)),a(e,["tokensInfo"],r)}return e}function pl(t){const e={},n=i(t,["values"]);n!=null&&a(e,["values"],n);const s=i(t,["statistics"]);return s!=null&&a(e,["statistics"],hl(s)),e}function hl(t){const e={},n=i(t,["truncated"]);n!=null&&a(e,["truncated"],n);const s=i(t,["token_count"]);return s!=null&&a(e,["tokenCount"],s),e}function dn(t){const e={},n=i(t,["parts"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(l=>bd(l))),a(e,["parts"],r)}const s=i(t,["role"]);return s!=null&&a(e,["role"],s),e}function gl(t){const e={},n=i(t,["controlType"]);n!=null&&a(e,["controlType"],n);const s=i(t,["enableControlImageComputation"]);return s!=null&&a(e,["computeControl"],s),e}function xl(t){const e={};if(i(t,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(i(t,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(i(t,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function yl(t,e){const n={},s=i(t,["systemInstruction"]);e!==void 0&&s!=null&&a(e,["systemInstruction"],Ee(s));const r=i(t,["tools"]);if(e!==void 0&&r!=null){let d=r;Array.isArray(d)&&(d=d.map(c=>Bo(c))),a(e,["tools"],d)}const l=i(t,["generationConfig"]);return e!==void 0&&l!=null&&a(e,["generationConfig"],ad(l)),n}function vl(t,e){const n={},s=i(e,["model"]);s!=null&&a(n,["_url","model"],de(t,s));const r=i(e,["contents"]);if(r!=null){let d=Ae(r);Array.isArray(d)&&(d=d.map(c=>dn(c))),a(n,["contents"],d)}const l=i(e,["config"]);return l!=null&&xl(l),n}function bl(t,e){const n={},s=i(e,["model"]);s!=null&&a(n,["_url","model"],de(t,s));const r=i(e,["contents"]);if(r!=null){let d=Ae(r);Array.isArray(d)&&(d=d.map(c=>c)),a(n,["contents"],d)}const l=i(e,["config"]);return l!=null&&yl(l,n),n}function Tl(t){const e={},n=i(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const s=i(t,["totalTokens"]);s!=null&&a(e,["totalTokens"],s);const r=i(t,["cachedContentTokenCount"]);return r!=null&&a(e,["cachedContentTokenCount"],r),e}function Nl(t){const e={},n=i(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const s=i(t,["totalTokens"]);return s!=null&&a(e,["totalTokens"],s),e}function Cl(t,e){const n={},s=i(e,["model"]);return s!=null&&a(n,["_url","name"],de(t,s)),n}function El(t,e){const n={},s=i(e,["model"]);return s!=null&&a(n,["_url","name"],de(t,s)),n}function wl(t){const e={},n=i(t,["sdkHttpResponse"]);return n!=null&&a(e,["sdkHttpResponse"],n),e}function _l(t){const e={},n=i(t,["sdkHttpResponse"]);return n!=null&&a(e,["sdkHttpResponse"],n),e}function Al(t,e){const n={},s=i(t,["outputGcsUri"]);e!==void 0&&s!=null&&a(e,["parameters","storageUri"],s);const r=i(t,["negativePrompt"]);e!==void 0&&r!=null&&a(e,["parameters","negativePrompt"],r);const l=i(t,["numberOfImages"]);e!==void 0&&l!=null&&a(e,["parameters","sampleCount"],l);const d=i(t,["aspectRatio"]);e!==void 0&&d!=null&&a(e,["parameters","aspectRatio"],d);const c=i(t,["guidanceScale"]);e!==void 0&&c!=null&&a(e,["parameters","guidanceScale"],c);const f=i(t,["seed"]);e!==void 0&&f!=null&&a(e,["parameters","seed"],f);const u=i(t,["safetyFilterLevel"]);e!==void 0&&u!=null&&a(e,["parameters","safetySetting"],u);const m=i(t,["personGeneration"]);e!==void 0&&m!=null&&a(e,["parameters","personGeneration"],m);const p=i(t,["includeSafetyAttributes"]);e!==void 0&&p!=null&&a(e,["parameters","includeSafetyAttributes"],p);const h=i(t,["includeRaiReason"]);e!==void 0&&h!=null&&a(e,["parameters","includeRaiReason"],h);const v=i(t,["language"]);e!==void 0&&v!=null&&a(e,["parameters","language"],v);const E=i(t,["outputMimeType"]);e!==void 0&&E!=null&&a(e,["parameters","outputOptions","mimeType"],E);const A=i(t,["outputCompressionQuality"]);e!==void 0&&A!=null&&a(e,["parameters","outputOptions","compressionQuality"],A);const I=i(t,["addWatermark"]);e!==void 0&&I!=null&&a(e,["parameters","addWatermark"],I);const R=i(t,["labels"]);e!==void 0&&R!=null&&a(e,["labels"],R);const k=i(t,["editMode"]);e!==void 0&&k!=null&&a(e,["parameters","editMode"],k);const P=i(t,["baseSteps"]);return e!==void 0&&P!=null&&a(e,["parameters","editConfig","baseSteps"],P),n}function Sl(t,e){const n={},s=i(e,["model"]);s!=null&&a(n,["_url","model"],de(t,s));const r=i(e,["prompt"]);r!=null&&a(n,["instances[0]","prompt"],r);const l=i(e,["referenceImages"]);if(l!=null){let c=l;Array.isArray(c)&&(c=c.map(f=>_d(f))),a(n,["instances[0]","referenceImages"],c)}const d=i(e,["config"]);return d!=null&&Al(d,n),n}function Il(t){const e={},n=i(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const s=i(t,["predictions"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(l=>cn(l))),a(e,["generatedImages"],r)}return e}function Rl(t,e){const n={},s=i(t,["taskType"]);e!==void 0&&s!=null&&a(e,["requests[]","taskType"],s);const r=i(t,["title"]);e!==void 0&&r!=null&&a(e,["requests[]","title"],r);const l=i(t,["outputDimensionality"]);if(e!==void 0&&l!=null&&a(e,["requests[]","outputDimensionality"],l),i(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(i(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function Pl(t,e){const n={},s=i(t,["taskType"]);e!==void 0&&s!=null&&a(e,["instances[]","task_type"],s);const r=i(t,["title"]);e!==void 0&&r!=null&&a(e,["instances[]","title"],r);const l=i(t,["outputDimensionality"]);e!==void 0&&l!=null&&a(e,["parameters","outputDimensionality"],l);const d=i(t,["mimeType"]);e!==void 0&&d!=null&&a(e,["instances[]","mimeType"],d);const c=i(t,["autoTruncate"]);return e!==void 0&&c!=null&&a(e,["parameters","autoTruncate"],c),n}function Ml(t,e){const n={},s=i(e,["model"]);s!=null&&a(n,["_url","model"],de(t,s));const r=i(e,["contents"]);if(r!=null){let c=Fn(t,r);Array.isArray(c)&&(c=c.map(f=>f)),a(n,["requests[]","content"],c)}const l=i(e,["config"]);l!=null&&Rl(l,n);const d=i(e,["model"]);return d!==void 0&&a(n,["requests[]","model"],de(t,d)),n}function kl(t,e){const n={},s=i(e,["model"]);s!=null&&a(n,["_url","model"],de(t,s));const r=i(e,["contents"]);if(r!=null){let d=Fn(t,r);Array.isArray(d)&&(d=d.map(c=>c)),a(n,["instances[]","content"],d)}const l=i(e,["config"]);return l!=null&&Pl(l,n),n}function Dl(t){const e={},n=i(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const s=i(t,["embeddings"]);if(s!=null){let l=s;Array.isArray(l)&&(l=l.map(d=>d)),a(e,["embeddings"],l)}const r=i(t,["metadata"]);return r!=null&&a(e,["metadata"],r),e}function Ll(t){const e={},n=i(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const s=i(t,["predictions[]","embeddings"]);if(s!=null){let l=s;Array.isArray(l)&&(l=l.map(d=>pl(d))),a(e,["embeddings"],l)}const r=i(t,["metadata"]);return r!=null&&a(e,["metadata"],r),e}function Fl(t){const e={},n=i(t,["endpoint"]);n!=null&&a(e,["name"],n);const s=i(t,["deployedModelId"]);return s!=null&&a(e,["deployedModelId"],s),e}function Ul(t){const e={};if(i(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=i(t,["fileUri"]);n!=null&&a(e,["fileUri"],n);const s=i(t,["mimeType"]);return s!=null&&a(e,["mimeType"],s),e}function jl(t){const e={};if(i(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=i(t,["description"]);n!=null&&a(e,["description"],n);const s=i(t,["name"]);s!=null&&a(e,["name"],s);const r=i(t,["parameters"]);r!=null&&a(e,["parameters"],r);const l=i(t,["parametersJsonSchema"]);l!=null&&a(e,["parametersJsonSchema"],l);const d=i(t,["response"]);d!=null&&a(e,["response"],d);const c=i(t,["responseJsonSchema"]);return c!=null&&a(e,["responseJsonSchema"],c),e}function Vl(t,e,n){const s={},r=i(e,["systemInstruction"]);n!==void 0&&r!=null&&a(n,["systemInstruction"],dn(Ee(r)));const l=i(e,["temperature"]);l!=null&&a(s,["temperature"],l);const d=i(e,["topP"]);d!=null&&a(s,["topP"],d);const c=i(e,["topK"]);c!=null&&a(s,["topK"],c);const f=i(e,["candidateCount"]);f!=null&&a(s,["candidateCount"],f);const u=i(e,["maxOutputTokens"]);u!=null&&a(s,["maxOutputTokens"],u);const m=i(e,["stopSequences"]);m!=null&&a(s,["stopSequences"],m);const p=i(e,["responseLogprobs"]);p!=null&&a(s,["responseLogprobs"],p);const h=i(e,["logprobs"]);h!=null&&a(s,["logprobs"],h);const v=i(e,["presencePenalty"]);v!=null&&a(s,["presencePenalty"],v);const E=i(e,["frequencyPenalty"]);E!=null&&a(s,["frequencyPenalty"],E);const A=i(e,["seed"]);A!=null&&a(s,["seed"],A);const I=i(e,["responseMimeType"]);I!=null&&a(s,["responseMimeType"],I);const R=i(e,["responseSchema"]);R!=null&&a(s,["responseSchema"],Un(R));const k=i(e,["responseJsonSchema"]);if(k!=null&&a(s,["responseJsonSchema"],k),i(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(i(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const P=i(e,["safetySettings"]);if(n!==void 0&&P!=null){let B=P;Array.isArray(B)&&(B=B.map(ne=>Ad(ne))),a(n,["safetySettings"],B)}const N=i(e,["tools"]);if(n!==void 0&&N!=null){let B=dt(N);Array.isArray(B)&&(B=B.map(ne=>kd(lt(ne)))),a(n,["tools"],B)}const T=i(e,["toolConfig"]);if(n!==void 0&&T!=null&&a(n,["toolConfig"],T),i(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const M=i(e,["cachedContent"]);n!==void 0&&M!=null&&a(n,["cachedContent"],Fe(t,M));const F=i(e,["responseModalities"]);F!=null&&a(s,["responseModalities"],F);const j=i(e,["mediaResolution"]);j!=null&&a(s,["mediaResolution"],j);const L=i(e,["speechConfig"]);if(L!=null&&a(s,["speechConfig"],jn(L)),i(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const x=i(e,["thinkingConfig"]);x!=null&&a(s,["thinkingConfig"],x);const D=i(e,["imageConfig"]);return D!=null&&a(s,["imageConfig"],D),s}function Bl(t,e,n){const s={},r=i(e,["systemInstruction"]);n!==void 0&&r!=null&&a(n,["systemInstruction"],Ee(r));const l=i(e,["temperature"]);l!=null&&a(s,["temperature"],l);const d=i(e,["topP"]);d!=null&&a(s,["topP"],d);const c=i(e,["topK"]);c!=null&&a(s,["topK"],c);const f=i(e,["candidateCount"]);f!=null&&a(s,["candidateCount"],f);const u=i(e,["maxOutputTokens"]);u!=null&&a(s,["maxOutputTokens"],u);const m=i(e,["stopSequences"]);m!=null&&a(s,["stopSequences"],m);const p=i(e,["responseLogprobs"]);p!=null&&a(s,["responseLogprobs"],p);const h=i(e,["logprobs"]);h!=null&&a(s,["logprobs"],h);const v=i(e,["presencePenalty"]);v!=null&&a(s,["presencePenalty"],v);const E=i(e,["frequencyPenalty"]);E!=null&&a(s,["frequencyPenalty"],E);const A=i(e,["seed"]);A!=null&&a(s,["seed"],A);const I=i(e,["responseMimeType"]);I!=null&&a(s,["responseMimeType"],I);const R=i(e,["responseSchema"]);R!=null&&a(s,["responseSchema"],Un(R));const k=i(e,["responseJsonSchema"]);k!=null&&a(s,["responseJsonSchema"],k);const P=i(e,["routingConfig"]);P!=null&&a(s,["routingConfig"],P);const N=i(e,["modelSelectionConfig"]);N!=null&&a(s,["modelConfig"],N);const T=i(e,["safetySettings"]);if(n!==void 0&&T!=null){let le=T;Array.isArray(le)&&(le=le.map(Y=>Y)),a(n,["safetySettings"],le)}const M=i(e,["tools"]);if(n!==void 0&&M!=null){let le=dt(M);Array.isArray(le)&&(le=le.map(Y=>Bo(lt(Y)))),a(n,["tools"],le)}const F=i(e,["toolConfig"]);n!==void 0&&F!=null&&a(n,["toolConfig"],F);const j=i(e,["labels"]);n!==void 0&&j!=null&&a(n,["labels"],j);const L=i(e,["cachedContent"]);n!==void 0&&L!=null&&a(n,["cachedContent"],Fe(t,L));const x=i(e,["responseModalities"]);x!=null&&a(s,["responseModalities"],x);const D=i(e,["mediaResolution"]);D!=null&&a(s,["mediaResolution"],D);const B=i(e,["speechConfig"]);B!=null&&a(s,["speechConfig"],Vo(jn(B)));const ne=i(e,["audioTimestamp"]);ne!=null&&a(s,["audioTimestamp"],ne);const me=i(e,["thinkingConfig"]);me!=null&&a(s,["thinkingConfig"],me);const ie=i(e,["imageConfig"]);return ie!=null&&a(s,["imageConfig"],ie),s}function Qs(t,e){const n={},s=i(e,["model"]);s!=null&&a(n,["_url","model"],de(t,s));const r=i(e,["contents"]);if(r!=null){let d=Ae(r);Array.isArray(d)&&(d=d.map(c=>dn(c))),a(n,["contents"],d)}const l=i(e,["config"]);return l!=null&&a(n,["generationConfig"],Vl(t,l,n)),n}function Zs(t,e){const n={},s=i(e,["model"]);s!=null&&a(n,["_url","model"],de(t,s));const r=i(e,["contents"]);if(r!=null){let d=Ae(r);Array.isArray(d)&&(d=d.map(c=>c)),a(n,["contents"],d)}const l=i(e,["config"]);return l!=null&&a(n,["generationConfig"],Bl(t,l,n)),n}function eo(t){const e={},n=i(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const s=i(t,["candidates"]);if(s!=null){let f=s;Array.isArray(f)&&(f=f.map(u=>cl(u))),a(e,["candidates"],f)}const r=i(t,["modelVersion"]);r!=null&&a(e,["modelVersion"],r);const l=i(t,["promptFeedback"]);l!=null&&a(e,["promptFeedback"],l);const d=i(t,["responseId"]);d!=null&&a(e,["responseId"],d);const c=i(t,["usageMetadata"]);return c!=null&&a(e,["usageMetadata"],c),e}function to(t){const e={},n=i(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const s=i(t,["candidates"]);if(s!=null){let u=s;Array.isArray(u)&&(u=u.map(m=>m)),a(e,["candidates"],u)}const r=i(t,["createTime"]);r!=null&&a(e,["createTime"],r);const l=i(t,["modelVersion"]);l!=null&&a(e,["modelVersion"],l);const d=i(t,["promptFeedback"]);d!=null&&a(e,["promptFeedback"],d);const c=i(t,["responseId"]);c!=null&&a(e,["responseId"],c);const f=i(t,["usageMetadata"]);return f!=null&&a(e,["usageMetadata"],f),e}function ql(t,e){const n={};if(i(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(i(t,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const s=i(t,["numberOfImages"]);e!==void 0&&s!=null&&a(e,["parameters","sampleCount"],s);const r=i(t,["aspectRatio"]);e!==void 0&&r!=null&&a(e,["parameters","aspectRatio"],r);const l=i(t,["guidanceScale"]);if(e!==void 0&&l!=null&&a(e,["parameters","guidanceScale"],l),i(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const d=i(t,["safetyFilterLevel"]);e!==void 0&&d!=null&&a(e,["parameters","safetySetting"],d);const c=i(t,["personGeneration"]);e!==void 0&&c!=null&&a(e,["parameters","personGeneration"],c);const f=i(t,["includeSafetyAttributes"]);e!==void 0&&f!=null&&a(e,["parameters","includeSafetyAttributes"],f);const u=i(t,["includeRaiReason"]);e!==void 0&&u!=null&&a(e,["parameters","includeRaiReason"],u);const m=i(t,["language"]);e!==void 0&&m!=null&&a(e,["parameters","language"],m);const p=i(t,["outputMimeType"]);e!==void 0&&p!=null&&a(e,["parameters","outputOptions","mimeType"],p);const h=i(t,["outputCompressionQuality"]);if(e!==void 0&&h!=null&&a(e,["parameters","outputOptions","compressionQuality"],h),i(t,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(i(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const v=i(t,["imageSize"]);if(e!==void 0&&v!=null&&a(e,["parameters","sampleImageSize"],v),i(t,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return n}function $l(t,e){const n={},s=i(t,["outputGcsUri"]);e!==void 0&&s!=null&&a(e,["parameters","storageUri"],s);const r=i(t,["negativePrompt"]);e!==void 0&&r!=null&&a(e,["parameters","negativePrompt"],r);const l=i(t,["numberOfImages"]);e!==void 0&&l!=null&&a(e,["parameters","sampleCount"],l);const d=i(t,["aspectRatio"]);e!==void 0&&d!=null&&a(e,["parameters","aspectRatio"],d);const c=i(t,["guidanceScale"]);e!==void 0&&c!=null&&a(e,["parameters","guidanceScale"],c);const f=i(t,["seed"]);e!==void 0&&f!=null&&a(e,["parameters","seed"],f);const u=i(t,["safetyFilterLevel"]);e!==void 0&&u!=null&&a(e,["parameters","safetySetting"],u);const m=i(t,["personGeneration"]);e!==void 0&&m!=null&&a(e,["parameters","personGeneration"],m);const p=i(t,["includeSafetyAttributes"]);e!==void 0&&p!=null&&a(e,["parameters","includeSafetyAttributes"],p);const h=i(t,["includeRaiReason"]);e!==void 0&&h!=null&&a(e,["parameters","includeRaiReason"],h);const v=i(t,["language"]);e!==void 0&&v!=null&&a(e,["parameters","language"],v);const E=i(t,["outputMimeType"]);e!==void 0&&E!=null&&a(e,["parameters","outputOptions","mimeType"],E);const A=i(t,["outputCompressionQuality"]);e!==void 0&&A!=null&&a(e,["parameters","outputOptions","compressionQuality"],A);const I=i(t,["addWatermark"]);e!==void 0&&I!=null&&a(e,["parameters","addWatermark"],I);const R=i(t,["labels"]);e!==void 0&&R!=null&&a(e,["labels"],R);const k=i(t,["imageSize"]);e!==void 0&&k!=null&&a(e,["parameters","sampleImageSize"],k);const P=i(t,["enhancePrompt"]);return e!==void 0&&P!=null&&a(e,["parameters","enhancePrompt"],P),n}function Gl(t,e){const n={},s=i(e,["model"]);s!=null&&a(n,["_url","model"],de(t,s));const r=i(e,["prompt"]);r!=null&&a(n,["instances[0]","prompt"],r);const l=i(e,["config"]);return l!=null&&ql(l,n),n}function Hl(t,e){const n={},s=i(e,["model"]);s!=null&&a(n,["_url","model"],de(t,s));const r=i(e,["prompt"]);r!=null&&a(n,["instances[0]","prompt"],r);const l=i(e,["config"]);return l!=null&&$l(l,n),n}function Jl(t){const e={},n=i(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const s=i(t,["predictions"]);if(s!=null){let l=s;Array.isArray(l)&&(l=l.map(d=>sd(d))),a(e,["generatedImages"],l)}const r=i(t,["positivePromptSafetyAttributes"]);return r!=null&&a(e,["positivePromptSafetyAttributes"],Uo(r)),e}function Ol(t){const e={},n=i(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const s=i(t,["predictions"]);if(s!=null){let l=s;Array.isArray(l)&&(l=l.map(d=>cn(d))),a(e,["generatedImages"],l)}const r=i(t,["positivePromptSafetyAttributes"]);return r!=null&&a(e,["positivePromptSafetyAttributes"],jo(r)),e}function Yl(t,e){const n={},s=i(t,["numberOfVideos"]);if(e!==void 0&&s!=null&&a(e,["parameters","sampleCount"],s),i(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(i(t,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const r=i(t,["durationSeconds"]);if(e!==void 0&&r!=null&&a(e,["parameters","durationSeconds"],r),i(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const l=i(t,["aspectRatio"]);e!==void 0&&l!=null&&a(e,["parameters","aspectRatio"],l);const d=i(t,["resolution"]);e!==void 0&&d!=null&&a(e,["parameters","resolution"],d);const c=i(t,["personGeneration"]);if(e!==void 0&&c!=null&&a(e,["parameters","personGeneration"],c),i(t,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const f=i(t,["negativePrompt"]);e!==void 0&&f!=null&&a(e,["parameters","negativePrompt"],f);const u=i(t,["enhancePrompt"]);if(e!==void 0&&u!=null&&a(e,["parameters","enhancePrompt"],u),i(t,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");const m=i(t,["lastFrame"]);e!==void 0&&m!=null&&a(e,["instances[0]","lastFrame"],un(m));const p=i(t,["referenceImages"]);if(e!==void 0&&p!=null){let h=p;Array.isArray(h)&&(h=h.map(v=>Od(v))),a(e,["instances[0]","referenceImages"],h)}if(i(t,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(i(t,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return n}function Wl(t,e){const n={},s=i(t,["numberOfVideos"]);e!==void 0&&s!=null&&a(e,["parameters","sampleCount"],s);const r=i(t,["outputGcsUri"]);e!==void 0&&r!=null&&a(e,["parameters","storageUri"],r);const l=i(t,["fps"]);e!==void 0&&l!=null&&a(e,["parameters","fps"],l);const d=i(t,["durationSeconds"]);e!==void 0&&d!=null&&a(e,["parameters","durationSeconds"],d);const c=i(t,["seed"]);e!==void 0&&c!=null&&a(e,["parameters","seed"],c);const f=i(t,["aspectRatio"]);e!==void 0&&f!=null&&a(e,["parameters","aspectRatio"],f);const u=i(t,["resolution"]);e!==void 0&&u!=null&&a(e,["parameters","resolution"],u);const m=i(t,["personGeneration"]);e!==void 0&&m!=null&&a(e,["parameters","personGeneration"],m);const p=i(t,["pubsubTopic"]);e!==void 0&&p!=null&&a(e,["parameters","pubsubTopic"],p);const h=i(t,["negativePrompt"]);e!==void 0&&h!=null&&a(e,["parameters","negativePrompt"],h);const v=i(t,["enhancePrompt"]);e!==void 0&&v!=null&&a(e,["parameters","enhancePrompt"],v);const E=i(t,["generateAudio"]);e!==void 0&&E!=null&&a(e,["parameters","generateAudio"],E);const A=i(t,["lastFrame"]);e!==void 0&&A!=null&&a(e,["instances[0]","lastFrame"],Re(A));const I=i(t,["referenceImages"]);if(e!==void 0&&I!=null){let P=I;Array.isArray(P)&&(P=P.map(N=>Yd(N))),a(e,["instances[0]","referenceImages"],P)}const R=i(t,["mask"]);e!==void 0&&R!=null&&a(e,["instances[0]","mask"],Jd(R));const k=i(t,["compressionQuality"]);return e!==void 0&&k!=null&&a(e,["parameters","compressionQuality"],k),n}function zl(t){const e={},n=i(t,["name"]);n!=null&&a(e,["name"],n);const s=i(t,["metadata"]);s!=null&&a(e,["metadata"],s);const r=i(t,["done"]);r!=null&&a(e,["done"],r);const l=i(t,["error"]);l!=null&&a(e,["error"],l);const d=i(t,["response","generateVideoResponse"]);return d!=null&&a(e,["response"],Zl(d)),e}function Kl(t){const e={},n=i(t,["name"]);n!=null&&a(e,["name"],n);const s=i(t,["metadata"]);s!=null&&a(e,["metadata"],s);const r=i(t,["done"]);r!=null&&a(e,["done"],r);const l=i(t,["error"]);l!=null&&a(e,["error"],l);const d=i(t,["response"]);return d!=null&&a(e,["response"],ed(d)),e}function Xl(t,e){const n={},s=i(e,["model"]);s!=null&&a(n,["_url","model"],de(t,s));const r=i(e,["prompt"]);r!=null&&a(n,["instances[0]","prompt"],r);const l=i(e,["image"]);l!=null&&a(n,["instances[0]","image"],un(l));const d=i(e,["video"]);d!=null&&a(n,["instances[0]","video"],qo(d));const c=i(e,["source"]);c!=null&&td(c,n);const f=i(e,["config"]);return f!=null&&Yl(f,n),n}function Ql(t,e){const n={},s=i(e,["model"]);s!=null&&a(n,["_url","model"],de(t,s));const r=i(e,["prompt"]);r!=null&&a(n,["instances[0]","prompt"],r);const l=i(e,["image"]);l!=null&&a(n,["instances[0]","image"],Re(l));const d=i(e,["video"]);d!=null&&a(n,["instances[0]","video"],$o(d));const c=i(e,["source"]);c!=null&&nd(c,n);const f=i(e,["config"]);return f!=null&&Wl(f,n),n}function Zl(t){const e={},n=i(t,["generatedSamples"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(d=>id(d))),a(e,["generatedVideos"],l)}const s=i(t,["raiMediaFilteredCount"]);s!=null&&a(e,["raiMediaFilteredCount"],s);const r=i(t,["raiMediaFilteredReasons"]);return r!=null&&a(e,["raiMediaFilteredReasons"],r),e}function ed(t){const e={},n=i(t,["videos"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(d=>rd(d))),a(e,["generatedVideos"],l)}const s=i(t,["raiMediaFilteredCount"]);s!=null&&a(e,["raiMediaFilteredCount"],s);const r=i(t,["raiMediaFilteredReasons"]);return r!=null&&a(e,["raiMediaFilteredReasons"],r),e}function td(t,e){const n={},s=i(t,["prompt"]);e!==void 0&&s!=null&&a(e,["instances[0]","prompt"],s);const r=i(t,["image"]);e!==void 0&&r!=null&&a(e,["instances[0]","image"],un(r));const l=i(t,["video"]);return e!==void 0&&l!=null&&a(e,["instances[0]","video"],qo(l)),n}function nd(t,e){const n={},s=i(t,["prompt"]);e!==void 0&&s!=null&&a(e,["instances[0]","prompt"],s);const r=i(t,["image"]);e!==void 0&&r!=null&&a(e,["instances[0]","image"],Re(r));const l=i(t,["video"]);return e!==void 0&&l!=null&&a(e,["instances[0]","video"],$o(l)),n}function sd(t){const e={},n=i(t,["_self"]);n!=null&&a(e,["image"],fd(n));const s=i(t,["raiFilteredReason"]);s!=null&&a(e,["raiFilteredReason"],s);const r=i(t,["_self"]);return r!=null&&a(e,["safetyAttributes"],Uo(r)),e}function cn(t){const e={},n=i(t,["_self"]);n!=null&&a(e,["image"],Fo(n));const s=i(t,["raiFilteredReason"]);s!=null&&a(e,["raiFilteredReason"],s);const r=i(t,["_self"]);r!=null&&a(e,["safetyAttributes"],jo(r));const l=i(t,["prompt"]);return l!=null&&a(e,["enhancedPrompt"],l),e}function od(t){const e={},n=i(t,["_self"]);n!=null&&a(e,["mask"],Fo(n));const s=i(t,["labels"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(l=>l)),a(e,["labels"],r)}return e}function id(t){const e={},n=i(t,["video"]);return n!=null&&a(e,["video"],Gd(n)),e}function rd(t){const e={},n=i(t,["_self"]);return n!=null&&a(e,["video"],Hd(n)),e}function ad(t){const e={},n=i(t,["modelSelectionConfig"]);n!=null&&a(e,["modelConfig"],n);const s=i(t,["audioTimestamp"]);s!=null&&a(e,["audioTimestamp"],s);const r=i(t,["candidateCount"]);r!=null&&a(e,["candidateCount"],r);const l=i(t,["enableAffectiveDialog"]);l!=null&&a(e,["enableAffectiveDialog"],l);const d=i(t,["frequencyPenalty"]);d!=null&&a(e,["frequencyPenalty"],d);const c=i(t,["logprobs"]);c!=null&&a(e,["logprobs"],c);const f=i(t,["maxOutputTokens"]);f!=null&&a(e,["maxOutputTokens"],f);const u=i(t,["mediaResolution"]);u!=null&&a(e,["mediaResolution"],u);const m=i(t,["presencePenalty"]);m!=null&&a(e,["presencePenalty"],m);const p=i(t,["responseJsonSchema"]);p!=null&&a(e,["responseJsonSchema"],p);const h=i(t,["responseLogprobs"]);h!=null&&a(e,["responseLogprobs"],h);const v=i(t,["responseMimeType"]);v!=null&&a(e,["responseMimeType"],v);const E=i(t,["responseModalities"]);E!=null&&a(e,["responseModalities"],E);const A=i(t,["responseSchema"]);A!=null&&a(e,["responseSchema"],A);const I=i(t,["routingConfig"]);I!=null&&a(e,["routingConfig"],I);const R=i(t,["seed"]);R!=null&&a(e,["seed"],R);const k=i(t,["speechConfig"]);k!=null&&a(e,["speechConfig"],Vo(k));const P=i(t,["stopSequences"]);P!=null&&a(e,["stopSequences"],P);const N=i(t,["temperature"]);N!=null&&a(e,["temperature"],N);const T=i(t,["thinkingConfig"]);T!=null&&a(e,["thinkingConfig"],T);const M=i(t,["topK"]);M!=null&&a(e,["topK"],M);const F=i(t,["topP"]);return F!=null&&a(e,["topP"],F),e}function ld(t,e){const n={},s=i(e,["model"]);return s!=null&&a(n,["_url","name"],de(t,s)),n}function dd(t,e){const n={},s=i(e,["model"]);return s!=null&&a(n,["_url","name"],de(t,s)),n}function cd(t){const e={};if(i(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=i(t,["enableWidget"]);return n!=null&&a(e,["enableWidget"],n),e}function ud(t){const e={},n=i(t,["timeRangeFilter"]);if(n!=null&&a(e,["timeRangeFilter"],n),i(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");return e}function fd(t){const e={},n=i(t,["bytesBase64Encoded"]);n!=null&&a(e,["imageBytes"],Be(n));const s=i(t,["mimeType"]);return s!=null&&a(e,["mimeType"],s),e}function Fo(t){const e={},n=i(t,["gcsUri"]);n!=null&&a(e,["gcsUri"],n);const s=i(t,["bytesBase64Encoded"]);s!=null&&a(e,["imageBytes"],Be(s));const r=i(t,["mimeType"]);return r!=null&&a(e,["mimeType"],r),e}function un(t){const e={};if(i(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const n=i(t,["imageBytes"]);n!=null&&a(e,["bytesBase64Encoded"],Be(n));const s=i(t,["mimeType"]);return s!=null&&a(e,["mimeType"],s),e}function Re(t){const e={},n=i(t,["gcsUri"]);n!=null&&a(e,["gcsUri"],n);const s=i(t,["imageBytes"]);s!=null&&a(e,["bytesBase64Encoded"],Be(s));const r=i(t,["mimeType"]);return r!=null&&a(e,["mimeType"],r),e}function md(t,e,n){const s={},r=i(e,["pageSize"]);n!==void 0&&r!=null&&a(n,["_query","pageSize"],r);const l=i(e,["pageToken"]);n!==void 0&&l!=null&&a(n,["_query","pageToken"],l);const d=i(e,["filter"]);n!==void 0&&d!=null&&a(n,["_query","filter"],d);const c=i(e,["queryBase"]);return n!==void 0&&c!=null&&a(n,["_url","models_url"],So(t,c)),s}function pd(t,e,n){const s={},r=i(e,["pageSize"]);n!==void 0&&r!=null&&a(n,["_query","pageSize"],r);const l=i(e,["pageToken"]);n!==void 0&&l!=null&&a(n,["_query","pageToken"],l);const d=i(e,["filter"]);n!==void 0&&d!=null&&a(n,["_query","filter"],d);const c=i(e,["queryBase"]);return n!==void 0&&c!=null&&a(n,["_url","models_url"],So(t,c)),s}function hd(t,e){const n={},s=i(e,["config"]);return s!=null&&md(t,s,n),n}function gd(t,e){const n={},s=i(e,["config"]);return s!=null&&pd(t,s,n),n}function xd(t){const e={},n=i(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const s=i(t,["nextPageToken"]);s!=null&&a(e,["nextPageToken"],s);const r=i(t,["_self"]);if(r!=null){let l=Io(r);Array.isArray(l)&&(l=l.map(d=>An(d))),a(e,["models"],l)}return e}function yd(t){const e={},n=i(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const s=i(t,["nextPageToken"]);s!=null&&a(e,["nextPageToken"],s);const r=i(t,["_self"]);if(r!=null){let l=Io(r);Array.isArray(l)&&(l=l.map(d=>Sn(d))),a(e,["models"],l)}return e}function vd(t){const e={},n=i(t,["maskMode"]);n!=null&&a(e,["maskMode"],n);const s=i(t,["segmentationClasses"]);s!=null&&a(e,["maskClasses"],s);const r=i(t,["maskDilation"]);return r!=null&&a(e,["dilation"],r),e}function An(t){const e={},n=i(t,["name"]);n!=null&&a(e,["name"],n);const s=i(t,["displayName"]);s!=null&&a(e,["displayName"],s);const r=i(t,["description"]);r!=null&&a(e,["description"],r);const l=i(t,["version"]);l!=null&&a(e,["version"],l);const d=i(t,["_self"]);d!=null&&a(e,["tunedModelInfo"],Dd(d));const c=i(t,["inputTokenLimit"]);c!=null&&a(e,["inputTokenLimit"],c);const f=i(t,["outputTokenLimit"]);f!=null&&a(e,["outputTokenLimit"],f);const u=i(t,["supportedGenerationMethods"]);return u!=null&&a(e,["supportedActions"],u),e}function Sn(t){const e={},n=i(t,["name"]);n!=null&&a(e,["name"],n);const s=i(t,["displayName"]);s!=null&&a(e,["displayName"],s);const r=i(t,["description"]);r!=null&&a(e,["description"],r);const l=i(t,["versionId"]);l!=null&&a(e,["version"],l);const d=i(t,["deployedModels"]);if(d!=null){let p=d;Array.isArray(p)&&(p=p.map(h=>Fl(h))),a(e,["endpoints"],p)}const c=i(t,["labels"]);c!=null&&a(e,["labels"],c);const f=i(t,["_self"]);f!=null&&a(e,["tunedModelInfo"],Ld(f));const u=i(t,["defaultCheckpointId"]);u!=null&&a(e,["defaultCheckpointId"],u);const m=i(t,["checkpoints"]);if(m!=null){let p=m;Array.isArray(p)&&(p=p.map(h=>h)),a(e,["checkpoints"],p)}return e}function bd(t){const e={},n=i(t,["videoMetadata"]);n!=null&&a(e,["videoMetadata"],n);const s=i(t,["thought"]);s!=null&&a(e,["thought"],s);const r=i(t,["inlineData"]);r!=null&&a(e,["inlineData"],dl(r));const l=i(t,["fileData"]);l!=null&&a(e,["fileData"],Ul(l));const d=i(t,["thoughtSignature"]);d!=null&&a(e,["thoughtSignature"],d);const c=i(t,["functionCall"]);c!=null&&a(e,["functionCall"],c);const f=i(t,["codeExecutionResult"]);f!=null&&a(e,["codeExecutionResult"],f);const u=i(t,["executableCode"]);u!=null&&a(e,["executableCode"],u);const m=i(t,["functionResponse"]);m!=null&&a(e,["functionResponse"],m);const p=i(t,["text"]);return p!=null&&a(e,["text"],p),e}function Td(t){const e={},n=i(t,["productImage"]);return n!=null&&a(e,["image"],Re(n)),e}function Nd(t,e){const n={},s=i(t,["numberOfImages"]);e!==void 0&&s!=null&&a(e,["parameters","sampleCount"],s);const r=i(t,["baseSteps"]);e!==void 0&&r!=null&&a(e,["parameters","editConfig","baseSteps"],r);const l=i(t,["outputGcsUri"]);e!==void 0&&l!=null&&a(e,["parameters","storageUri"],l);const d=i(t,["seed"]);e!==void 0&&d!=null&&a(e,["parameters","seed"],d);const c=i(t,["safetyFilterLevel"]);e!==void 0&&c!=null&&a(e,["parameters","safetySetting"],c);const f=i(t,["personGeneration"]);e!==void 0&&f!=null&&a(e,["parameters","personGeneration"],f);const u=i(t,["addWatermark"]);e!==void 0&&u!=null&&a(e,["parameters","addWatermark"],u);const m=i(t,["outputMimeType"]);e!==void 0&&m!=null&&a(e,["parameters","outputOptions","mimeType"],m);const p=i(t,["outputCompressionQuality"]);e!==void 0&&p!=null&&a(e,["parameters","outputOptions","compressionQuality"],p);const h=i(t,["enhancePrompt"]);e!==void 0&&h!=null&&a(e,["parameters","enhancePrompt"],h);const v=i(t,["labels"]);return e!==void 0&&v!=null&&a(e,["labels"],v),n}function Cd(t,e){const n={},s=i(e,["model"]);s!=null&&a(n,["_url","model"],de(t,s));const r=i(e,["source"]);r!=null&&wd(r,n);const l=i(e,["config"]);return l!=null&&Nd(l,n),n}function Ed(t){const e={},n=i(t,["predictions"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(r=>cn(r))),a(e,["generatedImages"],s)}return e}function wd(t,e){const n={},s=i(t,["prompt"]);e!==void 0&&s!=null&&a(e,["instances[0]","prompt"],s);const r=i(t,["personImage"]);e!==void 0&&r!=null&&a(e,["instances[0]","personImage","image"],Re(r));const l=i(t,["productImages"]);if(e!==void 0&&l!=null){let d=l;Array.isArray(d)&&(d=d.map(c=>Td(c))),a(e,["instances[0]","productImages"],d)}return n}function _d(t){const e={},n=i(t,["referenceImage"]);n!=null&&a(e,["referenceImage"],Re(n));const s=i(t,["referenceId"]);s!=null&&a(e,["referenceId"],s);const r=i(t,["referenceType"]);r!=null&&a(e,["referenceType"],r);const l=i(t,["maskImageConfig"]);l!=null&&a(e,["maskImageConfig"],vd(l));const d=i(t,["controlImageConfig"]);d!=null&&a(e,["controlImageConfig"],gl(d));const c=i(t,["styleImageConfig"]);c!=null&&a(e,["styleImageConfig"],c);const f=i(t,["subjectImageConfig"]);return f!=null&&a(e,["subjectImageConfig"],f),e}function Uo(t){const e={},n=i(t,["safetyAttributes","categories"]);n!=null&&a(e,["categories"],n);const s=i(t,["safetyAttributes","scores"]);s!=null&&a(e,["scores"],s);const r=i(t,["contentType"]);return r!=null&&a(e,["contentType"],r),e}function jo(t){const e={},n=i(t,["safetyAttributes","categories"]);n!=null&&a(e,["categories"],n);const s=i(t,["safetyAttributes","scores"]);s!=null&&a(e,["scores"],s);const r=i(t,["contentType"]);return r!=null&&a(e,["contentType"],r),e}function Ad(t){const e={};if(i(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const n=i(t,["category"]);n!=null&&a(e,["category"],n);const s=i(t,["threshold"]);return s!=null&&a(e,["threshold"],s),e}function Sd(t){const e={},n=i(t,["image"]);return n!=null&&a(e,["image"],Re(n)),e}function Id(t,e){const n={},s=i(t,["mode"]);e!==void 0&&s!=null&&a(e,["parameters","mode"],s);const r=i(t,["maxPredictions"]);e!==void 0&&r!=null&&a(e,["parameters","maxPredictions"],r);const l=i(t,["confidenceThreshold"]);e!==void 0&&l!=null&&a(e,["parameters","confidenceThreshold"],l);const d=i(t,["maskDilation"]);e!==void 0&&d!=null&&a(e,["parameters","maskDilation"],d);const c=i(t,["binaryColorThreshold"]);e!==void 0&&c!=null&&a(e,["parameters","binaryColorThreshold"],c);const f=i(t,["labels"]);return e!==void 0&&f!=null&&a(e,["labels"],f),n}function Rd(t,e){const n={},s=i(e,["model"]);s!=null&&a(n,["_url","model"],de(t,s));const r=i(e,["source"]);r!=null&&Md(r,n);const l=i(e,["config"]);return l!=null&&Id(l,n),n}function Pd(t){const e={},n=i(t,["predictions"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(r=>od(r))),a(e,["generatedMasks"],s)}return e}function Md(t,e){const n={},s=i(t,["prompt"]);e!==void 0&&s!=null&&a(e,["instances[0]","prompt"],s);const r=i(t,["image"]);e!==void 0&&r!=null&&a(e,["instances[0]","image"],Re(r));const l=i(t,["scribbleImage"]);return e!==void 0&&l!=null&&a(e,["instances[0]","scribble"],Sd(l)),n}function Vo(t){const e={},n=i(t,["voiceConfig"]);if(n!=null&&a(e,["voiceConfig"],n),i(t,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");const s=i(t,["languageCode"]);return s!=null&&a(e,["languageCode"],s),e}function kd(t){const e={},n=i(t,["functionDeclarations"]);if(n!=null){let u=n;Array.isArray(u)&&(u=u.map(m=>m)),a(e,["functionDeclarations"],u)}if(i(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=i(t,["googleSearch"]);s!=null&&a(e,["googleSearch"],ud(s));const r=i(t,["googleSearchRetrieval"]);if(r!=null&&a(e,["googleSearchRetrieval"],r),i(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const l=i(t,["googleMaps"]);l!=null&&a(e,["googleMaps"],cd(l));const d=i(t,["urlContext"]);d!=null&&a(e,["urlContext"],d);const c=i(t,["computerUse"]);c!=null&&a(e,["computerUse"],c);const f=i(t,["codeExecution"]);return f!=null&&a(e,["codeExecution"],f),e}function Bo(t){const e={},n=i(t,["functionDeclarations"]);if(n!=null){let p=n;Array.isArray(p)&&(p=p.map(h=>jl(h))),a(e,["functionDeclarations"],p)}const s=i(t,["retrieval"]);s!=null&&a(e,["retrieval"],s);const r=i(t,["googleSearch"]);r!=null&&a(e,["googleSearch"],r);const l=i(t,["googleSearchRetrieval"]);l!=null&&a(e,["googleSearchRetrieval"],l);const d=i(t,["enterpriseWebSearch"]);d!=null&&a(e,["enterpriseWebSearch"],d);const c=i(t,["googleMaps"]);c!=null&&a(e,["googleMaps"],c);const f=i(t,["urlContext"]);f!=null&&a(e,["urlContext"],f);const u=i(t,["computerUse"]);u!=null&&a(e,["computerUse"],u);const m=i(t,["codeExecution"]);return m!=null&&a(e,["codeExecution"],m),e}function Dd(t){const e={},n=i(t,["baseModel"]);n!=null&&a(e,["baseModel"],n);const s=i(t,["createTime"]);s!=null&&a(e,["createTime"],s);const r=i(t,["updateTime"]);return r!=null&&a(e,["updateTime"],r),e}function Ld(t){const e={},n=i(t,["labels","google-vertex-llm-tuning-base-model-id"]);n!=null&&a(e,["baseModel"],n);const s=i(t,["createTime"]);s!=null&&a(e,["createTime"],s);const r=i(t,["updateTime"]);return r!=null&&a(e,["updateTime"],r),e}function Fd(t,e){const n={},s=i(t,["displayName"]);e!==void 0&&s!=null&&a(e,["displayName"],s);const r=i(t,["description"]);e!==void 0&&r!=null&&a(e,["description"],r);const l=i(t,["defaultCheckpointId"]);return e!==void 0&&l!=null&&a(e,["defaultCheckpointId"],l),n}function Ud(t,e){const n={},s=i(t,["displayName"]);e!==void 0&&s!=null&&a(e,["displayName"],s);const r=i(t,["description"]);e!==void 0&&r!=null&&a(e,["description"],r);const l=i(t,["defaultCheckpointId"]);return e!==void 0&&l!=null&&a(e,["defaultCheckpointId"],l),n}function jd(t,e){const n={},s=i(e,["model"]);s!=null&&a(n,["_url","name"],de(t,s));const r=i(e,["config"]);return r!=null&&Fd(r,n),n}function Vd(t,e){const n={},s=i(e,["model"]);s!=null&&a(n,["_url","model"],de(t,s));const r=i(e,["config"]);return r!=null&&Ud(r,n),n}function Bd(t,e){const n={},s=i(t,["outputGcsUri"]);e!==void 0&&s!=null&&a(e,["parameters","storageUri"],s);const r=i(t,["includeRaiReason"]);e!==void 0&&r!=null&&a(e,["parameters","includeRaiReason"],r);const l=i(t,["outputMimeType"]);e!==void 0&&l!=null&&a(e,["parameters","outputOptions","mimeType"],l);const d=i(t,["outputCompressionQuality"]);e!==void 0&&d!=null&&a(e,["parameters","outputOptions","compressionQuality"],d);const c=i(t,["enhanceInputImage"]);e!==void 0&&c!=null&&a(e,["parameters","upscaleConfig","enhanceInputImage"],c);const f=i(t,["imagePreservationFactor"]);e!==void 0&&f!=null&&a(e,["parameters","upscaleConfig","imagePreservationFactor"],f);const u=i(t,["labels"]);e!==void 0&&u!=null&&a(e,["labels"],u);const m=i(t,["numberOfImages"]);e!==void 0&&m!=null&&a(e,["parameters","sampleCount"],m);const p=i(t,["mode"]);return e!==void 0&&p!=null&&a(e,["parameters","mode"],p),n}function qd(t,e){const n={},s=i(e,["model"]);s!=null&&a(n,["_url","model"],de(t,s));const r=i(e,["image"]);r!=null&&a(n,["instances[0]","image"],Re(r));const l=i(e,["upscaleFactor"]);l!=null&&a(n,["parameters","upscaleConfig","upscaleFactor"],l);const d=i(e,["config"]);return d!=null&&Bd(d,n),n}function $d(t){const e={},n=i(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const s=i(t,["predictions"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(l=>cn(l))),a(e,["generatedImages"],r)}return e}function Gd(t){const e={},n=i(t,["uri"]);n!=null&&a(e,["uri"],n);const s=i(t,["encodedVideo"]);s!=null&&a(e,["videoBytes"],Be(s));const r=i(t,["encoding"]);return r!=null&&a(e,["mimeType"],r),e}function Hd(t){const e={},n=i(t,["gcsUri"]);n!=null&&a(e,["uri"],n);const s=i(t,["bytesBase64Encoded"]);s!=null&&a(e,["videoBytes"],Be(s));const r=i(t,["mimeType"]);return r!=null&&a(e,["mimeType"],r),e}function Jd(t){const e={},n=i(t,["image"]);n!=null&&a(e,["_self"],Re(n));const s=i(t,["maskMode"]);return s!=null&&a(e,["maskMode"],s),e}function Od(t){const e={},n=i(t,["image"]);n!=null&&a(e,["image"],un(n));const s=i(t,["referenceType"]);return s!=null&&a(e,["referenceType"],s),e}function Yd(t){const e={},n=i(t,["image"]);n!=null&&a(e,["image"],Re(n));const s=i(t,["referenceType"]);return s!=null&&a(e,["referenceType"],s),e}function qo(t){const e={},n=i(t,["uri"]);n!=null&&a(e,["uri"],n);const s=i(t,["videoBytes"]);s!=null&&a(e,["encodedVideo"],Be(s));const r=i(t,["mimeType"]);return r!=null&&a(e,["encoding"],r),e}function $o(t){const e={},n=i(t,["uri"]);n!=null&&a(e,["gcsUri"],n);const s=i(t,["videoBytes"]);s!=null&&a(e,["bytesBase64Encoded"],Be(s));const r=i(t,["mimeType"]);return r!=null&&a(e,["mimeType"],r),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Wd="Content-Type",zd="X-Server-Timeout",Kd="User-Agent",In="x-goog-api-client",Xd="1.25.0",Qd=`google-genai-sdk/${Xd}`,Zd="v1beta1",ec="v1beta",no=/^\s*data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class tc{constructor(e){var n,s;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});const r={};this.clientOptions.vertexai?(r.apiVersion=(n=this.clientOptions.apiVersion)!==null&&n!==void 0?n:Zd,r.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(r.apiVersion=(s=this.clientOptions.apiVersion)!==null&&s!==void 0?s:ec,r.baseUrl="https://generativelanguage.googleapis.com/"),r.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=r,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(r,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const s=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&s.push(e.apiVersion),s.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const e=this.getBaseUrl(),n=new URL(e);return n.protocol=n.protocol=="http:"?"ws":"wss",n.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,n,s){const r=[this.getRequestUrlInternal(n)];return s&&r.push(this.getBaseResourcePath()),e!==""&&r.push(e),new URL(`${r.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let n=this.clientOptions.httpOptions;e.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const s=this.shouldPrependVertexProjectPath(e),r=this.constructUrl(e.path,n,s);if(e.queryParams)for(const[d,c]of Object.entries(e.queryParams))r.searchParams.append(d,String(c));let l={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else l.body=e.body;return l=await this.includeExtraHttpOptionsToRequestInit(l,n,e.abortSignal),this.unaryApiCall(r,l,e.httpMethod)}patchHttpOptions(e,n){const s=JSON.parse(JSON.stringify(e));for(const[r,l]of Object.entries(n))typeof l=="object"?s[r]=Object.assign(Object.assign({},s[r]),l):l!==void 0&&(s[r]=l);return s}async requestStream(e){let n=this.clientOptions.httpOptions;e.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const s=this.shouldPrependVertexProjectPath(e),r=this.constructUrl(e.path,n,s);(!r.searchParams.has("alt")||r.searchParams.get("alt")!=="sse")&&r.searchParams.set("alt","sse");let l={};return l.body=e.body,l=await this.includeExtraHttpOptionsToRequestInit(l,n,e.abortSignal),this.streamApiCall(r,l,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,n,s){if(n&&n.timeout||s){const r=new AbortController,l=r.signal;if(n.timeout&&(n==null?void 0:n.timeout)>0){const d=setTimeout(()=>r.abort(),n.timeout);d&&typeof d.unref=="function"&&d.unref()}s&&s.addEventListener("abort",()=>{r.abort()}),e.signal=l}return n&&n.extraBody!==null&&nc(e,n.extraBody),e.headers=await this.getHeadersInternal(n),e}async unaryApiCall(e,n,s){return this.apiCall(e.toString(),Object.assign(Object.assign({},n),{method:s})).then(async r=>(await so(r),new En(r))).catch(r=>{throw r instanceof Error?r:new Error(JSON.stringify(r))})}async streamApiCall(e,n,s){return this.apiCall(e.toString(),Object.assign(Object.assign({},n),{method:s})).then(async r=>(await so(r),this.processStreamResponse(r))).catch(r=>{throw r instanceof Error?r:new Error(JSON.stringify(r))})}processStreamResponse(e){var n;return ot(this,arguments,function*(){const r=(n=e==null?void 0:e.body)===null||n===void 0?void 0:n.getReader(),l=new TextDecoder("utf-8");if(!r)throw new Error("Response body is empty");try{let d="";for(;;){const{done:c,value:f}=yield ge(r.read());if(c){if(d.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const u=l.decode(f,{stream:!0});try{const p=JSON.parse(u);if("error"in p){const h=JSON.parse(JSON.stringify(p.error)),v=h.status,E=h.code,A=`got status: ${v}. ${JSON.stringify(p)}`;if(E>=400&&E<600)throw new ln({message:A,status:E})}}catch(p){if(p.name==="ApiError")throw p}d+=u;let m=d.match(no);for(;m;){const p=m[1];try{const h=new Response(p,{headers:e==null?void 0:e.headers,status:e==null?void 0:e.status,statusText:e==null?void 0:e.statusText});yield yield ge(new En(h)),d=d.slice(m[0].length),m=d.match(no)}catch(h){throw new Error(`exception parsing stream chunk ${p}. ${h}`)}}}}finally{r.releaseLock()}})}async apiCall(e,n){return fetch(e,n).catch(s=>{throw new Error(`exception ${s} sending request`)})}getDefaultHeaders(){const e={},n=Qd+" "+this.clientOptions.userAgentExtra;return e[Kd]=n,e[In]=n,e[Wd]="application/json",e}async getHeadersInternal(e){const n=new Headers;if(e&&e.headers){for(const[s,r]of Object.entries(e.headers))n.append(s,r);e.timeout&&e.timeout>0&&n.append(zd,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(n),n}async uploadFile(e,n){var s;const r={};n!=null&&(r.mimeType=n.mimeType,r.name=n.name,r.displayName=n.displayName),r.name&&!r.name.startsWith("files/")&&(r.name=`files/${r.name}`);const l=this.clientOptions.uploader,d=await l.stat(e);r.sizeBytes=String(d.size);const c=(s=n==null?void 0:n.mimeType)!==null&&s!==void 0?s:d.type;if(c===void 0||c==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");r.mimeType=c;const f=await this.fetchUploadUrl(r,n);return l.upload(e,f,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,n){var s;let r={};n!=null&&n.httpOptions?r=n.httpOptions:r={apiVersion:"",headers:{"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${e.sizeBytes}`,"X-Goog-Upload-Header-Content-Type":`${e.mimeType}`}};const l={file:e},d=await this.request({path:Q("upload/v1beta/files",l._url),body:JSON.stringify(l),httpMethod:"POST",httpOptions:r});if(!d||!(d!=null&&d.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const c=(s=d==null?void 0:d.headers)===null||s===void 0?void 0:s["x-goog-upload-url"];if(c===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return c}}async function so(t){var e;if(t===void 0)throw new Error("response is undefined");if(!t.ok){const n=t.status;let s;!((e=t.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?s=await t.json():s={error:{message:await t.text(),code:t.status,status:t.statusText}};const r=JSON.stringify(s);throw n>=400&&n<600?new ln({message:r,status:n}):new Error(r)}}function nc(t,e){if(!e||Object.keys(e).length===0)return;if(t.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let n={};if(typeof t.body=="string"&&t.body.length>0)try{const l=JSON.parse(t.body);if(typeof l=="object"&&l!==null&&!Array.isArray(l))n=l;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function s(l,d){const c=Object.assign({},l);for(const f in d)if(Object.prototype.hasOwnProperty.call(d,f)){const u=d[f],m=c[f];u&&typeof u=="object"&&!Array.isArray(u)&&m&&typeof m=="object"&&!Array.isArray(m)?c[f]=s(m,u):(m&&u&&typeof m!=typeof u&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${f}". Original type: ${typeof m}, New type: ${typeof u}. Overwriting.`),c[f]=u)}return c}const r=s(n,e);t.body=JSON.stringify(r)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const sc="mcp_used/unknown";let oc=!1;function Go(t){for(const e of t)if(ic(e)||typeof e=="object"&&"inputSchema"in e)return!0;return oc}function Ho(t){var e;const n=(e=t[In])!==null&&e!==void 0?e:"";t[In]=(n+` ${sc}`).trimStart()}function ic(t){return t!==null&&typeof t=="object"&&t instanceof Bn}function rc(t,e=100){return ot(this,arguments,function*(){let s,r=0;for(;r<e;){const l=yield ge(t.listTools({cursor:s}));for(const d of l.tools)yield yield ge(d),r++;if(!l.nextCursor)break;s=l.nextCursor}})}class Bn{constructor(e=[],n){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=n}static create(e,n){return new Bn(e,n)}async initialize(){var e,n,s,r;if(this.mcpTools.length>0)return;const l={},d=[];for(const m of this.mcpClients)try{for(var c=!0,f=(n=void 0,wt(rc(m))),u;u=await f.next(),e=u.done,!e;c=!0){r=u.value,c=!1;const p=r;d.push(p);const h=p.name;if(l[h])throw new Error(`Duplicate function name ${h} found in MCP tools. Please ensure function names are unique.`);l[h]=m}}catch(p){n={error:p}}finally{try{!c&&!e&&(s=f.return)&&await s.call(f)}finally{if(n)throw n.error}}this.mcpTools=d,this.functionNameToMcpClient=l}async tool(){return await this.initialize(),ur(this.mcpTools,this.config)}async callTool(e){await this.initialize();const n=[];for(const s of e)if(s.name in this.functionNameToMcpClient){const r=this.functionNameToMcpClient[s.name];let l;this.config.timeout&&(l={timeout:this.config.timeout});const d=await r.callTool({name:s.name,arguments:s.args},void 0,l);n.push({functionResponse:{name:s.name,response:d.isError?{error:d}:d}})}return n}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function ac(t,e,n){const s=new sr;let r;n.data instanceof Blob?r=JSON.parse(await n.data.text()):r=JSON.parse(n.data),Object.assign(s,r),e(s)}class lc{constructor(e,n,s){this.apiClient=e,this.auth=n,this.webSocketFactory=s}async connect(e){var n,s;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const r=this.apiClient.getWebsocketBaseUrl(),l=this.apiClient.getApiVersion(),d=uc(this.apiClient.getDefaultHeaders()),c=this.apiClient.getApiKey(),f=`${r}/ws/google.ai.generativelanguage.${l}.GenerativeService.BidiGenerateMusic?key=${c}`;let u=()=>{};const m=new Promise(P=>{u=P}),p=e.callbacks,h=function(){u({})},v=this.apiClient,E={onopen:h,onmessage:P=>{ac(v,p.onmessage,P)},onerror:(n=p==null?void 0:p.onerror)!==null&&n!==void 0?n:function(P){},onclose:(s=p==null?void 0:p.onclose)!==null&&s!==void 0?s:function(P){}},A=this.webSocketFactory.create(f,cc(d),E);A.connect(),await m;const k={setup:{model:de(this.apiClient,e.model)}};return A.send(JSON.stringify(k)),new dc(A,this.apiClient)}}class dc{constructor(e,n){this.conn=e,this.apiClient=n}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const n=el(e);this.conn.send(JSON.stringify({clientContent:n}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});const n=Za(e);this.conn.send(JSON.stringify(n))}sendPlaybackControl(e){const n={playbackControl:e};this.conn.send(JSON.stringify(n))}play(){this.sendPlaybackControl(nt.PLAY)}pause(){this.sendPlaybackControl(nt.PAUSE)}stop(){this.sendPlaybackControl(nt.STOP)}resetContext(){this.sendPlaybackControl(nt.RESET_CONTEXT)}close(){this.conn.close()}}function cc(t){const e={};return t.forEach((n,s)=>{e[s]=n}),e}function uc(t){const e=new Headers;for(const[n,s]of Object.entries(t))e.append(n,s);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const fc="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function mc(t,e,n){const s=new nr;let r;n.data instanceof Blob?r=await n.data.text():n.data instanceof ArrayBuffer?r=new TextDecoder().decode(n.data):r=n.data;const l=JSON.parse(r);if(t.isVertexAI()){const d=sl(l);Object.assign(s,d)}else Object.assign(s,l);e(s)}class pc{constructor(e,n,s){this.apiClient=e,this.auth=n,this.webSocketFactory=s,this.music=new lc(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var n,s,r,l,d,c;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");const f=this.apiClient.getWebsocketBaseUrl(),u=this.apiClient.getApiVersion();let m;const p=this.apiClient.getHeaders();e.config&&e.config.tools&&Go(e.config.tools)&&Ho(p);const h=yc(p);if(this.apiClient.isVertexAI())m=`${f}/ws/google.cloud.aiplatform.${u}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(h);else{const L=this.apiClient.getApiKey();let x="BidiGenerateContent",D="key";L!=null&&L.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),u!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),x="BidiGenerateContentConstrained",D="access_token"),m=`${f}/ws/google.ai.generativelanguage.${u}.GenerativeService.${x}?${D}=${L}`}let v=()=>{};const E=new Promise(L=>{v=L}),A=e.callbacks,I=function(){var L;(L=A==null?void 0:A.onopen)===null||L===void 0||L.call(A),v({})},R=this.apiClient,k={onopen:I,onmessage:L=>{mc(R,A.onmessage,L)},onerror:(n=A==null?void 0:A.onerror)!==null&&n!==void 0?n:function(L){},onclose:(s=A==null?void 0:A.onclose)!==null&&s!==void 0?s:function(L){}},P=this.webSocketFactory.create(m,xc(h),k);P.connect(),await E;let N=de(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&N.startsWith("publishers/")){const L=this.apiClient.getProject(),x=this.apiClient.getLocation();N=`projects/${L}/locations/${x}/`+N}let T={};this.apiClient.isVertexAI()&&((r=e.config)===null||r===void 0?void 0:r.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[nn.AUDIO]}:e.config.responseModalities=[nn.AUDIO]),!((l=e.config)===null||l===void 0)&&l.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const M=(c=(d=e.config)===null||d===void 0?void 0:d.tools)!==null&&c!==void 0?c:[],F=[];for(const L of M)if(this.isCallableTool(L)){const x=L;F.push(await x.tool())}else F.push(L);F.length>0&&(e.config.tools=F);const j={model:N,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?T=Qa(this.apiClient,j):T=Xa(this.apiClient,j),delete T.config,P.send(JSON.stringify(T)),new gc(P,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}}const hc={turnComplete:!0};class gc{constructor(e,n){this.conn=e,this.apiClient=n}tLiveClientContent(e,n){if(n.turns!==null&&n.turns!==void 0){let s=[];try{s=Ae(n.turns),e.isVertexAI()||(s=s.map(r=>dn(r)))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof n.turns}'`)}return{clientContent:{turns:s,turnComplete:n.turnComplete}}}return{clientContent:{turnComplete:n.turnComplete}}}tLiveClienttToolResponse(e,n){let s=[];if(n.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(n.functionResponses)?s=n.functionResponses:s=[n.functionResponses],s.length===0)throw new Error("functionResponses is required.");for(const l of s){if(typeof l!="object"||l===null||!("name"in l)||!("response"in l))throw new Error(`Could not parse function response, type '${typeof l}'.`);if(!e.isVertexAI()&&!("id"in l))throw new Error(fc)}return{toolResponse:{functionResponses:s}}}sendClientContent(e){e=Object.assign(Object.assign({},hc),e);const n=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(n))}sendRealtimeInput(e){let n={};this.apiClient.isVertexAI()?n={realtimeInput:nl(e)}:n={realtimeInput:tl(e)},this.conn.send(JSON.stringify(n))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");const n=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(n))}close(){this.conn.close()}}function xc(t){const e={};return t.forEach((n,s)=>{e[s]=n}),e}function yc(t){const e=new Headers;for(const[n,s]of Object.entries(t))e.append(n,s);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const oo=10;function io(t){var e,n,s;if(!((e=t==null?void 0:t.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let r=!1;for(const d of(n=t==null?void 0:t.tools)!==null&&n!==void 0?n:[])if(it(d)){r=!0;break}if(!r)return!0;const l=(s=t==null?void 0:t.automaticFunctionCalling)===null||s===void 0?void 0:s.maximumRemoteCalls;return l&&(l<0||!Number.isInteger(l))||l==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",l),!0):!1}function it(t){return"callTool"in t&&typeof t.callTool=="function"}function vc(t){var e,n,s;return(s=(n=(e=t.config)===null||e===void 0?void 0:e.tools)===null||n===void 0?void 0:n.some(r=>it(r)))!==null&&s!==void 0?s:!1}function bc(t){var e,n,s;return(s=(n=(e=t.config)===null||e===void 0?void 0:e.tools)===null||n===void 0?void 0:n.some(r=>!it(r)))!==null&&s!==void 0?s:!1}function ro(t){var e;return!(!((e=t==null?void 0:t.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Tc extends We{constructor(e){super(),this.apiClient=e,this.generateContent=async n=>{var s,r,l,d,c;const f=await this.processParamsMaybeAddMcpUsage(n);if(this.maybeMoveToResponseJsonSchem(n),!vc(n)||io(n.config))return await this.generateContentInternal(f);if(bc(n))throw new Error("Automatic function calling with CallableTools and Tools is not yet supported.");let u,m;const p=Ae(f.contents),h=(l=(r=(s=f.config)===null||s===void 0?void 0:s.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls)!==null&&l!==void 0?l:oo;let v=0;for(;v<h&&(u=await this.generateContentInternal(f),!(!u.functionCalls||u.functionCalls.length===0));){const E=u.candidates[0].content,A=[];for(const I of(c=(d=n.config)===null||d===void 0?void 0:d.tools)!==null&&c!==void 0?c:[])if(it(I)){const k=await I.callTool(u.functionCalls);A.push(...k)}v++,m={role:"user",parts:A},f.contents=Ae(f.contents),f.contents.push(E),f.contents.push(m),ro(f.config)&&(p.push(E),p.push(m))}return ro(f.config)&&(u.automaticFunctionCallingHistory=p),u},this.generateContentStream=async n=>{if(this.maybeMoveToResponseJsonSchem(n),io(n.config)){const s=await this.processParamsMaybeAddMcpUsage(n);return await this.generateContentStreamInternal(s)}else return await this.processAfcStream(n)},this.generateImages=async n=>await this.generateImagesInternal(n).then(s=>{var r;let l;const d=[];if(s!=null&&s.generatedImages)for(const f of s.generatedImages)f&&(f!=null&&f.safetyAttributes)&&((r=f==null?void 0:f.safetyAttributes)===null||r===void 0?void 0:r.contentType)==="Positive Prompt"?l=f==null?void 0:f.safetyAttributes:d.push(f);let c;return l?c={generatedImages:d,positivePromptSafetyAttributes:l,sdkHttpResponse:s.sdkHttpResponse}:c={generatedImages:d,sdkHttpResponse:s.sdkHttpResponse},c}),this.list=async n=>{var s;const d={config:Object.assign(Object.assign({},{queryBase:!0}),n==null?void 0:n.config)};if(this.apiClient.isVertexAI()&&!d.config.queryBase){if(!((s=d.config)===null||s===void 0)&&s.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");d.config.filter="labels.tune-type:*"}return new At(Ye.PAGED_ITEM_MODELS,c=>this.listInternal(c),await this.listInternal(d),d)},this.editImage=async n=>{const s={model:n.model,prompt:n.prompt,referenceImages:[],config:n.config};return n.referenceImages&&n.referenceImages&&(s.referenceImages=n.referenceImages.map(r=>r.toReferenceImageAPI())),await this.editImageInternal(s)},this.upscaleImage=async n=>{let s={numberOfImages:1,mode:"upscale"};n.config&&(s=Object.assign(Object.assign({},s),n.config));const r={model:n.model,image:n.image,upscaleFactor:n.upscaleFactor,config:s};return await this.upscaleImageInternal(r)},this.generateVideos=async n=>{var s,r,l,d,c,f;if((n.prompt||n.image||n.video)&&n.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((s=n.video)===null||s===void 0)&&s.uri&&(!((r=n.video)===null||r===void 0)&&r.videoBytes)?n.video={uri:n.video.uri,mimeType:n.video.mimeType}:!((d=(l=n.source)===null||l===void 0?void 0:l.video)===null||d===void 0)&&d.uri&&(!((f=(c=n.source)===null||c===void 0?void 0:c.video)===null||f===void 0)&&f.videoBytes)&&(n.source.video={uri:n.source.video.uri,mimeType:n.source.video.mimeType})),await this.generateVideosInternal(n)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var n,s,r;const l=(n=e.config)===null||n===void 0?void 0:n.tools;if(!l)return e;const d=await Promise.all(l.map(async f=>it(f)?await f.tool():f)),c={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:d})};if(c.config.tools=d,e.config&&e.config.tools&&Go(e.config.tools)){const f=(r=(s=e.config.httpOptions)===null||s===void 0?void 0:s.headers)!==null&&r!==void 0?r:{};let u=Object.assign({},f);Object.keys(u).length===0&&(u=this.apiClient.getDefaultHeaders()),Ho(u),c.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:u})}return c}async initAfcToolsMap(e){var n,s,r;const l=new Map;for(const d of(s=(n=e.config)===null||n===void 0?void 0:n.tools)!==null&&s!==void 0?s:[])if(it(d)){const c=d,f=await c.tool();for(const u of(r=f.functionDeclarations)!==null&&r!==void 0?r:[]){if(!u.name)throw new Error("Function declaration name is required.");if(l.has(u.name))throw new Error(`Duplicate tool declaration name: ${u.name}`);l.set(u.name,c)}}return l}async processAfcStream(e){var n,s,r;const l=(r=(s=(n=e.config)===null||n===void 0?void 0:n.automaticFunctionCalling)===null||s===void 0?void 0:s.maximumRemoteCalls)!==null&&r!==void 0?r:oo;let d=!1,c=0;const f=await this.initAfcToolsMap(e);return function(u,m,p){var h,v;return ot(this,arguments,function*(){for(var E,A,I,R;c<l;){d&&(c++,d=!1);const T=yield ge(u.processParamsMaybeAddMcpUsage(p)),M=yield ge(u.generateContentStreamInternal(T)),F=[],j=[];try{for(var k=!0,P=(A=void 0,wt(M)),N;N=yield ge(P.next()),E=N.done,!E;k=!0){R=N.value,k=!1;const L=R;if(yield yield ge(L),L.candidates&&(!((h=L.candidates[0])===null||h===void 0)&&h.content)){j.push(L.candidates[0].content);for(const x of(v=L.candidates[0].content.parts)!==null&&v!==void 0?v:[])if(c<l&&x.functionCall){if(!x.functionCall.name)throw new Error("Function call name was not returned by the model.");if(m.has(x.functionCall.name)){const D=yield ge(m.get(x.functionCall.name).callTool([x.functionCall]));F.push(...D)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${m.keys()}, mising tool: ${x.functionCall.name}`)}}}}catch(L){A={error:L}}finally{try{!k&&!E&&(I=P.return)&&(yield ge(I.call(P)))}finally{if(A)throw A.error}}if(F.length>0){d=!0;const L=new Ct;L.candidates=[{content:{role:"user",parts:F}}],yield yield ge(L);const x=[];x.push(...j),x.push({role:"user",parts:F});const D=Ae(p.contents).concat(x);p.contents=D}else break}})}(this,f,e)}async generateContentInternal(e){var n,s,r,l;let d,c="",f={};if(this.apiClient.isVertexAI()){const u=Zs(this.apiClient,e);return c=Q("{model}:generateContent",u._url),f=u._query,delete u._url,delete u._query,d=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(m=>m.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:m.headers},h})),d.then(m=>{const p=to(m),h=new Ct;return Object.assign(h,p),h})}else{const u=Qs(this.apiClient,e);return c=Q("{model}:generateContent",u._url),f=u._query,delete u._url,delete u._query,d=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:m.headers},h})),d.then(m=>{const p=eo(m),h=new Ct;return Object.assign(h,p),h})}}async generateContentStreamInternal(e){var n,s,r,l;let d,c="",f={};if(this.apiClient.isVertexAI()){const u=Zs(this.apiClient,e);return c=Q("{model}:streamGenerateContent?alt=sse",u._url),f=u._query,delete u._url,delete u._query,d=this.apiClient.requestStream({path:c,queryParams:f,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}),d.then(function(p){return ot(this,arguments,function*(){var h,v,E,A;try{for(var I=!0,R=wt(p),k;k=yield ge(R.next()),h=k.done,!h;I=!0){A=k.value,I=!1;const P=A,N=to(yield ge(P.json()));N.sdkHttpResponse={headers:P.headers};const T=new Ct;Object.assign(T,N),yield yield ge(T)}}catch(P){v={error:P}}finally{try{!I&&!h&&(E=R.return)&&(yield ge(E.call(R)))}finally{if(v)throw v.error}}})})}else{const u=Qs(this.apiClient,e);return c=Q("{model}:streamGenerateContent?alt=sse",u._url),f=u._query,delete u._url,delete u._query,d=this.apiClient.requestStream({path:c,queryParams:f,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}),d.then(function(p){return ot(this,arguments,function*(){var h,v,E,A;try{for(var I=!0,R=wt(p),k;k=yield ge(R.next()),h=k.done,!h;I=!0){A=k.value,I=!1;const P=A,N=eo(yield ge(P.json()));N.sdkHttpResponse={headers:P.headers};const T=new Ct;Object.assign(T,N),yield yield ge(T)}}catch(P){v={error:P}}finally{try{!I&&!h&&(E=R.return)&&(yield ge(E.call(R)))}finally{if(v)throw v.error}}})})}}async embedContent(e){var n,s,r,l;let d,c="",f={};if(this.apiClient.isVertexAI()){const u=kl(this.apiClient,e);return c=Q("{model}:predict",u._url),f=u._query,delete u._url,delete u._query,d=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(m=>m.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:m.headers},h})),d.then(m=>{const p=Ll(m),h=new Fs;return Object.assign(h,p),h})}else{const u=Ml(this.apiClient,e);return c=Q("{model}:batchEmbedContents",u._url),f=u._query,delete u._url,delete u._query,d=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:m.headers},h})),d.then(m=>{const p=Dl(m),h=new Fs;return Object.assign(h,p),h})}}async generateImagesInternal(e){var n,s,r,l;let d,c="",f={};if(this.apiClient.isVertexAI()){const u=Hl(this.apiClient,e);return c=Q("{model}:predict",u._url),f=u._query,delete u._url,delete u._query,d=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(m=>m.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:m.headers},h})),d.then(m=>{const p=Ol(m),h=new Us;return Object.assign(h,p),h})}else{const u=Gl(this.apiClient,e);return c=Q("{model}:predict",u._url),f=u._query,delete u._url,delete u._query,d=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:m.headers},h})),d.then(m=>{const p=Jl(m),h=new Us;return Object.assign(h,p),h})}}async editImageInternal(e){var n,s;let r,l="",d={};if(this.apiClient.isVertexAI()){const c=Sl(this.apiClient,e);return l=Q("{model}:predict",c._url),d=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(u=>{const m=u;return m.sdkHttpResponse={headers:f.headers},m})),r.then(f=>{const u=Il(f),m=new Wi;return Object.assign(m,u),m})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var n,s;let r,l="",d={};if(this.apiClient.isVertexAI()){const c=qd(this.apiClient,e);return l=Q("{model}:predict",c._url),d=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(u=>{const m=u;return m.sdkHttpResponse={headers:f.headers},m})),r.then(f=>{const u=$d(f),m=new zi;return Object.assign(m,u),m})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var n,s;let r,l="",d={};if(this.apiClient.isVertexAI()){const c=Cd(this.apiClient,e);return l=Q("{model}:predict",c._url),d=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),r.then(f=>{const u=Ed(f),m=new Ki;return Object.assign(m,u),m})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var n,s;let r,l="",d={};if(this.apiClient.isVertexAI()){const c=Rd(this.apiClient,e);return l=Q("{model}:predict",c._url),d=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),r.then(f=>{const u=Pd(f),m=new Xi;return Object.assign(m,u),m})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var n,s,r,l;let d,c="",f={};if(this.apiClient.isVertexAI()){const u=dd(this.apiClient,e);return c=Q("{name}",u._url),f=u._query,delete u._url,delete u._query,d=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(m=>m.json()),d.then(m=>Sn(m))}else{const u=ld(this.apiClient,e);return c=Q("{name}",u._url),f=u._query,delete u._url,delete u._query,d=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json()),d.then(m=>An(m))}}async listInternal(e){var n,s,r,l;let d,c="",f={};if(this.apiClient.isVertexAI()){const u=gd(this.apiClient,e);return c=Q("{models_url}",u._url),f=u._query,delete u._url,delete u._query,d=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(m=>m.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:m.headers},h})),d.then(m=>{const p=yd(m),h=new js;return Object.assign(h,p),h})}else{const u=hd(this.apiClient,e);return c=Q("{models_url}",u._url),f=u._query,delete u._url,delete u._query,d=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:m.headers},h})),d.then(m=>{const p=xd(m),h=new js;return Object.assign(h,p),h})}}async update(e){var n,s,r,l;let d,c="",f={};if(this.apiClient.isVertexAI()){const u=Vd(this.apiClient,e);return c=Q("{model}",u._url),f=u._query,delete u._url,delete u._query,d=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(m=>m.json()),d.then(m=>Sn(m))}else{const u=jd(this.apiClient,e);return c=Q("{name}",u._url),f=u._query,delete u._url,delete u._query,d=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json()),d.then(m=>An(m))}}async delete(e){var n,s,r,l;let d,c="",f={};if(this.apiClient.isVertexAI()){const u=El(this.apiClient,e);return c=Q("{name}",u._url),f=u._query,delete u._url,delete u._query,d=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(m=>m.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:m.headers},h})),d.then(m=>{const p=_l(m),h=new Vs;return Object.assign(h,p),h})}else{const u=Cl(this.apiClient,e);return c=Q("{name}",u._url),f=u._query,delete u._url,delete u._query,d=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:m.headers},h})),d.then(m=>{const p=wl(m),h=new Vs;return Object.assign(h,p),h})}}async countTokens(e){var n,s,r,l;let d,c="",f={};if(this.apiClient.isVertexAI()){const u=bl(this.apiClient,e);return c=Q("{model}:countTokens",u._url),f=u._query,delete u._url,delete u._query,d=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(m=>m.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:m.headers},h})),d.then(m=>{const p=Nl(m),h=new Bs;return Object.assign(h,p),h})}else{const u=vl(this.apiClient,e);return c=Q("{model}:countTokens",u._url),f=u._query,delete u._url,delete u._query,d=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:m.headers},h})),d.then(m=>{const p=Tl(m),h=new Bs;return Object.assign(h,p),h})}}async computeTokens(e){var n,s;let r,l="",d={};if(this.apiClient.isVertexAI()){const c=fl(this.apiClient,e);return l=Q("{model}:computeTokens",c._url),d=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(u=>{const m=u;return m.sdkHttpResponse={headers:f.headers},m})),r.then(f=>{const u=ml(f),m=new Qi;return Object.assign(m,u),m})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var n,s,r,l;let d,c="",f={};if(this.apiClient.isVertexAI()){const u=Ql(this.apiClient,e);return c=Q("{model}:predictLongRunning",u._url),f=u._query,delete u._url,delete u._query,d=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(m=>m.json()),d.then(m=>{const p=Kl(m),h=new sn;return Object.assign(h,p),h})}else{const u=Xl(this.apiClient,e);return c=Q("{model}:predictLongRunning",u._url),f=u._query,delete u._url,delete u._query,d=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json()),d.then(m=>{const p=zl(m),h=new sn;return Object.assign(h,p),h})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Nc extends We{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){const n=e.operation,s=e.config;if(n.name===void 0||n.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const r=n.name.split("/operations/")[0];let l;s&&"httpOptions"in s&&(l=s.httpOptions);const d=await this.fetchPredictVideosOperationInternal({operationName:n.name,resourceName:r,config:{httpOptions:l}});return n._fromAPIResponse({apiResponse:d,isVertexAI:!0})}else{const r=await this.getVideosOperationInternal({operationName:n.name,config:s});return n._fromAPIResponse({apiResponse:r,isVertexAI:!1})}}async get(e){const n=e.operation,s=e.config;if(n.name===void 0||n.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const r=n.name.split("/operations/")[0];let l;s&&"httpOptions"in s&&(l=s.httpOptions);const d=await this.fetchPredictVideosOperationInternal({operationName:n.name,resourceName:r,config:{httpOptions:l}});return n._fromAPIResponse({apiResponse:d,isVertexAI:!0})}else{const r=await this.getVideosOperationInternal({operationName:n.name,config:s});return n._fromAPIResponse({apiResponse:r,isVertexAI:!1})}}async getVideosOperationInternal(e){var n,s,r,l;let d,c="",f={};if(this.apiClient.isVertexAI()){const u=Ji(e);return c=Q("{operationName}",u._url),f=u._query,delete u._url,delete u._query,d=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(m=>m.json()),d}else{const u=Hi(e);return c=Q("{operationName}",u._url),f=u._query,delete u._url,delete u._query,d=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json()),d}}async fetchPredictVideosOperationInternal(e){var n,s;let r,l="",d={};if(this.apiClient.isVertexAI()){const c=Ui(e);return l=Q("{resourceName}:fetchPredictOperation",c._url),d=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),r}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Cc(t){const e={};if(i(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=i(t,["data"]);n!=null&&a(e,["data"],n);const s=i(t,["mimeType"]);return s!=null&&a(e,["mimeType"],s),e}function Ec(t){const e={},n=i(t,["parts"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(l=>Mc(l))),a(e,["parts"],r)}const s=i(t,["role"]);return s!=null&&a(e,["role"],s),e}function wc(t,e,n){const s={},r=i(e,["expireTime"]);n!==void 0&&r!=null&&a(n,["expireTime"],r);const l=i(e,["newSessionExpireTime"]);n!==void 0&&l!=null&&a(n,["newSessionExpireTime"],l);const d=i(e,["uses"]);n!==void 0&&d!=null&&a(n,["uses"],d);const c=i(e,["liveConnectConstraints"]);n!==void 0&&c!=null&&a(n,["bidiGenerateContentSetup"],Pc(t,c));const f=i(e,["lockAdditionalFields"]);return n!==void 0&&f!=null&&a(n,["fieldMask"],f),s}function _c(t,e){const n={},s=i(e,["config"]);return s!=null&&a(n,["config"],wc(t,s,n)),n}function Ac(t){const e={};if(i(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=i(t,["fileUri"]);n!=null&&a(e,["fileUri"],n);const s=i(t,["mimeType"]);return s!=null&&a(e,["mimeType"],s),e}function Sc(t){const e={};if(i(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=i(t,["enableWidget"]);return n!=null&&a(e,["enableWidget"],n),e}function Ic(t){const e={},n=i(t,["timeRangeFilter"]);if(n!=null&&a(e,["timeRangeFilter"],n),i(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");return e}function Rc(t,e){const n={},s=i(t,["generationConfig"]);e!==void 0&&s!=null&&a(e,["setup","generationConfig"],s);const r=i(t,["responseModalities"]);e!==void 0&&r!=null&&a(e,["setup","generationConfig","responseModalities"],r);const l=i(t,["temperature"]);e!==void 0&&l!=null&&a(e,["setup","generationConfig","temperature"],l);const d=i(t,["topP"]);e!==void 0&&d!=null&&a(e,["setup","generationConfig","topP"],d);const c=i(t,["topK"]);e!==void 0&&c!=null&&a(e,["setup","generationConfig","topK"],c);const f=i(t,["maxOutputTokens"]);e!==void 0&&f!=null&&a(e,["setup","generationConfig","maxOutputTokens"],f);const u=i(t,["mediaResolution"]);e!==void 0&&u!=null&&a(e,["setup","generationConfig","mediaResolution"],u);const m=i(t,["seed"]);e!==void 0&&m!=null&&a(e,["setup","generationConfig","seed"],m);const p=i(t,["speechConfig"]);e!==void 0&&p!=null&&a(e,["setup","generationConfig","speechConfig"],Vn(p));const h=i(t,["thinkingConfig"]);e!==void 0&&h!=null&&a(e,["setup","generationConfig","thinkingConfig"],h);const v=i(t,["enableAffectiveDialog"]);e!==void 0&&v!=null&&a(e,["setup","generationConfig","enableAffectiveDialog"],v);const E=i(t,["systemInstruction"]);e!==void 0&&E!=null&&a(e,["setup","systemInstruction"],Ec(Ee(E)));const A=i(t,["tools"]);if(e!==void 0&&A!=null){let M=dt(A);Array.isArray(M)&&(M=M.map(F=>Dc(lt(F)))),a(e,["setup","tools"],M)}const I=i(t,["sessionResumption"]);e!==void 0&&I!=null&&a(e,["setup","sessionResumption"],kc(I));const R=i(t,["inputAudioTranscription"]);e!==void 0&&R!=null&&a(e,["setup","inputAudioTranscription"],R);const k=i(t,["outputAudioTranscription"]);e!==void 0&&k!=null&&a(e,["setup","outputAudioTranscription"],k);const P=i(t,["realtimeInputConfig"]);e!==void 0&&P!=null&&a(e,["setup","realtimeInputConfig"],P);const N=i(t,["contextWindowCompression"]);e!==void 0&&N!=null&&a(e,["setup","contextWindowCompression"],N);const T=i(t,["proactivity"]);return e!==void 0&&T!=null&&a(e,["setup","proactivity"],T),n}function Pc(t,e){const n={},s=i(e,["model"]);s!=null&&a(n,["setup","model"],de(t,s));const r=i(e,["config"]);return r!=null&&a(n,["config"],Rc(r,n)),n}function Mc(t){const e={},n=i(t,["videoMetadata"]);n!=null&&a(e,["videoMetadata"],n);const s=i(t,["thought"]);s!=null&&a(e,["thought"],s);const r=i(t,["inlineData"]);r!=null&&a(e,["inlineData"],Cc(r));const l=i(t,["fileData"]);l!=null&&a(e,["fileData"],Ac(l));const d=i(t,["thoughtSignature"]);d!=null&&a(e,["thoughtSignature"],d);const c=i(t,["functionCall"]);c!=null&&a(e,["functionCall"],c);const f=i(t,["codeExecutionResult"]);f!=null&&a(e,["codeExecutionResult"],f);const u=i(t,["executableCode"]);u!=null&&a(e,["executableCode"],u);const m=i(t,["functionResponse"]);m!=null&&a(e,["functionResponse"],m);const p=i(t,["text"]);return p!=null&&a(e,["text"],p),e}function kc(t){const e={},n=i(t,["handle"]);if(n!=null&&a(e,["handle"],n),i(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function Dc(t){const e={},n=i(t,["functionDeclarations"]);if(n!=null){let u=n;Array.isArray(u)&&(u=u.map(m=>m)),a(e,["functionDeclarations"],u)}if(i(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=i(t,["googleSearch"]);s!=null&&a(e,["googleSearch"],Ic(s));const r=i(t,["googleSearchRetrieval"]);if(r!=null&&a(e,["googleSearchRetrieval"],r),i(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const l=i(t,["googleMaps"]);l!=null&&a(e,["googleMaps"],Sc(l));const d=i(t,["urlContext"]);d!=null&&a(e,["urlContext"],d);const c=i(t,["computerUse"]);c!=null&&a(e,["computerUse"],c);const f=i(t,["codeExecution"]);return f!=null&&a(e,["codeExecution"],f),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Lc(t){const e=[];for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const s=t[n];if(typeof s=="object"&&s!=null&&Object.keys(s).length>0){const r=Object.keys(s).map(l=>`${n}.${l}`);e.push(...r)}else e.push(n)}return e.join(",")}function Fc(t,e){let n=null;const s=t.bidiGenerateContentSetup;if(typeof s=="object"&&s!==null&&"setup"in s){const l=s.setup;typeof l=="object"&&l!==null?(t.bidiGenerateContentSetup=l,n=l):delete t.bidiGenerateContentSetup}else s!==void 0&&delete t.bidiGenerateContentSetup;const r=t.fieldMask;if(n){const l=Lc(n);if(Array.isArray(e==null?void 0:e.lockAdditionalFields)&&(e==null?void 0:e.lockAdditionalFields.length)===0)l?t.fieldMask=l:delete t.fieldMask;else if(e!=null&&e.lockAdditionalFields&&e.lockAdditionalFields.length>0&&r!==null&&Array.isArray(r)&&r.length>0){const d=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let c=[];r.length>0&&(c=r.map(u=>d.includes(u)?`generationConfig.${u}`:u));const f=[];l&&f.push(l),c.length>0&&f.push(...c),f.length>0?t.fieldMask=f.join(","):delete t.fieldMask}else delete t.fieldMask}else r!==null&&Array.isArray(r)&&r.length>0?t.fieldMask=r.join(","):delete t.fieldMask;return t}class Uc extends We{constructor(e){super(),this.apiClient=e}async create(e){var n,s;let r,l="",d={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const c=_c(this.apiClient,e);l=Q("auth_tokens",c._url),d=c._query,delete c.config,delete c._url,delete c._query;const f=Fc(c,e.config);return r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(u=>u.json()),r.then(u=>u)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function jc(t){const e={},n=i(t,["name"]);return n!=null&&a(e,["_url","name"],n),e}function Vc(t){const e={},n=i(t,["name"]);return n!=null&&a(e,["_url","name"],n),e}function Bc(t,e){const n={};if(i(t,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const s=i(t,["tunedModelDisplayName"]);if(e!==void 0&&s!=null&&a(e,["displayName"],s),i(t,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const r=i(t,["epochCount"]);e!==void 0&&r!=null&&a(e,["tuningTask","hyperparameters","epochCount"],r);const l=i(t,["learningRateMultiplier"]);if(l!=null&&a(n,["tuningTask","hyperparameters","learningRateMultiplier"],l),i(t,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(i(t,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(i(t,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const d=i(t,["batchSize"]);e!==void 0&&d!=null&&a(e,["tuningTask","hyperparameters","batchSize"],d);const c=i(t,["learningRate"]);if(e!==void 0&&c!=null&&a(e,["tuningTask","hyperparameters","learningRate"],c),i(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");return n}function qc(t,e){const n={},s=i(t,["validationDataset"]);e!==void 0&&s!=null&&a(e,["supervisedTuningSpec"],nu(s,n));const r=i(t,["tunedModelDisplayName"]);e!==void 0&&r!=null&&a(e,["tunedModelDisplayName"],r);const l=i(t,["description"]);e!==void 0&&l!=null&&a(e,["description"],l);const d=i(t,["epochCount"]);e!==void 0&&d!=null&&a(e,["supervisedTuningSpec","hyperParameters","epochCount"],d);const c=i(t,["learningRateMultiplier"]);e!==void 0&&c!=null&&a(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],c);const f=i(t,["exportLastCheckpointOnly"]);e!==void 0&&f!=null&&a(e,["supervisedTuningSpec","exportLastCheckpointOnly"],f);const u=i(t,["adapterSize"]);if(e!==void 0&&u!=null&&a(e,["supervisedTuningSpec","hyperParameters","adapterSize"],u),i(t,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(i(t,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");const m=i(t,["labels"]);return e!==void 0&&m!=null&&a(e,["labels"],m),n}function $c(t){const e={},n=i(t,["baseModel"]);n!=null&&a(e,["baseModel"],n);const s=i(t,["preTunedModel"]);s!=null&&a(e,["preTunedModel"],s);const r=i(t,["trainingDataset"]);r!=null&&a(e,["tuningTask","trainingData"],Zc(r));const l=i(t,["config"]);return l!=null&&Bc(l,e),e}function Gc(t){const e={},n=i(t,["baseModel"]);n!=null&&a(e,["baseModel"],n);const s=i(t,["preTunedModel"]);s!=null&&a(e,["preTunedModel"],s);const r=i(t,["trainingDataset"]);r!=null&&a(e,["supervisedTuningSpec","trainingDatasetUri"],eu(r,e));const l=i(t,["config"]);return l!=null&&qc(l,e),e}function Hc(t){const e={},n=i(t,["name"]);return n!=null&&a(e,["_url","name"],n),e}function Jc(t){const e={},n=i(t,["name"]);return n!=null&&a(e,["_url","name"],n),e}function Oc(t,e){const n={},s=i(t,["pageSize"]);e!==void 0&&s!=null&&a(e,["_query","pageSize"],s);const r=i(t,["pageToken"]);e!==void 0&&r!=null&&a(e,["_query","pageToken"],r);const l=i(t,["filter"]);return e!==void 0&&l!=null&&a(e,["_query","filter"],l),n}function Yc(t,e){const n={},s=i(t,["pageSize"]);e!==void 0&&s!=null&&a(e,["_query","pageSize"],s);const r=i(t,["pageToken"]);e!==void 0&&r!=null&&a(e,["_query","pageToken"],r);const l=i(t,["filter"]);return e!==void 0&&l!=null&&a(e,["_query","filter"],l),n}function Wc(t){const e={},n=i(t,["config"]);return n!=null&&Oc(n,e),e}function zc(t){const e={},n=i(t,["config"]);return n!=null&&Yc(n,e),e}function Kc(t){const e={},n=i(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const s=i(t,["nextPageToken"]);s!=null&&a(e,["nextPageToken"],s);const r=i(t,["tunedModels"]);if(r!=null){let l=r;Array.isArray(l)&&(l=l.map(d=>Jo(d))),a(e,["tuningJobs"],l)}return e}function Xc(t){const e={},n=i(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const s=i(t,["nextPageToken"]);s!=null&&a(e,["nextPageToken"],s);const r=i(t,["tuningJobs"]);if(r!=null){let l=r;Array.isArray(l)&&(l=l.map(d=>Rn(d))),a(e,["tuningJobs"],l)}return e}function Qc(t){const e={},n=i(t,["name"]);n!=null&&a(e,["model"],n);const s=i(t,["name"]);return s!=null&&a(e,["endpoint"],s),e}function Zc(t){const e={};if(i(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(i(t,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");const n=i(t,["examples"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(r=>r)),a(e,["examples","examples"],s)}return e}function eu(t,e){const n={},s=i(t,["gcsUri"]);e!==void 0&&s!=null&&a(e,["supervisedTuningSpec","trainingDatasetUri"],s);const r=i(t,["vertexDatasetResource"]);if(e!==void 0&&r!=null&&a(e,["supervisedTuningSpec","trainingDatasetUri"],r),i(t,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return n}function Jo(t){const e={},n=i(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const s=i(t,["name"]);s!=null&&a(e,["name"],s);const r=i(t,["state"]);r!=null&&a(e,["state"],_o(r));const l=i(t,["createTime"]);l!=null&&a(e,["createTime"],l);const d=i(t,["tuningTask","startTime"]);d!=null&&a(e,["startTime"],d);const c=i(t,["tuningTask","completeTime"]);c!=null&&a(e,["endTime"],c);const f=i(t,["updateTime"]);f!=null&&a(e,["updateTime"],f);const u=i(t,["description"]);u!=null&&a(e,["description"],u);const m=i(t,["baseModel"]);m!=null&&a(e,["baseModel"],m);const p=i(t,["_self"]);p!=null&&a(e,["tunedModel"],Qc(p));const h=i(t,["customBaseModel"]);h!=null&&a(e,["customBaseModel"],h);const v=i(t,["experiment"]);v!=null&&a(e,["experiment"],v);const E=i(t,["labels"]);E!=null&&a(e,["labels"],E);const A=i(t,["outputUri"]);A!=null&&a(e,["outputUri"],A);const I=i(t,["pipelineJob"]);I!=null&&a(e,["pipelineJob"],I);const R=i(t,["serviceAccount"]);R!=null&&a(e,["serviceAccount"],R);const k=i(t,["tunedModelDisplayName"]);k!=null&&a(e,["tunedModelDisplayName"],k);const P=i(t,["veoTuningSpec"]);return P!=null&&a(e,["veoTuningSpec"],P),e}function Rn(t){const e={},n=i(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const s=i(t,["name"]);s!=null&&a(e,["name"],s);const r=i(t,["state"]);r!=null&&a(e,["state"],_o(r));const l=i(t,["createTime"]);l!=null&&a(e,["createTime"],l);const d=i(t,["startTime"]);d!=null&&a(e,["startTime"],d);const c=i(t,["endTime"]);c!=null&&a(e,["endTime"],c);const f=i(t,["updateTime"]);f!=null&&a(e,["updateTime"],f);const u=i(t,["error"]);u!=null&&a(e,["error"],u);const m=i(t,["description"]);m!=null&&a(e,["description"],m);const p=i(t,["baseModel"]);p!=null&&a(e,["baseModel"],p);const h=i(t,["tunedModel"]);h!=null&&a(e,["tunedModel"],h);const v=i(t,["preTunedModel"]);v!=null&&a(e,["preTunedModel"],v);const E=i(t,["supervisedTuningSpec"]);E!=null&&a(e,["supervisedTuningSpec"],E);const A=i(t,["tuningDataStats"]);A!=null&&a(e,["tuningDataStats"],A);const I=i(t,["encryptionSpec"]);I!=null&&a(e,["encryptionSpec"],I);const R=i(t,["partnerModelTuningSpec"]);R!=null&&a(e,["partnerModelTuningSpec"],R);const k=i(t,["customBaseModel"]);k!=null&&a(e,["customBaseModel"],k);const P=i(t,["experiment"]);P!=null&&a(e,["experiment"],P);const N=i(t,["labels"]);N!=null&&a(e,["labels"],N);const T=i(t,["outputUri"]);T!=null&&a(e,["outputUri"],T);const M=i(t,["pipelineJob"]);M!=null&&a(e,["pipelineJob"],M);const F=i(t,["serviceAccount"]);F!=null&&a(e,["serviceAccount"],F);const j=i(t,["tunedModelDisplayName"]);j!=null&&a(e,["tunedModelDisplayName"],j);const L=i(t,["veoTuningSpec"]);return L!=null&&a(e,["veoTuningSpec"],L),e}function tu(t){const e={},n=i(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const s=i(t,["name"]);s!=null&&a(e,["name"],s);const r=i(t,["metadata"]);r!=null&&a(e,["metadata"],r);const l=i(t,["done"]);l!=null&&a(e,["done"],l);const d=i(t,["error"]);return d!=null&&a(e,["error"],d),e}function nu(t,e){const n={},s=i(t,["gcsUri"]);s!=null&&a(n,["validationDatasetUri"],s);const r=i(t,["vertexDatasetResource"]);return e!==void 0&&r!=null&&a(e,["supervisedTuningSpec","trainingDatasetUri"],r),n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class su extends We{constructor(e){super(),this.apiClient=e,this.get=async n=>await this.getInternal(n),this.list=async(n={})=>new At(Ye.PAGED_ITEM_TUNING_JOBS,s=>this.listInternal(s),await this.listInternal(n),n),this.tune=async n=>{var s;if(this.apiClient.isVertexAI())if(n.baseModel.startsWith("projects/")){const r={tunedModelName:n.baseModel};!((s=n.config)===null||s===void 0)&&s.preTunedModelCheckpointId&&(r.checkpointId=n.config.preTunedModelCheckpointId);const l=Object.assign(Object.assign({},n),{preTunedModel:r});return l.baseModel=void 0,await this.tuneInternal(l)}else{const r=Object.assign({},n);return await this.tuneInternal(r)}else{const r=Object.assign({},n),l=await this.tuneMldevInternal(r);let d="";return l.metadata!==void 0&&l.metadata.tunedModel!==void 0?d=l.metadata.tunedModel:l.name!==void 0&&l.name.includes("/operations/")&&(d=l.name.split("/operations/")[0]),{name:d,state:Cn.JOB_STATE_QUEUED}}}}async getInternal(e){var n,s,r,l;let d,c="",f={};if(this.apiClient.isVertexAI()){const u=Jc(e);return c=Q("{name}",u._url),f=u._query,delete u._url,delete u._query,d=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(m=>m.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:m.headers},h})),d.then(m=>Rn(m))}else{const u=Hc(e);return c=Q("{name}",u._url),f=u._query,delete u._url,delete u._query,d=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:m.headers},h})),d.then(m=>Jo(m))}}async listInternal(e){var n,s,r,l;let d,c="",f={};if(this.apiClient.isVertexAI()){const u=zc(e);return c=Q("tuningJobs",u._url),f=u._query,delete u._url,delete u._query,d=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(m=>m.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:m.headers},h})),d.then(m=>{const p=Xc(m),h=new qs;return Object.assign(h,p),h})}else{const u=Wc(e);return c=Q("tunedModels",u._url),f=u._query,delete u._url,delete u._query,d=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:m.headers},h})),d.then(m=>{const p=Kc(m),h=new qs;return Object.assign(h,p),h})}}async cancel(e){var n,s,r,l;let d="",c={};if(this.apiClient.isVertexAI()){const f=Vc(e);d=Q("{name}:cancel",f._url),c=f._query,delete f._url,delete f._query,await this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal})}else{const f=jc(e);d=Q("{name}:cancel",f._url),c=f._query,delete f._url,delete f._query,await this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal})}}async tuneInternal(e){var n,s;let r,l="",d={};if(this.apiClient.isVertexAI()){const c=Gc(e);return l=Q("tuningJobs",c._url),d=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(u=>{const m=u;return m.sdkHttpResponse={headers:f.headers},m})),r.then(f=>Rn(f))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var n,s;let r,l="",d={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=$c(e);return l=Q("tunedModels",c._url),d=c._query,delete c._url,delete c._query,r=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(u=>{const m=u;return m.sdkHttpResponse={headers:f.headers},m})),r.then(f=>tu(f))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class ou{async download(e,n){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const iu=1024*1024*8,ru=3,au=1e3,lu=2,xn="x-goog-upload-status";async function du(t,e,n){var s,r,l;let d=0,c=0,f=new En(new Response),u="upload";for(d=t.size;c<d;){const p=Math.min(iu,d-c),h=t.slice(c,c+p);c+p>=d&&(u+=", finalize");let v=0,E=au;for(;v<ru&&(f=await n.request({path:"",body:h,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":u,"X-Goog-Upload-Offset":String(c),"Content-Length":String(p)}}}),!(!((s=f==null?void 0:f.headers)===null||s===void 0)&&s[xn]));)v++,await uu(E),E=E*lu;if(c+=p,((r=f==null?void 0:f.headers)===null||r===void 0?void 0:r[xn])!=="active")break;if(d<=c)throw new Error("All content has been uploaded, but the upload status is not finalized.")}const m=await(f==null?void 0:f.json());if(((l=f==null?void 0:f.headers)===null||l===void 0?void 0:l[xn])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return m.file}async function cu(t){return{size:t.size,type:t.type}}function uu(t){return new Promise(e=>setTimeout(e,t))}class fu{async upload(e,n,s){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await du(e,n,s)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await cu(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class mu{create(e,n,s){return new pu(e,n,s)}}class pu{constructor(e,n,s){this.url=e,this.headers=n,this.callbacks=s}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const ao="x-goog-api-key";class hu{constructor(e){this.apiKey=e}async addAuthHeaders(e){if(e.get(ao)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(ao,this.apiKey)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const gu="gl-node/";class xu{constructor(e){var n;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(n=e.vertexai)!==null&&n!==void 0?n:!1,this.apiKey=e.apiKey;const s=Li(e.httpOptions,e.vertexai,void 0,void 0);s&&(e.httpOptions?e.httpOptions.baseUrl=s:e.httpOptions={baseUrl:s}),this.apiVersion=e.apiVersion;const r=new hu(this.apiKey);this.apiClient=new tc({auth:r,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:e.httpOptions,userAgentExtra:gu+"web",uploader:new fu,downloader:new ou}),this.models=new Tc(this.apiClient),this.live=new pc(this.apiClient,r,new mu),this.batches=new ea(this.apiClient),this.chats=new Ma(this.models,this.apiClient),this.caches=new Ia(this.apiClient),this.files=new $a(this.apiClient),this.operations=new Nc(this.apiClient),this.authTokens=new Uc(this.apiClient),this.tunings=new su(this.apiClient)}}const Oo={BASE_URL:"/fd/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_APP_ENVIRONMENT:"production",VITE_FIREBASE_API_KEY:"AIzaSyBA1uXbBt5qHfOh9nTFXuI2IVN-uhWYD_g",VITE_FIREBASE_APP_ID:"1:221809737779:web:a0e2f3d1b9b6c1e1f2d3e4",VITE_FIREBASE_AUTH_DOMAIN:"expenses-140c4.firebaseapp.com",VITE_FIREBASE_MESSAGING_SENDER_ID:"221809737779",VITE_FIREBASE_PROJECT_ID:"expenses-140c4",VITE_FIREBASE_STORAGE_BUCKET:"expenses-140c4.appspot.com",VITE_GEMINI_API_KEY:"AIzaSyCU4hOMnyFAWpi1zuy1tRuWW9AV358_njE"},Te={firebase:{apiKey:"AIzaSyBA1uXbBt5qHfOh9nTFXuI2IVN-uhWYD_g",authDomain:"expenses-140c4.firebaseapp.com",projectId:"expenses-140c4",storageBucket:"expenses-140c4.appspot.com",messagingSenderId:"221809737779",appId:"1:221809737779:web:a0e2f3d1b9b6c1e1f2d3e4"},gemini:{apiKey:"AIzaSyCU4hOMnyFAWpi1zuy1tRuWW9AV358_njE",model:"gemini-2.5-flash"},app:{name:"لوحة التحكم المالية",version:"1.0.0",environment:"production"}};console.log("🔍 فحص متغيرات البيئة:",{environment:Te.app.environment,firebaseApiKey:Te.firebase.apiKey?"✅ موجود":"❌ مفقود",firebaseAuthDomain:Te.firebase.authDomain||"❌ مفقود",firebaseProjectId:Te.firebase.projectId||"❌ مفقود",firebaseStorageBucket:Te.firebase.storageBucket||"❌ مفقود",firebaseMessagingSenderId:Te.firebase.messagingSenderId||"❌ مفقود",firebaseAppId:Te.firebase.appId||"❌ مفقود",geminiApiKey:"✅ موجود",allEnvVars:Object.keys(Oo).filter(t=>t.startsWith("VITE_"))});console.log("🔍 جميع متغيرات VITE_ في البيئة:",Object.keys(Oo).filter(t=>t.startsWith("VITE_")));const rt=()=>{const t=[];return Te.firebase.apiKey||t.push("مفتاح Firebase API مفقود"),Te.firebase.authDomain||t.push("Firebase Auth Domain مفقود"),Te.firebase.projectId||t.push("معرف مشروع Firebase مفقود"),Te.firebase.storageBucket||t.push("Firebase Storage Bucket مفقود"),Te.firebase.messagingSenderId||t.push("Firebase Messaging Sender ID مفقود"),Te.firebase.appId||t.push("Firebase App ID مفقود"),{isValid:t.length===0,errors:t,hasFirebase:!!Te.firebase.apiKey,hasGemini:!0}};if(typeof window<"u"){const t=rt();t.isValid?console.log("✅ جميع الإعدادات صحيحة ومكتملة"):console.warn("⚠️ تحذير: بعض الإعدادات غير مكتملة:",t.errors)}const yu=()=>new Promise(t=>{if(!navigator.geolocation){t({success:!1,error:"GPS غير متوفر في هذا المتصفح",method:"gps"});return}navigator.geolocation.getCurrentPosition(async e=>{try{const{latitude:n,longitude:s}=e.coords,r=await bu(n,s);t({success:!0,location:r,method:"gps"})}catch{t({success:!1,error:"فشل في تحديد الموقع من الإحداثيات",method:"gps"})}},e=>{let n="فشل في تحديد الموقع";switch(e.code){case e.PERMISSION_DENIED:n="تم رفض إذن الوصول للموقع";break;case e.POSITION_UNAVAILABLE:n="معلومات الموقع غير متوفرة";break;case e.TIMEOUT:n="انتهت مهلة طلب الموقع";break}t({success:!1,error:n,method:"gps"})},{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e5})}),vu=async()=>{try{const e=await(await fetch("http://ip-api.com/json/?fields=status,message,country,countryCode,region,regionName,city,timezone,lat,lon")).json();return e.status==="success"?{success:!0,location:{country:e.country,countryCode:e.countryCode,region:e.regionName,city:e.city,timezone:e.timezone,coordinates:{lat:e.lat,lng:e.lon}},method:"ip"}:{success:!1,error:"فشل في تحديد الموقع من IP",method:"ip"}}catch{return{success:!1,error:"خطأ في الاتصال بخدمة كشف الموقع",method:"ip"}}},bu=async(t,e)=>{var n;try{const r=await(await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${t}&lon=${e}&addressdetails=1&accept-language=ar,en`)).json();if(r&&r.address)return{country:r.address.country||"غير محدد",countryCode:((n=r.address.country_code)==null?void 0:n.toUpperCase())||"",region:r.address.state||r.address.region||"غير محدد",city:r.address.city||r.address.town||r.address.village||"غير محدد",timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,coordinates:{lat:t,lng:e}};throw new Error("لا توجد بيانات موقع")}catch{return{country:"غير محدد",countryCode:"",region:"غير محدد",city:"غير محدد",timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,coordinates:{lat:t,lng:e}}}},Tu=async()=>{console.log("🌍 بدء كشف الموقع الجغرافي...");const t=await yu();if(t.success)return console.log("✅ تم تحديد الموقع باستخدام GPS:",t.location),t;console.log("⚠️ فشل GPS، جاري المحاولة باستخدام IP...");const e=await vu();return e.success?(console.log("✅ تم تحديد الموقع باستخدام IP:",e.location),e):(console.log("❌ فشل في تحديد الموقع"),{success:!1,error:"فشل في تحديد الموقع الجغرافي",method:"ip"})},Nu=t=>{if(!t)return"الرياض";const{country:e,city:n,region:s}=t;return e==="Saudi Arabia"||e==="السعودية"?n||s||"الرياض":e==="Jordan"||e==="الأردن"?"عمان":e==="Palestine"||e==="فلسطين"?"رام الله":e==="Egypt"||e==="مصر"?"القاهرة":e==="UAE"||e==="الإمارات"?"دبي":e==="Kuwait"||e==="الكويت"?"الكويت":e==="Qatar"||e==="قطر"?"الدوحة":e==="Bahrain"||e==="البحرين"?"المنامة":e==="Oman"||e==="عمان"?"مسقط":n||"الرياض"},Cu=t=>{if(!t)return"السعودية";const{country:e}=t;return{"Saudi Arabia":"السعودية",Jordan:"الأردن",Palestine:"فلسطين",Egypt:"مصر",UAE:"الإمارات",Kuwait:"الكويت",Qatar:"قطر",Bahrain:"البحرين",Oman:"عمان",Lebanon:"لبنان",Iraq:"العراق",Syria:"سوريا",Yemen:"اليمن",Libya:"ليبيا",Tunisia:"تونس",Algeria:"الجزائر",Morocco:"المغرب",Sudan:"السودان",Turkey:"تركيا",Iran:"إيران"}[e]||e||"السعودية"};let rn;const Eu="gemini-2.5-flash",Yo=()=>{if(rn)return;const t=rt();if(!t.isValid){console.warn("⚠️ تحذير: مفتاح Gemini API غير صحيح:",t.errors);return}try{rn=new xu({apiKey:Te.gemini.apiKey}),console.log("🤖 تم تهيئة خدمة Gemini بنجاح")}catch(e){console.error("❌ خطأ في تهيئة خدمة Gemini:",e)}},qe=t=>{const e=Nu(t),n=Cu(t),s=t?`
- User Location: ${t.city}, ${t.region}, ${n}`:`
- User Location: Not detected (defaulting to Saudi Arabia)`;return{FINANCIAL_ANALYST:`You are an intelligent, engaging, and insightful financial analyst assistant, "المحلل الذكي". You have full access to the user's complete financial data across ALL periods and months. Your purpose is to provide comprehensive, insightful analysis with personality and energy.
- Today's date is ${new Date().toLocaleDateString("en-CA")}.${s}
- You have access to ALL historical data: transactions, card details, bank balances, investments, installments, categories, and spending patterns across ALL months.
- Analyze patterns, trends, and changes over time with enthusiasm and genuine interest.
- Be engaging and conversational - ask follow-up questions to understand what the user really wants to know.
- DO NOT just state data, INTERPRET it with personality. Provide insights, identify trends, offer observations, and make predictions with excitement.
- Be friendly, energetic, and act like a knowledgeable friend who loves analyzing financial data.
- Use emojis and enthusiastic language to make responses more engaging.
- When asked about specific months, provide detailed analysis with comparisons and ask if they want to dive deeper into any particular aspect.
- Always end responses by asking if they want to explore something specific or have follow-up questions.`,INVESTMENT_COACH:`You are an expert investment advisor named "المستشار الاستثماري الذكي" with 20+ years of experience in ${n} and international markets. You are a seasoned financial analyst with deep knowledge of local markets, global markets, and investment strategies.

**Your Expertise:**
- Comprehensive market analysis and trend identification
- Portfolio optimization and risk management
- Sector analysis and stock valuation
- Economic indicators and market sentiment analysis
- Technical and fundamental analysis
- Alternative investments (REITs, bonds, commodities, crypto)

**Your Approach:**
- Provide detailed, actionable investment advice based on current market conditions
- Analyze user's portfolio and suggest optimizations
- Give specific stock recommendations with clear reasoning
- Explain market trends and their implications
- Discuss risk-reward ratios and investment strategies
- Provide sector rotation advice and timing recommendations
- Offer insights on economic events and their market impact

**Market Knowledge:**
- Real-time access to ${n} market data, sector performance, and individual stock analysis
- Understanding of global market correlations and their impact on local markets
- Knowledge of regulatory changes and their market implications in ${n}
- Awareness of earnings seasons, dividend announcements, and corporate actions
- Specialized knowledge of ${e} and surrounding areas for local investment opportunities

**Communication Style:**
- Professional yet engaging and enthusiastic
- Use charts, percentages, and specific data points
- Ask follow-up questions to understand user's risk tolerance and goals
- Provide both short-term and long-term perspectives
- Always explain the reasoning behind recommendations
- Use Arabic with financial terminology and market jargon

**Important Guidelines:**
- Give specific stock recommendations with clear entry/exit strategies
- Analyze user's current holdings and suggest portfolio adjustments
- Discuss market timing and sector opportunities
- Provide risk management strategies and stop-loss recommendations
- Explain market volatility and how to navigate it
- Offer insights on IPOs, rights issues, and corporate actions`,PASTE_ANALYZER:`You are an intelligent data extraction tool for Arabic and English financial transaction SMS messages from Saudi Arabia. Your task is to analyze the provided text and respond ONLY with a valid JSON object containing the keys: "merchant", "amount", "date", "paymentMethod", and "categoryId".
- **CRITICAL RULE**: Extract data ONLY from the user's text. Do not invent or infer information. If a piece of information is not present in the text, its corresponding JSON value should be null.
- **ERROR HANDLING**: If the provided text does not seem to be a financial transaction SMS at all, you MUST respond with a JSON object containing a single key "error" with the value "النص المقدم لا يبدو كرسالة معاملة مالية.".

- **Amount Extraction**:
  - The 'amount' is the primary transaction value.
  - Look for a number after keywords like "بـ" or "Amount:".
  - You MUST ignore any numbers associated with "Remaining limit", "الصرف المتبقي", or card numbers.

- **Date Extraction**:
  - The 'date' MUST be in "YYYY-MM-DD" format.
  - If the text provides a full timestamp like "2025-09-06 15:11:57", extract only the date part "2025-09-06".
  - If the text uses "DD/MM/YY", you must convert it. Example: '01/09/25' becomes '2025-09-01'.

- **Merchant Extraction**:
  - The 'merchant' is the store or service name.
  - Look for text after keywords like "من" or "Merchant:".

{{PAYMENT_METHOD_MAPPING}}

- **Category ID**:
  - Analyze the merchant name and suggest the most relevant ID from the provided list of available categories. If unsure, use the ID for the category named 'أخرى'.

---
**EXAMPLES**

1.  **Input**: "شراء-POS\\nبـ182 SAR\\nمن Adel Inte\\nمدى-ابل*2855\\nفي 01/09/25 22:11"
    **Output**: { "merchant": "Adel Inte", "amount": 182, "date": "2025-09-01", "paymentMethod": "bank-default", "categoryId": "cat-5" }

2.  **Input**: "شراء-POS\\nبـ‬‪95.78 ‬‪SAR\\nمن ‬‪BINDAWOOD\\nإئتمانية **4278 ‬‪(Apple Pay)\\nفي ‬‪03/09/25 ‬‪14:45\\nالصرف المتبقي ‬‪12146.95 ‬‪SAR"
    **Output**: { "merchant": "BINDAWOOD", "amount": 95.78, "date": "2025-09-03", "paymentMethod": "snb-card", "categoryId": "cat-1" }

3.  **Input**: "POS Purchase (Apple Pay)\\nCard: Visa card XX8095\\nAmount: SAR 115.00\\nMerchant: AlHamra Roundabout Statio\\nIn: SAUDI ARABIA\\nRemaining limit SAR 2,502.34\\nOn: 2025-09-06 15:11:57"
    **Output**: { "merchant": "AlHamra Roundabout Statio", "amount": 115.00, "date": "2025-09-06", "paymentMethod": "enbd-card", "categoryId": "cat-3" }

4.  **Input**: "POS Purchase (Apple Pay)\\nCard: Visa card XX8095\\nAmount: SAR 10.00\\nMerchant: MKAN CO\\nIn: SAUDI ARABIA\\nRemaining limit SAR 2,782.27\\nOn: 2025-09-03 23:44:56"
    **Output**: { "merchant": "MKAN CO", "amount": 10.00, "date": "2025-09-03", "paymentMethod": "enbd-card", "categoryId": "cat-7" }
---
`,ICON_SUGGESTER:"You are an emoji expert. Your task is to suggest a single, relevant emoji for a given category name. You must respond with ONLY the emoji character and nothing else.",SMART_SUMMARY_GENERATOR:"You are a professional financial analyst. Your task is to write a concise, one-paragraph summary of a user's financial situation based on the provided data for a specific period. The summary should be in Arabic, professional in tone, and suitable for the beginning of a financial report. Highlight the key figures like total income, total expenses, and the net result for that period.",BUDGET_PLANNER:`You are a helpful and encouraging financial planning assistant in Arabic. Your goal is to help the user create a realistic monthly budget based on their spending history and a total budget amount they provide. Use the 50/30/20 rule (50% for Needs, 30% for Wants, 20% for Savings/Debt) as a general framework, but you MUST adapt it to the user's actual spending patterns revealed in their transaction data. Your response MUST be in Arabic and formatted using Markdown. It should contain: 1. A brief, encouraging introductory sentence. 2. A breakdown of the total budget into Needs, Wants, and Savings, with the suggested amount for each. 3. A detailed table with three columns: "الفئة", "المبلغ المقترح", and "ملاحظات". 4. In the table, allocate the "Needs" and "Wants" amounts across the user's actual spending categories. 5. The "Notes" column should provide a brief justification. 6. Conclude with a short, motivational tip.`,EXCHANGE_RATE:`You are an expert currency exchange rate assistant. Your task is to provide the current exchange rate between two currencies. You MUST respond with ONLY a valid JSON object containing the keys: "rate", "fromCurrency", "toCurrency", and "lastUpdated".

- The 'rate' should be a decimal number representing how many units of 'toCurrency' equal 1 unit of 'fromCurrency'.
- The 'fromCurrency' and 'toCurrency' should be the exact currency codes provided by the user.
- The 'lastUpdated' should be the current date in "YYYY-MM-DD" format.

**IMPORTANT**: If you cannot determine the exact current exchange rate, provide a reasonable estimate based on recent market trends and clearly state this in your response.

**EXAMPLE**:
Input: "USD to SAR"
Output: {"rate": 3.75, "fromCurrency": "USD", "toCurrency": "SAR", "lastUpdated": "2024-01-15"}`,SMART_SEARCH_ASSISTANT:`You are an intelligent and engaging shopping and search assistant. You provide location-aware recommendations based on the user's detected location: ${e}, ${n}.
- You have access to real-time information about local businesses, prices, and offers in the user's area and surrounding regions.
- When asked about product prices or store locations, provide specific, actionable information with enthusiasm tailored to ${e}.
- Include store names, locations, contact information, and current offers available in the user's area.
- For price comparisons, mention multiple stores and their current prices in ${e} and nearby cities.
- Be specific about locations in the user's city and surrounding areas.
- Provide practical shopping advice based on current market conditions in ${n} with a friendly, helpful tone.
- Always respond in Arabic with personality and energy - be engaging, not robotic.
- When discussing restaurants, include ratings, popular dishes, and location details in ${e} with excitement.
- For grocery items, compare prices across major chains available in the user's region.
- Ask follow-up questions to better understand what the user needs and provide more personalized recommendations.
- If the user is in Saudi Arabia, focus on Saudi retailers. If in Jordan, focus on Jordanian retailers, etc.
- Adapt your recommendations to local currency and local business practices.
- Use emojis and enthusiastic language to make responses more engaging and lively.`}},$e=async(t,e,n=!1)=>{if(!rn)throw new Error("لم تتم تهيئة خدمة الذكاء الاصطناعي. يرجى التأكد من صحة إعدادات الاتصال.");try{return(await rn.models.generateContent({model:Eu,contents:e,config:{systemInstruction:t,...n&&{responseMimeType:"application/json"}}})).text}catch(s){console.error("Gemini API Error:",s);let r="عفواً، حدث خطأ أثناء الاتصال بالخادم. يرجى المحاولة مرة أخرى.";throw s instanceof Error&&"message"in s&&s.message.includes("403")&&(r="تم رفض الوصول (403). يرجى التحقق من قيود مفتاح API الخاص بك في Google Cloud Console."),new Error(r)}},Wo=(t,e,n,s)=>{const r=Object.keys(n),l=Object.keys(s);let d=`- **Payment Method Mapping**:
  - The 'paymentMethod' MUST be one of these exact values: [${[...l,...r].map(u=>`'${u}'`).join(", ")}].
`;Object.values(s).forEach(u=>{const m=[u.name.split(" ")[0],...u.smsSamples||[]].filter(Boolean);m.length>0&&(d+=`  - If the text is a bank/mada transaction and contains any of these: '${m.join("', '")}', use '${u.id}'.
`)}),Object.values(n).forEach(u=>{const m=[u.name.split(" ")[0],...u.smsSamples||[]].filter(Boolean);m.length>0&&(d+=`  - If the text is a credit card transaction and contains any of these: '${m.join("', '")}', use '${u.id}'.
`)}),d+="  - If no specific bank account keywords match for a bank/mada transaction, default to the first bank account ID in the list.";const f=qe().PASTE_ANALYZER.replace("{{PAYMENT_METHOD_MAPPING}}",d);return $e(f,`Text to analyze: "${t}"

Available Categories: ${JSON.stringify(e)}

First bank account ID is '${l[0]}'`,!0)},Pn=t=>{const e=qe();return $e(e.ICON_SUGGESTER,`Category: ${t}`)},zo=(t,e,n)=>{const s=qe();return $e(s.BUDGET_PLANNER,`Total monthly budget is: ${t} SAR. My spending categories are: ${JSON.stringify(e)}. My transactions from the last 60 days are: ${JSON.stringify(n)}`)},Ko=async(t,e)=>{const n=qe(),s=`Get current exchange rate from ${t} to ${e}`,r=await $e(n.EXCHANGE_RATE,s,!0);try{const l=JSON.parse(r);return{rate:parseFloat(l.rate),fromCurrency:l.fromCurrency,toCurrency:l.toCurrency,lastUpdated:l.lastUpdated}}catch(l){throw console.error("Error parsing exchange rate:",l),new Error("خطأ في تحليل معدل التحويل. يرجى المحاولة مرة أخرى.")}},Xo=async(t,e,n)=>{const s=qe(n);return $e(s.FINANCIAL_ANALYST,`User Query: "${t}"

Complete Financial Data (All Periods): ${JSON.stringify(e)}`)},Qo=async(t,e)=>{const n=qe(e);return $e(n.SMART_SEARCH_ASSISTANT,`Search Query: "${t}"`)},Zo=async(t,e,n,s)=>{const r=qe(s);return $e(r.FINANCIAL_ANALYST,`Pattern Analysis Query: "${t}"

All Transactions: ${JSON.stringify(e)}

Calculations: ${JSON.stringify(n)}`)},ei=async(t,e,n,s)=>{const r=qe(s),l=e?`User Portfolio: ${JSON.stringify(e)}`:"No portfolio data provided",d=n?`Market Context: ${JSON.stringify(n)}`:"Current market analysis requested";return $e(r.INVESTMENT_COACH,`Investment Query: "${t}"

${l}

${d}`)},wu=Object.freeze(Object.defineProperty({__proto__:null,advancedInvestmentAdvice:ei,analyzeCompleteFinancialData:Xo,analyzeFinancialPatterns:Zo,analyzePastedText:Wo,generateBudgetPlan:zo,getExchangeRate:Ko,initializeAi:Yo,smartSearchAssistant:Qo,suggestCategoryIcon:Pn},Symbol.toStringTag,{value:"Module"})),_u="modulepreload",Au=function(t){return"/fd/"+t},lo={},De=function(e,n,s){let r=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),c=(d==null?void 0:d.nonce)||(d==null?void 0:d.getAttribute("nonce"));r=Promise.allSettled(n.map(f=>{if(f=Au(f),f in lo)return;lo[f]=!0;const u=f.endsWith(".css"),m=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${f}"]${m}`))return;const p=document.createElement("link");if(p.rel=u?"stylesheet":_u,u||(p.as="script"),p.crossOrigin="",p.href=f,c&&p.setAttribute("nonce",c),document.head.appendChild(p),u)return new Promise((h,v)=>{p.addEventListener("load",h),p.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${f}`)))})}))}function l(d){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=d,window.dispatchEvent(c),!c.defaultPrevented)throw d}return r.then(d=>{for(const c of d||[])c.status==="rejected"&&l(c.reason);return e().catch(l)})};let Xt=null,Le=null,Ie=null;const Su=()=>{try{return rt().hasFirebase?(mo().length===0?(Xt=po(Te.firebase),console.log("🔥 تم إنشاء تطبيق Firebase جديد")):(Xt=ho(),console.log("🔥 تم استخدام تطبيق Firebase الموجود")),Le=go(Xt),Ie=Ci(Xt),console.log("🔥 تم تهيئة Firebase بنجاح"),{success:!0}):(console.warn("⚠️ تحذير: مفاتيح Firebase API غير متوفرة. لن يتم تهيئة Firebase."),{success:!1,error:"مفاتيح Firebase غير متوفرة"})}catch(t){return console.error("❌ خطأ في تهيئة Firebase:",t),{success:!1,error:t instanceof Error?t.message:"خطأ غير معروف"}}},Iu=Su(),je={async signUp(t,e,n){if(!Ie)return{success:!1,error:"Firebase غير مهيأ"};try{const{createUserWithEmailAndPassword:s,updateProfile:r}=await De(async()=>{const{createUserWithEmailAndPassword:d,updateProfile:c}=await import("./firebase-B0X-WtUt.js").then(f=>f.j);return{createUserWithEmailAndPassword:d,updateProfile:c}},[]),l=await s(Ie,t,e);return await r(l.user,{displayName:n}),await this.saveData("users",l.user.uid,{email:t,displayName:n,createdAt:new Date().toISOString(),transactions:[],categories:[],cards:{},bankAccounts:{},investments:{currentValue:0},installments:[]}),{success:!0,user:l.user}}catch(s){return console.error("خطأ في التسجيل:",s),{success:!1,error:s instanceof Error?s.message:"خطأ غير معروف"}}},async signIn(t,e){if(!Ie)return{success:!1,error:"Firebase غير مهيأ"};try{const{signInWithEmailAndPassword:n}=await De(async()=>{const{signInWithEmailAndPassword:r}=await import("./firebase-B0X-WtUt.js").then(l=>l.j);return{signInWithEmailAndPassword:r}},[]);return{success:!0,user:(await n(Ie,t,e)).user}}catch(n){return console.error("خطأ في تسجيل الدخول:",n),{success:!1,error:n instanceof Error?n.message:"خطأ غير معروف"}}},async signOut(){if(!Ie)return{success:!1,error:"Firebase غير مهيأ"};try{const{signOut:t}=await De(async()=>{const{signOut:e}=await import("./firebase-B0X-WtUt.js").then(n=>n.j);return{signOut:e}},[]);return await t(Ie),{success:!0}}catch(t){return console.error("خطأ في تسجيل الخروج:",t),{success:!1,error:t instanceof Error?t.message:"خطأ غير معروف"}}},async getCurrentUser(){return Ie?Ie.currentUser:null},async onAuthStateChanged(t){if(!Ie)return t(null),()=>{};try{const{onAuthStateChanged:e}=await De(async()=>{const{onAuthStateChanged:n}=await import("./firebase-B0X-WtUt.js").then(s=>s.j);return{onAuthStateChanged:n}},[]);return e(Ie,n=>{console.log("🔐 تغيير في حالة المصادقة:",n?`مسجل دخول: ${n.email}`:"غير مسجل دخول"),t(n)})}catch(e){return console.error("❌ خطأ في تحميل onAuthStateChanged:",e),t(null),()=>{}}},async saveData(t,e,n){if(!Le)return{success:!1,error:"Firebase غير مهيأ"};try{const{doc:s,setDoc:r}=await De(async()=>{const{doc:d,setDoc:c}=await import("./firebase-B0X-WtUt.js").then(f=>f.h);return{doc:d,setDoc:c}},[]),l=s(Le,t,e);return await r(l,{...n,lastUpdated:new Date().toISOString()}),{success:!0,id:e}}catch(s){return console.error("خطأ في حفظ البيانات:",s),{success:!1,error:s instanceof Error?s.message:"خطأ غير معروف"}}},async getData(t,e){if(!Le)return{success:!1,error:"Firebase غير مهيأ"};try{const{doc:n,getDoc:s}=await De(async()=>{const{doc:d,getDoc:c}=await import("./firebase-B0X-WtUt.js").then(f=>f.h);return{doc:d,getDoc:c}},[]),r=n(Le,t,e),l=await s(r);return l.exists()?{success:!0,data:l.data()}:{success:!1,error:"المستند غير موجود"}}catch(n){return console.error("خطأ في جلب البيانات:",n),n instanceof Error?n.message.includes("permission")?{success:!1,error:"خطأ في الأذونات: تأكد من تسجيل الدخول وإعداد قواعد Firestore"}:n.message.includes("network")?{success:!1,error:"خطأ في الشبكة: تحقق من الاتصال بالإنترنت"}:{success:!1,error:n.message}:{success:!1,error:"خطأ غير معروف"}}},async getAllDocuments(t){if(!Le)return{success:!1,error:"Firebase غير مهيأ"};try{const{collection:e,getDocs:n}=await De(async()=>{const{collection:l,getDocs:d}=await import("./firebase-B0X-WtUt.js").then(c=>c.h);return{collection:l,getDocs:d}},[]),s=await n(e(Le,t)),r=[];return s.forEach(l=>{r.push({id:l.id,...l.data()})}),{success:!0,data:r}}catch(e){return console.error("خطأ في جلب المستندات:",e),{success:!1,error:e instanceof Error?e.message:"خطأ غير معروف"}}},async deleteDocument(t,e){if(!Le)return{success:!1,error:"Firebase غير مهيأ"};try{const{doc:n,deleteDoc:s}=await De(async()=>{const{doc:l,deleteDoc:d}=await import("./firebase-B0X-WtUt.js").then(c=>c.h);return{doc:l,deleteDoc:d}},[]),r=n(Le,t,e);return await s(r),{success:!0}}catch(n){return console.error("خطأ في حذف المستند:",n),{success:!1,error:n instanceof Error?n.message:"خطأ غير معروف"}}},async syncLocalDataToFirebase(t,e){try{return await this.saveData("users",t,{financialData:e,syncTimestamp:new Date().toISOString()})}catch(n){return console.error("خطأ في مزامنة البيانات:",n),{success:!1,error:n instanceof Error?n.message:"خطأ غير معروف"}}},async getDataFromFirebase(t){var e;try{const n=await this.getData("users",t);return n.success&&((e=n.data)!=null&&e.financialData)?{success:!0,data:n.data.financialData}:{success:!1,error:"لا توجد بيانات محفوظة"}}catch(n){return console.error("خطأ في جلب البيانات من Firebase:",n),{success:!1,error:n instanceof Error?n.message:"خطأ غير معروف"}}}},Ru=()=>Iu;function Qt(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var ti={exports:{}};/*!
    localForage -- Offline Storage, Improved
    Version 1.10.0
    https://localforage.github.io/localForage
    (c) 2013-2017 Mozilla, Apache License 2.0
*/(function(t,e){(function(n){t.exports=n()})(function(){return function n(s,r,l){function d(u,m){if(!r[u]){if(!s[u]){var p=typeof Qt=="function"&&Qt;if(!m&&p)return p(u,!0);if(c)return c(u,!0);var h=new Error("Cannot find module '"+u+"'");throw h.code="MODULE_NOT_FOUND",h}var v=r[u]={exports:{}};s[u][0].call(v.exports,function(E){var A=s[u][1][E];return d(A||E)},v,v.exports,n,s,r,l)}return r[u].exports}for(var c=typeof Qt=="function"&&Qt,f=0;f<l.length;f++)d(l[f]);return d}({1:[function(n,s,r){(function(l){var d=l.MutationObserver||l.WebKitMutationObserver,c;if(d){var f=0,u=new d(E),m=l.document.createTextNode("");u.observe(m,{characterData:!0}),c=function(){m.data=f=++f%2}}else if(!l.setImmediate&&typeof l.MessageChannel<"u"){var p=new l.MessageChannel;p.port1.onmessage=E,c=function(){p.port2.postMessage(0)}}else"document"in l&&"onreadystatechange"in l.document.createElement("script")?c=function(){var I=l.document.createElement("script");I.onreadystatechange=function(){E(),I.onreadystatechange=null,I.parentNode.removeChild(I),I=null},l.document.documentElement.appendChild(I)}:c=function(){setTimeout(E,0)};var h,v=[];function E(){h=!0;for(var I,R,k=v.length;k;){for(R=v,v=[],I=-1;++I<k;)R[I]();k=v.length}h=!1}s.exports=A;function A(I){v.push(I)===1&&!h&&c()}}).call(this,typeof zt<"u"?zt:typeof self<"u"?self:typeof window<"u"?window:{})},{}],2:[function(n,s,r){var l=n(1);function d(){}var c={},f=["REJECTED"],u=["FULFILLED"],m=["PENDING"];s.exports=p;function p(T){if(typeof T!="function")throw new TypeError("resolver must be a function");this.state=m,this.queue=[],this.outcome=void 0,T!==d&&A(this,T)}p.prototype.catch=function(T){return this.then(null,T)},p.prototype.then=function(T,M){if(typeof T!="function"&&this.state===u||typeof M!="function"&&this.state===f)return this;var F=new this.constructor(d);if(this.state!==m){var j=this.state===u?T:M;v(F,j,this.outcome)}else this.queue.push(new h(F,T,M));return F};function h(T,M,F){this.promise=T,typeof M=="function"&&(this.onFulfilled=M,this.callFulfilled=this.otherCallFulfilled),typeof F=="function"&&(this.onRejected=F,this.callRejected=this.otherCallRejected)}h.prototype.callFulfilled=function(T){c.resolve(this.promise,T)},h.prototype.otherCallFulfilled=function(T){v(this.promise,this.onFulfilled,T)},h.prototype.callRejected=function(T){c.reject(this.promise,T)},h.prototype.otherCallRejected=function(T){v(this.promise,this.onRejected,T)};function v(T,M,F){l(function(){var j;try{j=M(F)}catch(L){return c.reject(T,L)}j===T?c.reject(T,new TypeError("Cannot resolve promise with itself")):c.resolve(T,j)})}c.resolve=function(T,M){var F=I(E,M);if(F.status==="error")return c.reject(T,F.value);var j=F.value;if(j)A(T,j);else{T.state=u,T.outcome=M;for(var L=-1,x=T.queue.length;++L<x;)T.queue[L].callFulfilled(M)}return T},c.reject=function(T,M){T.state=f,T.outcome=M;for(var F=-1,j=T.queue.length;++F<j;)T.queue[F].callRejected(M);return T};function E(T){var M=T&&T.then;if(T&&(typeof T=="object"||typeof T=="function")&&typeof M=="function")return function(){M.apply(T,arguments)}}function A(T,M){var F=!1;function j(B){F||(F=!0,c.reject(T,B))}function L(B){F||(F=!0,c.resolve(T,B))}function x(){M(L,j)}var D=I(x);D.status==="error"&&j(D.value)}function I(T,M){var F={};try{F.value=T(M),F.status="success"}catch(j){F.status="error",F.value=j}return F}p.resolve=R;function R(T){return T instanceof this?T:c.resolve(new this(d),T)}p.reject=k;function k(T){var M=new this(d);return c.reject(M,T)}p.all=P;function P(T){var M=this;if(Object.prototype.toString.call(T)!=="[object Array]")return this.reject(new TypeError("must be an array"));var F=T.length,j=!1;if(!F)return this.resolve([]);for(var L=new Array(F),x=0,D=-1,B=new this(d);++D<F;)ne(T[D],D);return B;function ne(me,ie){M.resolve(me).then(le,function(Y){j||(j=!0,c.reject(B,Y))});function le(Y){L[ie]=Y,++x===F&&!j&&(j=!0,c.resolve(B,L))}}}p.race=N;function N(T){var M=this;if(Object.prototype.toString.call(T)!=="[object Array]")return this.reject(new TypeError("must be an array"));var F=T.length,j=!1;if(!F)return this.resolve([]);for(var L=-1,x=new this(d);++L<F;)D(T[L]);return x;function D(B){M.resolve(B).then(function(ne){j||(j=!0,c.resolve(x,ne))},function(ne){j||(j=!0,c.reject(x,ne))})}}},{1:1}],3:[function(n,s,r){(function(l){typeof l.Promise!="function"&&(l.Promise=n(2))}).call(this,typeof zt<"u"?zt:typeof self<"u"?self:typeof window<"u"?window:{})},{2:2}],4:[function(n,s,r){var l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(g){return typeof g}:function(g){return g&&typeof Symbol=="function"&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":typeof g};function d(g,b){if(!(g instanceof b))throw new TypeError("Cannot call a class as a function")}function c(){try{if(typeof indexedDB<"u")return indexedDB;if(typeof webkitIndexedDB<"u")return webkitIndexedDB;if(typeof mozIndexedDB<"u")return mozIndexedDB;if(typeof OIndexedDB<"u")return OIndexedDB;if(typeof msIndexedDB<"u")return msIndexedDB}catch{return}}var f=c();function u(){try{if(!f||!f.open)return!1;var g=typeof openDatabase<"u"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),b=typeof fetch=="function"&&fetch.toString().indexOf("[native code")!==-1;return(!g||b)&&typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}}function m(g,b){g=g||[],b=b||{};try{return new Blob(g,b)}catch(w){if(w.name!=="TypeError")throw w;for(var y=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,_=new y,S=0;S<g.length;S+=1)_.append(g[S]);return _.getBlob(b.type)}}typeof Promise>"u"&&n(3);var p=Promise;function h(g,b){b&&g.then(function(y){b(null,y)},function(y){b(y)})}function v(g,b,y){typeof b=="function"&&g.then(b),typeof y=="function"&&g.catch(y)}function E(g){return typeof g!="string"&&(console.warn(g+" used as a key, but it is not a string."),g=String(g)),g}function A(){if(arguments.length&&typeof arguments[arguments.length-1]=="function")return arguments[arguments.length-1]}var I="local-forage-detect-blob-support",R=void 0,k={},P=Object.prototype.toString,N="readonly",T="readwrite";function M(g){for(var b=g.length,y=new ArrayBuffer(b),_=new Uint8Array(y),S=0;S<b;S++)_[S]=g.charCodeAt(S);return y}function F(g){return new p(function(b){var y=g.transaction(I,T),_=m([""]);y.objectStore(I).put(_,"key"),y.onabort=function(S){S.preventDefault(),S.stopPropagation(),b(!1)},y.oncomplete=function(){var S=navigator.userAgent.match(/Chrome\/(\d+)/),w=navigator.userAgent.match(/Edge\//);b(w||!S||parseInt(S[1],10)>=43)}}).catch(function(){return!1})}function j(g){return typeof R=="boolean"?p.resolve(R):F(g).then(function(b){return R=b,R})}function L(g){var b=k[g.name],y={};y.promise=new p(function(_,S){y.resolve=_,y.reject=S}),b.deferredOperations.push(y),b.dbReady?b.dbReady=b.dbReady.then(function(){return y.promise}):b.dbReady=y.promise}function x(g){var b=k[g.name],y=b.deferredOperations.pop();if(y)return y.resolve(),y.promise}function D(g,b){var y=k[g.name],_=y.deferredOperations.pop();if(_)return _.reject(b),_.promise}function B(g,b){return new p(function(y,_){if(k[g.name]=k[g.name]||Ue(),g.db)if(b)L(g),g.db.close();else return y(g.db);var S=[g.name];b&&S.push(g.version);var w=f.open.apply(f,S);b&&(w.onupgradeneeded=function(U){var G=w.result;try{G.createObjectStore(g.storeName),U.oldVersion<=1&&G.createObjectStore(I)}catch(J){if(J.name==="ConstraintError")console.warn('The database "'+g.name+'" has been upgraded from version '+U.oldVersion+" to version "+U.newVersion+', but the storage "'+g.storeName+'" already exists.');else throw J}}),w.onerror=function(U){U.preventDefault(),_(w.error)},w.onsuccess=function(){var U=w.result;U.onversionchange=function(G){G.target.close()},y(U),x(g)}})}function ne(g){return B(g,!1)}function me(g){return B(g,!0)}function ie(g,b){if(!g.db)return!0;var y=!g.db.objectStoreNames.contains(g.storeName),_=g.version<g.db.version,S=g.version>g.db.version;if(_&&(g.version!==b&&console.warn('The database "'+g.name+`" can't be downgraded from version `+g.db.version+" to version "+g.version+"."),g.version=g.db.version),S||y){if(y){var w=g.db.version+1;w>g.version&&(g.version=w)}return!0}return!1}function le(g){return new p(function(b,y){var _=new FileReader;_.onerror=y,_.onloadend=function(S){var w=btoa(S.target.result||"");b({__local_forage_encoded_blob:!0,data:w,type:g.type})},_.readAsBinaryString(g)})}function Y(g){var b=M(atob(g.data));return m([b],{type:g.type})}function re(g){return g&&g.__local_forage_encoded_blob}function xe(g){var b=this,y=b._initReady().then(function(){var _=k[b._dbInfo.name];if(_&&_.dbReady)return _.dbReady});return v(y,g,g),y}function he(g){L(g);for(var b=k[g.name],y=b.forages,_=0;_<y.length;_++){var S=y[_];S._dbInfo.db&&(S._dbInfo.db.close(),S._dbInfo.db=null)}return g.db=null,ne(g).then(function(w){return g.db=w,ie(g)?me(g):w}).then(function(w){g.db=b.db=w;for(var U=0;U<y.length;U++)y[U]._dbInfo.db=w}).catch(function(w){throw D(g,w),w})}function Ce(g,b,y,_){_===void 0&&(_=1);try{var S=g.db.transaction(g.storeName,b);y(null,S)}catch(w){if(_>0&&(!g.db||w.name==="InvalidStateError"||w.name==="NotFoundError"))return p.resolve().then(function(){if(!g.db||w.name==="NotFoundError"&&!g.db.objectStoreNames.contains(g.storeName)&&g.version<=g.db.version)return g.db&&(g.version=g.db.version+1),me(g)}).then(function(){return he(g).then(function(){Ce(g,b,y,_-1)})}).catch(y);y(w)}}function Ue(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function Ge(g){var b=this,y={db:null};if(g)for(var _ in g)y[_]=g[_];var S=k[y.name];S||(S=Ue(),k[y.name]=S),S.forages.push(b),b._initReady||(b._initReady=b.ready,b.ready=xe);var w=[];function U(){return p.resolve()}for(var G=0;G<S.forages.length;G++){var J=S.forages[G];J!==b&&w.push(J._initReady().catch(U))}var O=S.forages.slice(0);return p.all(w).then(function(){return y.db=S.db,ne(y)}).then(function(W){return y.db=W,ie(y,b._defaultConfig.version)?me(y):W}).then(function(W){y.db=S.db=W,b._dbInfo=y;for(var ee=0;ee<O.length;ee++){var oe=O[ee];oe!==b&&(oe._dbInfo.db=y.db,oe._dbInfo.version=y.version)}})}function ze(g,b){var y=this;g=E(g);var _=new p(function(S,w){y.ready().then(function(){Ce(y._dbInfo,N,function(U,G){if(U)return w(U);try{var J=G.objectStore(y._dbInfo.storeName),O=J.get(g);O.onsuccess=function(){var W=O.result;W===void 0&&(W=null),re(W)&&(W=Y(W)),S(W)},O.onerror=function(){w(O.error)}}catch(W){w(W)}})}).catch(w)});return h(_,b),_}function Ke(g,b){var y=this,_=new p(function(S,w){y.ready().then(function(){Ce(y._dbInfo,N,function(U,G){if(U)return w(U);try{var J=G.objectStore(y._dbInfo.storeName),O=J.openCursor(),W=1;O.onsuccess=function(){var ee=O.result;if(ee){var oe=ee.value;re(oe)&&(oe=Y(oe));var ue=g(oe,ee.key,W++);ue!==void 0?S(ue):ee.continue()}else S()},O.onerror=function(){w(O.error)}}catch(ee){w(ee)}})}).catch(w)});return h(_,b),_}function Xe(g,b,y){var _=this;g=E(g);var S=new p(function(w,U){var G;_.ready().then(function(){return G=_._dbInfo,P.call(b)==="[object Blob]"?j(G.db).then(function(J){return J?b:le(b)}):b}).then(function(J){Ce(_._dbInfo,T,function(O,W){if(O)return U(O);try{var ee=W.objectStore(_._dbInfo.storeName);J===null&&(J=void 0);var oe=ee.put(J,g);W.oncomplete=function(){J===void 0&&(J=null),w(J)},W.onabort=W.onerror=function(){var ue=oe.error?oe.error:oe.transaction.error;U(ue)}}catch(ue){U(ue)}})}).catch(U)});return h(S,y),S}function Se(g,b){var y=this;g=E(g);var _=new p(function(S,w){y.ready().then(function(){Ce(y._dbInfo,T,function(U,G){if(U)return w(U);try{var J=G.objectStore(y._dbInfo.storeName),O=J.delete(g);G.oncomplete=function(){S()},G.onerror=function(){w(O.error)},G.onabort=function(){var W=O.error?O.error:O.transaction.error;w(W)}}catch(W){w(W)}})}).catch(w)});return h(_,b),_}function K(g){var b=this,y=new p(function(_,S){b.ready().then(function(){Ce(b._dbInfo,T,function(w,U){if(w)return S(w);try{var G=U.objectStore(b._dbInfo.storeName),J=G.clear();U.oncomplete=function(){_()},U.onabort=U.onerror=function(){var O=J.error?J.error:J.transaction.error;S(O)}}catch(O){S(O)}})}).catch(S)});return h(y,g),y}function te(g){var b=this,y=new p(function(_,S){b.ready().then(function(){Ce(b._dbInfo,N,function(w,U){if(w)return S(w);try{var G=U.objectStore(b._dbInfo.storeName),J=G.count();J.onsuccess=function(){_(J.result)},J.onerror=function(){S(J.error)}}catch(O){S(O)}})}).catch(S)});return h(y,g),y}function pe(g,b){var y=this,_=new p(function(S,w){if(g<0){S(null);return}y.ready().then(function(){Ce(y._dbInfo,N,function(U,G){if(U)return w(U);try{var J=G.objectStore(y._dbInfo.storeName),O=!1,W=J.openKeyCursor();W.onsuccess=function(){var ee=W.result;if(!ee){S(null);return}g===0||O?S(ee.key):(O=!0,ee.advance(g))},W.onerror=function(){w(W.error)}}catch(ee){w(ee)}})}).catch(w)});return h(_,b),_}function He(g){var b=this,y=new p(function(_,S){b.ready().then(function(){Ce(b._dbInfo,N,function(w,U){if(w)return S(w);try{var G=U.objectStore(b._dbInfo.storeName),J=G.openKeyCursor(),O=[];J.onsuccess=function(){var W=J.result;if(!W){_(O);return}O.push(W.key),W.continue()},J.onerror=function(){S(J.error)}}catch(W){S(W)}})}).catch(S)});return h(y,g),y}function Je(g,b){b=A.apply(this,arguments);var y=this.config();g=typeof g!="function"&&g||{},g.name||(g.name=g.name||y.name,g.storeName=g.storeName||y.storeName);var _=this,S;if(!g.name)S=p.reject("Invalid arguments");else{var w=g.name===y.name&&_._dbInfo.db,U=w?p.resolve(_._dbInfo.db):ne(g).then(function(G){var J=k[g.name],O=J.forages;J.db=G;for(var W=0;W<O.length;W++)O[W]._dbInfo.db=G;return G});g.storeName?S=U.then(function(G){if(G.objectStoreNames.contains(g.storeName)){var J=G.version+1;L(g);var O=k[g.name],W=O.forages;G.close();for(var ee=0;ee<W.length;ee++){var oe=W[ee];oe._dbInfo.db=null,oe._dbInfo.version=J}var ue=new p(function(fe,Ne){var be=f.open(g.name,J);be.onerror=function(_e){var Nt=be.result;Nt.close(),Ne(_e)},be.onupgradeneeded=function(){var _e=be.result;_e.deleteObjectStore(g.storeName)},be.onsuccess=function(){var _e=be.result;_e.close(),fe(_e)}});return ue.then(function(fe){O.db=fe;for(var Ne=0;Ne<W.length;Ne++){var be=W[Ne];be._dbInfo.db=fe,x(be._dbInfo)}}).catch(function(fe){throw(D(g,fe)||p.resolve()).catch(function(){}),fe})}}):S=U.then(function(G){L(g);var J=k[g.name],O=J.forages;G.close();for(var W=0;W<O.length;W++){var ee=O[W];ee._dbInfo.db=null}var oe=new p(function(ue,fe){var Ne=f.deleteDatabase(g.name);Ne.onerror=function(){var be=Ne.result;be&&be.close(),fe(Ne.error)},Ne.onblocked=function(){console.warn('dropInstance blocked for database "'+g.name+'" until all open connections are closed')},Ne.onsuccess=function(){var be=Ne.result;be&&be.close(),ue(be)}});return oe.then(function(ue){J.db=ue;for(var fe=0;fe<O.length;fe++){var Ne=O[fe];x(Ne._dbInfo)}}).catch(function(ue){throw(D(g,ue)||p.resolve()).catch(function(){}),ue})})}return h(S,b),S}var ut={_driver:"asyncStorage",_initStorage:Ge,_support:u(),iterate:Ke,getItem:ze,setItem:Xe,removeItem:Se,clear:K,length:te,key:pe,keys:He,dropInstance:Je};function It(){return typeof openDatabase=="function"}var Pe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fn="~~local_forage_type~",Rt=/^~~local_forage_type~([^~]+)~/,Qe="__lfsc__:",ft=Qe.length,mt="arbf",pt="blob",Pt="si08",Mt="ui08",kt="uic8",Dt="si16",Lt="si32",Ft="ur16",Ut="ui32",jt="fl32",Vt="fl64",Bt=ft+mt.length,qt=Object.prototype.toString;function ht(g){var b=g.length*.75,y=g.length,_,S=0,w,U,G,J;g[g.length-1]==="="&&(b--,g[g.length-2]==="="&&b--);var O=new ArrayBuffer(b),W=new Uint8Array(O);for(_=0;_<y;_+=4)w=Pe.indexOf(g[_]),U=Pe.indexOf(g[_+1]),G=Pe.indexOf(g[_+2]),J=Pe.indexOf(g[_+3]),W[S++]=w<<2|U>>4,W[S++]=(U&15)<<4|G>>2,W[S++]=(G&3)<<6|J&63;return O}function gt(g){var b=new Uint8Array(g),y="",_;for(_=0;_<b.length;_+=3)y+=Pe[b[_]>>2],y+=Pe[(b[_]&3)<<4|b[_+1]>>4],y+=Pe[(b[_+1]&15)<<2|b[_+2]>>6],y+=Pe[b[_+2]&63];return b.length%3===2?y=y.substring(0,y.length-1)+"=":b.length%3===1&&(y=y.substring(0,y.length-2)+"=="),y}function $t(g,b){var y="";if(g&&(y=qt.call(g)),g&&(y==="[object ArrayBuffer]"||g.buffer&&qt.call(g.buffer)==="[object ArrayBuffer]")){var _,S=Qe;g instanceof ArrayBuffer?(_=g,S+=mt):(_=g.buffer,y==="[object Int8Array]"?S+=Pt:y==="[object Uint8Array]"?S+=Mt:y==="[object Uint8ClampedArray]"?S+=kt:y==="[object Int16Array]"?S+=Dt:y==="[object Uint16Array]"?S+=Ft:y==="[object Int32Array]"?S+=Lt:y==="[object Uint32Array]"?S+=Ut:y==="[object Float32Array]"?S+=jt:y==="[object Float64Array]"?S+=Vt:b(new Error("Failed to get type for BinaryArray"))),b(S+gt(_))}else if(y==="[object Blob]"){var w=new FileReader;w.onload=function(){var U=fn+g.type+"~"+gt(this.result);b(Qe+pt+U)},w.readAsArrayBuffer(g)}else try{b(JSON.stringify(g))}catch(U){console.error("Couldn't convert value into a JSON string: ",g),b(null,U)}}function Gt(g){if(g.substring(0,ft)!==Qe)return JSON.parse(g);var b=g.substring(Bt),y=g.substring(ft,Bt),_;if(y===pt&&Rt.test(b)){var S=b.match(Rt);_=S[1],b=b.substring(S[0].length)}var w=ht(b);switch(y){case mt:return w;case pt:return m([w],{type:_});case Pt:return new Int8Array(w);case Mt:return new Uint8Array(w);case kt:return new Uint8ClampedArray(w);case Dt:return new Int16Array(w);case Ft:return new Uint16Array(w);case Lt:return new Int32Array(w);case Ut:return new Uint32Array(w);case jt:return new Float32Array(w);case Vt:return new Float64Array(w);default:throw new Error("Unkown type: "+y)}}var Ze={serialize:$t,deserialize:Gt,stringToBuffer:ht,bufferToString:gt};function xt(g,b,y,_){g.executeSql("CREATE TABLE IF NOT EXISTS "+b.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],y,_)}function Ht(g){var b=this,y={db:null};if(g)for(var _ in g)y[_]=typeof g[_]!="string"?g[_].toString():g[_];var S=new p(function(w,U){try{y.db=openDatabase(y.name,String(y.version),y.description,y.size)}catch(G){return U(G)}y.db.transaction(function(G){xt(G,y,function(){b._dbInfo=y,w()},function(J,O){U(O)})},U)});return y.serializer=Ze,S}function C(g,b,y,_,S,w){g.executeSql(y,_,S,function(U,G){G.code===G.SYNTAX_ERR?U.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[b.storeName],function(J,O){O.rows.length?w(J,G):xt(J,b,function(){J.executeSql(y,_,S,w)},w)},w):w(U,G)},w)}function $(g,b){var y=this;g=E(g);var _=new p(function(S,w){y.ready().then(function(){var U=y._dbInfo;U.db.transaction(function(G){C(G,U,"SELECT * FROM "+U.storeName+" WHERE key = ? LIMIT 1",[g],function(J,O){var W=O.rows.length?O.rows.item(0).value:null;W&&(W=U.serializer.deserialize(W)),S(W)},function(J,O){w(O)})})}).catch(w)});return h(_,b),_}function H(g,b){var y=this,_=new p(function(S,w){y.ready().then(function(){var U=y._dbInfo;U.db.transaction(function(G){C(G,U,"SELECT * FROM "+U.storeName,[],function(J,O){for(var W=O.rows,ee=W.length,oe=0;oe<ee;oe++){var ue=W.item(oe),fe=ue.value;if(fe&&(fe=U.serializer.deserialize(fe)),fe=g(fe,ue.key,oe+1),fe!==void 0){S(fe);return}}S()},function(J,O){w(O)})})}).catch(w)});return h(_,b),_}function z(g,b,y,_){var S=this;g=E(g);var w=new p(function(U,G){S.ready().then(function(){b===void 0&&(b=null);var J=b,O=S._dbInfo;O.serializer.serialize(b,function(W,ee){ee?G(ee):O.db.transaction(function(oe){C(oe,O,"INSERT OR REPLACE INTO "+O.storeName+" (key, value) VALUES (?, ?)",[g,W],function(){U(J)},function(ue,fe){G(fe)})},function(oe){if(oe.code===oe.QUOTA_ERR){if(_>0){U(z.apply(S,[g,J,y,_-1]));return}G(oe)}})})}).catch(G)});return h(w,y),w}function Z(g,b,y){return z.apply(this,[g,b,y,1])}function ae(g,b){var y=this;g=E(g);var _=new p(function(S,w){y.ready().then(function(){var U=y._dbInfo;U.db.transaction(function(G){C(G,U,"DELETE FROM "+U.storeName+" WHERE key = ?",[g],function(){S()},function(J,O){w(O)})})}).catch(w)});return h(_,b),_}function ke(g){var b=this,y=new p(function(_,S){b.ready().then(function(){var w=b._dbInfo;w.db.transaction(function(U){C(U,w,"DELETE FROM "+w.storeName,[],function(){_()},function(G,J){S(J)})})}).catch(S)});return h(y,g),y}function Oe(g){var b=this,y=new p(function(_,S){b.ready().then(function(){var w=b._dbInfo;w.db.transaction(function(U){C(U,w,"SELECT COUNT(key) as c FROM "+w.storeName,[],function(G,J){var O=J.rows.item(0).c;_(O)},function(G,J){S(J)})})}).catch(S)});return h(y,g),y}function yt(g,b){var y=this,_=new p(function(S,w){y.ready().then(function(){var U=y._dbInfo;U.db.transaction(function(G){C(G,U,"SELECT key FROM "+U.storeName+" WHERE id = ? LIMIT 1",[g+1],function(J,O){var W=O.rows.length?O.rows.item(0).key:null;S(W)},function(J,O){w(O)})})}).catch(w)});return h(_,b),_}function vt(g){var b=this,y=new p(function(_,S){b.ready().then(function(){var w=b._dbInfo;w.db.transaction(function(U){C(U,w,"SELECT key FROM "+w.storeName,[],function(G,J){for(var O=[],W=0;W<J.rows.length;W++)O.push(J.rows.item(W).key);_(O)},function(G,J){S(J)})})}).catch(S)});return h(y,g),y}function bt(g){return new p(function(b,y){g.transaction(function(_){_.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(S,w){for(var U=[],G=0;G<w.rows.length;G++)U.push(w.rows.item(G).name);b({db:g,storeNames:U})},function(S,w){y(w)})},function(_){y(_)})})}function et(g,b){b=A.apply(this,arguments);var y=this.config();g=typeof g!="function"&&g||{},g.name||(g.name=g.name||y.name,g.storeName=g.storeName||y.storeName);var _=this,S;return g.name?S=new p(function(w){var U;g.name===y.name?U=_._dbInfo.db:U=openDatabase(g.name,"","",0),g.storeName?w({db:U,storeNames:[g.storeName]}):w(bt(U))}).then(function(w){return new p(function(U,G){w.db.transaction(function(J){function O(ue){return new p(function(fe,Ne){J.executeSql("DROP TABLE IF EXISTS "+ue,[],function(){fe()},function(be,_e){Ne(_e)})})}for(var W=[],ee=0,oe=w.storeNames.length;ee<oe;ee++)W.push(O(w.storeNames[ee]));p.all(W).then(function(){U()}).catch(function(ue){G(ue)})},function(J){G(J)})})}):S=p.reject("Invalid arguments"),h(S,b),S}var X={_driver:"webSQLStorage",_initStorage:Ht,_support:It(),iterate:H,getItem:$,setItem:Z,removeItem:ae,clear:ke,length:Oe,key:yt,keys:vt,dropInstance:et};function ye(){try{return typeof localStorage<"u"&&"setItem"in localStorage&&!!localStorage.setItem}catch{return!1}}function we(g,b){var y=g.name+"/";return g.storeName!==b.storeName&&(y+=g.storeName+"/"),y}function ve(){var g="_localforage_support_test";try{return localStorage.setItem(g,!0),localStorage.removeItem(g),!1}catch{return!0}}function Me(){return!ve()||localStorage.length>0}function ce(g){var b=this,y={};if(g)for(var _ in g)y[_]=g[_];return y.keyPrefix=we(g,b._defaultConfig),Me()?(b._dbInfo=y,y.serializer=Ze,p.resolve()):p.reject()}function Jt(g){var b=this,y=b.ready().then(function(){for(var _=b._dbInfo.keyPrefix,S=localStorage.length-1;S>=0;S--){var w=localStorage.key(S);w.indexOf(_)===0&&localStorage.removeItem(w)}});return h(y,g),y}function Ot(g,b){var y=this;g=E(g);var _=y.ready().then(function(){var S=y._dbInfo,w=localStorage.getItem(S.keyPrefix+g);return w&&(w=S.serializer.deserialize(w)),w});return h(_,b),_}function Yt(g,b){var y=this,_=y.ready().then(function(){for(var S=y._dbInfo,w=S.keyPrefix,U=w.length,G=localStorage.length,J=1,O=0;O<G;O++){var W=localStorage.key(O);if(W.indexOf(w)===0){var ee=localStorage.getItem(W);if(ee&&(ee=S.serializer.deserialize(ee)),ee=g(ee,W.substring(U),J++),ee!==void 0)return ee}}});return h(_,b),_}function oi(g,b){var y=this,_=y.ready().then(function(){var S=y._dbInfo,w;try{w=localStorage.key(g)}catch{w=null}return w&&(w=w.substring(S.keyPrefix.length)),w});return h(_,b),_}function ii(g){var b=this,y=b.ready().then(function(){for(var _=b._dbInfo,S=localStorage.length,w=[],U=0;U<S;U++){var G=localStorage.key(U);G.indexOf(_.keyPrefix)===0&&w.push(G.substring(_.keyPrefix.length))}return w});return h(y,g),y}function ri(g){var b=this,y=b.keys().then(function(_){return _.length});return h(y,g),y}function ai(g,b){var y=this;g=E(g);var _=y.ready().then(function(){var S=y._dbInfo;localStorage.removeItem(S.keyPrefix+g)});return h(_,b),_}function li(g,b,y){var _=this;g=E(g);var S=_.ready().then(function(){b===void 0&&(b=null);var w=b;return new p(function(U,G){var J=_._dbInfo;J.serializer.serialize(b,function(O,W){if(W)G(W);else try{localStorage.setItem(J.keyPrefix+g,O),U(w)}catch(ee){(ee.name==="QuotaExceededError"||ee.name==="NS_ERROR_DOM_QUOTA_REACHED")&&G(ee),G(ee)}})})});return h(S,y),S}function di(g,b){if(b=A.apply(this,arguments),g=typeof g!="function"&&g||{},!g.name){var y=this.config();g.name=g.name||y.name,g.storeName=g.storeName||y.storeName}var _=this,S;return g.name?S=new p(function(w){g.storeName?w(we(g,_._defaultConfig)):w(g.name+"/")}).then(function(w){for(var U=localStorage.length-1;U>=0;U--){var G=localStorage.key(U);G.indexOf(w)===0&&localStorage.removeItem(G)}}):S=p.reject("Invalid arguments"),h(S,b),S}var ci={_driver:"localStorageWrapper",_initStorage:ce,_support:ye(),iterate:Yt,getItem:Ot,setItem:li,removeItem:ai,clear:Jt,length:ri,key:oi,keys:ii,dropInstance:di},ui=function(b,y){return b===y||typeof b=="number"&&typeof y=="number"&&isNaN(b)&&isNaN(y)},fi=function(b,y){for(var _=b.length,S=0;S<_;){if(ui(b[S],y))return!0;S++}return!1},qn=Array.isArray||function(g){return Object.prototype.toString.call(g)==="[object Array]"},Tt={},$n={},tt={INDEXEDDB:ut,WEBSQL:X,LOCALSTORAGE:ci},mi=[tt.INDEXEDDB._driver,tt.WEBSQL._driver,tt.LOCALSTORAGE._driver],Wt=["dropInstance"],mn=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(Wt),pi={description:"",driver:mi.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function hi(g,b){g[b]=function(){var y=arguments;return g.ready().then(function(){return g[b].apply(g,y)})}}function pn(){for(var g=1;g<arguments.length;g++){var b=arguments[g];if(b)for(var y in b)b.hasOwnProperty(y)&&(qn(b[y])?arguments[0][y]=b[y].slice():arguments[0][y]=b[y])}return arguments[0]}var gi=function(){function g(b){d(this,g);for(var y in tt)if(tt.hasOwnProperty(y)){var _=tt[y],S=_._driver;this[y]=S,Tt[S]||this.defineDriver(_)}this._defaultConfig=pn({},pi),this._config=pn({},this._defaultConfig,b),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return g.prototype.config=function(y){if((typeof y>"u"?"undefined":l(y))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var _ in y){if(_==="storeName"&&(y[_]=y[_].replace(/\W/g,"_")),_==="version"&&typeof y[_]!="number")return new Error("Database version must be a number.");this._config[_]=y[_]}return"driver"in y&&y.driver?this.setDriver(this._config.driver):!0}else return typeof y=="string"?this._config[y]:this._config},g.prototype.defineDriver=function(y,_,S){var w=new p(function(U,G){try{var J=y._driver,O=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!y._driver){G(O);return}for(var W=mn.concat("_initStorage"),ee=0,oe=W.length;ee<oe;ee++){var ue=W[ee],fe=!fi(Wt,ue);if((fe||y[ue])&&typeof y[ue]!="function"){G(O);return}}var Ne=function(){for(var Nt=function(vi){return function(){var bi=new Error("Method "+vi+" is not implemented by the current driver"),Gn=p.reject(bi);return h(Gn,arguments[arguments.length-1]),Gn}},hn=0,yi=Wt.length;hn<yi;hn++){var gn=Wt[hn];y[gn]||(y[gn]=Nt(gn))}};Ne();var be=function(Nt){Tt[J]&&console.info("Redefining LocalForage driver: "+J),Tt[J]=y,$n[J]=Nt,U()};"_support"in y?y._support&&typeof y._support=="function"?y._support().then(be,G):be(!!y._support):be(!0)}catch(_e){G(_e)}});return v(w,_,S),w},g.prototype.driver=function(){return this._driver||null},g.prototype.getDriver=function(y,_,S){var w=Tt[y]?p.resolve(Tt[y]):p.reject(new Error("Driver not found."));return v(w,_,S),w},g.prototype.getSerializer=function(y){var _=p.resolve(Ze);return v(_,y),_},g.prototype.ready=function(y){var _=this,S=_._driverSet.then(function(){return _._ready===null&&(_._ready=_._initDriver()),_._ready});return v(S,y,y),S},g.prototype.setDriver=function(y,_,S){var w=this;qn(y)||(y=[y]);var U=this._getSupportedDrivers(y);function G(){w._config.driver=w.driver()}function J(ee){return w._extend(ee),G(),w._ready=w._initStorage(w._config),w._ready}function O(ee){return function(){var oe=0;function ue(){for(;oe<ee.length;){var fe=ee[oe];return oe++,w._dbInfo=null,w._ready=null,w.getDriver(fe).then(J).catch(ue)}G();var Ne=new Error("No available storage method found.");return w._driverSet=p.reject(Ne),w._driverSet}return ue()}}var W=this._driverSet!==null?this._driverSet.catch(function(){return p.resolve()}):p.resolve();return this._driverSet=W.then(function(){var ee=U[0];return w._dbInfo=null,w._ready=null,w.getDriver(ee).then(function(oe){w._driver=oe._driver,G(),w._wrapLibraryMethodsWithReady(),w._initDriver=O(U)})}).catch(function(){G();var ee=new Error("No available storage method found.");return w._driverSet=p.reject(ee),w._driverSet}),v(this._driverSet,_,S),this._driverSet},g.prototype.supports=function(y){return!!$n[y]},g.prototype._extend=function(y){pn(this,y)},g.prototype._getSupportedDrivers=function(y){for(var _=[],S=0,w=y.length;S<w;S++){var U=y[S];this.supports(U)&&_.push(U)}return _},g.prototype._wrapLibraryMethodsWithReady=function(){for(var y=0,_=mn.length;y<_;y++)hi(this,mn[y])},g.prototype.createInstance=function(y){return new g(y)},g}(),xi=new gi;s.exports=xi},{3:3}]},{},[4])(4)})})(ti);var Pu=ti.exports;const _t=Ni(Pu),Mu={apiKey:"AIzaSyC7QzF9xZzJ8K9L0M1N2O3P4Q5R6S7T8U9V",authDomain:"financial-dashboard-fd.firebaseapp.com",projectId:"financial-dashboard-fd",storageBucket:"financial-dashboard-fd.appspot.com",messagingSenderId:"123456789012",appId:"1:123456789012:web:abcdef1234567890abcdef"};let Mn;mo().length===0?(Mn=po(Mu),console.log("🔥 تم إنشاء تطبيق Firebase جديد في storage.js")):(Mn=ho(),console.log("🔥 تم استخدام تطبيق Firebase الموجود في storage.js"));const kn=go(Mn);_t.config({driver:_t.INDEXEDDB,name:"MASROF",version:1,storeName:"financial_data",description:"تخزين البيانات المالية"});const ku=async t=>{try{const e=new Date().toISOString(),n={...t,backupTimestamp:e,version:"1.0"};return await xo(yo(kn,"backups",`backup_${Date.now()}`),n),console.log("☁️ تم حفظ النسخة الاحتياطية في السحابة"),!0}catch(e){return console.error("❌ خطأ في حفظ النسخة الاحتياطية في السحابة:",e),!1}},Du=async()=>{try{console.log("🔄 بدء استعادة البيانات من السحابة...");const t=Ei(kn,"backups"),e=await wi(t);if(e.empty)throw new Error("لا توجد نسخ احتياطية في السحابة");let n=null,s="";if(e.forEach(d=>{const c=d.data();c.backupTimestamp>s&&(s=c.backupTimestamp,n=c)}),!n)throw new Error("لم يتم العثور على نسخة احتياطية صالحة");const r=["transactions","categories","cards","bankAccounts","installments","loans","investments","settings"];let l=0;for(const d of r)n[d]&&(await _t.setItem(d,n[d]),await xo(yo(kn,"userData",d),{value:n[d],timestamp:new Date().toISOString(),version:"1.0"}),l++);return console.log(`✅ تم استعادة ${l} مجموعة بيانات من السحابة`),{success:!0,message:`تم استعادة ${l} مجموعة بيانات من السحابة`,timestamp:n.backupTimestamp}}catch(t){return console.error("❌ خطأ أثناء الاستعادة من السحابة:",t),{success:!1,message:t.message||"حدث خطأ أثناء استعادة البيانات من السحابة"}}},Lu=async()=>{try{const t={},e=["transactions","categories","cards","bankAccounts","installments","loans","investments","settings"];for(const d of e){const c=await _t.getItem(d);c&&(t[d]=c)}const n={...t,backupTimestamp:new Date().toISOString(),version:"1.0"},s=JSON.stringify(n,null,2),r=new Blob([s],{type:"application/json"}),l=document.createElement("a");return l.href=URL.createObjectURL(r),l.download=`masrof-backup-${new Date().toISOString().split("T")[0]}.json`,l.click(),console.log("💾 تم تحميل ملف النسخة الاحتياطية"),!0}catch(t){return console.error("❌ خطأ في تحميل النسخة الاحتياطية:",t),!1}},Fu=t=>new Promise((e,n)=>{const s=new FileReader;s.onload=async r=>{try{const l=JSON.parse(r.target.result);if(!l.version||!l.backupTimestamp)throw new Error("ملف النسخة الاحتياطية غير صالح");const d=["transactions","categories","cards","bankAccounts","installments","loans","investments","settings"];let c=0;for(const f of d)l[f]&&(await _t.setItem(f,l[f]),c++);console.log(`✅ تم استعادة ${c} مجموعة بيانات من الملف`),e({success:!0,message:`تم استعادة ${c} مجموعة بيانات من الملف`,timestamp:l.backupTimestamp})}catch(l){console.error("❌ خطأ في استعادة الملف:",l),n({success:!1,message:l.message||"حدث خطأ أثناء استعادة البيانات من الملف"})}},s.onerror=()=>{n({success:!1,message:"خطأ في قراءة الملف"})},s.readAsText(t)}),co=({onSuccess:t,onClose:e,hideCloseButton:n=!1,darkMode:s=!1,language:r="ar"})=>{const[l,d]=V.useState(!0),[c,f]=V.useState({email:"",password:"",displayName:""}),[u,m]=V.useState(!1),[p,h]=V.useState(""),v=async A=>{A.preventDefault(),m(!0),h("");try{let I;if(l)I=await je.signIn(c.email,c.password);else{if(!c.displayName.trim()){h("الاسم مطلوب"),m(!1);return}I=await je.signUp(c.email,c.password,c.displayName)}I.success?t(I.user):h(I.error||"حدث خطأ غير متوقع")}catch{h("حدث خطأ في الاتصال")}finally{m(!1)}},E=A=>{f(I=>({...I,[A.target.name]:A.target.value}))};return o.jsx("div",{className:`${n?"":"fixed inset-0 bg-black/60 backdrop-blur-sm z-[70] overflow-hidden"} flex items-center justify-center p-4`,style:n?{}:{position:"fixed",top:0,left:0,right:0,bottom:0},children:o.jsx("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md animate-fade-in",children:o.jsxs("div",{className:"p-6",children:[o.jsxs("div",{className:"flex justify-between items-center mb-6",children:[o.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:l?"🔐 تسجيل الدخول":"📝 إنشاء حساب جديد"}),!n&&o.jsx("button",{onClick:e,className:"text-slate-400 hover:text-slate-600 transition-colors",children:"✕"})]}),o.jsxs("form",{onSubmit:v,className:"space-y-4",children:[!l&&o.jsxs("div",{children:[o.jsx("label",{htmlFor:"displayName",className:"block text-sm font-medium text-slate-700 mb-1",children:"الاسم الكامل"}),o.jsx("input",{type:"text",id:"displayName",name:"displayName",value:c.displayName,onChange:E,className:"w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"أدخل اسمك الكامل",required:!l})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-slate-700 mb-1",children:"البريد الإلكتروني"}),o.jsx("input",{type:"email",id:"email",name:"email",value:c.email,onChange:E,className:"w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"example@email.com",required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-slate-700 mb-1",children:"كلمة المرور"}),o.jsx("input",{type:"password",id:"password",name:"password",value:c.password,onChange:E,className:"w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"كلمة المرور",required:!0,minLength:6})]}),p&&o.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:o.jsx("p",{className:"text-red-600 text-sm",children:p})}),o.jsx("button",{type:"submit",disabled:u,className:"w-full py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white font-semibold rounded-lg transition-colors",children:u?"⏳ جاري المعالجة...":l?"🔐 تسجيل الدخول":"📝 إنشاء حساب"})]}),o.jsx("div",{className:"mt-6 text-center",children:o.jsx("button",{onClick:()=>d(!l),className:"text-blue-600 hover:text-blue-700 font-medium",children:l?"ليس لديك حساب؟ إنشاء حساب جديد":"لديك حساب بالفعل؟ تسجيل الدخول"})})]})})})},ni=()=>o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[o.jsx("line",{x1:"22",y1:"2",x2:"11",y2:"13"}),o.jsx("polygon",{points:"22 2 15 22 11 13 2 9 22 2"})]}),at=()=>o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16",children:[o.jsx("path",{d:"M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"}),o.jsx("path",{fillRule:"evenodd",d:"M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"})]}),Uu=()=>o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16",children:[o.jsx("path",{d:"M9.5 2.672a.5.5 0 1 0 1 0V.672a.5.5 0 0 0-1 0v2zm4.5.012a.5.5 0 0 0-.707-.707l-1.414 1.414a.5.5 0 0 0 .707.707l1.414-1.414zM11.328 14a.5.5 0 0 0 .707.707l1.414-1.414a.5.5 0 0 0-.707-.707l-1.414 1.414zM16 8a.5.5 0 0 0-.5-.5h-2a.5.5 0 0 0 0 1h2a.5.5 0 0 0 .5-.5zM2 8a.5.5 0 0 0-.5-.5h-2a.5.5 0 0 0 0 1h2A.5.5 0 0 0 2 8zm4.5-.012a.5.5 0 0 0 .707-.707L5.793 5.864a.5.5 0 1 0-.707.707L6.5 7.988zM4.672 2.5a.5.5 0 0 0-.707.707l1.414 1.414a.5.5 0 0 0 .707-.707L4.672 2.5zM.5 8a.5.5 0 0 0 .5.5h2a.5.5 0 0 0 0-1h-2A.5.5 0 0 0 .5 8zM8 0a.5.5 0 0 0-.5.5v2a.5.5 0 0 0 1 0v-2A.5.5 0 0 0 8 0z"}),o.jsx("path",{d:"M8 4a4 4 0 1 1 0 8 4 4 0 0 1 0-8zm0 1a3 3 0 1 0 0 6 3 3 0 0 0 0-6z"})]}),ju=({className:t})=>o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-6 w-6 ${t}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})}),Vu=({className:t})=>o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-6 w-6 ${t}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),Bu=({className:t})=>o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-6 w-6 ${t}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h7"})}),qu=({className:t})=>o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-6 w-6 ${t}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 12h.01M12 12h.01M19 12h.01M5 12a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0z"})}),$u=({className:t})=>o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-8 w-8 ${t}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),St=({className:t})=>o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:`w-6 h-6 ${t}`,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})}),yn=({className:t})=>o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:`w-6 h-6 ${t}`,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),vn=({className:t})=>o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:`w-6 h-6 ${t}`,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.75 9.75l4.5 4.5m0-4.5l-4.5 4.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),Gu=({className:t})=>o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:`w-6 h-6 ${t}`,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"})}),Hu={ar:{"app.title":"لوحة التحكم المالية | MASROF","developed.by":"Developed by K.A Team","add.transaction":"إضافة حركة",logout:"خروج","dark.mode":"الوضع المظلم",notifications:"الإشعارات","enable.notifications":"تفعيل الإشعارات",language:"العربية","tab.summary":"الملخص","tab.analysis":"التحليل","tab.transactions":"الحركات","tab.budget":"الميزانية","tab.investment":"الاستثمار","tab.ai.assistant":"المحلل الذكي","tab.settings":"الإعدادات","tab.cards":"إدارة البطاقات","tab.bank":"البنك","tab.installments":"الأقساط","tab.debts.loans":"الديون والقروض","card.debts.summary":"ملخص ديون البطاقات","card.bank.accounts":"ملخص الحسابات البنكية","card.financial.report":"تقرير مالي شامل","card.categories.summary":"ملخص الفئات",due:"المستحق",remaining:"المتبقي","total.debts":"إجمالي الديون","total.available":"إجمالي المتاح",deposits:"الإيداعات",withdrawals:"السحوبات","total.bank.balances":"إجمالي الأرصدة البنكية","total.income":"إجمالي الدخل","total.expenses":"إجمالي المصاريف",net:"الصافي",rent:"إيجار",groceries:"مواد تموينية",shopping:"تسوق",bills:"سداد فواتير",restaurants:"مطاعم",transport:"مواصلات",entertainment:"ترفيه",health:"صحة",education:"تعليم",other:"أخرى","al.ahli.snb":"الأهلي SNB","emirates.enbd":"الإمارات ENBD","al.ahli.bank":"البنك الاهلي","arab.bank":"البنك العربي",add:"إضافة",edit:"تعديل",delete:"حذف",save:"حفظ",cancel:"إلغاء",confirm:"تأكيد",close:"إغلاق",search:"بحث",filter:"تصفية",export:"تصدير",import:"استيراد",active:"نشط",inactive:"غير نشط",pending:"معلق",completed:"مكتمل",cancelled:"ملغي",january:"يناير",february:"فبراير",march:"مارس",april:"أبريل",may:"مايو",june:"يونيو",july:"يوليو",august:"أغسطس",september:"سبتمبر",october:"أكتوبر",november:"نوفمبر",december:"ديسمبر",sunday:"الأحد",monday:"الاثنين",tuesday:"الثلاثاء",wednesday:"الأربعاء",thursday:"الخميس",friday:"الجمعة",saturday:"السبت",sar:"ريال سعودي",usd:"دولار أمريكي",eur:"يورو",aed:"درهم إماراتي",today:"اليوم",yesterday:"أمس","this.week":"هذا الأسبوع","this.month":"هذا الشهر","this.year":"هذا العام","last.week":"الأسبوع الماضي","last.month":"الشهر الماضي","last.year":"العام الماضي",success:"نجح",error:"خطأ",warning:"تحذير",info:"معلومات",loading:"جاري التحميل...","no.data":"لا توجد بيانات","try.again":"حاول مرة أخرى","required.field":"هذا الحقل مطلوب","invalid.email":"البريد الإلكتروني غير صحيح","invalid.amount":"المبلغ غير صحيح","invalid.date":"التاريخ غير صحيح","debt.to.me":"ديون لي","debt.from.me":"ديون علي",loans:"قروض","add.debt":"إضافة دين","add.loan":"إضافة قرض",debtor:"المدين",creditor:"الدائن",lender:"المقرض",amount:"المبلغ",description:"الوصف",date:"التاريخ",status:"الحالة",source:"المصدر",reason:"السبب",installments:"أقساط","paid.installments":"أقساط مدفوعة","remaining.installments":"أقساط متبقية","next.payment":"الدفعة التالية","payment.date":"تاريخ الدفع","installment.amount":"مبلغ القسط","total.amount":"المبلغ الإجمالي",investment:"استثمار","current.value":"القيمة الحالية","initial.investment":"الاستثمار الأولي","profit.loss":"الربح/الخسارة","return.rate":"معدل العائد",budget:"ميزانية","budget.limit":"حد الميزانية",spent:"مصروف","remaining.budget":"الميزانية المتبقية","over.budget":"تجاوز الميزانية",reports:"تقارير","financial.report":"تقرير مالي","monthly.report":"تقرير شهري","yearly.report":"تقرير سنوي","category.report":"تقرير الفئات","income.report":"تقرير الدخل","expense.report":"تقرير المصروفات",settings:"الإعدادات",profile:"الملف الشخصي",account:"الحساب",privacy:"الخصوصية",security:"الأمان",backup:"نسخ احتياطي",restore:"استعادة","export.data":"تصدير البيانات","import.data":"استيراد البيانات","ai.assistant":"المساعد الذكي","ask.question":"اسأل سؤال","get.advice":"احصل على نصيحة","analyze.data":"تحليل البيانات","generate.report":"توليد تقرير",notification:"إشعار","payment.reminder":"تذكير دفع","budget.alert":"تنبيه الميزانية","low.balance":"رصيد منخفض","payment.due":"دفعة مستحقة","network.error":"خطأ في الشبكة","server.error":"خطأ في الخادم","auth.error":"خطأ في المصادقة","permission.error":"خطأ في الصلاحية","validation.error":"خطأ في التحقق","unknown.error":"خطأ غير معروف",details:"التفاصيل","cannot.delete":"لا يمكن الحذف","cannot.delete.category":"لا يمكن حذف هذه الفئة لأنها مستخدمة في بعض الحركات","cannot.delete.transaction.type":"لا يمكن حذف نوع الحركة هذا لأنه مستخدم في بعض الحركات","cannot.delete.payment.method":"لا يمكن حذف وسيلة الدفع هذه لأنها مستخدمة في بعض الحركات","restore.backup":"استعادة نسخة احتياطية","confirm.restore":"هل أنت متأكد؟ سيتم الكتابة فوق جميع بياناتك الحالية","api.status":"حالة مفاتيح API"},en:{"app.title":"Financial Dashboard | MASROF","developed.by":"Developed by K.A Team","add.transaction":"Add Transaction",logout:"Logout","dark.mode":"Dark Mode",notifications:"Notifications","enable.notifications":"Enable Notifications",language:"English","tab.summary":"Summary","tab.analysis":"Analysis","tab.transactions":"Transactions","tab.budget":"Budget","tab.investment":"Investment","tab.ai.assistant":"AI Assistant","tab.settings":"Settings","tab.cards":"Card Management","tab.bank":"Bank","tab.installments":"Installments","tab.debts.loans":"Debts & Loans","card.debts.summary":"Card Debts Summary","card.bank.accounts":"Bank Accounts Summary","card.financial.report":"Comprehensive Financial Report","card.categories.summary":"Categories Summary",due:"Due",remaining:"Remaining","total.debts":"Total Debts","total.available":"Total Available",deposits:"Deposits",withdrawals:"Withdrawals","total.bank.balances":"Total Bank Balances","total.income":"Total Income","total.expenses":"Total Expenses",net:"Net",rent:"Rent",groceries:"Groceries",shopping:"Shopping",bills:"Bill Payments",restaurants:"Restaurants",transport:"Transport",entertainment:"Entertainment",health:"Health",education:"Education",other:"Other","al.ahli.snb":"Al Ahli SNB","emirates.enbd":"Emirates ENBD","al.ahli.bank":"Al Ahli Bank","arab.bank":"Arab Bank",add:"Add",edit:"Edit",delete:"Delete",save:"Save",cancel:"Cancel",confirm:"Confirm",close:"Close",search:"Search",filter:"Filter",export:"Export",import:"Import",active:"Active",inactive:"Inactive",pending:"Pending",completed:"Completed",cancelled:"Cancelled",january:"January",february:"February",march:"March",april:"April",may:"May",june:"June",july:"July",august:"August",september:"September",october:"October",november:"November",december:"December",sunday:"Sunday",monday:"Monday",tuesday:"Tuesday",wednesday:"Wednesday",thursday:"Thursday",friday:"Friday",saturday:"Saturday",sar:"Saudi Riyal",usd:"US Dollar",eur:"Euro",aed:"UAE Dirham",today:"Today",yesterday:"Yesterday","this.week":"This Week","this.month":"This Month","this.year":"This Year","last.week":"Last Week","last.month":"Last Month","last.year":"Last Year",success:"Success",error:"Error",warning:"Warning",info:"Info",loading:"Loading...","no.data":"No Data","try.again":"Try Again","required.field":"This field is required","invalid.email":"Invalid email address","invalid.amount":"Invalid amount","invalid.date":"Invalid date","debt.to.me":"Debts to Me","debt.from.me":"Debts from Me",loans:"Loans","add.debt":"Add Debt","add.loan":"Add Loan",debtor:"Debtor",creditor:"Creditor",lender:"Lender",amount:"Amount",description:"Description",date:"Date",status:"Status",source:"Source",reason:"Reason",installments:"Installments","paid.installments":"Paid Installments","remaining.installments":"Remaining Installments","next.payment":"Next Payment","payment.date":"Payment Date","installment.amount":"Installment Amount","total.amount":"Total Amount",investment:"Investment","current.value":"Current Value","initial.investment":"Initial Investment","profit.loss":"Profit/Loss","return.rate":"Return Rate",budget:"Budget","budget.limit":"Budget Limit",spent:"Spent","remaining.budget":"Remaining Budget","over.budget":"Over Budget",reports:"Reports","financial.report":"Financial Report","monthly.report":"Monthly Report","yearly.report":"Yearly Report","category.report":"Category Report","income.report":"Income Report","expense.report":"Expense Report",settings:"Settings",profile:"Profile",account:"Account",privacy:"Privacy",security:"Security",backup:"Backup",restore:"Restore","export.data":"Export Data","import.data":"Import Data","ai.assistant":"AI Assistant","ask.question":"Ask Question","get.advice":"Get Advice","analyze.data":"Analyze Data","generate.report":"Generate Report",notification:"Notification","payment.reminder":"Payment Reminder","budget.alert":"Budget Alert","low.balance":"Low Balance","payment.due":"Payment Due","network.error":"Network Error","server.error":"Server Error","auth.error":"Authentication Error","permission.error":"Permission Error","validation.error":"Validation Error","unknown.error":"Unknown Error",details:"Details","cannot.delete":"Cannot Delete","cannot.delete.category":"Cannot delete this category as it is used in some transactions","cannot.delete.transaction.type":"Cannot delete this transaction type as it is used in some transactions","cannot.delete.payment.method":"Cannot delete this payment method as it is used in some transactions","restore.backup":"Restore Backup","confirm.restore":"Are you sure? This will overwrite all your current data","api.status":"API Keys Status"}},q=(t,e="ar")=>Hu[e][t]||t,Ju=({selectedYear:t,selectedMonth:e,onYearChange:n,onMonthChange:s,onAddTransaction:r,currentUser:l,onSignOut:d,language:c="ar",darkMode:f=!1,notifications:u=!1,onToggleDarkMode:m,onToggleNotifications:p,onToggleLanguage:h})=>{const[v,E]=V.useState(!1),A=V.useRef(null),I=V.useMemo(()=>{const P=new Date().getFullYear(),N=[];for(let T=P+1;T>=2020;T--)N.push(T);return N},[]),R=V.useMemo(()=>[{value:"all",label:"كل الشهور"},{value:1,label:"يناير"},{value:2,label:"فبراير"},{value:3,label:"مارس"},{value:4,label:"أبريل"},{value:5,label:"مايو"},{value:6,label:"يونيو"},{value:7,label:"يوليو"},{value:8,label:"أغسطس"},{value:9,label:"سبتمبر"},{value:10,label:"أكتوبر"},{value:11,label:"نوفمبر"},{value:12,label:"ديسمبر"}],[]);V.useEffect(()=>{const P=N=>{A.current&&!A.current.contains(N.target)&&E(!1)};return document.addEventListener("mousedown",P),()=>{document.removeEventListener("mousedown",P)}},[]);const k=()=>l.displayName?l.displayName:l.email?l.email.split("@")[0]:"المستخدم";return o.jsx("header",{className:"bg-slate-50/95 dark:bg-slate-800/95 backdrop-blur-lg border-b border-slate-200 dark:border-slate-700 py-3 shadow-sm relative z-30",children:o.jsx("div",{className:"container mx-auto px-4",children:o.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center text-center sm:text-right gap-4",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-10 h-10 bg-blue-500/10 rounded-lg flex items-center justify-center text-xl",children:"💰"}),o.jsxs("div",{children:[o.jsx("h1",{className:"text-xl font-bold text-slate-900 dark:text-slate-100 tracking-wide",children:"لوحة التحكم المالية"}),o.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Developed by K.A Team"})]})]}),o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsxs("div",{className:"flex items-center gap-2 bg-slate-200 dark:bg-slate-700 p-1.5 rounded-lg",children:[o.jsx("select",{value:t,onChange:P=>n(parseInt(P.target.value)),className:"bg-slate-200 dark:bg-slate-700 text-slate-800 dark:text-slate-200 font-semibold border-0 focus:ring-0 appearance-none p-2 rounded-md",children:I.map(P=>o.jsx("option",{value:P,children:P},P))}),o.jsx("select",{value:e,onChange:P=>s(P.target.value==="all"?"all":parseInt(P.target.value)),className:"bg-slate-200 dark:bg-slate-700 text-slate-800 dark:text-slate-200 font-semibold border-0 focus:ring-0 appearance-none p-2 rounded-md",children:R.map(P=>o.jsx("option",{value:P.value,children:P.label},P.value))})]}),o.jsxs("div",{className:"relative",ref:A,children:[o.jsxs("button",{onClick:()=>E(!v),className:"flex items-center gap-3 p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors",children:[o.jsx("div",{className:"text-right",children:o.jsx("p",{className:"font-semibold text-slate-800 dark:text-slate-200 text-sm",children:k()})}),o.jsx("div",{className:"w-8 h-8 bg-blue-100 dark:bg-blue-900/50 rounded-full flex items-center justify-center",children:o.jsx("span",{className:"text-blue-600 font-bold text-sm",children:(l.displayName||l.email||"U").charAt(0).toUpperCase()})}),o.jsx("svg",{className:`w-4 h-4 text-slate-500 transition-transform ${v?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),v&&o.jsxs("div",{className:"absolute left-0 top-full mt-2 w-64 bg-white dark:bg-slate-800 rounded-lg shadow-xl border border-slate-200 dark:border-slate-700 py-2 z-[9999]",children:[o.jsxs("div",{className:"px-4 py-3 border-b border-slate-200 dark:border-slate-700",children:[o.jsx("p",{className:"font-semibold text-slate-800 dark:text-slate-200 text-sm",children:k()}),o.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:l.email})]}),o.jsxs("button",{onClick:()=>{m==null||m(),E(!1)},className:"w-full flex items-center justify-between px-4 py-3 hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("span",{className:"text-lg",children:f?"🌙":"☀️"}),o.jsx("span",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:q("dark.mode",c)})]}),o.jsx("div",{className:`relative inline-flex h-5 w-9 items-center rounded-full transition-colors ${f?"bg-blue-600":"bg-slate-200"}`,children:o.jsx("span",{className:`inline-block h-3 w-3 transform rounded-full bg-white transition-transform ${f?"translate-x-5":"translate-x-1"}`})})]}),o.jsxs("button",{onClick:()=>{p==null||p(),E(!1)},className:"w-full flex items-center justify-between px-4 py-3 hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("span",{className:"text-lg",children:u?"🔔":"🔕"}),o.jsx("span",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:q("notifications",c)})]}),o.jsx("div",{className:`relative inline-flex h-5 w-9 items-center rounded-full transition-colors ${u?"bg-blue-600":"bg-slate-200"}`,children:o.jsx("span",{className:`inline-block h-3 w-3 transform rounded-full bg-white transition-transform ${u?"translate-x-5":"translate-x-1"}`})})]}),o.jsxs("button",{onClick:()=>{h==null||h(),E(!1)},className:"w-full flex items-center justify-between px-4 py-3 hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("span",{className:"text-lg",children:"🌐"}),o.jsx("span",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:q("language",c)})]}),o.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center ${f?"bg-blue-500":"bg-blue-600"}`,children:o.jsx("span",{className:"text-white font-bold text-xs",children:c==="ar"?"A":"E"})})]}),o.jsx("div",{className:"border-t border-slate-200 dark:border-slate-700 my-2"}),o.jsxs("button",{onClick:()=>{d(),E(!1)},className:"w-full flex items-center gap-3 px-4 py-3 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors text-red-600 dark:text-red-400",children:[o.jsx("span",{className:"text-lg",children:"🚪"}),o.jsx("span",{className:"text-sm font-medium",children:"خروج"})]})]})]}),o.jsxs("button",{onClick:r,className:"hidden md:flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold px-4 py-2.5 rounded-lg transition-all duration-300",children:[o.jsx($u,{className:"w-5 h-5"}),o.jsx("span",{children:q("add.transaction",c)})]})]})]})})})},Ou=(t="ar")=>[{id:"summary",label:`📊 ${q("tab.summary",t)}`,icon:ju},{id:"analysis",label:`📈 ${q("tab.analysis",t)}`,icon:Vu},{id:"transactions",label:`💳 ${q("tab.transactions",t)}`,icon:Bu},{id:"budget",label:`✨ ${q("tab.budget",t)}`},{id:"investment",label:`💹 ${q("tab.investment",t)}`},{id:"ai-assistant",label:`🤖 ${q("tab.ai.assistant",t)}`},{id:"cards",label:`💳 ${q("tab.cards",t)}`},{id:"bank",label:`🏦 ${q("tab.bank",t)}`},{id:"installments",label:`📱 ${q("tab.installments",t)}`},{id:"debts-loans",label:`📊 ${q("tab.debts.loans",t)}`},{id:"settings",label:`⚙️ ${q("tab.settings",t)}`}],uo=["summary","analysis","transactions"],Yu=({activeTab:t,setActiveTab:e,language:n="ar"})=>{const[s,r]=V.useState(!1),l=Ou(n),d=u=>{e(u),r(!1)},c=l.filter(u=>uo.includes(u.id)),f=l.filter(u=>!uo.includes(u.id));return o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"hidden md:flex flex-wrap justify-center mb-8 tab-bar rounded-xl p-2",children:l.map(u=>o.jsx("button",{onClick:()=>d(u.id),className:`tab-btn px-4 py-2 mx-1 mb-1 rounded-lg font-semibold text-sm flex items-center gap-2 ${t===u.id?"active":""}`,children:u.label},u.id))}),o.jsxs("div",{className:"md:hidden fixed bottom-0 left-0 right-0 h-20 bg-white/80 backdrop-blur-lg border-t border-slate-200 z-40 flex justify-around items-center",children:[c.map(u=>{const m=u.icon;return o.jsxs("button",{onClick:()=>d(u.id),className:`flex flex-col items-center justify-center gap-1 transition-colors w-full h-full ${t===u.id?"text-blue-600":"text-slate-500 hover:text-slate-900"}`,children:[m&&o.jsx(m,{}),o.jsx("span",{className:"text-xs",children:u.label.split(" ")[1]})]},u.id)}),o.jsxs("button",{onClick:()=>r(!s),className:`flex flex-col items-center justify-center gap-1 transition-colors w-full h-full ${s?"text-blue-600":"text-slate-500 hover:text-slate-900"}`,children:[o.jsx(qu,{}),o.jsx("span",{className:"text-xs",children:"المزيد"})]})]}),s&&o.jsx("div",{className:"md:hidden fixed inset-0 bg-gray-900/50 backdrop-blur-sm z-50 flex justify-center items-end",onClick:()=>r(!1),children:o.jsxs("div",{className:"bg-white w-full rounded-t-2xl p-4 border-t border-slate-200 animate-fade-in",onClick:u=>u.stopPropagation(),children:[o.jsx("div",{className:"w-16 h-1 bg-slate-300 rounded-full mx-auto mb-4"}),o.jsx("div",{className:"grid grid-cols-3 gap-4 text-center",children:f.map(u=>o.jsxs("button",{onClick:()=>d(u.id),className:`p-3 rounded-lg flex flex-col items-center gap-2 ${t===u.id?"bg-blue-100 text-blue-700":"bg-slate-100 text-slate-700"}`,children:[o.jsx("span",{className:"text-2xl",children:u.label.split(" ")[0]}),o.jsx("span",{className:"text-xs font-semibold",children:u.label.split(" ")[1]})]},u.id))})]})})]})},Wu=({className:t,darkMode:e=!1})=>o.jsx("div",{className:`absolute inset-0 -translate-x-full animate-[shimmer_2s_infinite] bg-gradient-to-r from-transparent via-${e?"slate-700/80":"slate-200/80"} to-transparent ${t}`}),bn=({darkMode:t=!1})=>o.jsxs("div",{className:"glass-card p-6 h-96 relative overflow-hidden",children:[o.jsx("div",{className:`h-6 w-1/2 rounded mb-6 ${t?"bg-slate-700":"bg-slate-200"}`}),o.jsxs("div",{className:"space-y-4",children:[o.jsx("div",{className:`h-4 w-full rounded ${t?"bg-slate-700":"bg-slate-200"}`}),o.jsx("div",{className:`h-4 w-5/6 rounded ${t?"bg-slate-700":"bg-slate-200"}`}),o.jsx("div",{className:`h-4 w-full rounded ${t?"bg-slate-700":"bg-slate-200"}`}),o.jsx("div",{className:`h-4 w-3/4 rounded ${t?"bg-slate-700":"bg-slate-200"}`})]}),o.jsx(Wu,{darkMode:t})]}),zu=({darkMode:t=!1})=>o.jsxs("div",{className:"container mx-auto px-2 sm:px-4 max-w-7xl mt-8 mb-20",children:[o.jsx("div",{className:"h-16 mb-3"}),o.jsx("div",{className:`flex flex-wrap justify-center mb-8 rounded-xl p-2 h-14 ${t?"bg-slate-700":"bg-slate-100"}`}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 animate-fade-in",children:[o.jsx(bn,{}),o.jsx(bn,{}),o.jsx(bn,{})]})]}),se=t=>(t||0).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),Ku=({title:t,details:e,barColor:n,darkMode:s=!1,language:r="ar"})=>o.jsxs("div",{className:`p-4 rounded-xl border shadow-sm hover:shadow-md transition-shadow h-32 flex flex-col justify-between ${s?"bg-slate-800 border-slate-700":"bg-white border-gray-200"}`,children:[o.jsxs("div",{className:"flex justify-between items-start",children:[o.jsx("h4",{className:`font-bold text-sm ${s?"text-slate-200":"text-slate-800"}`,children:t}),o.jsx("div",{className:"w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center",children:o.jsx("span",{className:"text-blue-600 text-sm",children:"💳"})})]}),o.jsxs("div",{className:`p-2 rounded-lg border ${s?"bg-slate-700 border-slate-600":"bg-slate-50 border-gray-200"}`,children:[o.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[o.jsxs("span",{className:s?"text-slate-400":"text-slate-600",children:[q("due",r),":"]}),o.jsx("span",{className:`font-semibold number-display text-xs ${s?"text-slate-200":"text-slate-900"}`,children:se(e.balance)})]}),o.jsxs("div",{className:"flex justify-between text-xs",children:[o.jsxs("span",{className:s?"text-slate-400":"text-slate-600",children:[q("remaining",r),":"]}),o.jsx("span",{className:`font-semibold number-display text-xs ${s?"text-slate-200":"text-emerald-700"}`,children:se(e.available)})]})]}),o.jsx("div",{className:`rounded-full h-1.5 overflow-hidden ${s?"bg-slate-600":"bg-slate-200"}`,children:o.jsx("div",{className:`${n} rounded-full h-1.5 transition-all duration-300`,style:{width:`${Math.min(100,e.usagePercentage)}%`}})})]}),Xu=({calculations:t,categories:e,darkMode:n=!1,language:s="ar",onNavigateToTransactions:r})=>{const l=Object.values(t.expensesByCategory).reduce((c,f)=>c+Number(f),0);if(l===0)return o.jsx("p",{className:`text-center p-4 text-sm ${n?"text-slate-400":"text-slate-500"}`,children:q("no.data",s)});const d=Object.entries(t.expensesByCategory).sort(([,c],[,f])=>f-c);return o.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto pr-2",children:d.map(([c,f])=>{const u=e.find(p=>p.id===c);u?`${u.icon}${u.name}`:q("other",s);const m=Number(f)/l*100;return o.jsxs("div",{className:`p-3 rounded-lg border shadow-sm hover:shadow-md transition-shadow h-20 flex flex-col justify-between cursor-pointer ${n?"bg-slate-800 border-slate-700 hover:bg-slate-750":"bg-white border-gray-200 hover:bg-gray-50"}`,onClick:()=>r==null?void 0:r(c),children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"text-base",children:(u==null?void 0:u.icon)||"📊"}),o.jsx("span",{className:`font-medium truncate text-sm ${n?"text-slate-300":"text-slate-700"}`,title:u==null?void 0:u.name,children:(u==null?void 0:u.name)||q("other",s)})]}),o.jsx("span",{className:`font-semibold number-display text-sm px-2 py-1 rounded border ${n?"text-slate-200 bg-slate-700 border-slate-600":"text-slate-900 bg-slate-50 border-gray-200"}`,children:se(f)})]}),o.jsx("div",{className:`mt-2 rounded-full h-1.5 overflow-hidden ${n?"bg-slate-600":"bg-slate-200"}`,children:o.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 h-1.5 rounded-full transition-all duration-500",style:{width:`${m.toFixed(1)}%`}})}),o.jsxs("div",{className:`text-xs mt-1 text-center ${n?"text-slate-400":"text-slate-500"}`,children:[m.toFixed(1),"%"]}),o.jsx("div",{className:"text-xs text-center mt-1 text-blue-500 hover:text-blue-600",children:"انقر لعرض الحركات"})]},c)})})},Qu=({calculations:t,categories:e,state:n,darkMode:s=!1,language:r="ar",onNavigateToTransactions:l})=>{const{totalIncome:d,totalExpenses:c,cardPayments:f,bankAccountDetails:u,totalBankBalance:m}=t,p=d-c,h=["bg-blue-500","bg-red-500","bg-green-500","bg-purple-500","bg-yellow-500"],v=t.cardDetails,E=Object.values(v).reduce((R,k)=>R+k.balance,0),A=Object.values(v).reduce((R,k)=>R+k.available,0),I=Object.values(v).reduce((R,k)=>R+k.limit,0);return o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 animate-fade-in",children:[o.jsxs("div",{className:"card-consistent xl:col-span-1",children:[o.jsxs("h3",{className:`font-semibold text-lg mb-4 ${s?"text-slate-200":"text-slate-800"}`,children:["💳 ",q("card.debts.summary",r)]}),o.jsx("div",{className:"space-y-4",children:Object.values(v).map((R,k)=>o.jsx(Ku,{title:R.name,details:R,barColor:h[k%h.length],darkMode:s,language:r},R.id))}),o.jsx("div",{className:`mt-4 p-3 rounded-lg ${s?"bg-slate-700":"bg-slate-100"}`,children:o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{className:"bg-red-50 p-3 rounded-lg border border-red-200 text-center",children:[o.jsx("p",{className:`font-semibold text-xs mb-2 ${s?"text-red-400":"text-red-600"}`,children:q("total.debts",r)}),o.jsx("p",{className:`font-bold text-sm number-display ${s?"text-red-400":"text-red-600"}`,children:se(E)})]}),o.jsxs("div",{className:"bg-emerald-50 p-3 rounded-lg border border-emerald-200 text-center",children:[o.jsx("p",{className:`font-semibold text-xs mb-2 ${s?"text-emerald-400":"text-emerald-600"}`,children:q("total.available",r)}),o.jsx("p",{className:`font-bold text-sm number-display ${s?"text-emerald-400":"text-emerald-600"}`,children:se(A)})]}),o.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg border border-blue-200 text-center",children:[o.jsx("p",{className:"text-blue-600 font-semibold text-xs mb-2 whitespace-nowrap",children:"إجمالي الحدود"}),o.jsx("p",{className:"font-bold text-sm text-blue-600 number-display",children:se(I)})]})]})})]}),o.jsxs("div",{className:"card-consistent xl:col-span-1",children:[o.jsx("h3",{className:"font-semibold text-lg text-slate-800 mb-4",children:"🏦 ملخص الحسابات البنكية"}),o.jsx("div",{className:"space-y-3",children:Object.values(u).map(R=>{const k=R.balance>0?"bank-card-positive":R.balance<0?"bank-card-negative":"bank-card-neutral";return o.jsxs("div",{className:`card-consistent ${k} h-32 flex flex-col justify-between`,children:[o.jsxs("div",{className:"flex justify-between items-start",children:[o.jsx("h3",{className:"font-semibold text-lg text-slate-800",children:R.name}),o.jsx("div",{className:"w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center",children:o.jsx("span",{className:"text-blue-600 text-sm",children:"🏛️"})})]}),o.jsx("div",{className:"text-center",children:o.jsx("p",{className:"font-bold text-2xl text-blue-900 number-display",children:se(R.balance)})}),o.jsxs("div",{className:"flex justify-center gap-6 mt-1",children:[o.jsxs("div",{className:"text-center",children:[o.jsx("p",{className:"text-emerald-600 font-semibold text-xs mb-0.5",children:"الإيداعات"}),o.jsxs("p",{className:"text-emerald-700 font-bold text-sm",children:["+",se(R.deposits)]})]}),o.jsxs("div",{className:"text-center",children:[o.jsx("p",{className:"text-red-600 font-semibold text-xs mb-0.5",children:"السحوبات"}),o.jsxs("p",{className:"text-red-700 font-bold text-sm",children:["-",se(R.withdrawals)]})]})]})]},R.id)})})]}),o.jsxs("div",{className:"card-consistent xl:col-span-1",children:[o.jsx("h3",{className:"font-semibold text-lg text-slate-800 mb-4",children:"📈 تقرير مالي شامل"}),o.jsxs("div",{className:"space-y-2 text-sm",children:[o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{children:"إجمالي الدخل:"}),o.jsx("span",{className:"font-bold text-sm text-emerald-500 number-display",children:se(d)})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{children:"إجمالي المصاريف:"}),o.jsx("span",{className:"font-bold text-sm text-red-500 number-display",children:se(c)})]}),o.jsx("hr",{className:"my-2 border-slate-200"}),Object.values(v).map((R,k)=>o.jsxs("div",{className:"flex justify-between text-xs",children:[o.jsxs("span",{className:"text-slate-500",children:["مصاريف ",R.name,":"]}),o.jsx("span",{className:`font-semibold ${h[k%h.length].replace("bg-","text-")} number-display`,children:se(R.balance+(f[R.id]||0))})]},R.id)),o.jsx("hr",{className:"my-2 border-slate-200 border-dashed"}),Object.entries(f).map(([R,k])=>{var P;return o.jsxs("div",{className:"flex justify-between text-xs",children:[o.jsxs("span",{className:"text-slate-500",children:["إجمالي سداد ",(P=v[R])==null?void 0:P.name,":"]}),o.jsx("span",{className:"font-semibold text-emerald-500 number-display",children:se(k)})]},R)}),o.jsx("hr",{className:"my-2 border-slate-200"}),o.jsxs("div",{className:"flex justify-between font-bold text-sm",children:[o.jsx("span",{children:"الصافي:"}),o.jsx("span",{className:`number-display ${p>=0?"text-emerald-500":"text-red-500"}`,children:se(p)})]})]})]}),o.jsxs("div",{className:"card-consistent xl:col-span-1",children:[o.jsx("h3",{className:"font-semibold text-lg text-slate-800 mb-4",children:"📊 ملخص الفئات"}),o.jsx(Xu,{calculations:t,categories:e,onNavigateToTransactions:l})]})]})},Zu=({transactions:t,allTransactions:e,categories:n,deleteTransaction:s,editTransaction:r,state:l,darkMode:d=!1,language:c="ar",initialCategoryFilter:f,initialMonthFilter:u})=>{const[m,p]=V.useState(""),[h,v]=V.useState(""),[E,A]=V.useState(f||""),[I,R]=V.useState(""),[k,P]=V.useState(""),[N,T]=V.useState(u||""),M=x=>{const D={cash:"💵 نقدي","tabby-bnpl":"📱 تابي (BNPL)","tamara-bnpl":"📱 تمارا (BNPL)"};return D[x]?D[x]:l.cards[x]?`💳 ${l.cards[x].name}`:l.bankAccounts[x]?`🏦 ${l.bankAccounts[x].name}`:x},F=x=>{const D={income:"💰 دخل",expense:"💸 مصاريف","bnpl-payment":"📱 سداد قسط","investment-deposit":"💹 إيداع استثماري","investment-withdrawal":"💹 سحب استثماري"};if(D[x])return D[x];if(x.endsWith("-payment")){const B=x.replace("-payment","");if(l.cards[B])return`💳 سداد ${l.cards[B].name}`}return x},j=V.useMemo(()=>{let x=e;if(N)x=e.filter(D=>{const B=new Date(D.date);return`${B.getFullYear()}-${String(B.getMonth()+1).padStart(2,"0")}`===N});else if(I&&k){const D=new Date(I),B=new Date(k);B.setHours(23,59,59,999),x=e.filter(ne=>{const me=new Date(ne.date);return me>=D&&me<=B})}return x=x.filter(D=>{const B=m.toLowerCase(),ne=n.find(Y=>Y.id===D.categoryId),me=D.description.toLowerCase().includes(B)||(ne==null?void 0:ne.name.toLowerCase().includes(B)),ie=!h||D.paymentMethod===h,le=!E||D.categoryId===E;return me&&ie&&le}),x.sort((D,B)=>{const ne=new Date(D.date),ie=new Date(B.date).getTime()-ne.getTime();if(ie===0){const le=parseInt(D.id.replace("trans-","").split("-")[0]);return parseInt(B.id.replace("trans-","").split("-")[0])-le}return ie})},[t,e,m,h,E,I,k,N,n]),L=V.useMemo(()=>j.reduce((x,D)=>(D.type==="income"||D.type.toString().includes("payment")||D.type==="investment-withdrawal"?x.positive+=D.amount:x.negative+=D.amount,x),{positive:0,negative:0}),[j]);return o.jsx("div",{className:"space-y-6 animate-fade-in",children:o.jsxs("div",{className:"glass-card p-6",children:[o.jsx("h3",{className:"text-lg sm:text-xl font-bold text-slate-900 mb-4",children:"📋 سجل المعاملات والتقارير"}),o.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4 items-end p-4 bg-slate-100 rounded-lg mb-6",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"monthFilter",className:"block text-sm font-medium text-slate-600 mb-1",children:"فلتر الشهر"}),o.jsx("input",{type:"month",id:"monthFilter",value:N,onChange:x=>{T(x.target.value),x.target.value&&(R(""),P(""))},className:"w-full p-2"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"dateFrom",className:"block text-sm font-medium text-slate-600 mb-1",children:"من تاريخ"}),o.jsx("input",{type:"date",id:"dateFrom",value:I,onChange:x=>{R(x.target.value),(x.target.value||k)&&T("")},className:"w-full p-2"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"dateTo",className:"block text-sm font-medium text-slate-600 mb-1",children:"إلى تاريخ"}),o.jsx("input",{type:"date",id:"dateTo",value:k,onChange:x=>{P(x.target.value),(x.target.value||I)&&T("")},className:"w-full p-2"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"filterMethod",className:"block text-sm font-medium text-slate-600 mb-1",children:"وسيلة الدفع"}),o.jsxs("select",{id:"filterMethod",value:h,onChange:x=>v(x.target.value),className:"p-2 w-full",children:[o.jsx("option",{value:"",children:"كل الوسائل"}),Object.values(l.bankAccounts).map(x=>o.jsxs("option",{value:x.id,children:["🏦 ",x.name]},x.id)),o.jsx("option",{value:"cash",children:"💵 نقدي"}),Object.values(l.cards).map(x=>o.jsxs("option",{value:x.id,children:["💳 ",x.name]},x.id)),o.jsx("option",{value:"tabby-bnpl",children:"📱 تابي"}),o.jsx("option",{value:"tamara-bnpl",children:"📱 تمارا"})]})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"filterCategory",className:"block text-sm font-medium text-slate-600 mb-1",children:"الفئة"}),o.jsxs("select",{id:"filterCategory",value:E,onChange:x=>A(x.target.value),className:"p-2 w-full",children:[o.jsx("option",{value:"",children:"كل الفئات"}),n.map(x=>o.jsx("option",{value:x.id,children:x.name},x.id))]})]}),o.jsxs("div",{className:"sm:col-span-2 lg:col-span-5",children:[o.jsx("label",{htmlFor:"searchTerm",className:"block text-sm font-medium text-slate-600 mb-1",children:"بحث بالوصف"}),o.jsx("input",{type:"text",id:"searchTerm",placeholder:"🔍...",value:m,onChange:x=>p(x.target.value),className:"p-2 w-full"})]})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-center mb-6",children:[o.jsxs("div",{className:"card-consistent",children:[o.jsxs("div",{className:"flex justify-between items-start mb-3",children:[o.jsx("h3",{className:"font-semibold text-lg text-emerald-700",children:"إجمالي الإيجابي"}),o.jsx("div",{className:"w-8 h-8 bg-emerald-100 rounded-full flex items-center justify-center",children:o.jsx("span",{className:"text-emerald-600 text-lg",children:"💰"})})]}),o.jsx("div",{className:"bg-emerald-50 p-3 rounded-lg border border-emerald-200",children:o.jsx("p",{className:"font-bold text-sm text-emerald-800 number-display",children:se(L.positive)})})]}),o.jsxs("div",{className:"card-consistent",children:[o.jsxs("div",{className:"flex justify-between items-start mb-3",children:[o.jsx("h3",{className:"font-semibold text-lg text-red-700",children:"إجمالي السلبي"}),o.jsx("div",{className:"w-8 h-8 bg-red-100 rounded-full flex items-center justify-center",children:o.jsx("span",{className:"text-red-600 text-lg",children:"💸"})})]}),o.jsx("div",{className:"bg-red-50 p-3 rounded-lg border border-red-200",children:o.jsx("p",{className:"font-bold text-sm text-red-800 number-display",children:se(L.negative)})})]}),o.jsxs("div",{className:"card-consistent",children:[o.jsxs("div",{className:"flex justify-between items-start mb-3",children:[o.jsx("h3",{className:"font-semibold text-lg text-sky-700",children:"الصافي"}),o.jsx("div",{className:"w-8 h-8 bg-sky-100 rounded-full flex items-center justify-center",children:o.jsx("span",{className:"text-sky-600 text-lg",children:"📊"})})]}),o.jsx("div",{className:"bg-sky-50 p-3 rounded-lg border border-sky-200",children:o.jsx("p",{className:"font-bold text-sm text-sky-800 number-display",children:se(L.positive-L.negative)})})]})]}),o.jsxs("div",{className:"overflow-x-auto",children:[o.jsxs("table",{className:"w-full text-sm",children:[o.jsx("thead",{className:"border-b border-gray-200",children:o.jsxs("tr",{children:[o.jsx("th",{className:"text-right py-3 px-4 font-semibold",children:"التاريخ"}),o.jsx("th",{className:"text-right py-3 px-4 font-semibold",children:"الوسيلة"}),o.jsx("th",{className:"text-right py-3 px-4 font-semibold",children:"النوع"}),o.jsx("th",{className:"text-right py-3 px-4 font-semibold",children:"المبلغ"}),o.jsx("th",{className:"text-right py-3 px-4 font-semibold",children:"الفئة"}),o.jsx("th",{className:"text-right py-3 px-4 font-semibold hidden sm:table-cell",children:"الوصف"}),o.jsx("th",{className:"text-center py-3 px-4 font-semibold"})]})}),o.jsx("tbody",{children:j.map(x=>{const D=n.find(ne=>ne.id===x.categoryId),B=x.type==="income"||x.type.toString().includes("payment")||x.type==="investment-withdrawal";return o.jsxs("tr",{className:"border-b border-gray-200/50 hover:bg-gray-50",children:[o.jsx("td",{className:"p-3",children:x.date}),o.jsx("td",{className:"p-3",children:M(x.paymentMethod)}),o.jsx("td",{className:"p-3",children:F(x.type)}),o.jsxs("td",{className:`p-3 font-semibold number-display ${B?"text-emerald-500":"text-red-500"}`,children:[B?"+":"-"," ",se(x.amount)]}),o.jsx("td",{className:"p-3",children:D?`${D.icon} ${D.name}`:"غير محدد"}),o.jsx("td",{className:"p-3 text-slate-500 hidden sm:table-cell",children:x.description||"-"}),o.jsx("td",{className:"p-3 text-center",children:o.jsxs("div",{className:"flex gap-2 justify-center",children:[o.jsx("button",{onClick:()=>r(x.id),className:"text-slate-400 hover:text-blue-500 p-1 transition-colors",title:"تعديل الحركة",children:"✏️"}),o.jsx("button",{onClick:()=>s(x.id),className:"text-slate-400 hover:text-red-500 p-1 transition-colors",title:"حذف الحركة",children:o.jsx(at,{})})]})})]},x.id)})})]}),j.length===0&&o.jsxs("div",{className:"text-center p-8 text-slate-500",children:[o.jsx("p",{children:"لا توجد معاملات تطابق الفلاتر المحددة."}),o.jsx("p",{className:"text-xs mt-1",children:"جرب توسيع النطاق الزمني أو تعديل الفلاتر الأخرى."})]})]})]})})},ef=()=>o.jsxs("div",{className:"ai-bubble chat-bubble typing-indicator flex items-center space-x-1 p-3 self-start",children:[o.jsx("span",{className:"block w-2 h-2 bg-gray-400 rounded-full animate-pulse [animation-delay:-0.3s]"}),o.jsx("span",{className:"block w-2 h-2 bg-gray-400 rounded-full animate-pulse [animation-delay:-0.15s]"}),o.jsx("span",{className:"block w-2 h-2 bg-gray-400 rounded-full animate-pulse"})]}),tf=({calculations:t,filteredTransactions:e,allTransactions:n,state:s,darkMode:r=!1,language:l="ar"})=>{const[d,c]=V.useState([]),[f,u]=V.useState(""),[m,p]=V.useState(!1),[h,v]=V.useState(null),[E,A]=V.useState(!1),I=V.useRef(null);V.useEffect(()=>{var P;(P=I.current)==null||P.scrollTo(0,I.current.scrollHeight)},[d,m]),V.useEffect(()=>{(async()=>{if(!E){console.log("🌍 بدء كشف الموقع الجغرافي...");const N=await Tu();if(N.success&&N.location){v(N.location),console.log("✅ تم كشف الموقع:",N.location);const T=R(N.location);c([T])}else{console.log("⚠️ فشل في كشف الموقع، استخدام الافتراضي");const T=R();c([T])}A(!0)}})()},[E]);const R=P=>{const N=P?`📍 **تم كشف موقعك:** ${P.city}, ${P.region}`:"📍 **الموقع:** لم يتم كشف الموقع (استخدام الافتراضي)",T=(P==null?void 0:P.city)||"الرياض",M=(P==null?void 0:P.country)||"السعودية";return{id:"1",text:`مرحباً! أنا مساعدك الذكي 🤖✨

${N}

🔍 **يمكنني مساعدتك في:**
• تحليل بياناتك المالية عبر جميع الأشهر
• البحث عن أفضل العروض والأسعار في ${T} و${M}
• مقارنة الأسعار والمطاعم في منطقتك

💬 **اسألني مثلاً:**
• "كم صرفت هذا الشهر؟"
• "أين أفضل عروض في ${T}؟"
• "كم سعر الهاتف في سوق اليوم؟"
• "أفضل مطاعم في منطقتي"

ماذا تريد أن تعرف؟ 😊`,sender:"ai"}},k=async P=>{P.preventDefault();const N=f.trim();if(!N||m)return;const T={id:Date.now().toString(),text:N,sender:"user"};c(M=>[...M,T]),u(""),p(!0);try{let M="";const F=["أين","كم سعر","عروض","محل","مطعم","بنده","تميمي","كارفور","عروض","سعر","أفضل","تقييم","مطاعم","متاجر","عرض","أرخص","غالي","السوق","متجر","مطعم","مقهى","كوفي","برجر","بيتزا","شاورما","دجاج","لحم","سمك","أكل","طعام","شراب","مشروب","قهوة","شاي"],j=["مصروف","دخل","ديون","بطاقة","شهر","تحليل","نمط","إنفاق","رصيد","قرض","قسط","استثمار","مالي","حساب","صرفت","وصل","تحويل","دفع","قسط","باقي","متوسط","إجمالي","شهر","أسبوع","سنة","مقارنة","تغير","زيادة","نقص","أعلى","أقل"],L=F.some(B=>N.toLowerCase().includes(B.toLowerCase())),x=j.some(B=>N.toLowerCase().includes(B.toLowerCase()));if(L)M=await Qo(N,h||void 0);else if(x){const B={currentPeriod:{calculations:t,transactions:e},allHistoricalData:{allTransactions:n,categories:s.categories,cards:s.cards,bankAccounts:s.bankAccounts,loans:s.loans,installments:s.installments,investments:s.investments},state:s};M=await Xo(N,B,h||void 0)}else M=await Zo(N,n,t,h||void 0);const D={id:(Date.now()+1).toString(),text:M,sender:"ai"};c(B=>[...B,D])}catch(M){const F={id:(Date.now()+1).toString(),text:M instanceof Error?M.message:"عذراً، حدث خطأ ما. يرجى المحاولة مرة أخرى.",sender:"ai"};c(j=>[...j,F])}finally{p(!1)}};return o.jsxs("div",{className:"glass-card overflow-hidden flex flex-col",style:{height:"70vh"},children:[o.jsxs("div",{className:`p-4 ${r?"bg-slate-800":"bg-gray-100"} text-center flex-shrink-0`,children:[o.jsx("h3",{className:`text-xl font-bold ${r?"text-slate-100":"text-slate-900"}`,children:"🤖 المحلل الذكي"}),o.jsx("p",{className:`text-sm ${r?"text-slate-400":"text-slate-500"}`,children:"تحليل بياناتك المالية + البحث عن أفضل العروض في السعودية"})]}),o.jsxs("div",{ref:I,className:"p-4 flex-grow overflow-y-auto flex flex-col gap-4",children:[d.map(P=>o.jsx("div",{className:`chat-bubble ${P.sender==="user"?"user-bubble":"ai-bubble"}`,children:o.jsx("p",{dangerouslySetInnerHTML:{__html:P.text.replace(/\n/g,"<br />")}})},P.id)),m&&o.jsx(ef,{})]}),o.jsx("div",{className:"p-4 border-t border-gray-200 flex-shrink-0",children:o.jsxs("form",{onSubmit:k,className:"flex gap-2",children:[o.jsx("input",{type:"text",value:f,onChange:P=>u(P.target.value),className:"w-full p-3",placeholder:"اكتب سؤالك هنا...",required:!0,autoComplete:"off",disabled:m}),o.jsx("button",{type:"submit",disabled:m,className:"p-3 magical-button text-white rounded-lg flex-shrink-0 disabled:opacity-50",children:o.jsx(ni,{})})]})})]})},nf=({calculations:t,categories:e,allTransactions:n,darkMode:s=!1,language:r="ar"})=>{const l=V.useRef(null),d=V.useRef(null),c=V.useRef({}),f=V.useMemo(()=>Object.entries(t.expensesByCategory).map(([m,p])=>{const h=e.find(v=>v.id===m);return{name:h?`${h.icon} ${h.name}`:"غير محدد",value:p}}).sort((m,p)=>p.value-m.value),[t.expensesByCategory,e]),u=V.useMemo(()=>{const m={},p=new Date;for(let h=5;h>=0;h--){const E=new Date(p.getFullYear(),p.getMonth()-h,1).toLocaleString("en-US",{month:"short",year:"numeric"});m[E]={income:0,expenses:0}}return n.forEach(h=>{const E=new Date(h.date).toLocaleString("en-US",{month:"short",year:"numeric"});m[E]&&(h.type==="income"&&(m[E].income+=h.amount),(h.type==="expense"||h.type==="bnpl-payment")&&(m[E].expenses+=h.amount))}),{labels:Object.keys(m),incomeData:Object.values(m).map(h=>h.income),expensesData:Object.values(m).map(h=>h.expenses)}},[n]);return V.useEffect(()=>{var p,h;const m=window.Chart;if(m){if((p=c.current.pie)==null||p.destroy(),(h=c.current.bar)==null||h.destroy(),l.current&&f.length>0){const v=l.current.getContext("2d");v&&(c.current.pie=new m(v,{type:"doughnut",data:{labels:f.map(E=>E.name),datasets:[{data:f.map(E=>E.value),backgroundColor:["#3b82f6","#60a5fa","#93c5fd","#bfdbfe","#d1d5db","#9ca3af","#6b7280"],borderColor:"#ffffff",borderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"right",labels:{color:"#475569",font:{family:"Cairo"}}}}}}))}if(d.current&&u.labels.length>0){const v=d.current.getContext("2d");v&&(c.current.bar=new m(v,{type:"bar",data:{labels:u.labels,datasets:[{label:"الدخل",data:u.incomeData,backgroundColor:"#10b981",borderRadius:4},{label:"المصاريف",data:u.expensesData,backgroundColor:"#ef4444",borderRadius:4}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{ticks:{color:"#64748b"},grid:{color:"#e2e8f0"}},x:{ticks:{color:"#64748b"},grid:{display:!1}}},plugins:{legend:{labels:{color:"#475569",font:{family:"Cairo"}}}}}}))}return()=>{var v,E;(v=c.current.pie)==null||v.destroy(),(E=c.current.bar)==null||E.destroy()}}},[f,u]),o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 animate-fade-in",children:[o.jsxs("div",{className:"glass-card p-6",children:[o.jsx("h3",{className:"text-xl font-bold mb-4 text-slate-900 dark:text-slate-100",children:"📊 توزيع مصاريف الفترة"}),o.jsx("div",{className:"h-80",children:f.length>0?o.jsx("canvas",{ref:l}):o.jsx("p",{className:"text-center text-slate-500 dark:text-slate-400 mt-10",children:"لا توجد مصاريف لعرضها."})})]}),o.jsxs("div",{className:"glass-card p-6",children:[o.jsx("h3",{className:"text-xl font-bold mb-4 text-slate-900 dark:text-slate-100",children:"📈 الدخل مقابل المصاريف (آخر 6 أشهر)"}),o.jsx("div",{className:"h-80",children:o.jsx("canvas",{ref:d})})]})]})},sf=({state:t,setLoading:e,setModal:n,darkMode:s=!1,language:r="ar"})=>{const[l,d]=V.useState(""),[c,f]=V.useState(""),u=async()=>{const m=parseFloat(l);if(isNaN(m)||m<=0){n({title:q("error",r),body:`<p>${q("invalid.amount",r)}</p>`,confirmText:q("confirm",r),hideCancel:!0});return}e(!0,q("loading",r)),f("");try{const p=new Date;p.setDate(p.getDate()-60);const h=t.transactions.filter(E=>new Date(E.date)>=p&&E.type==="expense");if(h.length<5)throw new Error("لا توجد بيانات كافية عن إنفاقك لإنشاء خطة دقيقة. يرجى إضافة 5 معاملات على الأقل.");const v=await zo(m,t.categories,h);f(v)}catch(p){const h=p instanceof Error?p.message:"حدث خطأ غير متوقع.";n({title:q("error",r),body:`<p>${h}</p>`,confirmText:q("confirm",r),hideCancel:!0})}finally{e(!1)}};return o.jsxs("div",{className:"glass-card p-6 animate-fade-in",children:[o.jsxs("h3",{className:`text-xl font-bold mb-4 ${s?"text-slate-200":"text-slate-900"}`,children:["✨ ",q("budget",r)]}),o.jsxs("div",{className:`flex flex-col sm:flex-row items-end gap-4 mb-6 p-4 rounded-lg ${s?"bg-slate-700":"bg-slate-100"}`,children:[o.jsxs("div",{className:"flex-grow",children:[o.jsx("label",{htmlFor:"monthly-budget-input",className:`block text-sm font-medium mb-1 ${s?"text-slate-300":"text-slate-600"}`,children:q("budget.limit",r)}),o.jsx("input",{type:"number",id:"monthly-budget-input",className:`w-full p-2 ${s?"bg-slate-600 text-slate-200 border-slate-500":"bg-white text-slate-900 border-gray-300"} border rounded`,placeholder:"5000",value:l,onChange:m=>d(m.target.value)})]}),o.jsxs("button",{onClick:u,className:"w-full sm:w-auto px-6 py-2 magical-button text-white rounded-lg font-semibold flex-shrink-0",children:["✨ ",q("generate.report",r)]})]}),o.jsx("div",{className:"prose max-w-none",children:c?o.jsx("div",{className:s?"text-slate-200":"text-slate-900",dangerouslySetInnerHTML:{__html:c.replace(/### (.*)/g,`<h4 class="text-lg font-bold ${s?"text-slate-200":"text-slate-900"} mt-3 mb-2">$1</h4>`).replace(/\n/g,"<br />")}}):o.jsx("p",{className:`text-center ${s?"text-slate-400":"text-slate-500"}`,children:q("no.data",r)})})]})},of=({state:t,setState:e,calculations:n,setModal:s,darkMode:r=!1,language:l="ar"})=>{const[d,c]=V.useState([{id:"1",text:`مرحباً! أنا مستشارك الاستثماري الذكي 🎯📈

💼 **خبرتي تشمل:**
• تحليل شامل لسوق تداول السعودي
• استراتيجيات استثمارية متقدمة
• إدارة المخاطر وتحسين المحافظ
• توصيات أسهم محددة مع تحليل عميق

📊 **يمكنني مساعدتك في:**
• تحليل محفظتك الحالية وتحسينها
• توصيات أسهم مع أهداف سعرية واضحة
• قراءة السوق وتوقعات الاتجاهات
• استراتيجيات دخول وخروج محددة

💡 **اسألني مثلاً:**
• "ما رأيك في أسهم أرامكو الآن؟"
• "كيف أحسن محفظتي الاستثمارية؟"
• "ما هي أفضل القطاعات للاستثمار؟"
• "أريد تحليل شامل لسوق اليوم"

أخبرني عن محفظتك وأهدافك الاستثمارية! 🚀`,sender:"ai"}]),[f,u]=V.useState(""),[m,p]=V.useState(!1),h=V.useRef(null);V.useEffect(()=>{var I;(I=h.current)==null||I.scrollTo(0,h.current.scrollHeight)},[d,m]);const v=I=>{I.preventDefault();const R=I.target,k=parseFloat(R.elements.namedItem("investment-amount").value),P=R.elements.namedItem("investment-type").value,N=R.elements.namedItem("payment-method").value;if(isNaN(k)||k<=0){s({title:"خطأ",body:"<p>الرجاء إدخال مبلغ صحيح.</p>"});return}const T={amount:k,date:new Date().toISOString().split("T")[0],description:P==="deposit"?"إيداع في المحفظة الاستثمارية":"سحب من المحفظة الاستثمارية",paymentMethod:N,type:P==="deposit"?"investment-deposit":"investment-withdrawal",categoryId:null};e(M=>({...M,transactions:[...M.transactions,{...T,id:`trans-${Date.now()}`}]})),R.reset()},E=async I=>{I.preventDefault();const R=f.trim();if(!(!R||m)){c(k=>[...k,{id:Date.now().toString(),text:R,sender:"user"}]),u(""),p(!0);try{const k={currentValue:t.investments.currentValue,totalDeposited:t.investments.totalDeposited,totalWithdrawn:t.investments.totalWithdrawn,transactions:t.transactions.filter(N=>N.type==="investment-deposit"||N.type==="investment-withdrawal"),recentPerformance:n.investments},P=await ei(R,k,{marketDate:new Date().toLocaleDateString("en-CA"),saudiMarketContext:"Tadawul analysis requested",userInvestmentHistory:k});c(N=>[...N,{id:(Date.now()+1).toString(),text:P,sender:"ai"}])}catch(k){c(P=>[...P,{id:(Date.now()+1).toString(),text:k instanceof Error?k.message:"عذراً، حدث خطأ في الاستشارة الاستثمارية.",sender:"ai"}])}finally{p(!1)}}},A=()=>{const I=`<div><label class="block text-sm font-medium text-slate-600 mb-1">القيمة الحالية للمحفظة (ريال)</label><input type="number" id="edit-investment-value" class="w-full p-2" value="${t.investments.currentValue}"><p class="text-xs text-slate-500 mt-2">أدخل القيمة السوقية الحالية لجميع استثماراتك.</p></div>`;s({show:!0,title:"تحديث قيمة المحفظة",body:I,confirmText:"حفظ",onConfirm:()=>{const R=parseFloat(document.getElementById("edit-investment-value").value);if(isNaN(R)||R<0)return alert("الرجاء إدخال قيمة صحيحة."),!1;e(k=>({...k,investments:{...k.investments,currentValue:R}}))}})};return o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 animate-fade-in",children:[o.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[o.jsxs("div",{className:"glass-card p-6 text-center",children:[o.jsx("h3",{className:"text-lg font-bold text-slate-900 mb-2",children:"💰 القيمة الحالية للمحفظة"}),o.jsx("p",{className:"text-4xl font-bold text-emerald-500 number-display",children:se(t.investments.currentValue)}),o.jsxs("p",{className:"text-sm text-slate-500 mt-2",children:["إجمالي المستثمر: ",o.jsx("span",{className:"font-semibold number-display text-slate-600",children:se(n.totalInvestmentDeposits)})]}),o.jsx("button",{onClick:A,className:"mt-4 w-full px-4 py-2 bg-slate-200 text-slate-800 rounded-lg hover:bg-slate-300 transition-colors text-sm",children:"✏️ تحديث القيمة الحالية"})]}),o.jsxs("div",{className:"glass-card p-6",children:[o.jsx("h3",{className:"text-lg font-bold text-slate-900 mb-4",children:"💸 إضافة حركة استثمارية"}),o.jsxs("form",{onSubmit:v,className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"investment-amount",className:"block text-sm font-medium text-slate-600",children:"المبلغ"}),o.jsx("input",{type:"number",id:"investment-amount",name:"investment-amount",className:"mt-1 w-full p-2",required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"investment-type",className:"block text-sm font-medium text-slate-600",children:"نوع الحركة"}),o.jsxs("select",{id:"investment-type",name:"investment-type",className:"mt-1 w-full p-2",children:[o.jsx("option",{value:"deposit",children:"إيداع للمحفظة"}),o.jsx("option",{value:"withdrawal",children:"سحب من المحفظة"})]})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"payment-method",className:"block text-sm font-medium text-slate-600",children:"الحساب البنكي"}),o.jsx("select",{id:"payment-method",name:"payment-method",className:"mt-1 w-full p-2",children:Object.values(t.bankAccounts).map(I=>o.jsxs("option",{value:I.id,children:["🏦 ",I.name]},I.id))})]}),o.jsx("button",{type:"submit",className:"w-full magical-button text-white font-semibold py-2 rounded-lg",children:"تنفيذ الحركة"})]})]})]}),o.jsxs("div",{className:"lg:col-span-2 glass-card overflow-hidden flex flex-col",style:{height:"75vh"},children:[o.jsxs("div",{className:`p-4 ${r?"bg-slate-800":"bg-gray-100"} text-center flex-shrink-0`,children:[o.jsx("h3",{className:`text-xl font-bold ${r?"text-slate-100":"text-slate-900"}`,children:"🎯 مستشارك الاستثماري المتقدم"}),o.jsx("p",{className:`text-sm ${r?"text-slate-400":"text-slate-500"}`,children:"تحليل السوق + توصيات أسهم + إدارة المحافظ"})]}),o.jsxs("div",{ref:h,className:"p-4 flex-grow overflow-y-auto flex flex-col gap-4",children:[d.map(I=>o.jsx("div",{className:`chat-bubble ${I.sender==="user"?"user-bubble":"ai-bubble"}`,dangerouslySetInnerHTML:{__html:I.text.replace(/\n/g,"<br/>")}},I.id)),m&&o.jsxs("div",{className:"ai-bubble chat-bubble typing-indicator flex items-center space-x-1 p-3 self-start",children:[o.jsx("span",{className:"block w-2 h-2 bg-gray-400 rounded-full animate-pulse [animation-delay:-0.3s]"}),o.jsx("span",{className:"block w-2 h-2 bg-gray-400 rounded-full animate-pulse [animation-delay:-0.15s]"}),o.jsx("span",{className:"block w-2 h-2 bg-gray-400 rounded-full animate-pulse"})]})]}),o.jsx("div",{className:"p-4 border-t border-gray-200 flex-shrink-0",children:o.jsxs("form",{onSubmit:E,className:"flex gap-2",children:[o.jsx("input",{type:"text",value:f,onChange:I=>u(I.target.value),className:"w-full p-3",placeholder:"اسأل عن الاستثمار...",required:!0,autoComplete:"off",disabled:m}),o.jsx("button",{type:"submit",className:"p-3 magical-button text-white rounded-lg flex-shrink-0",disabled:m,children:o.jsx(ni,{})})]})})]})]})},rf=({card:t,statementDetails:e,openCardFormModal:n,deleteCard:s})=>{const r=(l,d)=>!l||l.length===0?'<tr><td colspan="3" class="text-center text-slate-500 py-3">لا توجد حركات</td></tr>':l.map(c=>{var p;const f=((p=c.description)==null?void 0:p.includes(`سداد ${d.name}`))||c.type===`سداد ${d.name}`||c.type===`${d.id}-payment`,u=f?"text-green-500":"text-red-500",m=f?"+":"";return`
                <tr class="hover:bg-slate-50">
                    <td class="p-2">${c.postingDate||c.date}</td>
                    <td class="p-2 truncate" title="${c.description}">${c.description}</td>
                    <td class="p-2 number-display ${u}">${m}${se(c.amount)}</td>
                </tr>
            `}).join("");return o.jsxs("div",{className:"bg-white p-6 rounded-xl border border-gray-200 shadow-sm hover:shadow-md transition-shadow flex flex-col",children:[o.jsxs("div",{className:"flex items-start justify-between mb-4",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:o.jsx("span",{className:"text-blue-600 text-xl",children:"💳"})}),o.jsx("h3",{className:"text-xl font-bold text-slate-900",children:t.name})]}),o.jsxs("div",{className:"flex gap-2 flex-shrink-0",children:[o.jsx("button",{onClick:()=>n(t.id),className:"text-sm bg-white/80 hover:bg-white w-8 h-8 rounded-full flex items-center justify-center transition-colors shadow-sm","aria-label":`تعديل بطاقة ${t.name}`,children:"✏️"}),o.jsx("button",{onClick:()=>s(t.id),className:"text-sm bg-red-100 hover:bg-red-200 w-8 h-8 rounded-full flex items-center justify-center transition-colors","aria-label":`حذف بطاقة ${t.name}`,children:o.jsx(at,{})})]})]}),o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{className:"bg-amber-50 p-4 rounded-lg border border-amber-200 shadow-sm",children:[o.jsxs("div",{className:"flex justify-between items-center mb-2",children:[o.jsx("span",{className:"text-amber-700 text-sm font-medium",children:"المبلغ المستحق للكشف الحالي"}),o.jsx("div",{className:"w-8 h-8 bg-amber-100 rounded-full flex items-center justify-center",children:o.jsx("span",{className:"text-amber-600 text-lg",children:"📅"})})]}),o.jsx("div",{className:"bg-white p-3 rounded-lg border border-amber-200 mb-2",children:o.jsxs("p",{className:"font-bold text-2xl text-amber-800 number-display text-center",children:[se(e.statementDueAmount)," ريال"]})}),o.jsxs("div",{className:"flex justify-between items-center text-xs",children:[o.jsx("span",{className:"text-amber-600 font-medium",children:"تاريخ الاستحقاق:"}),o.jsx("span",{className:"font-semibold text-amber-700 bg-amber-100 px-2 py-1 rounded",children:e.dueDate.toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})})]})]}),o.jsx("div",{className:"bg-slate-50 p-4 rounded-lg border border-gray-200",children:o.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[o.jsxs("div",{className:"p-3 bg-red-50 rounded-lg border border-red-200 text-center",children:[o.jsx("p",{className:"text-red-700 text-sm font-medium mb-1",children:"الرصيد الإجمالي المستحق"}),o.jsxs("p",{className:"font-bold text-red-800 number-display",children:[se(t.balance)," ريال"]})]}),o.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg border border-blue-200 text-center",children:[o.jsx("p",{className:"text-blue-700 text-sm font-medium mb-1",children:"الحد الائتماني"}),o.jsxs("p",{className:"font-bold text-blue-800 number-display",children:[se(t.limit)," ريال"]})]}),o.jsxs("div",{className:"p-3 bg-green-50 rounded-lg border border-green-200 text-center",children:[o.jsx("p",{className:"text-green-700 text-sm font-medium mb-1",children:"الرصيد المتاح"}),o.jsxs("p",{className:"font-bold text-green-800 number-display",children:[se(t.available)," ريال"]})]}),o.jsxs("div",{className:"p-3 bg-orange-50 rounded-lg border border-orange-200 text-center",children:[o.jsx("p",{className:"text-orange-700 text-sm font-medium mb-1",children:"نسبة الاستخدام"}),o.jsxs("p",{className:`font-bold ${t.usagePercentage>80?"text-red-800":t.usagePercentage>60?"text-yellow-800":"text-green-800"}`,children:[t.usagePercentage.toFixed(1),"%"]})]})]})})]}),o.jsxs("div",{className:"mt-4 flex-grow flex flex-col",children:[o.jsxs("h4",{className:"font-semibold text-slate-600 mb-2 border-b border-slate-200 pb-1",children:["المعاملات القادمة (",e.upcomingTransactions.length,")"]}),o.jsx("div",{className:"flex-grow max-h-32 overflow-y-auto",children:o.jsx("table",{className:"w-full text-xs",dangerouslySetInnerHTML:{__html:`<tbody>${r(e.upcomingTransactions,t)}</tbody>`}})})]})]})},af=({state:t,calculations:e,openCardFormModal:n,deleteCard:s})=>{const r=V.useMemo(()=>{const d={};return Object.values(t.cards).forEach(c=>{const f=new Date,u=f.getDate(),m=f.getMonth(),p=f.getFullYear();let h,v,E;u>c.statementDay?h=new Date(p,m,c.statementDay):h=new Date(p,m-1,c.statementDay),v=new Date(h.getFullYear(),h.getMonth()-1,c.statementDay+1);let A=h.getMonth()+1,I=h.getFullYear();A>11&&(A=0,I+=1),E=new Date(I,A,c.dueDay);const R=t.transactions.filter(N=>{const T=new Date(N.postingDate||N.date);return N.paymentMethod===c.id&&(N.type==="expense"||N.type==="bnpl-payment")&&T>=v&&T<=h}),k=t.transactions.filter(N=>{var L,x,D,B,ne,me,ie;const T=new Date(N.postingDate||N.date),M=N.paymentMethod===c.id&&(N.type==="expense"||N.type==="bnpl-payment"),F=(((L=N.description)==null?void 0:L.includes(`سداد ${c.name}`))||N.type===`سداد ${c.name}`||N.type===`${c.id}-payment`)&&(N.type==="expense"||((x=N.type)==null?void 0:x.includes("سداد"))||((D=N.type)==null?void 0:D.includes("-payment"))),j=N.paymentMethod===c.id&&(((B=N.description)==null?void 0:B.includes("سداد"))||((ne=N.type)==null?void 0:ne.includes("سداد"))||((me=N.type)==null?void 0:me.includes("-payment")))&&!((ie=N.description)!=null&&ie.includes(c.name))&&N.type!==`سداد ${c.name}`&&N.type!==`${c.id}-payment`;return(M||F||j)&&T>h}),P=R.reduce((N,T)=>N+T.amount,0);d[c.id]={statementDueAmount:P,dueDate:E,totalOutstanding:0,upcomingTransactions:k}}),d},[t.transactions,t.cards]),l=Object.values(t.cards);return o.jsxs("div",{className:"space-y-6 animate-fade-in",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:"إدارة البطاقات"}),o.jsx("button",{onClick:()=>n(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold",children:"+ إضافة بطاقة"})]}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:l.map(d=>{const c=e.cardDetails[d.id];return o.jsx(rf,{card:c,statementDetails:r[c.id],openCardFormModal:n,deleteCard:s},c.id)})})]})},lf=(t,e)=>{const n={income:"💰 دخل",expense:"💸 مصاريف","bnpl-payment":"📱 سداد قسط","investment-deposit":"💹 إيداع استثماري","investment-withdrawal":"💹 سحب استثماري"};if(n[t])return n[t];if(t.endsWith("-payment")){const s=t.replace("-payment","");if(e.cards[s])return`💳 سداد ${e.cards[s].name}`}return t},df=({account:t,openBankAccountFormModal:e,deleteBankAccount:n})=>o.jsxs("div",{className:"bg-white p-6 rounded-xl border border-gray-200 shadow-sm hover:shadow-md transition-shadow",children:[o.jsxs("div",{className:"flex justify-between items-start mb-4",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:o.jsx("span",{className:"text-blue-600 text-xl",children:"🏦"})}),o.jsx("h4",{className:"text-xl font-bold text-slate-900",children:t.name})]}),o.jsxs("div",{className:"flex gap-2 flex-shrink-0",children:[o.jsx("button",{onClick:()=>e(t.id),className:"text-sm bg-white/80 hover:bg-white w-8 h-8 rounded-full flex items-center justify-center transition-colors shadow-sm","aria-label":`تعديل حساب ${t.name}`,children:"✏️"}),o.jsx("button",{onClick:()=>n(t.id),className:"text-sm bg-red-100 hover:bg-red-200 w-8 h-8 rounded-full flex items-center justify-center transition-colors","aria-label":`حذف حساب ${t.name}`,children:o.jsx(at,{})})]})]}),o.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200 shadow-sm mb-4",children:[o.jsx("p",{className:"text-blue-700 font-semibold text-center mb-2",children:"الرصيد الحالي"}),o.jsx("p",{className:"text-3xl font-bold text-blue-900 number-display text-center",children:se(t.balance)})]}),o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{className:"bg-emerald-50 p-3 rounded-lg border border-emerald-200 text-center",children:[o.jsx("p",{className:"text-emerald-700 font-semibold text-sm mb-1",children:"إيداعات الفترة"}),o.jsx("p",{className:"text-lg font-bold text-emerald-800 number-display",children:se(t.deposits)})]}),o.jsxs("div",{className:"bg-red-50 p-3 rounded-lg border border-red-200 text-center",children:[o.jsx("p",{className:"text-red-700 font-semibold text-sm mb-1",children:"سحوبات الفترة"}),o.jsx("p",{className:"text-lg font-bold text-red-800 number-display",children:se(t.withdrawals)})]})]})]}),cf=({state:t,setState:e,calculations:n,filteredTransactions:s,categories:r,setModal:l,openBankAccountFormModal:d,deleteBankAccount:c,openTransferModal:f})=>o.jsxs("div",{className:"space-y-6 animate-fade-in",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:"إدارة الحسابات البنكية"}),o.jsxs("div",{className:"flex gap-3",children:[Object.keys(t.bankAccounts).length>1&&o.jsx("button",{onClick:f,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-semibold",children:"💸 تحويل بين الحسابات"}),o.jsx("button",{onClick:()=>d(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold",children:"+ إضافة حساب"})]})]}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:Object.values(n.bankAccountDetails).map(u=>o.jsx(df,{account:u,openBankAccountFormModal:d,deleteBankAccount:c},u.id))}),o.jsxs("div",{className:"glass-card p-6",children:[o.jsx("h3",{className:"text-xl font-bold mb-4 text-slate-900",children:"📋 معاملات الحسابات البنكية (الفترة المحددة)"}),o.jsx("div",{className:"overflow-x-auto",children:o.jsxs("table",{className:"w-full text-sm",children:[o.jsx("thead",{className:"border-b border-gray-200",children:o.jsxs("tr",{children:[o.jsx("th",{className:"text-right p-3 font-semibold",children:"التاريخ"}),o.jsx("th",{className:"text-right p-3 font-semibold",children:"الحساب"}),o.jsx("th",{className:"text-right p-3 font-semibold",children:"النوع"}),o.jsx("th",{className:"text-right p-3 font-semibold",children:"المبلغ"}),o.jsx("th",{className:"text-right p-3 font-semibold",children:"الفئة"}),o.jsx("th",{className:"text-right p-3 font-semibold",children:"الوصف"})]})}),o.jsx("tbody",{children:s.filter(u=>t.bankAccounts[u.paymentMethod]).sort((u,m)=>new Date(m.date).getTime()-new Date(u.date).getTime()).map(u=>{var v;const m=["income","investment-withdrawal"].includes(u.type),p=m?"text-emerald-500":"text-red-500",h=r.find(E=>E.id===u.categoryId);return o.jsxs("tr",{className:"border-b border-gray-200/50",children:[o.jsx("td",{className:"p-3",children:u.date}),o.jsx("td",{className:"p-3",children:(v=t.bankAccounts[u.paymentMethod])==null?void 0:v.name}),o.jsx("td",{className:"p-3",children:lf(u.type,t)}),o.jsxs("td",{className:`p-3 font-semibold ${p} number-display`,children:[m?"+":"-",se(u.amount)]}),o.jsx("td",{className:"p-3",children:h?`${h.icon} ${h.name}`:"-"}),o.jsx("td",{className:"p-3 text-slate-500",children:u.description||"-"})]},u.id)})})]})})]})]}),Zt=(t,e)=>{const n={cash:"💵 نقدي","tabby-bnpl":"📱 تابي","tamara-bnpl":"📱 تمارا",reconciliation:"🔄 تسوية"};return n[t]?n[t]:e.cards[t]?`💳 ${e.cards[t].name}`:e.bankAccounts[t]?`🏦 ${e.bankAccounts[t].name}`:t},uf=({state:t,setState:e,filteredTransactions:n,setModal:s,darkMode:r=!1,language:l="ar"})=>{const[d,c]=Dn.useState(!1),f=()=>{const N=t.installments.filter(x=>x.paid<x.total),T=N.filter(x=>x.provider==="tabby-bnpl"),M=N.filter(x=>x.provider==="tamara-bnpl"),F=T.reduce((x,D)=>{const B=D.total-D.paid;return x+D.installmentAmount*B},0),j=M.reduce((x,D)=>{const B=D.total-D.paid;return x+D.installmentAmount*B},0),L=F+j;return{tabbyTotal:F,tamaraTotal:j,grandTotal:L,activeCount:N.length,completedCount:t.installments.filter(x=>x.paid>=x.total).length}},u=()=>{const N=t.installments.filter(F=>F.paid<F.total);if(N.length===0)return null;const T=t.transactions.filter(F=>F.isInstallmentPayment);if(T.length===0){const F=N.sort((x,D)=>new Date(x.createdAt).getTime()-new Date(D.createdAt).getTime())[0],j=new Date(F.createdAt),L=new Date(j);return L.setDate(L.getDate()+30),L.toISOString().split("T")[0]}let M=null;for(const F of N){const j=T.filter(L=>L.installmentId===F.id).sort((L,x)=>new Date(x.date).getTime()-new Date(L.date).getTime());if(j.length>0){const L=j[0],x=new Date(L.date),D=new Date(x);D.setDate(D.getDate()+30),(!M||D<new Date(M))&&(M=D.toISOString().split("T")[0])}else{const L=new Date(F.createdAt),x=new Date(L);x.setDate(x.getDate()+30),(!M||x<new Date(M))&&(M=x.toISOString().split("T")[0])}}return M},m=()=>t.installments.filter(T=>T.paid<T.total).reduce((T,M)=>T+M.installmentAmount,0),p=()=>{const N=t.installments.filter(M=>M.paid<M.total),T=t.transactions.filter(M=>M.isInstallmentPayment);return N.map(M=>{const F=T.filter(L=>L.installmentId===M.id).sort((L,x)=>new Date(x.date).getTime()-new Date(L.date).getTime());let j;if(F.length>0){const L=F[0],x=new Date(L.date),D=new Date(x);D.setDate(D.getDate()+30),j=D.toISOString().split("T")[0]}else{const L=new Date(M.createdAt),x=new Date(L);x.setDate(x.getDate()+30),j=x.toISOString().split("T")[0]}return{installment:M,nextPaymentDate:j}}).sort((M,F)=>new Date(M.nextPaymentDate).getTime()-new Date(F.nextPaymentDate).getTime())},h=N=>{const T=t.transactions.find(j=>j.id===N);if(!T||!T.isInstallmentPayment||!t.installments.find(j=>j.id===T.installmentId))return;const F=`
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-slate-600 mb-2">المبلغ</label>
                    <input type="number" id="edit-amount" value="${T.amount}" step="0.01" class="w-full p-3 border border-slate-300 rounded-lg" />
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-600 mb-2">التاريخ</label>
                    <input type="date" id="edit-date" value="${T.date}" class="w-full p-3 border border-slate-300 rounded-lg" />
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-600 mb-2">الوصف</label>
                    <input type="text" id="edit-description" value="${T.description}" class="w-full p-3 border border-slate-300 rounded-lg" />
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-600 mb-2">مصدر الدفع</label>
                    <select id="edit-payment-method" class="w-full p-3 border border-slate-300 rounded-lg">
                        ${Object.values(t.bankAccounts).map(j=>`<option value="${j.id}" ${T.paymentMethod===j.id?"selected":""}>🏦 ${j.name}</option>`).join("")}
                        <option value="cash" ${T.paymentMethod==="cash"?"selected":""}>💵 نقدي</option>
                        ${Object.values(t.cards).map(j=>`<option value="${j.id}" ${T.paymentMethod===j.id?"selected":""}>💳 ${j.name}</option>`).join("")}
                    </select>
                </div>
            </div>
        `;s({show:!0,title:"تعديل حركة القسط",body:F,confirmText:"حفظ التعديلات",onConfirm:()=>{const j=parseFloat(document.getElementById("edit-amount").value),L=document.getElementById("edit-date").value,x=document.getElementById("edit-description").value,D=document.getElementById("edit-payment-method").value;e(B=>({...B,transactions:B.transactions.map(ne=>ne.id===N?{...ne,amount:j,date:L,description:x,paymentMethod:D}:ne)})),s({show:!1})}})},v=N=>{const T=t.transactions.find(F=>F.id===N);if(!T||!T.isInstallmentPayment)return;s({show:!0,title:"حذف حركة القسط",body:"<p>هل أنت متأكد من حذف هذه الحركة؟ سيتم تقليل عدد الأقساط المدفوعة للقسط المرتبط.</p>",confirmText:"حذف",onConfirm:()=>{const F=T.installmentId;e(j=>({...j,transactions:j.transactions.filter(L=>L.id!==N),installments:j.installments.map(L=>L.id===F?{...L,paid:Math.max(0,L.paid-1)}:L)})),s({show:!1})}})},E=N=>{const T=t.installments.find(F=>F.id===N);if(!T)return;const M=`
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-slate-600 mb-2">وصف القسط</label>
                    <input type="text" id="edit-description" value="${T.description}" class="w-full p-3 border border-slate-300 rounded-lg" />
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-600 mb-2">قيمة القسط</label>
                    <input type="number" id="edit-amount" value="${T.installmentAmount}" step="0.01" class="w-full p-3 border border-slate-300 rounded-lg" />
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-600 mb-2">عدد الأقساط الإجمالي</label>
                    <input type="number" id="edit-total" value="${T.total}" min="1" class="w-full p-3 border border-slate-300 rounded-lg" />
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-600 mb-2">عدد الأقساط المدفوعة</label>
                    <input type="number" id="edit-paid" value="${T.paid}" min="0" max="${T.total}" class="w-full p-3 border border-slate-300 rounded-lg" />
                </div>
            </div>
        `;s({show:!0,title:"تعديل خطة القسط",body:M,confirmText:"حفظ التعديلات",onConfirm:()=>{const F=document.getElementById("edit-description").value,j=parseFloat(document.getElementById("edit-amount").value),L=parseInt(document.getElementById("edit-total").value),x=parseInt(document.getElementById("edit-paid").value);e(D=>({...D,installments:D.installments.map(B=>B.id===N?{...B,description:F,installmentAmount:j,total:L,paid:x}:B)})),s({show:!1})}})},A=N=>{const T=t.installments.find(F=>F.id===N);if(!T)return;const M=`<p>هل أنت متأكد من حذف خطة القسط "${T.description}"؟ سيتم حذف جميع الحركات المرتبطة بها.</p>`;s({show:!0,title:"حذف خطة القسط",body:M,confirmText:"حذف",onConfirm:()=>{e(F=>({...F,installments:F.installments.filter(j=>j.id!==N),transactions:F.transactions.filter(j=>j.installmentId!==N)})),s({show:!1})}})},I=N=>{const T=t.installments.find(j=>j.id===N);if(!T||T.paid>=T.total)return;let M="";Object.values(t.bankAccounts).forEach(j=>{M+=`<option value="${j.id}">🏦 ${j.name}</option>`}),M+='<option value="cash">💵 نقدي</option>',Object.values(t.cards).forEach(j=>{M+=`<option value="${j.id}">💳 ${j.name}</option>`});const F=`<p class="mb-4">اختر مصدر الدفع لسداد قسط "${T.description}" بقيمة ${se(T.installmentAmount)} ريال.</p><div><label for="installment-payment-source" class="block text-sm font-medium text-slate-600 mb-2">مصدر الدفع</label><select id="installment-payment-source" class="w-full p-3">${M}</select></div>`;s({show:!0,title:"سداد قسط",body:F,confirmText:"تأكيد الدفع",onConfirm:()=>{var B;const j=document.getElementById("installment-payment-source").value,L=t.categories.find(ne=>ne.name==="سداد فواتير"||ne.name==="💳 سداد فواتير"),x=(L==null?void 0:L.id)||((B=t.categories.find(ne=>ne.name==="أخرى"))==null?void 0:B.id)||"",D={id:"trans-"+Date.now(),amount:T.installmentAmount,date:new Date().toISOString().split("T")[0],description:`سداد القسط ${T.paid+1} لـ: ${T.description}`,paymentMethod:j,type:"bnpl-payment",categoryId:x,isInstallmentPayment:!0,installmentId:N};e(ne=>{const me=ne.installments.map(ie=>{if(ie.id===N){const le={...ie,paid:ie.paid+1};return console.log("🔄 تحديث قسط:",{id:ie.id,paid:ie.paid,newPaid:le.paid,total:ie.total}),le}return ie});return{...ne,transactions:[...ne.transactions,D],installments:me}})}})},R=t.installments.filter(N=>N.paid<N.total),k=t.transactions.filter(N=>N.isInstallmentPayment),P=f();return u(),m(),o.jsxs("div",{className:"animate-fade-in",children:[o.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-xl border border-blue-200 shadow-sm mb-6",children:[o.jsx("div",{className:"flex justify-between items-start mb-4",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center",children:o.jsx("span",{className:"text-blue-600 text-2xl",children:"📊"})}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-slate-100",children:"ملخص الأقساط"}),o.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"إجمالي الأقساط النشطة والمستحقة"})]})]})}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[o.jsxs("div",{className:"bg-white dark:bg-slate-800 p-4 rounded-lg border border-blue-200 dark:border-blue-800",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[o.jsx("span",{className:"text-2xl",children:"🎯"}),o.jsx("span",{className:"font-semibold text-blue-800",children:"إجمالي الأقساط"})]}),o.jsx("p",{className:"text-2xl font-bold text-blue-900",children:se(P.grandTotal)})]}),o.jsxs("div",{className:"bg-white dark:bg-slate-800 p-4 rounded-lg border border-blue-200 dark:border-blue-800",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[o.jsx("span",{className:"text-2xl",children:"📱"}),o.jsx("span",{className:"font-semibold text-blue-800",children:"تابي"})]}),o.jsx("p",{className:"text-xl font-bold text-blue-900",children:se(P.tabbyTotal)})]}),o.jsxs("div",{className:"bg-white dark:bg-slate-800 p-4 rounded-lg border border-blue-200 dark:border-blue-800",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[o.jsx("span",{className:"text-2xl",children:"📱"}),o.jsx("span",{className:"font-semibold text-blue-800",children:"تمارا"})]}),o.jsx("p",{className:"text-xl font-bold text-blue-900",children:se(P.tamaraTotal)})]})]}),p().length>0&&o.jsxs("div",{className:"bg-white p-4 rounded-lg border border-blue-200 mb-4",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[o.jsx("span",{className:"text-2xl",children:"⏰"}),o.jsxs("div",{children:[o.jsx("p",{className:"font-semibold text-blue-800",children:"مواعيد الأقساط التالية"}),o.jsx("p",{className:"text-sm text-slate-600",children:"أقرب المواعيد"})]})]}),o.jsx("div",{className:"space-y-2",children:p().slice(0,3).map((N,T)=>o.jsxs("div",{className:"flex justify-between items-center bg-slate-50 p-2 rounded",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-sm font-medium text-slate-700",children:N.installment.description}),o.jsx("p",{className:"text-xs text-slate-500",children:Zt(N.installment.provider,t)})]}),o.jsxs("div",{className:"text-right",children:[o.jsx("p",{className:"text-sm font-bold text-blue-900",children:new Date(N.nextPaymentDate).toLocaleDateString("en-GB")}),o.jsx("p",{className:"text-xs text-slate-600",children:se(N.installment.installmentAmount)})]})]},N.installment.id))})]}),o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsxs("div",{className:"flex gap-6",children:[o.jsxs("div",{className:"text-center",children:[o.jsx("p",{className:"text-2xl font-bold text-blue-900",children:P.activeCount}),o.jsx("p",{className:"text-sm text-slate-600",children:"أقساط نشطة"})]}),o.jsx("div",{className:"text-center",children:o.jsxs("button",{onClick:()=>c(!0),className:"text-center hover:bg-green-50 p-2 rounded-lg transition-colors",children:[o.jsx("p",{className:"text-2xl font-bold text-green-600",children:P.completedCount}),o.jsx("p",{className:"text-sm text-slate-600",children:"أقساط مكتملة"})]})})]}),p().length>0&&o.jsx("button",{onClick:()=>{t.installments.filter(T=>T.paid<T.total).forEach(T=>{I(T.id)})},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold",children:"💳 دفع جميع الأقساط"})]})]}),o.jsx("h3",{className:"text-2xl font-bold mb-4 text-slate-900 dark:text-slate-100",children:"📱 خطط الأقساط النشطة"}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:R.length>0?R.map(N=>{const T=N.paid/N.total*100;return console.log("📊 عرض قسط:",{id:N.id,paid:N.paid,total:N.total,progress:T}),o.jsxs("div",{className:"bg-white dark:bg-slate-800 p-4 rounded-xl border border-gray-200 dark:border-slate-700 shadow-sm hover:shadow-md transition-shadow",children:[o.jsxs("div",{className:"flex justify-between items-start mb-3",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:o.jsx("span",{className:"text-blue-600 text-lg",children:"📱"})}),o.jsxs("div",{children:[o.jsx("h4",{className:"font-bold text-slate-900 dark:text-slate-100",children:N.description}),o.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:Zt(N.provider,t)})]})]}),o.jsx("div",{className:"bg-blue-50 px-3 py-1 rounded-lg border border-blue-200",children:o.jsxs("span",{className:"font-bold text-blue-800 number-display text-sm",children:[se(N.installmentAmount),"/شهر"]})})]}),o.jsxs("div",{className:"bg-slate-50 dark:bg-slate-900/50 p-3 rounded-lg border border-gray-200 dark:border-slate-700 mb-3",children:[o.jsx("div",{className:"w-full bg-slate-200 rounded-full h-2.5 mb-2 overflow-hidden",children:o.jsx("div",{className:"bg-blue-700 h-2.5 rounded-full transition-all duration-500",style:{width:`${T}%`}})}),o.jsxs("div",{className:"flex justify-between text-xs text-slate-600 dark:text-slate-400",children:[o.jsxs("span",{className:"font-medium",children:[N.paid," / ",N.total," مدفوع"]}),o.jsxs("span",{className:"font-medium",children:["متبقي: ",N.total-N.paid]})]}),o.jsx("div",{className:"text-center mt-2",children:o.jsxs("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:[T.toFixed(1),"% مكتمل"]})})]}),o.jsxs("div",{className:"flex gap-2 mt-3",children:[o.jsx("button",{onClick:()=>I(N.id),className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all duration-300 text-sm shadow-md font-semibold",children:"💳 دفع القسط التالي"}),o.jsx("button",{onClick:()=>E(N.id),className:"px-3 py-2 bg-green-100 hover:bg-green-200 text-green-700 rounded-lg transition-colors text-sm",title:"تعديل القسط",children:"✏️"}),o.jsx("button",{onClick:()=>A(N.id),className:"px-3 py-2 bg-red-100 hover:bg-red-200 text-red-700 rounded-lg transition-colors text-sm",title:"حذف القسط",children:"🗑️"})]})]},N.id)}):o.jsx("div",{className:"md:col-span-2 text-center p-6 glass-card",children:o.jsx("p",{className:"text-slate-500",children:"🎉 لا توجد أقساط نشطة حاليًا!"})})}),o.jsxs("div",{className:"glass-card p-6 mt-8",children:[o.jsx("h3",{className:"text-xl font-bold mb-4 text-slate-900 dark:text-slate-100",children:"📋 سجل دفعات الأقساط"}),o.jsx("div",{className:"overflow-x-auto",children:o.jsxs("table",{className:"w-full text-sm",children:[o.jsx("thead",{className:"border-b border-gray-200 dark:border-slate-700",children:o.jsxs("tr",{children:[o.jsx("th",{className:"text-right p-3 font-semibold text-slate-600 dark:text-slate-400",children:"التاريخ"}),o.jsx("th",{className:"text-right p-3 font-semibold text-slate-600 dark:text-slate-400",children:"الوصف"}),o.jsx("th",{className:"text-right p-3 font-semibold text-slate-600 dark:text-slate-400",children:"المصدر"}),o.jsx("th",{className:"text-right p-3 font-semibold text-slate-600 dark:text-slate-400",children:"المبلغ"}),o.jsx("th",{className:"text-right p-3 font-semibold text-slate-600 dark:text-slate-400",children:"الإجراءات"})]})}),o.jsx("tbody",{children:k.sort((N,T)=>new Date(T.date).getTime()-new Date(N.date).getTime()).map(N=>o.jsxs("tr",{className:"border-b border-gray-200/50 dark:border-slate-700/50 text-slate-700 dark:text-slate-300",children:[o.jsx("td",{className:"p-3",children:new Date(N.date).toLocaleDateString("en-GB")}),o.jsx("td",{className:"p-3 text-slate-600 dark:text-slate-400",children:N.description}),o.jsx("td",{className:"p-3",children:Zt(N.paymentMethod,t)}),o.jsx("td",{className:"p-3 text-red-500 font-semibold number-display",children:se(N.amount)}),o.jsx("td",{className:"p-3",children:o.jsxs("div",{className:"flex gap-2",children:[o.jsx("button",{onClick:()=>h(N.id),className:"px-2 py-1 bg-blue-100 hover:bg-blue-200 text-blue-700 rounded text-xs transition-colors",title:"تعديل",children:"✏️"}),o.jsx("button",{onClick:()=>v(N.id),className:"px-2 py-1 bg-red-100 hover:bg-red-200 text-red-700 rounded text-xs transition-colors",title:"حذف",children:"🗑️"})]})})]},N.id))})]})})]}),d&&o.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[100] flex items-center justify-center p-4",children:o.jsx("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl animate-fade-in max-h-[90vh] overflow-y-auto",onClick:N=>N.stopPropagation(),children:o.jsxs("div",{className:"p-6",children:[o.jsxs("div",{className:"flex justify-between items-center mb-6",children:[o.jsx("h3",{className:"text-xl font-bold text-slate-800",children:"✅ الأقساط المكتملة"}),o.jsx("button",{onClick:()=>c(!1),className:"text-slate-400 hover:text-slate-600",children:"✕"})]}),o.jsxs("div",{className:"space-y-4",children:[Object.values(t.installments).filter(N=>N.paid>=N.total).map(N=>o.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:[o.jsxs("div",{className:"flex justify-between items-start mb-2",children:[o.jsxs("div",{children:[o.jsx("h4",{className:"font-bold text-green-800",children:N.description}),o.jsx("p",{className:"text-sm text-green-600",children:Zt(N.provider,t)})]}),o.jsx("span",{className:"bg-green-200 text-green-800 px-2 py-1 rounded-full text-xs font-medium",children:"مكتمل"})]}),o.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[o.jsxs("div",{className:"bg-white p-3 rounded-lg",children:[o.jsx("p",{className:"text-green-700 font-bold text-lg",children:N.total}),o.jsx("p",{className:"text-green-600 text-sm",children:"إجمالي الأقساط"})]}),o.jsxs("div",{className:"bg-white p-3 rounded-lg",children:[o.jsx("p",{className:"text-green-700 font-bold text-lg",children:se(N.installmentAmount)}),o.jsx("p",{className:"text-green-600 text-sm",children:"قيمة القسط"})]}),o.jsxs("div",{className:"bg-white p-3 rounded-lg",children:[o.jsx("p",{className:"text-green-700 font-bold text-lg",children:se(N.total*N.installmentAmount)}),o.jsx("p",{className:"text-green-600 text-sm",children:"المجموع الكلي"})]})]})]},N.id)),Object.values(t.installments).filter(N=>N.paid>=N.total).length===0&&o.jsxs("div",{className:"text-center py-12 text-slate-500",children:[o.jsx("div",{className:"text-6xl mb-4",children:"🎉"}),o.jsx("p",{className:"text-lg",children:"لا توجد أقساط مكتملة حالياً"}),o.jsx("p",{className:"text-sm",children:"ستظهر الأقساط المكتملة هنا عند إنهائها"})]})]}),o.jsx("div",{className:"flex justify-end mt-6",children:o.jsx("button",{onClick:()=>c(!1),className:"px-4 py-2 bg-slate-200 text-slate-700 rounded-lg hover:bg-slate-300 transition-colors",children:"إغلاق"})})]})})})]})},fo=({onClose:t,onSave:e,initialData:n,type:s,darkMode:r=!1,language:l="ar"})=>{const[d,c]=V.useState({[s==="toMe"?"debtor":"creditor"]:"",amount:0,description:"",date:new Date().toISOString().split("T")[0],status:"pending",source:"",reason:""}),[f,u]=V.useState({});Dn.useEffect(()=>{n&&c(n)},[n]);const m=E=>{const{name:A,value:I}=E.target;c(R=>({...R,[A]:A==="amount"?parseFloat(I)||0:I})),f[A]&&u(R=>({...R,[A]:""}))},p=()=>{const E={};return d[s==="toMe"?"debtor":"creditor"]||(E[s==="toMe"?"debtor":"creditor"]="اسم المدين/الدائن مطلوب"),d.amount<=0&&(E.amount="المبلغ يجب أن يكون أكبر من صفر"),d.description.trim()||(E.description="وصف الدين مطلوب"),d.date||(E.date="تاريخ الدين مطلوب"),u(E),Object.keys(E).length===0},h=E=>{E.preventDefault(),p()&&e(d,n==null?void 0:n.id)},v=s==="toMe";return o.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[9999] flex items-center justify-center p-4",onClick:t,children:o.jsx("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-lg animate-fade-in max-h-[90vh] overflow-y-auto",onClick:E=>E.stopPropagation(),children:o.jsxs("div",{className:"p-6",children:[o.jsxs("div",{className:"flex justify-between items-center mb-6",children:[o.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:v?"إضافة دين لي":"إضافة دين علي"}),o.jsx("button",{onClick:t,className:"text-slate-400 hover:text-slate-600",children:o.jsx(St,{})})]}),o.jsxs("form",{onSubmit:h,className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:v?"debtor":"creditor",className:"block text-sm font-medium text-slate-600 mb-2",children:v?"اسم المدين":"اسم الدائن"}),o.jsx("input",{type:"text",id:v?"debtor":"creditor",name:v?"debtor":"creditor",value:d[v?"debtor":"creditor"],onChange:m,className:"w-full p-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:v?"اسم الشخص الذي يدين لي":"اسم الشخص الذي أدين له",required:!0}),f[v?"debtor":"creditor"]&&o.jsx("p",{className:"text-red-500 text-sm mt-1",children:f[v?"debtor":"creditor"]})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"amount",className:"block text-sm font-medium text-slate-600 mb-2",children:"المبلغ"}),o.jsx("input",{type:"number",id:"amount",name:"amount",value:d.amount,onChange:m,className:"w-full p-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",step:"0.01",min:"0",placeholder:"0.00",required:!0}),f.amount&&o.jsx("p",{className:"text-red-500 text-sm mt-1",children:f.amount})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"source",className:"block text-sm font-medium text-slate-600 mb-2",children:v?"من أين دينني":"أين أضفت الدين"}),o.jsx("input",{type:"text",id:"source",name:"source",value:d.source,onChange:m,className:"w-full p-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:v?"مثال: بنك الراجحي، تطبيق ستور":"مثال: بنك الأهلي، تطبيق تابي"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"reason",className:"block text-sm font-medium text-slate-600 mb-2",children:"السبب (اختياري)"}),o.jsx("textarea",{id:"reason",name:"reason",value:d.reason,onChange:m,className:"w-full p-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3,placeholder:"سبب الدين أو تفاصيل إضافية..."})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-slate-600 mb-2",children:"وصف الدين"}),o.jsx("input",{type:"text",id:"description",name:"description",value:d.description,onChange:m,className:"w-full p-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"وصف مختصر للدين",required:!0}),f.description&&o.jsx("p",{className:"text-red-500 text-sm mt-1",children:f.description})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"date",className:"block text-sm font-medium text-slate-600 mb-2",children:"تاريخ الدين"}),o.jsx("input",{type:"date",id:"date",name:"date",value:d.date,onChange:m,className:"w-full p-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0}),f.date&&o.jsx("p",{className:"text-red-500 text-sm mt-1",children:f.date})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-slate-600 mb-2",children:"الحالة"}),o.jsxs("select",{id:"status",name:"status",value:d.status,onChange:m,className:"w-full p-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[o.jsx("option",{value:"pending",children:"معلق"}),o.jsx("option",{value:"partial",children:"جزئي"}),o.jsx("option",{value:"paid",children:"مدفوع"})]})]}),o.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[o.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 bg-slate-200 text-slate-700 rounded-lg hover:bg-slate-300 transition-colors",children:"إلغاء"}),o.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"إضافة الدين"})]})]})]})})})},ff=({state:t,setState:e,setModal:n,openLoanFormModal:s,darkMode:r=!1,language:l="ar"})=>{const[d,c]=V.useState("loans"),[f,u]=V.useState(!1),[m,p]=V.useState(!1),[h,v]=V.useState(!1),E=x=>{switch(x){case"car":return"🚗";case"house":return"🏠";case"personal":return"👤";case"business":return"💼";case"education":return"🎓";default:return"💰"}},A=x=>{switch(x){case"car":return"سيارة";case"house":return"بيت";case"personal":return"شخصي";case"business":return"تجاري";case"education":return"تعليمي";default:return"أخرى"}},I=x=>{switch(x){case"active":return"bg-green-100 text-green-800";case"completed":return"bg-blue-100 text-blue-800";case"defaulted":return"bg-red-100 text-red-800";case"pending":return"bg-yellow-100 text-yellow-800";case"partial":return"bg-orange-100 text-orange-800";case"paid":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},R=x=>{switch(x){case"active":return"نشط";case"completed":return"مكتمل";case"defaulted":return"متأخر";case"pending":return"معلق";case"partial":return"جزئي";case"paid":return"مدفوع";default:return"غير محدد"}},k=x=>{e(D=>({...D,loans:Object.fromEntries(Object.entries(D.loans).filter(([B])=>B!==x))}))},P=x=>{const D={...x,id:`debt-to-me-${Date.now()}`,createdAt:new Date().toISOString()};e(B=>({...B,debtsToMe:{...B.debtsToMe,[D.id]:D}})),p(!1),n({show:!0,title:"تم إضافة الدين بنجاح",body:`<p>تم إضافة الدين من "${D.debtor}" بقيمة ${se(D.amount)} ريال.</p>`,hideCancel:!0,confirmText:"موافق"})},N=x=>{const D={...x,id:`debt-from-me-${Date.now()}`,createdAt:new Date().toISOString()};e(B=>({...B,debtsFromMe:{...B.debtsFromMe,[D.id]:D}})),v(!1),n({show:!0,title:"تم إضافة الدين بنجاح",body:`<p>تم إضافة الدين لـ "${D.creditor}" بقيمة ${se(D.amount)} ريال.</p>`,hideCancel:!0,confirmText:"موافق"})},T=x=>{e(D=>({...D,debtsToMe:Object.fromEntries(Object.entries(D.debtsToMe).filter(([B])=>B!==x))}))},M=x=>{e(D=>({...D,debtsFromMe:Object.fromEntries(Object.entries(D.debtsFromMe).filter(([B])=>B!==x))}))},F=Object.values(t.loans).filter(x=>x.status==="active").length,j=Object.values(t.debtsToMe).filter(x=>x.status!=="paid").length,L=Object.values(t.debtsFromMe).filter(x=>x.status!=="paid").length;return o.jsxs("div",{className:"space-y-6 animate-fade-in",children:[o.jsx("div",{className:"flex justify-between items-center",children:o.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:"📊 الديون والقروض"})}),o.jsxs("div",{className:"flex space-x-1 bg-slate-100 dark:bg-slate-800 p-1 rounded-lg",children:[o.jsxs("button",{onClick:()=>c("loans"),className:`flex-1 py-2 px-4 rounded-md font-medium transition-colors ${d==="loans"?"bg-white dark:bg-slate-700 text-blue-600 shadow-sm":"text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-200"}`,children:["🏦 القروض (",F,")"]}),o.jsxs("button",{onClick:()=>c("debts-to-me"),className:`flex-1 py-2 px-4 rounded-md font-medium transition-colors ${d==="debts-to-me"?"bg-white dark:bg-slate-700 text-blue-600 shadow-sm":"text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-200"}`,children:["💰 الديون لي (",j,")"]}),o.jsxs("button",{onClick:()=>c("debts-from-me"),className:`flex-1 py-2 px-4 rounded-md font-medium transition-colors ${d==="debts-from-me"?"bg-white dark:bg-slate-700 text-blue-600 shadow-sm":"text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-200"}`,children:["💸 الديون علي (",L,")"]})]}),d==="loans"&&o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("h3",{className:"text-xl font-semibold text-slate-800",children:"القروض الكبيرة"}),o.jsx("button",{onClick:()=>s(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold",children:"+ إضافة قرض"})]}),Object.keys(t.loans).length===0?o.jsxs("div",{className:"text-center py-12 text-slate-500",children:[o.jsx("div",{className:"text-6xl mb-4",children:"🏦"}),o.jsx("p",{className:"text-lg",children:"لا توجد قروض مسجلة"}),o.jsx("p",{className:"text-sm",children:'اضغط على "إضافة قرض" لبدء إدارة قروضك'})]}):o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Object.values(t.loans).map(x=>o.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-xl border border-gray-200 dark:border-slate-700 shadow-sm hover:shadow-md transition-shadow",children:[o.jsxs("div",{className:"flex justify-between items-start mb-4",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:o.jsx("span",{className:"text-blue-600 text-xl",children:E(x.type)})}),o.jsxs("div",{children:[o.jsx("h4",{className:"text-lg font-bold text-slate-900 dark:text-slate-100",children:x.name}),o.jsxs("p",{className:"text-sm text-slate-500",children:[A(x.type)," - ",x.lender]})]})]}),o.jsxs("div",{className:"flex gap-2 flex-shrink-0",children:[o.jsx("button",{onClick:()=>s(x.id),className:"text-sm bg-blue-100 hover:bg-blue-200 w-8 h-8 rounded-full flex items-center justify-center transition-colors","aria-label":`تعديل قرض ${x.name}`,children:"✏️"}),o.jsx("button",{onClick:()=>k(x.id),className:"text-sm bg-red-100 hover:bg-red-200 w-8 h-8 rounded-full flex items-center justify-center transition-colors","aria-label":`حذف قرض ${x.name}`,children:o.jsx(at,{})})]})]}),o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[o.jsx("p",{className:"text-blue-700 font-semibold text-sm mb-1",children:"المبلغ الإجمالي"}),o.jsx("p",{className:"text-xl font-bold text-blue-900",children:se(x.totalAmount)})]}),(x.prepaidAmount||0)>0&&o.jsxs("div",{className:"bg-slate-50 p-3 rounded-lg",children:[o.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[o.jsx("span",{className:"font-medium text-slate-700",children:"التقدم"}),o.jsxs("span",{className:"font-medium text-slate-700",children:[Math.round((x.prepaidAmount||0)/x.totalAmount*100),"%"]})]}),o.jsx("div",{className:"w-full bg-slate-200 rounded-full h-3 mb-2",children:o.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-green-500 h-3 rounded-full transition-all duration-500",style:{width:`${(x.prepaidAmount||0)/x.totalAmount*100}%`}})}),o.jsxs("div",{className:"grid grid-cols-2 gap-2 text-center",children:[o.jsxs("div",{className:"bg-green-50 p-2 rounded",children:[o.jsx("p",{className:"text-green-700 font-bold text-sm",children:Math.floor((x.prepaidAmount||0)/x.monthlyPayment)}),o.jsx("p",{className:"text-green-600 text-xs",children:"مدفوع"})]}),o.jsxs("div",{className:"bg-blue-50 p-2 rounded",children:[o.jsx("p",{className:"text-blue-700 font-bold text-sm",children:x.totalMonths-Math.floor((x.prepaidAmount||0)/x.monthlyPayment)}),o.jsx("p",{className:"text-blue-600 text-xs",children:"متبقي"})]})]})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[o.jsxs("div",{className:"bg-slate-50 p-3 rounded-lg",children:[o.jsx("p",{className:"text-slate-600 text-xs mb-1",children:"القسط الشهري"}),o.jsx("p",{className:"font-semibold text-slate-800",children:se(x.monthlyPayment)})]}),o.jsxs("div",{className:"bg-slate-50 p-3 rounded-lg",children:[o.jsx("p",{className:"text-slate-600 text-xs mb-1",children:"المدة المتبقية"}),o.jsxs("p",{className:"font-semibold text-slate-800",children:[x.remainingMonths||0," شهر"]})]})]}),(x.prepaidAmount||0)>0&&o.jsxs("div",{className:"bg-orange-50 p-3 rounded-lg",children:[o.jsx("p",{className:"text-orange-700 font-semibold text-sm mb-1",children:"مدفوع مسبقاً"}),o.jsx("p",{className:"text-orange-900 font-bold text-lg",children:se(x.prepaidAmount||0)})]}),o.jsxs("div",{className:"bg-yellow-50 p-3 rounded-lg",children:[o.jsx("p",{className:"text-yellow-700 font-semibold text-sm mb-1",children:"القسط التالي"}),o.jsx("p",{className:"text-yellow-900 font-bold text-lg",children:new Date(new Date().getFullYear(),new Date().getMonth()+1,1).toLocaleDateString("en-GB")})]}),o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${I(x.status)}`,children:R(x.status)}),o.jsxs("span",{className:"text-xs text-slate-500",children:["بدأ في: ",new Date(x.startDate).toLocaleDateString("en-GB")]})]})]})]},x.id))})]}),d==="debts-to-me"&&o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("h3",{className:"text-xl font-semibold text-slate-800",children:"الديون المستحقة لي"}),o.jsx("button",{onClick:()=>p(!0),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-semibold",children:"+ إضافة دين لي"})]}),Object.keys(t.debtsToMe).length===0?o.jsxs("div",{className:"text-center py-12 text-slate-500",children:[o.jsx("div",{className:"text-6xl mb-4",children:"💰"}),o.jsx("p",{className:"text-lg",children:"لا توجد ديون مستحقة لك"}),o.jsx("p",{className:"text-sm",children:'اضغط على "إضافة دين لي" لتسجيل الأموال المستحقة لك'})]}):o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Object.values(t.debtsToMe).map(x=>o.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-xl border border-gray-200 dark:border-slate-700 shadow-sm hover:shadow-md transition-shadow",children:[o.jsxs("div",{className:"flex justify-between items-start mb-4",children:[o.jsxs("div",{children:[o.jsx("h4",{className:"text-lg font-bold text-slate-900 dark:text-slate-100",children:x.debtor}),o.jsx("p",{className:"text-sm text-slate-500",children:x.description})]}),o.jsx("button",{onClick:()=>T(x.id),className:"text-sm bg-red-100 hover:bg-red-200 w-8 h-8 rounded-full flex items-center justify-center transition-colors","aria-label":`حذف دين ${x.debtor}`,children:o.jsx(at,{})})]}),o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{className:"bg-green-50 p-3 rounded-lg",children:[o.jsx("p",{className:"text-green-700 font-semibold text-sm mb-1",children:"المبلغ المستحق"}),o.jsx("p",{className:"text-xl font-bold text-green-900",children:se(x.amount)})]}),o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${I(x.status)}`,children:R(x.status)}),o.jsxs("span",{className:"text-xs text-slate-500",children:["تاريخ: ",new Date(x.date).toLocaleDateString("ar-SA")]})]})]})]},x.id))})]}),d==="debts-from-me"&&o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("h3",{className:"text-xl font-semibold text-slate-800",children:"الديون المستحقة علي"}),o.jsx("button",{onClick:()=>v(!0),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-semibold",children:"+ إضافة دين علي"})]}),Object.keys(t.debtsFromMe).length===0?o.jsxs("div",{className:"text-center py-12 text-slate-500",children:[o.jsx("div",{className:"text-6xl mb-4",children:"💸"}),o.jsx("p",{className:"text-lg",children:"لا توجد ديون مستحقة عليك"}),o.jsx("p",{className:"text-sm",children:'اضغط على "إضافة دين علي" لتسجيل الأموال المستحقة عليك'})]}):o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Object.values(t.debtsFromMe).map(x=>o.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-xl border border-gray-200 dark:border-slate-700 shadow-sm hover:shadow-md transition-shadow",children:[o.jsxs("div",{className:"flex justify-between items-start mb-4",children:[o.jsxs("div",{children:[o.jsx("h4",{className:"text-lg font-bold text-slate-900 dark:text-slate-100",children:x.creditor}),o.jsx("p",{className:"text-sm text-slate-500",children:x.description})]}),o.jsx("button",{onClick:()=>M(x.id),className:"text-sm bg-red-100 hover:bg-red-200 w-8 h-8 rounded-full flex items-center justify-center transition-colors","aria-label":`حذف دين ${x.creditor}`,children:o.jsx(at,{})})]}),o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{className:"bg-red-50 p-3 rounded-lg",children:[o.jsx("p",{className:"text-red-700 font-semibold text-sm mb-1",children:"المبلغ المستحق"}),o.jsx("p",{className:"text-xl font-bold text-red-900",children:se(x.amount)})]}),o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${I(x.status)}`,children:R(x.status)}),o.jsxs("span",{className:"text-xs text-slate-500",children:["تاريخ: ",new Date(x.date).toLocaleDateString("ar-SA")]})]})]})]},x.id))})]}),m&&o.jsx(fo,{onClose:()=>p(!1),onSave:P,type:"toMe"}),h&&o.jsx(fo,{onClose:()=>v(!1),onSave:N,type:"fromMe"})]})},mf=({state:t,setState:e,setModal:n,setLoading:s,onRestore:r,darkMode:l=!1,language:d="ar",onSaveToCloud:c,onRestoreFromCloud:f,onDownloadBackup:u,onRestoreFromFile:m})=>{const[p,h]=V.useState(rt()),[v,E]=V.useState({connected:!1}),[A,I]=V.useState(!0),[R,k]=V.useState({firebase:p.hasFirebase,gemini:p.hasGemini});V.useEffect(()=>{const K=rt();h(K),k({firebase:K.hasFirebase,gemini:K.hasGemini}),K.hasFirebase?(async()=>{try{I(!0);const pe=await je.getData("test","connection");E({connected:!0})}catch(pe){E({connected:!1,error:pe instanceof Error?pe.message:"خطأ في الاتصال"})}finally{I(!1)}})():(E({connected:!1,error:"مفاتيح Firebase غير متوفرة"}),I(!1))},[]);const P=({isValid:K})=>K?o.jsx(yn,{className:"w-6 h-6 text-green-500"}):o.jsx(vn,{className:"w-6 h-6 text-red-500"}),N=()=>o.jsx(Gu,{className:"w-6 h-6 text-yellow-500"}),[T,M]=V.useState({name:"",icon:""}),[F,j]=V.useState(null),[L,x]=V.useState({name:"",icon:""}),[D,B]=V.useState({name:"",icon:""}),ne=()=>{if(!T.name.trim()||!T.icon.trim()){n({title:q("error",d),body:`<p>${q("required.field",d)}</p>`,hideCancel:!0,confirmText:q("confirm",d)});return}const te={id:`cat-${Date.now()}`,name:T.name.trim(),icon:T.icon.trim()};e(pe=>({...pe,categories:[...pe.categories,te]})),M({name:"",icon:""}),n({title:q("success",d),body:`<p>${q("success",d)}</p>`,hideCancel:!0,confirmText:q("confirm",d)})},[me,ie]=V.useState(!1),le=async()=>{const K=T.name.trim();if(!K){n({title:q("error",d),body:`<p>${q("required.field",d)}</p>`,hideCancel:!0,confirmText:q("confirm",d)});return}ie(!0);try{const{suggestCategoryIcon:te,initializeAi:pe}=await De(async()=>{const{suggestCategoryIcon:Je,initializeAi:ut}=await Promise.resolve().then(()=>wu);return{suggestCategoryIcon:Je,initializeAi:ut}},void 0);pe();const He=await te(K);He&&He.trim()?M(Je=>({...Je,icon:He.trim()})):n({title:q("error",d),body:`<p>${q("unknown.error",d)}</p>`,hideCancel:!0,confirmText:q("confirm",d)})}catch(te){console.error("Icon suggestion error:",te),n({title:q("error",d),body:`<p>${q("try.again",d)}</p><p>${q("details",d)}: ${te.message}</p>`,hideCancel:!0,confirmText:q("confirm",d)})}finally{ie(!1)}},Y=K=>{t.transactions.some(te=>te.categoryId===K)?n({title:q("cannot.delete",d),body:`<p>${q("cannot.delete.category",d)}</p>`,hideCancel:!0,confirmText:q("confirm",d)}):(e(te=>({...te,categories:te.categories.filter(pe=>pe.id!==K)})),n({title:q("success",d),body:`<p>${q("success",d)}</p>`,hideCancel:!0,confirmText:q("confirm",d)}))},[re,xe]=V.useState(!1),he=async()=>{const K=L.name.trim();if(!K){n({title:q("error",d),body:`<p>${q("required.field",d)}</p>`,hideCancel:!0,confirmText:q("confirm",d)});return}try{xe(!0);const te=await Pn(K);te&&te.trim()?x(pe=>({...pe,icon:te.trim()})):n({title:q("error",d),body:`<p>${q("unknown.error",d)}</p>`,hideCancel:!0,confirmText:q("confirm",d)})}catch(te){console.error("Transaction type icon suggestion error:",te),n({title:q("error",d),body:`<p>${q("try.again",d)}</p><p>${q("details",d)}: ${te.message}</p>`,hideCancel:!0,confirmText:q("confirm",d)})}finally{xe(!1)}},[Ce,Ue]=V.useState(!1),Ge=async()=>{const K=D.name.trim();if(!K){n({title:q("error",d),body:`<p>${q("required.field",d)}</p>`,hideCancel:!0,confirmText:q("confirm",d)});return}try{Ue(!0);const te=await Pn(K);te&&te.trim()?B(pe=>({...pe,icon:te.trim()})):n({title:q("error",d),body:`<p>${q("unknown.error",d)}</p>`,hideCancel:!0,confirmText:q("confirm",d)})}catch(te){console.error("Payment method icon suggestion error:",te),n({title:q("error",d),body:`<p>${q("try.again",d)}</p><p>${q("details",d)}: ${te.message}</p>`,hideCancel:!0,confirmText:q("confirm",d)})}finally{Ue(!1)}},ze=()=>{if(!L.name.trim()||!L.icon.trim()){n({title:q("error",d),body:`<p>${q("required.field",d)}</p>`,hideCancel:!0,confirmText:q("confirm",d)});return}const te={id:`custom-type-${Date.now()}`,name:L.name.trim(),icon:L.icon.trim(),isCustom:!0};e(pe=>({...pe,customTransactionTypes:[...pe.customTransactionTypes||[],te]})),x({name:"",icon:""}),n({title:q("success",d),body:`<p>${q("success",d)}</p>`,hideCancel:!0,confirmText:q("confirm",d)})},Ke=K=>{t.transactions.some(te=>te.type===K)?n({title:q("cannot.delete",d),body:`<p>${q("cannot.delete.transaction.type",d)}</p>`,hideCancel:!0,confirmText:q("confirm",d)}):(e(te=>({...te,customTransactionTypes:(te.customTransactionTypes||[]).filter(pe=>pe.id!==K)})),n({title:q("success",d),body:`<p>${q("success",d)}</p>`,hideCancel:!0,confirmText:q("confirm",d)}))},Xe=()=>{if(!D.name.trim()||!D.icon.trim()){n({title:q("error",d),body:`<p>${q("required.field",d)}</p>`,hideCancel:!0,confirmText:q("confirm",d)});return}const te={id:`custom-payment-${Date.now()}`,name:D.name.trim(),icon:D.icon.trim(),isCustom:!0};e(pe=>({...pe,customPaymentMethods:[...pe.customPaymentMethods||[],te]})),B({name:"",icon:""}),n({title:q("success",d),body:`<p>${q("success",d)}</p>`,hideCancel:!0,confirmText:q("confirm",d)})},Se=K=>{t.transactions.some(te=>te.paymentMethod===K)?n({title:q("cannot.delete",d),body:`<p>${q("cannot.delete.payment.method",d)}</p>`,hideCancel:!0,confirmText:q("confirm",d)}):(e(te=>({...te,customPaymentMethods:(te.customPaymentMethods||[]).filter(pe=>pe.id!==K)})),n({title:q("success",d),body:`<p>${q("success",d)}</p>`,hideCancel:!0,confirmText:q("confirm",d)}))};return o.jsxs("div",{className:"space-y-6 animate-fade-in",children:[o.jsx("div",{className:"flex justify-between items-center",children:o.jsxs("h2",{className:`text-2xl font-bold ${l?"text-slate-200":"text-slate-900"}`,children:["⚙️ ",q("settings",d)]})}),o.jsxs("div",{className:"glass-card p-6",children:[o.jsxs("h3",{className:`text-lg font-bold mb-4 ${l?"text-slate-200":"text-slate-900"}`,children:["🔑 ",q("api.status",d)]}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:`flex items-center justify-between p-4 rounded-lg ${l?"bg-slate-700":"bg-slate-50"}`,children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"text-2xl",children:"🔥"}),o.jsxs("div",{children:[o.jsx("h4",{className:`font-semibold ${l?"text-slate-200":"text-slate-800"}`,children:"Firebase Configuration"}),o.jsxs("p",{className:`text-sm ${l?"text-slate-400":"text-slate-600"}`,children:["Project ID: ",Te.firebase.projectId]})]})]}),o.jsx("div",{className:"flex items-center gap-2",children:R.firebase?v.connected?o.jsxs(o.Fragment,{children:[o.jsx(yn,{className:"w-6 h-6 text-green-500"}),o.jsx("span",{className:"text-sm text-green-600",children:"متصل"})]}):o.jsxs(o.Fragment,{children:[o.jsx(N,{}),o.jsx("span",{className:"text-sm text-yellow-600",children:"مفاتيح موجودة لكن غير متصل"})]}):o.jsxs(o.Fragment,{children:[o.jsx(vn,{className:"w-6 h-6 text-red-500"}),o.jsx("span",{className:"text-sm text-red-600",children:"مفاتيح غير متوفرة"})]})})]}),o.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-50 rounded-lg",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"text-2xl",children:"🤖"}),o.jsxs("div",{children:[o.jsx("h4",{className:"font-semibold text-slate-800",children:"Gemini AI API"}),o.jsxs("p",{className:"text-sm text-slate-600",children:["Model: ",Te.gemini.model]})]})]}),o.jsx("div",{className:"flex items-center gap-2",children:R.gemini?o.jsxs(o.Fragment,{children:[o.jsx(yn,{className:"w-6 h-6 text-green-500"}),o.jsx("span",{className:"text-sm text-green-600",children:"مُعد"})]}):o.jsxs(o.Fragment,{children:[o.jsx(vn,{className:"w-6 h-6 text-red-500"}),o.jsx("span",{className:"text-sm text-red-600",children:"غير مُعد"})]})})]})]}),!p.isValid&&o.jsxs("div",{className:"mt-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:[o.jsx("h5",{className:"font-semibold text-red-800 mb-2",children:"⚠️ تحذيرات:"}),o.jsx("ul",{className:"space-y-1",children:p.errors.map((K,te)=>o.jsxs("li",{className:"text-sm text-red-600",children:["• ",K]},te))})]})]}),o.jsxs("div",{className:"glass-card p-6",children:[o.jsx("h3",{className:"text-lg font-bold mb-4 text-slate-900 dark:text-slate-100",children:"📱 معلومات المشروع"}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsxs("div",{className:"p-3 bg-slate-50 rounded-lg",children:[o.jsx("p",{className:"text-sm text-slate-600",children:"اسم التطبيق"}),o.jsx("p",{className:"font-semibold text-slate-800",children:Te.app.name})]}),o.jsxs("div",{className:"p-3 bg-slate-50 rounded-lg",children:[o.jsx("p",{className:"text-sm text-slate-600",children:"الإصدار"}),o.jsx("p",{className:"font-semibold text-slate-800",children:Te.app.version})]}),o.jsxs("div",{className:"p-3 bg-slate-50 rounded-lg",children:[o.jsx("p",{className:"text-sm text-slate-600",children:"البيئة"}),o.jsx("p",{className:"font-semibold text-slate-800",children:Te.app.environment})]}),o.jsxs("div",{className:"p-3 bg-slate-50 rounded-lg",children:[o.jsx("p",{className:"text-sm text-slate-600",children:"حالة النظام"}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(P,{isValid:p.isValid&&v.connected}),o.jsx("span",{className:`text-sm font-semibold ${p.isValid&&v.connected?"text-green-600":"text-red-600"}`,children:p.isValid&&v.connected?"جاهز":"يحتاج إعداد"})]})]}),o.jsxs("div",{className:"p-3 bg-slate-50 rounded-lg",children:[o.jsx("p",{className:"text-sm text-slate-600",children:"تطوير"}),o.jsx("p",{className:"font-semibold text-slate-800",children:"Khaleel Alsani"})]})]})]}),(!p.isValid||!v.connected)&&o.jsxs("div",{className:"glass-card p-6",children:[o.jsx("h3",{className:"text-lg font-bold mb-4 text-slate-900 dark:text-slate-100",children:"📝 تعليمات الإعداد"}),o.jsxs("div",{className:"space-y-4",children:[!R.gemini&&o.jsxs("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[o.jsx("h4",{className:"font-semibold text-yellow-800 mb-2",children:"🤖 إعداد Gemini API:"}),o.jsxs("ol",{className:"text-sm text-yellow-700 space-y-1 list-decimal list-inside",children:[o.jsxs("li",{children:["اذهب إلى ",o.jsx("a",{href:"https://makersuite.google.com/app/apikey",target:"_blank",className:"underline",children:"Google AI Studio"})]}),o.jsx("li",{children:"أنشئ مفتاح API جديد"}),o.jsxs("li",{children:["أضف المفتاح كـ GitHub Secret باسم ",o.jsx("code",{className:"bg-yellow-100 px-1 rounded",children:"VITE_GEMINI_API_KEY"})]}),o.jsxs("li",{children:["أو ضعه في ملف ",o.jsx("code",{className:"bg-yellow-100 px-1 rounded",children:".env.local"})," للتطوير المحلي"]})]})]}),!R.firebase&&o.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[o.jsx("h4",{className:"font-semibold text-blue-800 mb-2",children:"🔥 إعداد Firebase:"}),o.jsxs("p",{className:"text-sm text-blue-700",children:["تأكد من إضافة جميع مفاتيح Firebase كـ GitHub Secrets:",o.jsx("br",{}),"• VITE_FIREBASE_API_KEY",o.jsx("br",{}),"• VITE_FIREBASE_AUTH_DOMAIN",o.jsx("br",{}),"• VITE_FIREBASE_PROJECT_ID",o.jsx("br",{}),"• VITE_FIREBASE_STORAGE_BUCKET",o.jsx("br",{}),"• VITE_FIREBASE_MESSAGING_SENDER_ID",o.jsx("br",{}),"• VITE_FIREBASE_APP_ID"]})]})]})]}),o.jsxs("div",{className:"glass-card p-6",children:[o.jsx("h3",{className:"text-lg font-bold mb-4 text-slate-900 dark:text-slate-100",children:"📂 إدارة الفئات"}),o.jsxs("div",{className:"mb-6 p-4 bg-slate-50 rounded-lg",children:[o.jsx("h4",{className:"font-semibold text-slate-800 mb-3",children:"➕ إضافة فئة جديدة"}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[o.jsx("input",{type:"text",placeholder:"اسم الفئة",value:T.name,onChange:K=>M(te=>({...te,name:K.target.value})),className:"px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx("input",{type:"text",placeholder:"الأيقونة (مثل: 🍔)",value:T.icon,onChange:K=>M(te=>({...te,icon:K.target.value})),className:"flex-1 px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),o.jsx("button",{type:"button",onClick:le,disabled:!T.name.trim()||me,className:"px-3 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center min-w-[44px]",title:"اقتراح أيقونة بالذكاء الاصطناعي",children:me?o.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):"🤖"})]})]}),o.jsx("button",{onClick:ne,className:"mt-3 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"➕ إضافة الفئة"})]}),o.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:t.categories.map(K=>o.jsxs("div",{className:"p-3 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"text-lg",children:K.icon}),o.jsx("span",{className:"text-sm font-medium text-slate-800",children:K.name})]}),o.jsx("button",{onClick:()=>Y(K.id),className:"text-red-500 hover:text-red-700 text-sm",title:"حذف الفئة",children:"🗑️"})]},K.id))})]}),o.jsxs("div",{className:"glass-card p-6",children:[o.jsx("h3",{className:"text-lg font-bold mb-4 text-slate-900 dark:text-slate-100",children:"⚙️ إدارة أنواع الحركات ووسائل الدفع"}),o.jsxs("div",{className:"mb-6 p-4 bg-slate-50 rounded-lg",children:[o.jsx("h4",{className:"font-semibold text-slate-800 mb-3",children:"📝 أنواع الحركات المخصصة"}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[o.jsx("input",{type:"text",placeholder:"اسم نوع الحركة (مثل: سحب نقدي)",value:L.name,onChange:K=>x(te=>({...te,name:K.target.value})),className:"px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx("input",{type:"text",placeholder:"الأيقونة (مثل: 💸)",value:L.icon,onChange:K=>x(te=>({...te,icon:K.target.value})),className:"flex-1 px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),o.jsx("button",{type:"button",onClick:he,disabled:!L.name.trim()||re,className:"px-3 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center min-w-[44px]",title:"اقتراح أيقونة بالذكاء الاصطناعي",children:re?o.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):"🤖"}),o.jsx("button",{onClick:ze,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"➕ إضافة"})]})]}),o.jsx("div",{className:"mt-4 grid grid-cols-2 md:grid-cols-3 gap-2",children:(t.customTransactionTypes||[]).map(K=>o.jsxs("div",{className:"p-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"text-sm",children:K.icon}),o.jsx("span",{className:"text-xs font-medium text-slate-800",children:K.name})]}),o.jsx("button",{onClick:()=>Ke(K.id),className:"text-red-500 hover:text-red-700 text-xs",title:"حذف نوع الحركة",children:"🗑️"})]},K.id))})]}),o.jsxs("div",{className:"mb-6 p-4 bg-slate-50 rounded-lg",children:[o.jsx("h4",{className:"font-semibold text-slate-800 mb-3",children:"💳 وسائل الدفع المخصصة"}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[o.jsx("input",{type:"text",placeholder:"اسم وسيلة الدفع (مثل: PayPal)",value:D.name,onChange:K=>B(te=>({...te,name:K.target.value})),className:"px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx("input",{type:"text",placeholder:"الأيقونة (مثل: 💳)",value:D.icon,onChange:K=>B(te=>({...te,icon:K.target.value})),className:"flex-1 px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),o.jsx("button",{type:"button",onClick:Ge,disabled:!D.name.trim()||Ce,className:"px-3 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center min-w-[44px]",title:"اقتراح أيقونة بالذكاء الاصطناعي",children:Ce?o.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):"🤖"}),o.jsx("button",{onClick:Xe,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"➕ إضافة"})]})]}),o.jsx("div",{className:"mt-4 grid grid-cols-2 md:grid-cols-3 gap-2",children:(t.customPaymentMethods||[]).map(K=>o.jsxs("div",{className:"p-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"text-sm",children:K.icon}),o.jsx("span",{className:"text-xs font-medium text-slate-800",children:K.name})]}),o.jsx("button",{onClick:()=>Se(K.id),className:"text-red-500 hover:text-red-700 text-xs",title:"حذف وسيلة الدفع",children:"🗑️"})]},K.id))})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[o.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:[o.jsx("h4",{className:"font-semibold text-blue-800 mb-3",children:"📋 أنواع الحركات المدمجة"}),o.jsxs("div",{className:"space-y-2 text-sm",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("span",{children:"💰 دخل"}),o.jsx("span",{className:"text-blue-600",children:"مدمج"})]}),o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("span",{children:"💸 مصاريف"}),o.jsx("span",{className:"text-blue-600",children:"مدمج"})]}),o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("span",{children:"📱 سداد قسط"}),o.jsx("span",{className:"text-blue-600",children:"مدمج"})]}),o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("span",{children:"💹 إيداع استثماري"}),o.jsx("span",{className:"text-blue-600",children:"مدمج"})]}),o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("span",{children:"💹 سحب استثماري"}),o.jsx("span",{className:"text-blue-600",children:"مدمج"})]})]})]}),o.jsxs("div",{className:"p-4 bg-green-50 rounded-lg border border-green-200",children:[o.jsx("h4",{className:"font-semibold text-green-800 mb-3",children:"💳 وسائل الدفع المدمجة"}),o.jsxs("div",{className:"space-y-2 text-sm",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("span",{children:"💵 نقدي"}),o.jsx("span",{className:"text-green-600",children:"مدمج"})]}),o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("span",{children:"📱 تابي"}),o.jsx("span",{className:"text-green-600",children:"مدمج"})]}),o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("span",{children:"📱 تمارا"}),o.jsx("span",{className:"text-green-600",children:"مدمج"})]}),o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("span",{children:"💳 سداد البطاقات"}),o.jsx("span",{className:"text-green-600",children:"مدمج"})]})]})]})]})]}),o.jsxs("div",{className:"glass-card p-6",children:[o.jsx("h3",{className:"text-lg font-bold mb-4 text-slate-900 dark:text-slate-100",children:"💾 النسخ الاحتياطي والاستعادة"}),o.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-6 text-sm",children:"احفظ بياناتك في السحابة أو استعدها بسهولة."}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[o.jsxs("button",{onClick:u,className:"btn btn-primary flex flex-col items-center justify-center p-4 h-24",children:[o.jsx("span",{className:"text-2xl mb-2",children:"💾"}),o.jsx("span",{className:"font-semibold",children:"تحميل ملف"})]}),o.jsxs("button",{onClick:c,className:"btn btn-secondary flex flex-col items-center justify-center p-4 h-24",children:[o.jsx("span",{className:"text-2xl mb-2",children:"☁️"}),o.jsx("span",{className:"font-semibold",children:"حفظ في السحابة"})]}),o.jsxs("label",{className:"btn btn-secondary flex flex-col items-center justify-center p-4 h-24 cursor-pointer",children:[o.jsx("span",{className:"text-2xl mb-2",children:"📤"}),o.jsx("span",{className:"font-semibold",children:"استعادة من ملف"}),o.jsx("input",{type:"file",accept:".json",className:"hidden",onChange:m})]}),o.jsxs("button",{onClick:f,className:"btn btn-info flex flex-col items-center justify-center p-4 h-24",style:{backgroundColor:"#0ea5e9",color:"#fff"},children:[o.jsx("span",{className:"text-2xl mb-2",children:"☁️"}),o.jsx("span",{className:"font-semibold",children:"استعادة من السحابة"})]})]}),o.jsxs("div",{className:"mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[o.jsx("h4",{className:"font-semibold text-blue-800 dark:text-blue-200 mb-2",children:"💡 نصائح مهمة:"}),o.jsxs("ul",{className:"text-sm text-blue-700 dark:text-blue-300 space-y-1",children:[o.jsx("li",{children:"• احفظ نسخة احتياطية بانتظام لتجنب فقدان البيانات"}),o.jsx("li",{children:"• النسخ السحابية متاحة من أي جهاز"}),o.jsx("li",{children:"• ملفات النسخ الاحتياطية محمية ومشفرة"})]})]})]}),o.jsx("div",{className:"text-center",children:o.jsx("button",{onClick:()=>{h(rt()),window.location.reload()},disabled:A,className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors",children:A?"جاري التحقق...":"🔄 إعادة التحقق"})})]})},pf=({onClose:t,onSave:e,initialData:n,categories:s,cards:r,bankAccounts:l,loans:d,setModalConfig:c,darkMode:f=!1,language:u="ar"})=>{var le;const[m,p]=V.useState({amount:0,date:new Date().toISOString().split("T")[0],description:"",paymentMethod:Object.keys(l)[0]||"cash",type:"expense",categoryId:((le=s.find(Y=>Y.name==="أخرى"))==null?void 0:le.id)||null}),[h,v]=V.useState(!1),[E,A]=V.useState(""),[I,R]=V.useState({isOpen:!1,text:""}),[k,P]=V.useState(!1),[N,T]=V.useState(!1),[M,F]=V.useState(4),[j,L]=V.useState(Object.keys(l)[0]||"cash");V.useEffect(()=>{var Y;n?p(n):(Y=navigator.clipboard)!=null&&Y.readText&&(async()=>{try{const re=await navigator.clipboard.readText();re&&re.trim().length>10&&sessionStorage.getItem("ignoredClipboardText")!==re&&R({isOpen:!0,text:re})}catch{console.info("Clipboard read access denied or not supported.")}})()},[n]);const x=Y=>{const{name:re,value:xe}=Y.target;if(re==="paymentMethod"){const he=xe.includes("bnpl");T(he),he&&p(Ce=>({...Ce,type:"expense"}))}p(he=>({...he,[re]:re==="amount"?parseFloat(xe):xe}))},D=Y=>{if(Y.preventDefault(),m.type==="income"&&Object.keys(d).length>0&&Object.values(d).filter(xe=>xe.status==="active").length>0){P(!0);return}N&&m.paymentMethod.includes("bnpl")?e({...m,bnplData:{installmentsCount:M,initialPaymentSource:j,installmentAmount:m.amount/M}},n==null?void 0:n.id):e(m,n==null?void 0:n.id)},B=async Y=>{if(Y.trim()){v(!0),A("");try{const re=await Wo(Y,s,r,l),xe=JSON.parse(re);xe.error?A(xe.error):p(he=>({...he,amount:xe.amount||he.amount,date:xe.date||he.date,description:xe.merchant||he.description,paymentMethod:xe.paymentMethod||he.paymentMethod,categoryId:xe.categoryId||he.categoryId}))}catch(re){A(re instanceof Error?re.message:q("unknown.error",u)),console.error(re)}finally{v(!1)}}},ne=async()=>{A("");try{if(navigator.permissions&&navigator.permissions.query&&(await navigator.permissions.query({name:"clipboard-read"})).state==="denied"){A("تم رفض الوصول إلى الحافظة. لتفعيل هذه الميزة، يرجى الذهاب إلى إعدادات الموقع في متصفحك والسماح بالوصول إلى الحافظة.");return}const Y=await navigator.clipboard.readText();Y&&Y.trim().length>0?B(Y):A("الحافظة فارغة. الرجاء نسخ نص المعاملة أولاً.")}catch(Y){console.error("Clipboard operation failed: ",Y),A("فشل الوصول إلى الحافظة. يرجى منح الإذن عند طلبه، أو التحقق من إعدادات المتصفح.")}},me=V.useMemo(()=>{const Y=[{value:"cash",label:"💵 نقدي"}];return Object.values(l).forEach(re=>Y.push({value:re.id,label:`🏦 ${re.name}`})),Object.values(r).forEach(re=>Y.push({value:re.id,label:`💳 ${re.name}`})),Y.push({value:"tabby-bnpl",label:"📱 تابي"}),Y.push({value:"tamara-bnpl",label:"📱 تمارا"}),Y},[l,r]),ie=V.useMemo(()=>{const Y=[{value:"expense",label:"💸 مصاريف"},{value:"income",label:"💰 دخل"},{value:"bnpl-payment",label:"📱 سداد قسط"},{value:"investment-deposit",label:"💹 إيداع استثماري"},{value:"investment-withdrawal",label:"💹 سحب استثماري"}];return Object.values(r).forEach(re=>Y.push({value:`${re.id}-payment`,label:`💳 سداد ${re.name}`})),Y},[r]);return o.jsxs(o.Fragment,{children:[I.isOpen&&o.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[60] flex items-center justify-center p-4",onClick:()=>R({isOpen:!1,text:""}),children:o.jsx("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md animate-fade-in",onClick:Y=>Y.stopPropagation(),children:o.jsxs("div",{className:"p-6",children:[o.jsx("h3",{className:"text-xl font-bold text-slate-800 mb-4",children:"اكتشاف نص في الحافظة"}),o.jsx("p",{className:"text-sm text-slate-600 mb-4",children:"وجدنا نصاً في حافظة النصوص. هل تود لصقه وتحليله لتعبئة الحقول تلقائياً؟"}),o.jsx("pre",{className:"bg-slate-100 p-3 rounded-md text-xs text-slate-500 max-h-24 overflow-y-auto whitespace-pre-wrap font-sans",children:I.text}),o.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[o.jsx("button",{onClick:()=>{sessionStorage.setItem("ignoredClipboardText",I.text),R({isOpen:!1,text:""})},className:"px-4 py-2 bg-slate-200 rounded-lg",children:"تجاهل"}),o.jsx("button",{onClick:()=>{R({isOpen:!1,text:""}),B(I.text)},className:"px-4 py-2 bg-blue-600 text-white rounded-lg",children:"لصق وتحليل"})]})]})})}),o.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:t,children:o.jsx("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-lg animate-fade-in max-h-[90vh] overflow-y-auto",onClick:Y=>Y.stopPropagation(),children:o.jsxs("div",{className:"p-6",children:[o.jsxs("div",{className:"flex justify-between items-center mb-6",children:[o.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:n?"تعديل الحركة":"إضافة حركة جديدة"}),o.jsx("button",{onClick:t,className:"text-slate-400 hover:text-slate-600",children:o.jsx(St,{})})]}),o.jsxs("button",{type:"button",onClick:ne,disabled:h,className:"w-full flex items-center justify-center gap-2 mb-4 px-4 py-2 bg-blue-50 text-blue-600 rounded-lg hover:bg-blue-100 transition-colors disabled:opacity-50",children:[o.jsx(Uu,{}),o.jsx("span",{children:"لصق وتحليل من الحافظة"})]}),h&&o.jsxs("div",{className:"text-center p-4 mb-4 bg-blue-50 rounded-lg",children:[o.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500 mx-auto"}),o.jsx("p",{className:"text-blue-600 mt-2 text-sm",children:"جاري التحليل..."})]}),E&&o.jsx("p",{className:"text-red-500 text-sm mb-4 bg-red-50 p-3 rounded-lg",children:E}),o.jsxs("form",{onSubmit:D,className:"space-y-4",children:[o.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"amount",className:"form-label",children:"المبلغ"}),o.jsx("input",{type:"number",name:"amount",value:m.amount,onChange:x,className:"w-full",required:!0,step:"0.01"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"date",className:"form-label",children:"التاريخ"}),o.jsx("input",{type:"date",name:"date",value:m.date,onChange:x,className:"w-full",required:!0})]})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"description",className:"form-label",children:"الوصف"}),o.jsx("input",{type:"text",name:"description",value:m.description,onChange:x,className:"w-full",required:!0})]}),o.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"type",className:"form-label",children:"نوع الحركة"}),o.jsx("select",{name:"type",value:m.type,onChange:x,className:"w-full",children:ie.map(Y=>o.jsx("option",{value:Y.value,children:Y.label},Y.value))})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"paymentMethod",className:"form-label",children:"وسيلة الدفع"}),o.jsx("select",{name:"paymentMethod",value:m.paymentMethod,onChange:x,className:"w-full",children:me.map(Y=>o.jsx("option",{value:Y.value,children:Y.label},Y.value))})]})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"categoryId",className:"form-label",children:"الفئة"}),o.jsxs("select",{name:"categoryId",value:m.categoryId||"",onChange:x,className:"w-full",children:[o.jsx("option",{value:"",children:"-- اختر فئة --"}),s.map(Y=>o.jsxs("option",{value:Y.id,children:[Y.icon," ",Y.name]},Y.id))]})]}),N&&o.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg space-y-4",children:[o.jsx("h3",{className:"font-semibold text-blue-800",children:"📱 إعدادات التقسيط"}),o.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"installmentsCount",className:"form-label",children:"عدد الأقساط"}),o.jsxs("select",{value:M,onChange:Y=>F(parseInt(Y.target.value)),className:"w-full",children:[o.jsx("option",{value:2,children:"قسطين (2)"}),o.jsx("option",{value:3,children:"3 أقساط"}),o.jsx("option",{value:4,children:"4 أقساط"})]})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"initialPaymentSource",className:"form-label",children:"مصدر الدفعة الأولى"}),o.jsx("select",{value:j,onChange:Y=>L(Y.target.value),className:"w-full",children:me.filter(Y=>!Y.value.includes("bnpl")).map(Y=>o.jsx("option",{value:Y.value,children:Y.label},Y.value))})]})]}),o.jsx("div",{className:"bg-blue-100 p-3 rounded-lg",children:o.jsxs("p",{className:"text-sm text-blue-700",children:[o.jsx("strong",{children:"الدفعة الأولى:"})," ",(m.amount/M).toFixed(2)," ريال",o.jsx("br",{}),o.jsx("strong",{children:"المبلغ المتبقي:"})," ",(m.amount*(M-1)/M).toFixed(2)," ريال"]})})]}),o.jsx("button",{type:"submit",className:"w-full py-3 magical-button text-white font-semibold rounded-lg mt-6",children:n?"حفظ التعديلات":"إضافة الحركة"})]})]})})}),k&&o.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[100] flex items-center justify-center p-4",children:o.jsx("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md animate-fade-in",onClick:Y=>Y.stopPropagation(),children:o.jsxs("div",{className:"p-6",children:[o.jsx("h3",{className:"text-xl font-bold text-slate-800 mb-4",children:"خصم أقساط القروض"}),o.jsx("p",{className:"text-sm text-slate-600 mb-4",children:"لديك قروض نشطة. هل تريد خصم أقساطها من هذا الراتب؟"}),o.jsx("div",{className:"space-y-3 mb-6",children:Object.values(d).filter(Y=>Y.status==="active").map(Y=>o.jsx("div",{className:"bg-blue-50 p-3 rounded-lg",children:o.jsx("div",{className:"flex justify-between items-center",children:o.jsxs("div",{children:[o.jsx("p",{className:"font-semibold text-blue-800",children:Y.name}),o.jsxs("p",{className:"text-sm text-blue-600",children:["القسط: ",Y.monthlyPayment.toLocaleString()," ريال"]})]})})},Y.id))}),o.jsxs("div",{className:"flex justify-end gap-3",children:[o.jsx("button",{onClick:()=>{P(!1),e(m,n==null?void 0:n.id)},className:"px-4 py-2 bg-slate-200 rounded-lg hover:bg-slate-300 transition-colors",children:"لا، حفظ الراتب فقط"}),o.jsx("button",{onClick:()=>{P(!1);const Y=Object.values(d).filter(he=>he.status==="active"),re=Y.reduce((he,Ce)=>he+Ce.monthlyPayment,0),xe={...m};Y.map(he=>({id:`trans-${Date.now()}-loan-${he.id}`,amount:he.monthlyPayment,date:m.date,description:`قسط شهري - ${he.name}`,paymentMethod:m.paymentMethod,type:"expense",categoryId:null})),e(xe,n==null?void 0:n.id),c({title:"تم حفظ الراتب وخصم الأقساط",body:`<p>تم خصم ${re.toLocaleString()} ريال كأقساط قروض من الراتب.</p>`,hideCancel:!0,confirmText:"موافق"})},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"نعم، خصم الأقساط"})]})]})})})]})},hf=({onClose:t,onSave:e,initialData:n,darkMode:s=!1,language:r="ar"})=>{var u;const[l,d]=V.useState({name:"",limit:0,dueDay:15,statementDay:25,smsSamples:[]});V.useEffect(()=>{n&&d(n)},[n]);const c=m=>{const{name:p,value:h,type:v}=m.target;d(p==="smsSamples"?E=>({...E,smsSamples:h.split(",").map(A=>A.trim()).filter(Boolean)}):E=>({...E,[p]:v==="number"?parseFloat(h)||0:h}))},f=m=>{m.preventDefault(),e(l,n==null?void 0:n.id)};return o.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:t,children:o.jsx("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-lg animate-fade-in",onClick:m=>m.stopPropagation(),children:o.jsxs("div",{className:"p-6",children:[o.jsxs("div",{className:"flex justify-between items-center mb-6",children:[o.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:n?"تعديل البطاقة":"إضافة بطاقة جديدة"}),o.jsx("button",{onClick:t,className:"text-slate-400 hover:text-slate-600",children:o.jsx(St,{})})]}),o.jsxs("form",{onSubmit:f,className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-slate-600 mb-1",children:"اسم البطاقة"}),o.jsx("input",{type:"text",name:"name",value:l.name,onChange:c,className:"w-full p-2",required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"limit",className:"block text-sm font-medium text-slate-600 mb-1",children:"الحد الائتماني"}),o.jsx("input",{type:"number",name:"limit",value:l.limit,onChange:c,className:"w-full p-2",required:!0,step:"100"})]}),o.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"statementDay",className:"block text-sm font-medium text-slate-600 mb-1",children:"يوم إصدار الكشف (شهرياً)"}),o.jsx("input",{type:"number",name:"statementDay",value:l.statementDay,onChange:c,className:"w-full p-2",required:!0,min:"1",max:"31"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"dueDay",className:"block text-sm font-medium text-slate-600 mb-1",children:"يوم الاستحقاق (شهرياً)"}),o.jsx("input",{type:"number",name:"dueDay",value:l.dueDay,onChange:c,className:"w-full p-2",required:!0,min:"1",max:"31"})]})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"smsSamples",className:"block text-sm font-medium text-slate-600 mb-1",children:"الكلمات المفتاحية للرسائل (افصل بفواصل)"}),o.jsx("input",{type:"text",name:"smsSamples",value:((u=l.smsSamples)==null?void 0:u.join(", "))||"",onChange:c,className:"w-full p-2",placeholder:"مثال: SNB, الأهلي, إئتمانية"}),o.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"كلمات فريدة من رسائل البنك للمساعدة في التعرف التلقائي عند لصق نص رسالة."})]}),o.jsx("button",{type:"submit",className:"w-full py-3 magical-button text-white font-semibold rounded-lg mt-6",children:n?"حفظ التعديلات":"إضافة البطاقة"})]})]})})})},gf=({onClose:t,onSave:e,initialData:n,darkMode:s=!1,language:r="ar"})=>{var u;const[l,d]=V.useState({name:"",balance:0,currency:"SAR",smsSamples:[]});V.useEffect(()=>{n&&d(n)},[n]);const c=m=>{const{name:p,value:h,type:v}=m.target;d(p==="smsSamples"?E=>({...E,smsSamples:h.split(",").map(A=>A.trim()).filter(Boolean)}):E=>({...E,[p]:v==="number"?parseFloat(h)||0:h}))},f=m=>{m.preventDefault(),e(l,n==null?void 0:n.id)};return o.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:t,children:o.jsx("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-lg animate-fade-in",onClick:m=>m.stopPropagation(),children:o.jsxs("div",{className:"p-6",children:[o.jsxs("div",{className:"flex justify-between items-center mb-6",children:[o.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:n?"تعديل الحساب":"إضافة حساب بنكي"}),o.jsx("button",{onClick:t,className:"text-slate-400 hover:text-slate-600",children:o.jsx(St,{})})]}),o.jsxs("form",{onSubmit:f,className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-slate-600 mb-1",children:"اسم الحساب"}),o.jsx("input",{type:"text",name:"name",value:l.name,onChange:c,className:"w-full p-2",required:!0})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"balance",className:"block text-sm font-medium text-slate-600 mb-1",children:"الرصيد الافتتاحي"}),o.jsx("input",{type:"number",name:"balance",value:l.balance,onChange:c,className:"w-full p-2",required:!0,step:"10"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"currency",className:"block text-sm font-medium text-slate-600 mb-1",children:"العملة"}),o.jsxs("select",{name:"currency",value:l.currency||"SAR",onChange:c,className:"w-full p-2",required:!0,children:[o.jsx("option",{value:"SAR",children:"🇸🇦 ريال سعودي (SAR)"}),o.jsx("option",{value:"AED",children:"🇦🇪 درهم إماراتي (AED)"}),o.jsx("option",{value:"USD",children:"🇺🇸 دولار أمريكي (USD)"}),o.jsx("option",{value:"EUR",children:"🇪🇺 يورو (EUR)"}),o.jsx("option",{value:"GBP",children:"🇬🇧 جنيه إسترليني (GBP)"}),o.jsx("option",{value:"JOD",children:"🇯🇴 دينار أردني (JOD)"}),o.jsx("option",{value:"KWD",children:"🇰🇼 دينار كويتي (KWD)"}),o.jsx("option",{value:"QAR",children:"🇶🇦 ريال قطري (QAR)"}),o.jsx("option",{value:"BHD",children:"🇧🇭 دينار بحريني (BHD)"}),o.jsx("option",{value:"OMR",children:"🇴🇲 ريال عماني (OMR)"})]})]})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"smsSamples",className:"block text-sm font-medium text-slate-600 mb-1",children:"الكلمات المفتاحية للرسائل (افصل بفواصل)"}),o.jsx("input",{type:"text",name:"smsSamples",value:((u=l.smsSamples)==null?void 0:u.join(", "))||"",onChange:c,className:"w-full p-2",placeholder:"مثال: Alrajhi, الراجحي, مدى"}),o.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"كلمات فريدة من رسائل البنك للمساعدة في التعرف التلقائي عند لصق نص رسالة."})]}),o.jsx("button",{type:"submit",className:"w-full py-3 magical-button text-white font-semibold rounded-lg mt-6",children:n?"حفظ التعديلات":"إضافة الحساب"})]})]})})})},xf=({onClose:t,onSave:e,initialData:n,bankAccounts:s,darkMode:r=!1,language:l="ar"})=>{const[d,c]=V.useState({type:"car",name:"",totalAmount:0,downPayment:0,finalPayment:0,monthlyPayment:0,startDate:new Date().toISOString().split("T")[0],endDate:"",remainingMonths:0,totalMonths:0,lender:"",status:"active",linkedAccount:"",prepaidAmount:0,prepaidInstallments:0}),[f,u]=V.useState({});V.useEffect(()=>{n&&c(n)},[n]),V.useEffect(()=>{if(d.totalAmount>0&&d.downPayment>=0&&d.finalPayment>=0&&d.monthlyPayment>0){const A=d.totalAmount-d.downPayment-d.finalPayment-(d.prepaidAmount||0);if(A>0){const I=Math.ceil(A/d.monthlyPayment),R=new Date(d.startDate),k=new Date(R);k.setMonth(k.getMonth()+I),c(P=>({...P,totalMonths:I,endDate:k.toISOString().split("T")[0],remainingMonths:I}))}}},[d.totalAmount,d.downPayment,d.finalPayment,d.monthlyPayment,d.startDate,d.prepaidAmount]),V.useEffect(()=>{if(d.prepaidAmount&&d.monthlyPayment>0){const A=Math.floor(d.prepaidAmount/d.monthlyPayment);c(I=>({...I,prepaidInstallments:A}))}else c(A=>({...A,prepaidInstallments:0}))},[d.prepaidAmount,d.monthlyPayment]);const m=[{value:"car",label:"سيارة",icon:"🚗"},{value:"house",label:"بيت",icon:"🏠"},{value:"personal",label:"شخصي",icon:"👤"},{value:"business",label:"تجاري",icon:"💼"},{value:"education",label:"تعليمي",icon:"🎓"}],p=A=>{const{name:I,value:R}=A.target;c(k=>({...k,[I]:I.includes("Amount")||I.includes("Payment")||I.includes("Months")?parseFloat(R)||0:R})),f[I]&&u(k=>({...k,[I]:""}))},h=()=>{const A={};return d.name.trim()||(A.name="اسم القرض مطلوب"),d.totalAmount<=0&&(A.totalAmount="المبلغ الإجمالي يجب أن يكون أكبر من صفر"),d.downPayment<0&&(A.downPayment="الدفعة الأولى لا يمكن أن تكون سالبة"),d.finalPayment<0&&(A.finalPayment="الدفعة الأخيرة لا يمكن أن تكون سالبة"),d.monthlyPayment<=0&&(A.monthlyPayment="القسط الشهري يجب أن يكون أكبر من صفر"),d.lender.trim()||(A.lender="اسم البنك أو المؤسسة مطلوب"),d.startDate||(A.startDate="تاريخ بداية القرض مطلوب"),d.downPayment+d.finalPayment>=d.totalAmount&&(A.downPayment="مجموع الدفعة الأولى والأخيرة يجب أن يكون أقل من المبلغ الإجمالي"),u(A),Object.keys(A).length===0},v=A=>{if(A.preventDefault(),!h())return;const I={...d,id:(n==null?void 0:n.id)||`loan-${Date.now()}`,createdAt:(n==null?void 0:n.createdAt)||new Date().toISOString()};e(I)},E=Object.values(s).map(A=>({value:A.id,label:`${A.name} (${A.currency})`}));return o.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[9999] flex items-center justify-center p-4",onClick:t,children:o.jsx("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-2xl animate-fade-in max-h-[90vh] overflow-y-auto",onClick:A=>A.stopPropagation(),children:o.jsxs("div",{className:"p-6",children:[o.jsxs("div",{className:"flex justify-between items-center mb-6",children:[o.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:n?"تعديل القرض":"إضافة قرض جديد"}),o.jsx("button",{onClick:t,className:"text-slate-400 hover:text-slate-600",children:o.jsx(St,{})})]}),o.jsxs("form",{onSubmit:v,className:"space-y-6",children:[o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"type",className:"block text-sm font-medium text-slate-600 mb-2",children:"نوع القرض"}),o.jsx("select",{id:"type",name:"type",value:d.type,onChange:p,className:"w-full p-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:m.map(A=>o.jsxs("option",{value:A.value,children:[A.icon," ",A.label]},A.value))})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-slate-600 mb-2",children:"اسم القرض"}),o.jsx("input",{type:"text",id:"name",name:"name",value:d.name,onChange:p,className:"w-full p-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"مثل: قرض سيارة تويوتا",required:!0}),f.name&&o.jsx("p",{className:"text-red-500 text-sm mt-1",children:f.name})]})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"totalAmount",className:"block text-sm font-medium text-slate-600 mb-2",children:"المبلغ الإجمالي"}),o.jsx("input",{type:"number",id:"totalAmount",name:"totalAmount",value:d.totalAmount,onChange:p,className:"w-full p-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",step:"0.01",min:"0",required:!0}),f.totalAmount&&o.jsx("p",{className:"text-red-500 text-sm mt-1",children:f.totalAmount})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"downPayment",className:"block text-sm font-medium text-slate-600 mb-2",children:"الدفعة الأولى"}),o.jsx("input",{type:"number",id:"downPayment",name:"downPayment",value:d.downPayment,onChange:p,className:"w-full p-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",step:"0.01",min:"0",required:!0}),f.downPayment&&o.jsx("p",{className:"text-red-500 text-sm mt-1",children:f.downPayment})]})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"finalPayment",className:"block text-sm font-medium text-slate-600 mb-2",children:"الدفعة الأخيرة"}),o.jsx("input",{type:"number",id:"finalPayment",name:"finalPayment",value:d.finalPayment,onChange:p,className:"w-full p-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",step:"0.01",min:"0",required:!0}),f.finalPayment&&o.jsx("p",{className:"text-red-500 text-sm mt-1",children:f.finalPayment})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"monthlyPayment",className:"block text-sm font-medium text-slate-600 mb-2",children:"القسط الشهري"}),o.jsx("input",{type:"number",id:"monthlyPayment",name:"monthlyPayment",value:d.monthlyPayment,onChange:p,className:"w-full p-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",step:"0.01",min:"0",required:!0}),f.monthlyPayment&&o.jsx("p",{className:"text-red-500 text-sm mt-1",children:f.monthlyPayment})]})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"prepaidAmount",className:"block text-sm font-medium text-slate-600 mb-2",children:"المبلغ المدفوع مسبقاً (اختياري)"}),o.jsx("input",{type:"number",id:"prepaidAmount",name:"prepaidAmount",value:d.prepaidAmount||0,onChange:p,className:"w-full p-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",step:"0.01",min:"0",placeholder:"0"}),o.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"المبلغ الذي تم دفعه قبل إضافة القرض للنظام"}),(d.prepaidAmount||0)>0&&o.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg mt-2",children:[o.jsxs("p",{className:"text-blue-700 font-semibold text-sm",children:["الأقساط المدفوعة مسبقاً: ",d.prepaidInstallments||0," قسط"]}),o.jsxs("p",{className:"text-blue-600 text-sm",children:["المبلغ المتبقي: ",formatCurrency(d.totalAmount-d.downPayment-d.finalPayment-(d.prepaidAmount||0))," ريال"]})]})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"startDate",className:"block text-sm font-medium text-slate-600 mb-2",children:"تاريخ بداية القرض"}),o.jsx("input",{type:"date",id:"startDate",name:"startDate",value:d.startDate,onChange:p,className:"w-full p-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0}),f.startDate&&o.jsx("p",{className:"text-red-500 text-sm mt-1",children:f.startDate})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"endDate",className:"block text-sm font-medium text-slate-600 mb-2",children:"تاريخ انتهاء القرض (محسوب تلقائياً)"}),o.jsx("input",{type:"date",id:"endDate",name:"endDate",value:d.endDate||"",className:"w-full p-3 border border-slate-300 rounded-lg bg-gray-50",disabled:!0})]})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"lender",className:"block text-sm font-medium text-slate-600 mb-2",children:"البنك أو المؤسسة"}),o.jsx("input",{type:"text",id:"lender",name:"lender",value:d.lender,onChange:p,className:"w-full p-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"مثل: البنك الأهلي التجاري",required:!0}),f.lender&&o.jsx("p",{className:"text-red-500 text-sm mt-1",children:f.lender})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"linkedAccount",className:"block text-sm font-medium text-slate-600 mb-2",children:"ربط بالحساب البنكي (اختياري)"}),o.jsxs("select",{id:"linkedAccount",name:"linkedAccount",value:d.linkedAccount,onChange:p,className:"w-full p-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[o.jsx("option",{value:"",children:"اختر حساب بنكي"}),E.map(A=>o.jsx("option",{value:A.value,children:A.label},A.value))]})]})]}),d.totalMonths>0&&o.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[o.jsx("h4",{className:"font-semibold text-blue-800 mb-2",children:"المعلومات المحسوبة"}),o.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-blue-700",children:"المدة الإجمالية:"}),o.jsxs("span",{className:"font-semibold text-blue-900",children:[" ",d.totalMonths," شهر"]})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-blue-700",children:"المدة المتبقية:"}),o.jsxs("span",{className:"font-semibold text-blue-900",children:[" ",d.remainingMonths," شهر"]})]})]})]}),o.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[o.jsx("button",{type:"button",onClick:t,className:"px-6 py-3 bg-slate-200 text-slate-700 rounded-lg hover:bg-slate-300 transition-colors font-medium",children:"إلغاء"}),o.jsx("button",{type:"submit",className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:n?"حفظ التعديلات":"إضافة القرض"})]})]})]})})})},yf=()=>{var $t,Gt,Ze,xt,Ht;const[t,e]=V.useState(!1),[n,s]=V.useState(Kt),[r,l]=V.useState(new Date().getFullYear()),[d,c]=V.useState(new Date().getMonth()+1),[f,u]=V.useState("summary"),[m,p]=V.useState({isLoading:!1,text:""}),[h,v]=V.useState(null),[E,A]=V.useState({isOpen:!1}),[I,R]=V.useState({}),[k,P]=V.useState({isOpen:!1}),[N,T]=V.useState({isOpen:!1}),[M,F]=V.useState({isOpen:!1}),[j,L]=V.useState({isOpen:!1}),[x,D]=V.useState({fromAccount:"",toAccount:"",amount:0,description:"",exchangeRate:1}),[B,ne]=V.useState(!1),[me,ie]=V.useState(""),[le,Y]=V.useState(null),[re,xe]=V.useState(!1),[he,Ce]=V.useState(!0);V.useEffect(()=>{(async()=>{Yo();try{Ru()}catch(H){console.warn("Firebase already initialized or error:",H)}const $=await je.onAuthStateChanged(async H=>{try{H?(console.log("✅ تم تسجيل دخول المستخدم:",H.email),Y(H),await Ue(H.uid)):(console.log("❌ لا يوجد مستخدم مسجل دخول"),Y(null),await Ge())}catch(z){console.error("خطأ في تحميل بيانات المستخدم:",z),await Ge()}finally{Ce(!1),e(!0)}});return()=>{typeof $=="function"&&$()}})()},[]),V.useEffect(()=>(E.isOpen||k.isOpen||N.isOpen||M.isOpen||j.isOpen||h||m.isLoading?document.body.classList.add("modal-open"):document.body.classList.remove("modal-open"),()=>{document.body.classList.remove("modal-open")}),[E.isOpen,k.isOpen,N.isOpen,M.isOpen,j.isOpen,h,m.isLoading]),V.useEffect(()=>{n.settings.darkMode?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark");const C=document.documentElement;n.settings.language==="ar"?(C.setAttribute("lang","ar"),C.setAttribute("dir","rtl")):(C.setAttribute("lang","en"),C.setAttribute("dir","ltr"))},[n.settings.darkMode,n.settings.language]),V.useEffect(()=>{var C,$;j.isOpen&&x.fromAccount&&x.toAccount&&((C=n.bankAccounts[x.fromAccount])==null?void 0:C.currency)!==(($=n.bankAccounts[x.toAccount])==null?void 0:$.currency)&&ht()},[x.fromAccount,x.toAccount,j.isOpen]);const Ue=async C=>{var $;try{const H=await je.getData("users",C);if(H.success&&H.data){const z=Kt(),Z={...z,...H.data,cards:{...z.cards,...H.data.cards||{}},bankAccounts:{...z.bankAccounts,...H.data.bankAccounts||{}},investments:{...z.investments,...H.data.investments||{}}};s(Z),console.log("✅ تم تحميل بيانات المستخدم من Firebase")}else H.success||(console.warn("⚠️ فشل في تحميل بيانات المستخدم من Firebase:",H.error),($=H.error)!=null&&$.includes("الأذونات")&&v({title:"تحذير - إعداد Firebase",body:`<p>فشل في تحميل البيانات من السحابة. يرجى:</p>
                               <ul>
                                 <li>تأكد من تسجيل الدخول</li>
                                 <li>تحقق من إعداد قواعد Firestore</li>
                                 <li>راجع ملف FIREBASE_SETUP.md للإرشادات</li>
                               </ul>
                               <p>سيتم استخدام البيانات المحلية مؤقتاً.</p>`,confirmText:"موافق",hideCancel:!0}))}catch(H){console.error("خطأ في تحميل بيانات المستخدم:",H)}},Ge=async()=>{try{const C=["financial_dashboard_state","financial_dashboard_backup_1","financial_dashboard_backup_2"];for(let z=0;z<7;z++){const Z=new Date;Z.setDate(Z.getDate()-z);const ae=Z.toISOString().split("T")[0];C.push(`financial_dashboard_${ae}`)}let $=null,H="";for(const z of C){const Z=localStorage.getItem(z);if(Z)try{JSON.parse(Z),$=Z,H=z;break}catch{console.warn(`⚠️ بيانات تالفة في ${z}`)}}if($){const z=JSON.parse($),Z=Kt(),ae={...Z,...z,cards:{...Z.cards,...z.cards||{}},bankAccounts:{...Z.bankAccounts,...z.bankAccounts||{}},investments:{...Z.investments,...z.investments||{}}};s(ae),console.log(`✅ تم تحميل البيانات بنجاح من: ${H}`)}else console.log("ℹ️ لم توجد بيانات محفوظة، سيتم استخدام البيانات الافتراضية")}catch(C){console.error("❌ خطأ في تحميل البيانات المحلية:",C)}};V.useEffect(()=>{if(t&&!he){try{const C=JSON.stringify(n);localStorage.setItem("financial_dashboard_state",C),localStorage.setItem("financial_dashboard_backup_1",C),localStorage.setItem("financial_dashboard_backup_2",C);const $=new Date().toISOString();localStorage.setItem(`financial_dashboard_${$.split("T")[0]}`,C),console.log("✅ تم حفظ البيانات في localStorage مع نسخ احتياطية متعددة")}catch(C){console.error("❌ خطأ في حفظ البيانات:",C)}if(le){const $=setTimeout(async()=>{try{const H=await je.saveData("users",le.uid,n);H.success?console.log("✅ تم حفظ البيانات في Firebase"):console.warn("⚠️ فشل في حفظ البيانات في Firebase:",H.error)}catch(H){console.error("❌ خطأ في حفظ البيانات في Firebase:",H)}},2e3);return()=>clearTimeout($)}}},[n,t,le,he]),V.useEffect(()=>{f!=="transactions"&&ut()},[f]);const ze=(C,$="")=>p({isLoading:C,text:$}),Ke=V.useCallback(()=>n.transactions?n.transactions.filter($=>{const H=new Date($.date),z=H.getFullYear()===r,Z=d==="all"||H.getMonth()+1===d;return z&&Z}).sort(($,H)=>{const z=new Date($.date),ae=new Date(H.date).getTime()-z.getTime();if(ae===0){const ke=parseInt($.id.replace("trans-","").split("-")[0]);return parseInt(H.id.replace("trans-","").split("-")[0])-ke}return ae}):[],[n.transactions,r,d]),Xe=V.useMemo(()=>n.transactions?[...n.transactions].sort((C,$)=>{const H=new Date(C.date),Z=new Date($.date).getTime()-H.getTime();if(Z===0){const ae=parseInt(C.id.replace("trans-","").split("-")[0]);return parseInt($.id.replace("trans-","").split("-")[0])-ae}return Z}):[],[n.transactions]),Se=V.useMemo(()=>Ke(),[Ke]),K=V.useMemo(()=>{const C={},$={},H={},z={};n.cards&&typeof n.cards=="object"&&Object.values(n.cards).forEach(X=>{X&&X.id&&(H[X.id]={...X,balance:0,available:X.limit,usagePercentage:0})}),n.bankAccounts&&typeof n.bankAccounts=="object"&&Object.values(n.bankAccounts).forEach(X=>{X&&X.id&&(z[X.id]={...X,deposits:0,withdrawals:0})});let Z=0,ae=0,ke=0,Oe=0;Se.forEach(X=>{if(X.type==="income")Z+=X.amount;else if(X.type==="expense")ae+=X.amount,X.categoryId&&(C[X.categoryId]=(C[X.categoryId]||0)+X.amount);else if(X.type==="bnpl-payment")ae+=X.amount,X.categoryId&&(C[X.categoryId]=(C[X.categoryId]||0)+X.amount);else if(X.type==="investment-deposit")ke+=X.amount,ae+=X.amount;else if(X.type==="investment-withdrawal")Oe+=X.amount,Z+=X.amount;else if(X.type.endsWith("-payment")){const ye=X.type.replace("-payment","");$[ye]?$[ye]+=X.amount:$[ye]=X.amount}}),Object.keys(n.cards).forEach(X=>{const ye=n.cards[X];let we=0;n.transactions.forEach(ve=>{var Me,ce,Jt,Ot,Yt;(Me=ve.description)!=null&&Me.includes(`سداد ${ye.name}`)||ve.type===`سداد ${ye.name}`||ve.type===`${X}-payment`?we-=ve.amount:(ve.paymentMethod===X&&((ce=ve.description)!=null&&ce.includes("سداد")||(Jt=ve.type)!=null&&Jt.includes("سداد")||(Ot=ve.type)!=null&&Ot.includes("-payment"))&&!((Yt=ve.description)!=null&&Yt.includes(ye.name))&&ve.type!==`سداد ${ye.name}`&&ve.type!==`${X}-payment`||ve.paymentMethod===X&&(ve.type==="expense"||ve.type==="bnpl-payment"))&&(we+=ve.amount)}),H[X].balance=we,H[X].available=ye.limit-we,H[X].usagePercentage=ye.limit>0?we/ye.limit*100:0}),Object.keys(n.bankAccounts).forEach(X=>{const ye=n.bankAccounts[X];let we=0,ve=0,Me=ye.balance;n.transactions.forEach(ce=>{ce.paymentMethod===X&&(["income","investment-withdrawal"].includes(ce.type)?Me+=ce.amount:["expense","investment-deposit"].includes(ce.type)&&(Me-=ce.amount)),ce.type.endsWith("-payment")&&ce.paymentMethod===X&&(Me-=ce.amount),ce.type==="expense"&&ce.isInstallmentPayment&&ce.paymentMethod===X&&(Me-=ce.amount)}),Se.forEach(ce=>{ce.paymentMethod===X&&(["income","investment-withdrawal"].includes(ce.type)?we+=ce.amount:["expense","investment-deposit"].includes(ce.type)&&(ve+=ce.amount)),ce.type.endsWith("-payment")&&ce.paymentMethod===X&&(ve+=ce.amount),ce.type==="expense"&&ce.isInstallmentPayment&&ce.paymentMethod===X&&(ve+=ce.amount)}),z[X].balance=Me,z[X].deposits=we,z[X].withdrawals=ve});const yt=Object.values(H).reduce((X,ye)=>X+ye.balance,0),vt=Object.values(H).reduce((X,ye)=>X+ye.available,0),bt=Object.values(H).reduce((X,ye)=>X+ye.limit,0),et=Object.values(z).reduce((X,ye)=>X+ye.balance,0);return{totalIncome:Z,totalExpenses:ae,cardDetails:H,cardPayments:$,bankAccountDetails:z,totalDebt:yt,totalAvailable:vt,totalLimits:bt,totalBankBalance:et,totalInvestmentDeposits:ke,totalInvestmentWithdrawals:Oe,expensesByCategory:C}},[Se,n.transactions,n.cards,n.bankAccounts]),te=(C,$)=>{s(H=>{if($){const z=H.transactions.map(Z=>Z.id===$?{...Z,...C}:Z);return{...H,transactions:z}}else if(C.bnplData&&C.paymentMethod.includes("bnpl")){const z={id:`installment-${Date.now()}`,provider:C.paymentMethod,description:C.description,totalAmount:C.amount,installmentAmount:C.bnplData.installmentAmount,total:C.bnplData.installmentsCount,paid:1,createdAt:C.date},Z={id:`trans-${Date.now()}-1`,amount:C.bnplData.installmentAmount,date:C.date,description:`الدفعة الأولى لـ: ${C.description}`,paymentMethod:C.bnplData.initialPaymentSource,type:"expense",categoryId:C.categoryId,isInstallmentPayment:!0,installmentId:z.id};return{...H,transactions:[...H.transactions,Z],installments:[...H.installments,z]}}else{const z={id:`trans-${Date.now()}`,...C};return{...H,transactions:[...H.transactions,z]}}}),A({isOpen:!1})},pe=C=>{v({title:"تأكيد الحذف",body:"<p>هل أنت متأكد من رغبتك في حذف هذه الحركة؟ لا يمكن التراجع عن هذا الإجراء.</p>",confirmText:"نعم, حذف",onConfirm:()=>{s($=>{const H=$.transactions.find(ae=>ae.id===C);if(!H)return $;const z=$.transactions.filter(ae=>ae.id!==C);let Z=$.installments;return H.isInstallmentPayment&&H.installmentId&&(Z=$.installments.map(ae=>ae.id===H.installmentId?{...ae,paid:Math.max(0,ae.paid-1)}:ae)),{...$,transactions:z,installments:Z}}),v(null)}})},He=C=>{const $=n.transactions.find(H=>H.id===C);$&&A({isOpen:!0,initialData:$})},Je=(C,$)=>{R({categoryId:C,monthFilter:$}),u("transactions")},ut=()=>{R({})},It=async C=>{Y(C),xe(!1),await Ue(C.uid)},Pe=async()=>{try{const C=await je.signOut();C.success?(console.log("✅ تم تسجيل الخروج بنجاح"),Y(null),await Ge()):console.error("❌ خطأ في تسجيل الخروج:",C.error)}catch(C){console.error("❌ خطأ في تسجيل الخروج:",C)}},fn=(C,$)=>{s(H=>{const z={...H.cards};if($)z[$]={...z[$],...C,id:$};else{const Z=`card-${Date.now()}`;z[Z]={...C,id:Z}}return{...H,cards:z}}),P({isOpen:!1})},Rt=C=>{var $;n.transactions.some(H=>H.paymentMethod===C||H.type===`${C}-payment`)?v({title:"لا يمكن الحذف",body:"<p>لا يمكن حذف هذه البطاقة لأنها مستخدمة في بعض الحركات. يرجى تعديل الحركات أولاً.</p>",hideCancel:!0,confirmText:"موافق"}):v({title:"تأكيد الحذف",body:`<p>هل أنت متأكد من رغبتك في حذف بطاقة "${($=n.cards[C])==null?void 0:$.name}"؟</p>`,confirmText:"نعم, حذف",onConfirm:()=>{s(H=>{const z={...H.cards};return delete z[C],{...H,cards:z}}),v(null)}})},Qe=(C,$)=>{s(H=>{const z={...H.bankAccounts};if($)z[$]={...z[$],...C,id:$};else{const Z=`bank-${Date.now()}`;z[Z]={...C,id:Z}}return{...H,bankAccounts:z}}),T({isOpen:!1})},ft=C=>{var $;n.transactions.some(H=>H.paymentMethod===C)?v({title:"لا يمكن الحذف",body:"<p>لا يمكن حذف هذا الحساب لأنه مستخدم في بعض الحركات. يرجى تعديل الحركات أولاً.</p>",hideCancel:!0,confirmText:"موافق"}):v({title:"تأكيد الحذف",body:`<p>هل أنت متأكد من رغبتك في حذف حساب "${($=n.bankAccounts[C])==null?void 0:$.name}"؟</p>`,confirmText:"نعم, حذف",onConfirm:()=>{s(H=>{const z={...H.bankAccounts};return delete z[C],{...H,bankAccounts:z}}),v(null)}})},mt=C=>{v({title:"استعادة نسخة احتياطية",body:"<p>هل أنت متأكد من استعادة هذه البيانات؟ سيتم استبدال جميع البيانات الحالية.</p>",confirmText:"استعادة",cancelText:"إلغاء",onConfirm:()=>{try{const $=Kt();if(C.creditCards&&!C.cards){const z={};Object.entries(C.creditCards).forEach(([Z,ae])=>{z[Z]={id:Z,name:Z.toUpperCase(),limit:ae.creditLimit||0,balance:ae.currentBalance||0,dueDay:ae.dueDay||1,smsSamples:[],keywords:[]}}),C.cards=z}if(C.cards&&typeof C.cards=="object"&&(C.cards.snb||C.cards.enbd)){const z={};C.cards.snb&&(z["snb-card"]={id:"snb-card",name:"SNB الأهلي",limit:C.cards.snb.limit||0,dueDay:C.cards.snb.dueDay||1,statementDay:25,smsSamples:["SNB","الأهلي","إئتمانية"]}),C.cards.enbd&&(z["enbd-card"]={id:"enbd-card",name:"ENBD الإمارات",limit:C.cards.enbd.limit||0,dueDay:C.cards.enbd.dueDay||1,statementDay:28,smsSamples:["ENBD","الإمارات","Visa card"]}),C.cards=z}C.bank&&!C.bankAccounts&&(C.bankAccounts={"bank-default":{id:"bank-default",name:"حساب البنك",balance:C.bank.balance||0,smsSamples:["مدى","mada","Alrajhi","الراجحي","Inma","الإنماء","بنك"]}}),C.transactions&&Array.isArray(C.transactions)&&(C.transactions=C.transactions.map(z=>z.paymentMethod==="mada-bank"?{...z,paymentMethod:"bank-default"}:z));const H={...$,...C};s(H),le&&(async()=>{try{const Z=await je.saveData("users",le.uid,H);Z.success?console.log("✅ تم حفظ البيانات المستعادة في Firebase"):console.warn("⚠️ فشل في حفظ البيانات في Firebase:",Z.error)}catch(Z){console.error("❌ خطأ في حفظ البيانات في Firebase:",Z)}})(),v({title:"تم الاستعادة بنجاح",body:"<p>تم استعادة بياناتك بنجاح وحفظها في السحابة.</p>",confirmText:"موافق",hideCancel:!0})}catch{v({title:"خطأ في الاستعادة",body:"<p>حدث خطأ أثناء استعادة البيانات. يرجى المحاولة مرة أخرى.</p>",confirmText:"موافق",hideCancel:!0})}}})},pt=C=>P({isOpen:!0,initialData:C?n.cards[C]:null}),Pt=C=>T({isOpen:!0,initialData:C?n.bankAccounts[C]:null}),Mt=C=>F({isOpen:!0,initialData:C?n.loans[C]:null}),kt=()=>{s(C=>({...C,settings:{...C.settings,darkMode:!C.settings.darkMode}}))},Dt=()=>{s(C=>({...C,settings:{...C.settings,notifications:!C.settings.notifications}}))},Lt=async()=>{try{if(await ku(n))v({title:"✅ تم بنجاح",body:"<p>تم حفظ جميع البيانات في السحابة بنجاح!</p>",confirmText:"موافق"});else throw new Error("فشل في حفظ البيانات")}catch{v({title:"❌ خطأ",body:"<p>حدث خطأ أثناء حفظ البيانات في السحابة. يرجى المحاولة مرة أخرى.</p>",confirmText:"موافق"})}},Ft=async()=>{try{const C=await Du();if(C.success)window.location.reload(),v({title:"✅ تم بنجاح",body:`<p>${C.message}</p><p>تم تحديث البيانات بنجاح!</p>`,confirmText:"موافق"});else throw new Error(C.message)}catch(C){v({title:"❌ خطأ",body:`<p>${C.message}</p>`,confirmText:"موافق"})}},Ut=async()=>{try{if(await Lu())v({title:"✅ تم بنجاح",body:"<p>تم تحميل ملف النسخة الاحتياطية بنجاح!</p>",confirmText:"موافق"});else throw new Error("فشل في تحميل النسخة الاحتياطية")}catch{v({title:"❌ خطأ",body:"<p>حدث خطأ أثناء تحميل النسخة الاحتياطية.</p>",confirmText:"موافق"})}},jt=C=>{const $=C.target.files[0];$&&Fu($).then(H=>{if(H.success)window.location.reload(),v({title:"✅ تم بنجاح",body:`<p>${H.message}</p><p>تم تحديث البيانات بنجاح!</p>`,confirmText:"موافق"});else throw new Error(H.message)}).catch(H=>{v({title:"❌ خطأ",body:`<p>${H.message}</p>`,confirmText:"موافق"})})},Vt=()=>{s(C=>({...C,settings:{...C.settings,language:C.settings.language==="ar"?"en":"ar"}}))},Bt=()=>{if(!x.fromAccount||!x.toAccount||x.amount<=0){v({title:"خطأ",body:"<p>يرجى ملء جميع البيانات بشكل صحيح.</p>",hideCancel:!0,confirmText:"موافق"});return}if(x.fromAccount===x.toAccount){v({title:"خطأ",body:"<p>لا يمكن التحويل لنفس الحساب.</p>",hideCancel:!0,confirmText:"موافق"});return}const C=n.bankAccounts[x.fromAccount],$=n.bankAccounts[x.toAccount],H=n.cards[x.fromAccount],z=n.cards[x.toAccount],Z=C||H,ae=$||z,ke=x.amount*x.exchangeRate,Oe=H?`${x.fromAccount}-payment`:"expense",yt=z?`${x.toAccount}-payment`:"income",vt={id:`trans-${Date.now()}-withdrawal`,amount:x.amount,date:new Date().toISOString().split("T")[0],description:`تحويل إلى ${(ae==null?void 0:ae.name)||"حساب آخر"}: ${x.description}${x.exchangeRate!==1?` (معدل: ${x.exchangeRate})`:""}`,paymentMethod:x.fromAccount,type:Oe,categoryId:null},bt={id:`trans-${Date.now()}-deposit`,amount:ke,date:new Date().toISOString().split("T")[0],description:`تحويل من ${(Z==null?void 0:Z.name)||"حساب آخر"}: ${x.description}${x.exchangeRate!==1?` (معدل: ${x.exchangeRate})`:""}`,paymentMethod:x.toAccount,type:yt,categoryId:null};s(et=>({...et,transactions:[...et.transactions,vt,bt]})),L({isOpen:!1}),D({fromAccount:"",toAccount:"",amount:0,description:"",exchangeRate:1}),ie(""),v({title:"نجح التحويل",body:"<p>تم التحويل بنجاح!</p>",hideCancel:!0,confirmText:"موافق"})},qt=C=>{if(s($=>({...$,loans:{...$.loans,[C.id]:C}})),!C.id.includes("edit")){const $=[];C.downPayment>0&&$.push({id:`trans-${Date.now()}-down-payment`,amount:C.downPayment,date:C.startDate,description:`دفعة أولى - ${C.name}`,paymentMethod:C.linkedAccount||"cash",type:"expense",categoryId:null}),$.push({id:`trans-${Date.now()}-loan-deposit`,amount:C.totalAmount,date:C.startDate,description:`إيداع قرض - ${C.name} من ${C.lender}`,paymentMethod:C.linkedAccount||"cash",type:"income",categoryId:null}),C.finalPayment>0&&C.endDate&&$.push({id:`trans-${Date.now()}-final-payment`,amount:C.finalPayment,date:C.endDate,description:`دفعة أخيرة - ${C.name}`,paymentMethod:C.linkedAccount||"cash",type:"expense",categoryId:null}),s(H=>({...H,transactions:[...H.transactions,...$]}))}F({isOpen:!1}),v({title:"تم إضافة القرض بنجاح",body:"<p>تم إضافة القرض والحركات المرتبطة به بنجاح!</p>",hideCancel:!0,confirmText:"موافق"})},ht=async()=>{if(!x.fromAccount||!x.toAccount)return;const C=n.bankAccounts[x.fromAccount],$=n.bankAccounts[x.toAccount];if(!C||!$)return;const H=C.currency||"SAR",z=$.currency||"SAR";if(H===z){D(Z=>({...Z,exchangeRate:1})),ie("");return}ne(!0),ie("");try{const Z=await Ko(H,z);D(ae=>({...ae,exchangeRate:Z.rate}))}catch(Z){ie(Z instanceof Error?Z.message:"فشل في الحصول على معدل التحويل"),console.error("Exchange rate error:",Z)}finally{ne(!1)}};if(!t||he)return o.jsx(zu,{});if(!le)return o.jsx("div",{className:"bg-slate-100 min-h-screen font-sans flex items-center justify-center",children:o.jsxs("div",{className:"w-full max-w-md px-4",children:[o.jsxs("div",{className:"text-center mb-8",children:[o.jsx("div",{className:"w-16 h-16 bg-blue-500/10 rounded-2xl flex items-center justify-center text-3xl mx-auto mb-4",children:"💰"}),o.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"لوحة التحكم المالية"}),o.jsx("p",{className:"text-slate-600 mt-2",children:"قم بتسجيل الدخول للوصول لنظام إدارة المصاريف"})]}),o.jsx(co,{onSuccess:It,onClose:()=>{},hideCloseButton:!0})]})});`${r}${d==="all"?"كل الشهور":new Date(r,d-1).toLocaleString("ar-SA",{month:"long"})}`;const gt=()=>{switch(f){case"summary":return o.jsx(Qu,{calculations:K,categories:n.categories,state:n,darkMode:n.settings.darkMode,language:n.settings.language,onNavigateToTransactions:Je});case"transactions":return o.jsx(Zu,{transactions:Se,allTransactions:Xe,categories:n.categories,deleteTransaction:pe,editTransaction:He,state:n,darkMode:n.settings.darkMode,language:n.settings.language,initialCategoryFilter:I.categoryId,initialMonthFilter:I.monthFilter});case"ai-assistant":return o.jsx(tf,{calculations:K,filteredTransactions:Se,allTransactions:Xe,state:n,darkMode:n.settings.darkMode,language:n.settings.language});case"analysis":return o.jsx(nf,{calculations:K,categories:n.categories,allTransactions:n.transactions,darkMode:n.settings.darkMode,language:n.settings.language});case"budget":return o.jsx(sf,{state:n,setLoading:ze,setModal:v,darkMode:n.settings.darkMode,language:n.settings.language});case"investment":return o.jsx(of,{state:n,setState:s,calculations:K,setModal:v,darkMode:n.settings.darkMode,language:n.settings.language});case"cards":return o.jsx(af,{state:n,calculations:K,openCardFormModal:pt,deleteCard:Rt,darkMode:n.settings.darkMode,language:n.settings.language});case"bank":return o.jsx(cf,{state:n,setState:s,calculations:K,filteredTransactions:Se,categories:n.categories,setModal:v,openBankAccountFormModal:Pt,deleteBankAccount:ft,openTransferModal:()=>L({isOpen:!0}),darkMode:n.settings.darkMode,language:n.settings.language});case"installments":return o.jsx(uf,{state:n,setState:s,filteredTransactions:Se,setModal:v,darkMode:n.settings.darkMode,language:n.settings.language});case"debts-loans":return o.jsx(ff,{state:n,setState:s,setModal:v,openLoanFormModal:Mt,darkMode:n.settings.darkMode,language:n.settings.language});case"settings":return o.jsx(mf,{state:n,setState:s,setModal:v,setLoading:ze,onRestore:mt,darkMode:n.settings.darkMode,language:n.settings.language,onSaveToCloud:Lt,onRestoreFromCloud:Ft,onDownloadBackup:Ut,onRestoreFromFile:jt});default:return o.jsx("div",{children:"Tab not found"})}};return o.jsxs("div",{className:`min-h-screen font-sans ${n.settings.darkMode?"dark":""}`,children:[o.jsx(Ju,{selectedYear:r,selectedMonth:d,onYearChange:l,onMonthChange:C=>c(C),onAddTransaction:()=>A({isOpen:!0}),currentUser:le,onSignOut:Pe,language:n.settings.language,darkMode:n.settings.darkMode,notifications:n.settings.notifications,onToggleDarkMode:kt,onToggleNotifications:Dt,onToggleLanguage:Vt}),o.jsxs("main",{className:"container mx-auto px-2 sm:px-4 max-w-7xl mt-8 mb-20",children:[o.jsx(Yu,{activeTab:f,setActiveTab:u,language:n.settings.language}),gt()]}),o.jsx("button",{onClick:()=>A({isOpen:!0}),className:"md:hidden fixed bottom-24 right-4 bg-blue-600 text-white w-14 h-14 rounded-full shadow-lg flex items-center justify-center z-40 text-2xl",children:"+"}),E.isOpen&&o.jsx(pf,{onClose:()=>A({isOpen:!1}),onSave:te,initialData:E.initialData,categories:n.categories,cards:n.cards,bankAccounts:n.bankAccounts,loans:n.loans,setModalConfig:v,darkMode:n.settings.darkMode,language:n.settings.language}),k.isOpen&&o.jsx(hf,{onClose:()=>P({isOpen:!1}),onSave:fn,initialData:k.initialData}),N.isOpen&&o.jsx(gf,{onClose:()=>T({isOpen:!1}),onSave:Qe,initialData:N.initialData}),M.isOpen&&o.jsx(xf,{onClose:()=>F({isOpen:!1}),onSave:qt,initialData:M.initialData,bankAccounts:n.bankAccounts}),j.isOpen&&o.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[9999] flex items-center justify-center p-4",onClick:()=>{L({isOpen:!1}),D({fromAccount:"",toAccount:"",amount:0,description:"",exchangeRate:1}),ie("")},children:o.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-xl w-full max-w-lg animate-fade-in max-h-[90vh] overflow-y-auto",onClick:C=>C.stopPropagation(),children:o.jsxs("div",{className:"p-6",children:[o.jsxs("div",{className:"flex justify-between items-center mb-6",children:[o.jsx("h2",{className:"text-2xl font-bold text-slate-800 dark:text-slate-100",children:"💸 تحويل بين الحسابات"}),o.jsx("button",{onClick:()=>{L({isOpen:!1}),D({fromAccount:"",toAccount:"",amount:0,description:"",exchangeRate:1}),ie("")},className:"text-slate-400 hover:text-slate-600",children:"✕"})]}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"fromAccount",className:"block text-sm font-medium text-slate-600 mb-1",children:"من الحساب"}),o.jsxs("select",{id:"fromAccount",name:"fromAccount",value:x.fromAccount,onChange:C=>D($=>({...$,fromAccount:C.target.value})),className:"w-full p-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[o.jsx("option",{value:"",children:"اختر الحساب المصدر"}),Object.entries(n.bankAccounts).map(([C,$])=>o.jsxs("option",{value:C,children:["🏦 ",$.name]},C)),Object.entries(n.cards).map(([C,$])=>o.jsxs("option",{value:C,children:["💳 ",$.name]},C))]})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"toAccount",className:"block text-sm font-medium text-slate-600 mb-1",children:"إلى الحساب"}),o.jsxs("select",{id:"toAccount",name:"toAccount",value:x.toAccount,onChange:C=>D($=>({...$,toAccount:C.target.value})),className:"w-full p-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[o.jsx("option",{value:"",children:"اختر الحساب الهدف"}),Object.entries(n.bankAccounts).filter(([C])=>C!==x.fromAccount).map(([C,$])=>o.jsxs("option",{value:C,children:["🏦 ",$.name]},C)),Object.entries(n.cards).filter(([C])=>C!==x.fromAccount).map(([C,$])=>o.jsxs("option",{value:C,children:["💳 ",$.name]},C))]})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"amount",className:"block text-sm font-medium text-slate-600 mb-1",children:"المبلغ"}),o.jsx("input",{type:"number",id:"amount",name:"amount",step:"0.01",value:x.amount,onChange:C=>D($=>({...$,amount:parseFloat(C.target.value)||0})),className:"w-full p-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0.00",required:!0})]}),x.fromAccount&&x.toAccount&&(($t=n.bankAccounts[x.fromAccount])==null?void 0:$t.currency)!==((Gt=n.bankAccounts[x.toAccount])==null?void 0:Gt.currency)&&o.jsxs("div",{children:[o.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:["💱 معدل التحويل (",(Ze=n.bankAccounts[x.fromAccount])==null?void 0:Ze.currency," → ",(xt=n.bankAccounts[x.toAccount])==null?void 0:xt.currency,")"]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx("input",{type:"number",step:"0.0001",value:x.exchangeRate,onChange:C=>D($=>({...$,exchangeRate:parseFloat(C.target.value)||1})),className:"flex-1 px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"1.0000"}),o.jsxs("button",{type:"button",onClick:ht,disabled:B,className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 transition-colors flex items-center gap-2",title:"تحديث معدل التحويل تلقائياً",children:[B?o.jsx("div",{className:"w-4 h-4 border-2 border-t-transparent border-white rounded-full animate-spin"}):"🔄",o.jsx("span",{className:"hidden sm:inline",children:"تحديث"})]})]}),me&&o.jsx("p",{className:"text-red-500 text-xs mt-1",children:me}),o.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["المبلغ المحول: ",(x.amount*x.exchangeRate).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})," ",(Ht=n.bankAccounts[x.toAccount])==null?void 0:Ht.currency]})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-slate-600 mb-1",children:"الوصف (اختياري)"}),o.jsx("input",{type:"text",id:"description",name:"description",value:x.description,onChange:C=>D($=>({...$,description:C.target.value})),className:"w-full p-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"مثل: تحويل للطوارئ"})]})]}),o.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[o.jsx("button",{type:"button",onClick:()=>{L({isOpen:!1}),D({fromAccount:"",toAccount:"",amount:0,description:"",exchangeRate:1}),ie("")},className:"px-4 py-2 bg-slate-200 rounded-lg hover:bg-slate-300 transition-colors",children:"إلغاء"}),o.jsx("button",{type:"button",onClick:Bt,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"تحويل"})]})]})})}),h&&o.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[10001] flex items-center justify-center p-4",onClick:()=>v(null),children:o.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl w-full max-w-md mx-4 animate-fade-in max-h-[90vh] overflow-y-auto",onClick:C=>C.stopPropagation(),children:[o.jsx("h3",{className:"text-xl font-bold text-slate-800 dark:text-slate-100 mb-4",children:h.title}),o.jsx("div",{className:"text-slate-600 dark:text-slate-300",dangerouslySetInnerHTML:{__html:h.body}}),o.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[!h.hideCancel&&o.jsx("button",{onClick:()=>v(null),className:"px-4 py-2 bg-slate-200 rounded-lg",children:"إلغاء"}),o.jsx("button",{onClick:()=>{(!h.onConfirm||h.onConfirm()!==!1)&&v(null)},className:"px-4 py-2 bg-blue-600 text-white rounded-lg",children:h.confirmText||"موافق"})]})]})}),m.isLoading&&o.jsxs("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[10001] flex flex-col items-center justify-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white"}),o.jsx("p",{className:"text-white mt-4",children:m.text||"جاري التحميل..."})]}),re&&le&&o.jsx(co,{onSuccess:It,onClose:()=>xe(!1)})]})},si=document.getElementById("root");if(!si)throw new Error("Could not find root element");const vf=Tn.createRoot(si);vf.render(o.jsx(Dn.StrictMode,{children:o.jsx(yf,{})}));"serviceWorker"in navigator&&(window.addEventListener("load",()=>{navigator.serviceWorker.register("./fd/sw.js").then(t=>{console.log("✅ Service Worker registered successfully:",t),t.addEventListener("updatefound",()=>{const e=t.installing;e&&e.addEventListener("statechange",()=>{e.state==="installed"&&navigator.serviceWorker.controller&&confirm("تحديث جديد متاح. هل تريد إعادة تحميل الصفحة؟")&&window.location.reload()})})}).catch(t=>{console.error("❌ Service Worker registration failed:",t)})}),navigator.serviceWorker.addEventListener("controllerchange",()=>{window.location.reload()}));let Et;window.addEventListener("beforeinstallprompt",t=>{console.log("PWA install prompt available"),t.preventDefault(),Et=t;const e=document.createElement("button");e.textContent="تثبيت التطبيق",e.className="fixed bottom-4 right-4 bg-blue-600 text-white px-4 py-2 rounded-lg shadow-lg z-50",e.onclick=()=>{Et&&(Et.prompt(),Et.userChoice.then(n=>{n.outcome==="accepted"?console.log("✅ User accepted the install prompt"):console.log("❌ User dismissed the install prompt"),Et=null,e.remove()}))},document.body.appendChild(e)});window.addEventListener("appinstalled",()=>{console.log("✅ PWA was installed");const t=document.querySelector("button[onclick]");t&&t.remove()});
